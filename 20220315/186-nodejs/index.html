<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><meta name="keywords" data-name="fire" content="JavaScript,Vue.js,小程序,WebPack,ECMAScript 6,vue,php,js,JavaScript,typescirpt,node,egg,很帅很愁人,web前端,全栈,网页,博客，前端博客,JavaScript,html5,css3,Jquery,NodeJs
"><meta name="360-site-verification" content="178e3a7a27a16a1253976882a4d99509"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/fly-32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/fly-16.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="iy8yHMd-90Qb6NAJqgoij_Cz3i3Jh9FRGRxrWJbRrOw"><meta name="msvalidate.01" content="92E59C28288B8049A45C6288AD39DFA0"><meta name="baidu-site-verification" content="code-etAIIwOVpZ"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"blog.wy1991.cn",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!0,sidebar:{position:"left",display:"hide",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="nodejs"><meta property="og:type" content="article"><meta property="og:title" content="186-nodejs"><meta property="og:url" content="https://blog.wy1991.cn/20220315/186-nodejs/index.html"><meta property="og:site_name" content="很帅很愁人~"><meta property="og:description" content="nodejs"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2022-03-15T08:24:02.000Z"><meta property="article:modified_time" content="2022-03-15T08:24:56.737Z"><meta property="article:author" content="很帅很愁人~"><meta property="article:tag" content="nodejs"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://blog.wy1991.cn/20220315/186-nodejs/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>186-nodejs | 很帅很愁人~</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><script src="/js/fairyDustCursor.js"></script><script src="/js/clickLove.js"></script></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">很帅很愁人~</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">迷茫是因为才华配不上梦想の，所以你必须非常努力，才能显得毫不费力！</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-学习"><a href="/19410322/999999-%E6%9C%89%E7%82%B9%E5%A5%BD%E7%8E%A9/" rel="section"><i class="fa fa-calendar fa-fw"></i>学习</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.wy1991.cn/20220315/186-nodejs/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/my.jpg"><meta itemprop="name" content="很帅很愁人~"><meta itemprop="description" content="梦是一种欲望, 想是一种行动。梦想是梦与想的结晶，加油打工人~~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="很帅很愁人~"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">186-nodejs</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-03-15 16:24:02 / 修改时间：16:24:56" itemprop="dateCreated datePublished" datetime="2022-03-15T16:24:02+08:00">2022-03-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/nodejs/" itemprop="url" rel="index"><span itemprop="name">nodejs</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span></span><div class="post-description" style="opacity:0">nodejs</div></div></header><div class="post-body" itemprop="articleBody"><h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><p>官网：nodejs.org</p><ul><li>LTS：长期支持版本，相对稳定一些，推荐线上环境使用该版本</li><li>Current：最新的 node 版本，包含很多新特性（学习阶段使用）</li></ul><p>安装 node 时会自动安装 npm 工具包</p><p>REPL：Read-Eval-Print- Loop，读取-求值-输出 循环，简单的、交互式的编程环境</p><h3 id="全局对象和模块化开发"><a href="#全局对象和模块化开发" class="headerlink" title="全局对象和模块化开发"></a>全局对象和模块化开发</h3><p>清空控制台：console.clear</p><p>打印函数的调用栈：console.trace</p><h4 id="全局对象"><a href="#全局对象" class="headerlink" title="全局对象"></a>全局对象</h4><h5 id="特殊的全局对象"><a href="#特殊的全局对象" class="headerlink" title="特殊的全局对象"></a>特殊的全局对象</h5><p>这些全局对象可以在模块中任意使用(每个模块都有，看起来像全局对象)，但是在命令行交互中是不可以使用的</p><p>__dirname、__filename、exports、module、require()</p><ul><li><p>__dirname:获取当前文件所在的路径，不包括后面的文件名</p></li><li><p>__filename：获取当前文件所在的路径和文件名称，包括后面的文件名称</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(__dirname) <span class="comment">/* 打印当前文件所在目录：E:\Web\Node */</span></span><br><span class="line"><span class="built_in">console</span>.log(__filename) <span class="comment">/* 打印当前路径+文件名：E:\Web\Node\index.js */</span></span><br></pre></td></tr></table></figure><h5 id="常见的全局对象"><a href="#常见的全局对象" class="headerlink" title="常见的全局对象"></a>常见的全局对象</h5><ul><li><p>process 对象：process 提供了 Node 进程中相关的信息：</p><ul><li>比如 Node 的运行环境、参数信息等；</li></ul></li><li><p>console 对象：提供了简单的调试控制台</p></li><li><p>定时器函数：在 Node 中使用定时器有好几种方式</p><ul><li>setTimeout( fn , 1000)：fn 在 1000 毫秒后执行一次；</li><li>setInterval( fn , 1000)：fn 每 1000 毫秒重复执行一次；</li><li>setImmediate(callback[, …args])：callbackI / O 事件后的回调的“立即”执行</li><li>process.nextTick(callback[, …args])：添加到下一次 tick 队列中；</li></ul></li></ul><h5 id="global-对象"><a href="#global-对象" class="headerlink" title="global 对象"></a>global 对象</h5><p>是一个全局对象，process、console、setTimeout 等都有被放到 global 中</p><p>和 window 的区别：</p><ul><li>在浏览器中，全局变量都是在 window 上的，比如有 document、setInterval、setTimeout、alert、console 等等</li><li>浏览器顶层 var 定义一个变量会默认添加到 window 对象上，node 中不会，只是当前模块的中的变量，不会放到全局中</li></ul><h4 id="JS-模块化"><a href="#JS-模块化" class="headerlink" title="JS 模块化"></a>JS 模块化</h4><p>模块化：将程序划分成一个个小的结构</p><p>Node 中对 CommonJS 进行了支持和实现：</p><ul><li>在 Node 中每一个 js 就是一个单独的模块</li><li>模块的包含 CommonJS 规范的核心变量：exports、module.exports、require<ul><li>exports 和 module.exports 可以负责对模块中的内容进行导出；</li><li>require 函数可以帮助我们导入其他模块（自定义模块、系统模块、第三方库模块）中的内容；</li></ul></li><li>可以使用这些变量进行模块化开发</li><li>每个模块里面都有一个 exports 对象，默认指向一个空对象</li><li>Node 中实现 commonJS 的本质就是引用赋值</li></ul><h5 id="exports"><a href="#exports" class="headerlink" title="exports"></a>exports</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bar.js</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;coderwhy&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Hello,&#x27;</span> + name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.name = name <span class="comment">/* 想把谁导出就往exports上加属性(属性自己取名) */</span></span><br><span class="line"><span class="built_in">exports</span>.age = age</span><br><span class="line"><span class="built_in">exports</span>.sayHello = sayHello</span><br><span class="line"></span><br><span class="line"><span class="comment">//main.js</span></span><br><span class="line"><span class="keyword">const</span> bar = <span class="built_in">require</span>(<span class="string">&#x27;./bar&#x27;</span>) <span class="comment">/**返回一个exports对象 */</span></span><br><span class="line"><span class="comment">// 实质： bar = &#123;name, age, sayHello&#125;</span></span><br><span class="line"><span class="comment">// const &#123;name, age, sayHello&#125; = require(&#x27;./bar&#x27;); //对象的解构</span></span><br><span class="line"><span class="built_in">console</span>.log(bar.name)</span><br><span class="line"><span class="built_in">console</span>.log(bar.sayHello(<span class="string">&#x27;World&#x27;</span>))</span><br><span class="line"><span class="comment">//bar对象是exports对象的浅层拷贝(引用赋值)</span></span><br></pre></td></tr></table></figure><h5 id="module-exports"><a href="#module-exports" class="headerlink" title="module.exports"></a>module.exports</h5><p>一个 js 文件就是一个模块，每一个模块都是 Module 的一个实例</p><p>module.exports = exports (一个对象，赋值的操作在顶层)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">//使用此种方式导出时，与exports就没关系了</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;abc&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="attr">sayHello</span>: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;hello, &#x27;</span> + name)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="require-细节"><a href="#require-细节" class="headerlink" title="require 细节"></a>require 细节</h5><p>require 是一个函数</p><p>require 查找规则(导入格式如下：require(x) ):</p><ul><li><p><input disabled type="checkbox"> x 是一个核心模块，比如 path、http</p><ul><li><input disabled type="checkbox"> 直接返回核心模块，并且停止查找</li></ul></li><li><p><input disabled type="checkbox"> X 是以 ./ 或 ../ 或 /（根目录）开头的</p><ol><li>将 X 当做一个文件在对应的目录下查找<ul><li><input disabled type="checkbox"> 如果有后缀名，按照后缀名的格式查找对应的文件</li><li><input disabled type="checkbox"> 如果没有后缀名，会按照如下顺序：<ul><li><input disabled type="checkbox"> 直接查找文件 X</li><li><input disabled type="checkbox"> 查找 X.js 文件</li><li><input disabled type="checkbox"> 查找 X.json 文件</li><li><input disabled type="checkbox"> 查找 X.node 文件</li></ul></li></ul></li><li>没有找到对应的文件，将 X 作为一个目录<ul><li><input disabled type="checkbox"> 查找目录下面的 index 文件（查找 X/index.js 文件 &gt; 查找 X/index.json 文件 &gt; 查找 X/index.node 文件）</li></ul></li><li>如果没有找到，那么报错：not found</li></ol></li><li><p><input disabled type="checkbox"> 直接是一个 X（没有路径），并且 X 不是一个核心模块</p><ul><li><input disabled type="checkbox"> 会在每一层目录里面的 node_modules 里查找第三方模块</li><li><input disabled type="checkbox"> 如果找到根目录也没找到，报错 not found</li></ul></li></ul><h5 id="模块的加载过程"><a href="#模块的加载过程" class="headerlink" title="模块的加载过程"></a>模块的加载过程</h5><ul><li><input disabled type="checkbox"> 模块在被第一次引入时，模块中的 js 代码会被运行一次</li><li><input disabled type="checkbox"> 模块被多次引入时，会缓存，最终只加载（运行）一次<ul><li><input disabled type="checkbox"> 是因为每个模块对象 module 都有一个属性：loaded，为 false 表示还没有加载，为 true 表示已经加载；</li></ul></li><li><input disabled type="checkbox"> 如果有循环引入，node 采用深度优先算法加载</li></ul><h5 id="ES-Module"><a href="#ES-Module" class="headerlink" title="ES Module"></a>ES Module</h5><p>ES Module 模块采用 export 和 import 关键字来实现模块化</p><ul><li><input disabled type="checkbox"> export 负责将模块内的内容导出</li><li><input disabled type="checkbox"> import 负责从其他模块导入内容</li><li><input disabled type="checkbox"> ES Module 将自动采用严格模式(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvU3RyaWN0X21vZGU=">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode<i class="fa fa-external-link-alt"></i></span>)</li></ul><p><strong>导出导入方式</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//export导出的是引用(地址)，不是值</span></span><br><span class="line"><span class="comment">//导出方式一</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="string">&#x27;dsad&#x27;</span></span><br><span class="line"><span class="comment">//导出方式二</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="comment">//此处为大括号，不是对象,里面放要导出的变量的引用列表</span></span><br><span class="line">  name,</span><br><span class="line">  age,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//导出方式三</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="comment">//导出时给变量起别名</span></span><br><span class="line">  name <span class="keyword">as</span> Fname,</span><br><span class="line">  age <span class="keyword">as</span> Fage,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//导入方式一</span></span><br><span class="line"><span class="keyword">import</span> &#123; name, age &#125; <span class="keyword">from</span> <span class="string">&#x27;./modules/foo.js&#x27;</span></span><br><span class="line"><span class="comment">//导入方式二</span></span><br><span class="line"><span class="keyword">import</span> &#123; name <span class="keyword">as</span> Sname, age <span class="keyword">as</span> Sage &#125; <span class="keyword">from</span> <span class="string">&#x27;./modules/foo.js&#x27;</span> <span class="comment">//导入时取别名</span></span><br><span class="line"><span class="comment">//导入方式三</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> foo <span class="keyword">from</span> <span class="string">&#x27;./modules/foo.js&#x27;</span> <span class="comment">//将导入的所有东西放进一个对象中</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.name)</span><br><span class="line"></span><br><span class="line"><span class="comment">//export 和import结合使用</span></span><br><span class="line"><span class="keyword">export</span> &#123; name, age &#125; <span class="keyword">from</span> <span class="string">&#x27;.*foo.js&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>default 用法</strong>（默认导出）</p><ul><li>默认导出 export 时不需要指定名字</li><li>导入时不需要使用{}，并且可以自己指定名字</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params"></span>) </span>&#123;	<span class="comment">//一个模块中只能有一个默认导出export default</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;	<span class="comment">//导出时不需要名字</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">import</span> format <span class="keyword">from</span> <span class="string">&#x27;./foo.js&#x27;</span>;	<span class="comment">//导入时自己取名</span></span><br></pre></td></tr></table></figure><h5 id="import-函数"><a href="#import-函数" class="headerlink" title="import 函数"></a>import 函数</h5><p>用来动态加载某一个模块，返回一个 promise</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> flag = <span class="literal">true</span></span><br><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&#x27;./modules/foo.js&#x27;</span>)</span><br><span class="line">    .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res.name)</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;&#125;)</span><br><span class="line">  <span class="comment">//或者</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&#x27;./modules/foo.js&#x27;</span>).then(<span class="function">(<span class="params">aaa</span>) =&gt;</span> &#123;</span><br><span class="line">    aaa.sayHello()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="常用内置模块解析"><a href="#常用内置模块解析" class="headerlink" title="常用内置模块解析"></a>常用内置模块解析</h3><h4 id="path"><a href="#path" class="headerlink" title="path"></a>path</h4><ul><li>使用</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> filepath = path.resolve(basePath, filename) <span class="comment">//路径拼接,自动转成操作系统上支持的路径格式</span></span><br><span class="line"><span class="built_in">console</span>.log(filepath)</span><br></pre></td></tr></table></figure><ul><li>path 模块的其他方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="comment">//1.获取路径的信息</span></span><br><span class="line"><span class="keyword">const</span> filename = <span class="string">&#x27;/User/why/abc.txt&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(path.dirname(filename)) <span class="comment">//获取文件路径  /User/why</span></span><br><span class="line"><span class="built_in">console</span>.log(path.basename(filename)) <span class="comment">//获取文件名  abc.txt</span></span><br><span class="line"><span class="built_in">console</span>.log(path.extname(filename)) <span class="comment">//获取后缀名  .txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.join路径拼接</span></span><br><span class="line"><span class="comment">// resolve会判断拼接的路径字符串中,是否有以/或./或../开头的路径,使用最多</span></span><br><span class="line"><span class="comment">//join是直接拼接两个路径</span></span><br><span class="line"><span class="keyword">const</span> basepath = <span class="string">&#x27;/User/why&#x27;</span></span><br><span class="line"><span class="keyword">const</span> filename = <span class="string">&#x27;abc.txt&#x27;</span></span><br><span class="line"><span class="keyword">const</span> filepath = path.join(basepath, filename)</span><br></pre></td></tr></table></figure><h4 id="fs"><a href="#fs" class="headerlink" title="fs"></a>fs</h4><p>fs 是 File System 的缩写，表示文件系统</p><ul><li>fs 的三种使用操作</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 案例: 读取文件的信息</span></span><br><span class="line"><span class="keyword">const</span> filepath = <span class="string">&#x27;./abc.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.方式一: 同步操作</span></span><br><span class="line"><span class="keyword">const</span> info = fs.statSync(filepath)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;后续需要执行的代码&#x27;</span>) <span class="comment">//会被阻塞</span></span><br><span class="line"><span class="built_in">console</span>.log(info)</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.方式二: 异步操作</span></span><br><span class="line">fs.stat(filepath, <span class="function">(<span class="params">err, info</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(info)</span><br><span class="line">  <span class="built_in">console</span>.log(info.isFile())</span><br><span class="line">  <span class="built_in">console</span>.log(info.isDirectory())</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;后续需要执行的代码&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.方式三: 基于Promise的异步操作</span></span><br><span class="line">fs.promises</span><br><span class="line">  .stat(filepath)</span><br><span class="line">  .then(<span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(info)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;后续需要执行的代码&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>文件描述符</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">fs.open(<span class="string">&#x27;./abc.txt&#x27;</span>, <span class="function">(<span class="params">err, fd</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 通过描述符去获取文件的信息</span></span><br><span class="line">  fs.fstat(fd, <span class="function">(<span class="params">err, info</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(info)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>文件的读写</li></ul><p>fs.readFile(path[, options], callback)：读取文件的内容</p><p>fs.writeFile(file, data[, options], callback)：在文件中写入内容</p><p>option 参数：flag：写入的方式,encoding：字符的编码；</p><ul><li><input disabled type="checkbox"> flag</li><li><input disabled type="checkbox"> w 打开文件写入，默认值，会覆盖原有内容；</li><li><input disabled type="checkbox"> w+打开文件进行读写，如果不存在则创建文件；</li><li><input disabled type="checkbox"> r+ 打开文件进行读写，如果不存在那么抛出异常；</li><li><input disabled type="checkbox"> r 打开文件读取，读取时的默认值</li><li><input disabled type="checkbox"> a 打开要写入的文件，将流放在文件末尾。如果不存在则创建文件；</li><li><input disabled type="checkbox"> a+打开文件以进行读写，将流放在文件末尾。如果不存在则创建文件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.文件写入</span></span><br><span class="line"><span class="keyword">const</span> content = <span class="string">&#x27;你好啊,李银河&#x27;</span></span><br><span class="line">fs.writeFile(<span class="string">&#x27;./abc.txt&#x27;</span>, content, &#123; <span class="attr">flag</span>: <span class="string">&#x27;a&#x27;</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 2.文件读取  如果不填写encoding，返回的结果是Buffer</span></span><br><span class="line">fs.readFile(<span class="string">&#x27;./abc.txt&#x27;</span>, &#123; <span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span> &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>文件夹的操作</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.创建文件夹</span></span><br><span class="line"><span class="keyword">const</span> dirname = <span class="string">&#x27;./why&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (!fs.existsSync(dirname)) &#123;</span><br><span class="line">  <span class="comment">//如果文件不存在</span></span><br><span class="line">  fs.mkdir(dirname, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//创建文件夹</span></span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.读取文件夹中的所有文件的名字</span></span><br><span class="line">fs.readdir(dirname, <span class="function">(<span class="params">err, files</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//简单读取</span></span><br><span class="line">  <span class="built_in">console</span>.log(files) <span class="comment">//files：该文件夹下的所有文件的名字放进一个数组里面</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//读取其他文件时</span></span><br><span class="line"><span class="keyword">const</span> avatarPath = <span class="string">&#x27;../../uploads/avatar/&#x27;</span></span><br><span class="line">fs.readdirSync(path.join(__dirname, avatarPath)).forEach(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// __dirname 当前目录</span></span><br><span class="line">  <span class="built_in">console</span>.log(file)</span><br><span class="line">&#125;) <span class="comment">//读取当前文件所在的目录，遍历</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFiles</span>(<span class="params">dirname</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//递归读取多重文件夹的文件</span></span><br><span class="line">  fs.readdir(dirname, &#123; <span class="attr">withFileTypes</span>: <span class="literal">true</span> &#125;, <span class="function">(<span class="params">err, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//withFileTypes: true 传入文件类型</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">      <span class="comment">// info.isFile(); 判断是不是文件</span></span><br><span class="line">      <span class="comment">// info.isDirectory(); //判断info是不是文件夹</span></span><br><span class="line">      <span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">        <span class="comment">//如果当前的是文件夹</span></span><br><span class="line">        <span class="keyword">const</span> filepath = path.resolve(dirname, file.name)</span><br><span class="line">        getFiles(filepath) <span class="comment">//递归调用</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(file.name) <span class="comment">//不是文件夹，打印文件名</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">getFiles(dirname)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.重命名</span></span><br><span class="line">fs.rename(<span class="string">&#x27;./why&#x27;</span>, <span class="string">&#x27;./kobe&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//why重命名为kobe</span></span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>padStart(2, 0);</p><p>一个函数，数字是两位数，不足时用 0 补齐;（01、02 之类）</p><h4 id="events-模块"><a href="#events-模块" class="headerlink" title="events 模块"></a>events 模块</h4><ul><li>emitter.on(eventName, listener):监听事件，也可使用 addListener(emitter.once():监听一次)</li><li>emitter.off():参数同上，移除事件监听,也可使用 removeListener</li><li>emitter.emit(eventName[…args]):发出事件，可以携带一些参数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基本使用</span></span><br><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>) <span class="comment">//导入的是一个类</span></span><br><span class="line"><span class="comment">// 1.创建发射器</span></span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> EventEmitter() <span class="comment">//创建对象，事件总线</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.监听某一个事件</span></span><br><span class="line"><span class="comment">// addListener是on的alias简写</span></span><br><span class="line">emitter.on(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 监听事件名为click的事件</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;监听1到click事件&#x27;</span>, args)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> listener2 = <span class="function">(<span class="params">args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;监听2到click事件&#x27;</span>, args)</span><br><span class="line">&#125;</span><br><span class="line">emitter.on(<span class="string">&#x27;click&#x27;</span>, listener2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.发出一个事件</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  emitter.emit(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;coderwhy&#x27;</span>, <span class="string">&#x27;james&#x27;</span>, <span class="string">&#x27;kobe&#x27;</span>) <span class="comment">//发射事件的时候传递参数</span></span><br><span class="line">  emitter.off(<span class="string">&#x27;click&#x27;</span>, listener2) <span class="comment">//取消监听</span></span><br><span class="line">  emitter.emit(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;coderwhy&#x27;</span>, <span class="string">&#x27;james&#x27;</span>, <span class="string">&#x27;kobe&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure><h3 id="包管理工具-🔖"><a href="#包管理工具-🔖" class="headerlink" title="包管理工具 🔖"></a>包管理工具 🔖</h3><p>Node Package Manager，Node 包管理器</p><p>版本号：<span class="exturl" data-url="aHR0cHM6Ly9zZW12ZXIub3JnL2xhbmcvemgtQ04v">https://semver.org/lang/zh-CN/<i class="fa fa-external-link-alt"></i></span></p><p>semver 版本规范是 X.Y.Z</p><ul><li>X 主版本号(major)：当你做了不兼容的 API 修改(可能不兼容之前的版本)</li><li>Y 次版本号(minor)：当你做了向下兼容的功能性新增(新功能增加，但是兼容之前的版本)</li><li>Z 修订号(patch)：当你做了向下兼容的问题修正(没有新功能，修复了之前版本的 BUG)</li></ul><p>^和~区别：</p><ul><li>^x.y.z：x 保持不变，y 和 z 安装最新的版本</li><li>~x.y.z：x 和 y 保持不变，z 永远安装最新的版本</li></ul><h4 id="常见属性"><a href="#常见属性" class="headerlink" title="常见属性"></a>常见属性</h4><ul><li><p>scripts 属性</p><p>用于配置一些脚本命令，以键值对的形式存在</p></li><li><p>dependencies 属性</p><p>指定开发和生产环境都需要依赖的包，通常是项目实际开发用到的一些库模块</p></li><li><p>devDependencies 属性</p><p>指定开发时需要，生产环境不需要的包，比如 webpack，使用–save-dev 安装到此属性中</p></li></ul><h4 id="npm-install-命令"><a href="#npm-install-命令" class="headerlink" title="npm install 命令"></a>npm install 命令</h4><ul><li><p>全局安装</p><p>npm install 包名 -g</p><p>直接将某个包安装到全局：npm install yarn -g</p><p>全局安装一般是安装工具</p></li><li><p>局部安装</p><p>npm install 包名</p><ul><li><p>安装发开和生产依赖</p><p>npm install axios</p><p>npm i axios</p></li><li><p>安装开发时依赖</p><p>npm install axios –save-dev</p><p>npm install axios -D</p><p>npm i axios -D</p></li><li><p>安装 package.json 中的依赖包</p><p>npm install</p></li></ul></li></ul><p>从 npm5 开始，npm 支持缓存策略，package-lock.json</p><p>npm config get cache 查看缓存文件的路径</p><h4 id="npm-其他命令"><a href="#npm-其他命令" class="headerlink" title="npm 其他命令"></a>npm 其他命令</h4><ul><li><p>卸载某个依赖包</p><p>npm uninstall package</p><p>npm uninstall package –save-dev</p><p>npm uninstall package -D</p></li><li><p>强制重新 build</p><p>npm recuild</p></li><li><p>清除缓存</p><p>npm cache clean</p></li></ul><h4 id="Yarn-工具"><a href="#Yarn-工具" class="headerlink" title="Yarn 工具"></a>Yarn 工具</h4><p>安装：npm install yarn -g</p><h4 id="cnpm-工具"><a href="#cnpm-工具" class="headerlink" title="cnpm 工具"></a>cnpm 工具</h4><p>安装：npm install -g cnpm –registry=<span class="exturl" data-url="aHR0cHM6Ly9yZWdpc3RyeS5ucG0udGFvYmFvLm9yZy8=">https://registry.npm.taobao.org<i class="fa fa-external-link-alt"></i></span></p><p>查看镜像：cnpm config get registry # <span class="exturl" data-url="aHR0cHM6Ly9yLm5wbS50YW9iYW8ub3JnLw==">https://r.npm.taobao.org/<i class="fa fa-external-link-alt"></i></span></p><h4 id="npx-工具"><a href="#npx-工具" class="headerlink" title="npx 工具"></a>npx 工具</h4><p>npm5.2 之后自带的一个命令</p><p>常用来调用项目中的某个模块的指令</p><p>npx webpack –version</p><p>若全局安装的 4.0.0，局部安装的 3.6.0，运行此命令后显示 3.6.0</p><h3 id="开发脚手架工具"><a href="#开发脚手架工具" class="headerlink" title="开发脚手架工具"></a>开发脚手架工具</h3><p>使用第三方库，commander.js，安装：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install commander</span><br></pre></td></tr></table></figure><p>06 和 07 两节，以后用到时看视频</p><p>发布 npm 包：</p><ol><li>去 npmjs.com 注册账号</li><li>在本地电脑 npm 包文件夹里终端输入 npm login，输入账号密码邮箱登录</li><li>修改 package.json</li><li>终端输入 npm publish 进行发布</li></ol><h3 id="Buffer-和浏览器的事件循环"><a href="#Buffer-和浏览器的事件循环" class="headerlink" title="Buffer 和浏览器的事件循环"></a>Buffer 和浏览器的事件循环</h3><h4 id="编码和解码"><a href="#编码和解码" class="headerlink" title="编码和解码"></a>编码和解码</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> message = <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建Buffer</span></span><br><span class="line"><span class="comment">//方式1，已过期，不推荐</span></span><br><span class="line"><span class="comment">// const buffer = new Buffer(message);</span></span><br><span class="line"><span class="comment">// console.log(buffer);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建方式二</span></span><br><span class="line"><span class="keyword">const</span> buffer = Buffer.from(message)</span><br><span class="line"><span class="built_in">console</span>.log(buffer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> message2 = <span class="string">&#x27;孙悟空&#x27;</span></span><br><span class="line"><span class="keyword">const</span> buffer2 = Buffer.from(message2, <span class="string">&#x27;utf8&#x27;</span>) <span class="comment">//指定编码方式,默认就是utf8</span></span><br><span class="line"><span class="built_in">console</span>.log(buffer2)</span><br><span class="line"><span class="built_in">console</span>.log(buffer2.toString(<span class="string">&#x27;utf8&#x27;</span>)) <span class="comment">//指定解码方式，不指定默认为utf8</span></span><br></pre></td></tr></table></figure><h4 id="Buffer-和文件操作"><a href="#Buffer-和文件操作" class="headerlink" title="Buffer 和文件操作"></a>Buffer 和文件操作</h4><ul><li>文本文件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&#x27;./foo.txt&#x27;</span>, &#123; <span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span> &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//指定解码方式</span></span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line">fs.readFile(<span class="string">&#x27;./foo.txt&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//未指定解码方式</span></span><br><span class="line">  <span class="built_in">console</span>.log(data.toString()) <span class="comment">//将读取到的字节流使用utf8解码</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>图片文件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取图片文件</span></span><br><span class="line">fs.readFile(<span class="string">&#x27;./wamp.png&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">  fs.writeFile(<span class="string">&#x27;./foo.png&#x27;</span>, data, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//将读取到的图片文件写入到当前文件夹</span></span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//sharp库的使用(sharp库：对图片进行处理)</span></span><br><span class="line"><span class="keyword">const</span> sharp = <span class="built_in">require</span>(<span class="string">&#x27;sharp&#x27;</span>)</span><br><span class="line">sharp(<span class="string">&#x27;./foo.png&#x27;</span>)</span><br><span class="line">  .resize(<span class="number">200</span>, <span class="number">200</span>) <span class="comment">//将图片大小变为200*200</span></span><br><span class="line">  .toFile(<span class="string">&#x27;./baz.png&#x27;</span>) <span class="comment">//将缩小后的图片写入当前文件夹</span></span><br></pre></td></tr></table></figure><h4 id="事件循环和异步-IO"><a href="#事件循环和异步-IO" class="headerlink" title="事件循环和异步 IO"></a>事件循环和异步 IO</h4><p>事件循环：我们编写的 js 代码和浏览器/Node 之间的一个桥梁</p><p>进程(process)：计算机啊已经运行的程序</p><p>线程(thread)：操作系统能够运行运算调度的最小单位</p><p>优先执行微任务，微任务执行完以后才执行宏任务队列，宏任务执行之前，微任务队列必须为空</p><h4 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h4><p>流：一连串的字节，字节流，所有的流都是 EventEmitter 的实例</p><p>Writable:可以向其写入数据的流</p><p>Readble：可以从中读取数据的流</p><p>流的读取：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//流的方式读取</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> reader = fs.createReadStream(<span class="string">&#x27;./foo.txt&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">start</span>: <span class="number">3</span>, <span class="comment">//从第三个位置开始读</span></span><br><span class="line">  <span class="attr">end</span>: <span class="number">6</span>, <span class="comment">//读到第六个位置结束</span></span><br><span class="line">  <span class="attr">highWaterMark</span>: <span class="number">2</span>, <span class="comment">//最高读两个</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//数据读取的过程</span></span><br><span class="line">reader.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">  reader.pause() <span class="comment">//暂停读取</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    reader.resume() <span class="comment">//暂停1s后恢复读取</span></span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">reader.on(<span class="string">&#x27;open&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;文件被打开&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">reader.on(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;文件被关闭&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>流的写入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="comment">//传统写入方式</span></span><br><span class="line"><span class="comment">// fs.writeFile(&quot;./bar.txt&quot;, &quot;Hello Stream&quot;, (err) =&gt; &#123;</span></span><br><span class="line"><span class="comment">// console.log(err);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="keyword">const</span> writer = fs.createWriteStream(<span class="string">&#x27;./bar.txt&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">flags</span>: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">  <span class="attr">start</span>: <span class="number">4</span>, <span class="comment">//开始写入的位置,如果这个位置有字符，会覆盖原来的</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">writer.write(<span class="string">&#x27;你好啊&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//流的写入</span></span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// writer.close();   //关闭文件</span></span><br><span class="line"></span><br><span class="line">writer.end(<span class="string">&#x27;Hello World&#x27;</span>) <span class="comment">//end是先写入再执行close关闭文件</span></span><br><span class="line"></span><br><span class="line">writer.on(<span class="string">&#x27;close&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;文件被关闭&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>pipe 的使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="comment">//把一个文件的内容写入到另一个文件里面</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//传统写法</span></span><br><span class="line"><span class="comment">// fs.writeFile(&#x27;./bar.txt&#x27;, (err, data) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   fs.writeFile(&#x27;./baz.txt&#x27;, data, (err) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     console.log(err);</span></span><br><span class="line"><span class="comment">//   &#125;);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//stream写法</span></span><br><span class="line"><span class="keyword">const</span> reader = fs.createReadStream(<span class="string">&#x27;./foo.txt&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> writer = fs.createWriteStream(<span class="string">&#x27;./foz.txt&#x27;</span>)</span><br><span class="line">reader.pipe(writer)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure><h3 id="Http-模块"><a href="#Http-模块" class="headerlink" title="Http 模块"></a>Http 模块</h3><h4 id="Web-服务器"><a href="#Web-服务器" class="headerlink" title="Web 服务器"></a>Web 服务器</h4><ul><li>初体验</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>) <span class="comment">//导入模块</span></span><br><span class="line"><span class="comment">//创建web服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.end(<span class="string">&#x27;Hello Server&#x27;</span>) <span class="comment">//等价于执行 write和close</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8000</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//启动服务器,并且指定端口号和主机</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>检测服务器有没有发生改变：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g nodemon  #全局安装</span><br><span class="line"><span class="meta">#</span><span class="bash">通过nodemon启动服务器，修改代码后服务器可以自动重启</span></span><br><span class="line"><span class="meta">#</span><span class="bash">如：nodemon aaa.js</span></span><br></pre></td></tr></table></figure><ul><li>另一种创建服务器的方式(本质是一样的)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> server1 = <span class="keyword">new</span> http.Server(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//创建服务器</span></span><br><span class="line">  res.end(<span class="string">&#x27;另一种方式创建server&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">server1.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;server启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>listen 的三个参数：</p><ol><li>端口 port：可省，系统会默认分配端</li><li>主机 host：localhost 会被解析成 127.0.0.1，0.0.0.0 监听 ip 上的所有地址</li><li>回调函数</li></ol><h4 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h4><p>request 对象中封装了客户端给服务器传递过来的所有信息</p><ul><li><p>res.url:请求的地址</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>) <span class="comment">//解析url</span></span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>) <span class="comment">//解析query</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//请求地址：http://localhost:8000/login?username=ysj&amp;password=123</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.url) <span class="comment">// /login?username=ysj&amp;password=123</span></span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.parse(req.url) <span class="comment">//解析req.url</span></span><br><span class="line">  <span class="built_in">console</span>.log(pathname) <span class="comment">// /login</span></span><br><span class="line">  <span class="built_in">console</span>.log(query) <span class="comment">// username=ysj&amp;password=123</span></span><br><span class="line">  <span class="keyword">const</span> &#123; username, password &#125; = qs.parse(query) <span class="comment">//解析query</span></span><br><span class="line">  <span class="built_in">console</span>.log(username, password) <span class="comment">// ysj 123</span></span><br><span class="line">  res.end(<span class="string">&#x27;Hello Server&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>res.method:请求方式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&#x27;kobe&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;8888&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当其为字符串时转成对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; username, password &#125; = <span class="built_in">JSON</span>.parse(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>) <span class="comment">//解析url</span></span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>) <span class="comment">//解析query</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//请求地址：http://localhost:8000/login?username=ysj&amp;password=123</span></span><br><span class="line">  <span class="keyword">const</span> &#123; pathname &#125; = url.parse(req.url)</span><br><span class="line">  <span class="keyword">if</span> (pathname == <span class="string">&#x27;/login&#x27;</span> &amp;&amp; req.method == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">//拿到body中的数据</span></span><br><span class="line">    <span class="comment">// 如果确定传过来的数据是字符串类型</span></span><br><span class="line">    req.setEncoding(<span class="string">&#x27;utf-8&#x27;</span>) <span class="comment">// 提前设置编码格式</span></span><br><span class="line">    req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//若未提前设置编码格式，传过来的数据是二进制</span></span><br><span class="line">      <span class="comment">// console.log(data.toString()); //将二进制转成字符串</span></span><br><span class="line">      <span class="keyword">const</span> &#123; username, password &#125; = <span class="built_in">JSON</span>.parse(data) <span class="comment">//将字符串转换为json对象</span></span><br><span class="line">      <span class="built_in">console</span>.log(username, password)</span><br><span class="line">    &#125;)</span><br><span class="line">    res.end(<span class="string">&#x27;Hello Server&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>在 Restful 规范(设计风格)中，对于数据的增删改查应该通过不同的请求方式:</p><ul><li>GET：查询数据</li><li>POST：新建数据</li><li>PATCH：更新数据（部分更新）</li><li>PUT：更新数据（全部更新）</li><li>DELETE：删除数据</li></ul></li><li><p>res.headers:请求头</p><ul><li>content-type：请求携带数据的类型<ul><li>application/json 是 json 类型</li><li>text/plain 是文本类型</li><li>application/xml 是 xml 类型</li><li>multipart/form-data 表示是上传文件</li></ul></li><li>content-lenght：数据的长度</li><li>accept-encoding：告知服务器，客户端支持的文件压缩格式</li><li>accept：告知服务器，客户端可接受文件的格式类型</li><li>user-agent：客户端相关的信息</li></ul></li></ul><h4 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h4><p>返回状态码</p><table><thead><tr><th>状态代码</th><th>说明</th></tr></thead><tbody><tr><td>200</td><td>客户端请求成功</td></tr><tr><td>400</td><td>由于客户端请求有语法错误，不能被服务器所理解</td></tr><tr><td>401</td><td>请求未经授权，这个状态码必须与 WWW-Authenticate 报头域一起使用</td></tr><tr><td>403</td><td>服务器收到请求，但是拒绝提供服务。服务器通常会在响应正文中给出不提供服务的原因</td></tr><tr><td>404</td><td>请求的资源不存在，如输入了错误的 url</td></tr><tr><td>500</td><td>服务器发生不可预期的错误，导致无法完成客户端的请求</td></tr><tr><td>503</td><td>服务器当前不能够处理客户端的请求，在一段时间之后，服务器可能会恢复正常</td></tr></tbody></table><p>状态码的设置方式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.直接给属性赋值</span></span><br><span class="line">res.statusCode = <span class="number">500</span></span><br><span class="line"><span class="comment">// 2.和Head一起设置</span></span><br><span class="line">res.writeHead(<span class="number">500</span>)</span><br></pre></td></tr></table></figure><p>设置响应 Header</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置方式一</span></span><br><span class="line">res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain;charset=utf-8&#x27;</span>)</span><br><span class="line"><span class="comment">//设置方式二</span></span><br><span class="line">res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html;charset=utf8&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Http-请求"><a href="#Http-请求" class="headerlink" title="Http 请求"></a>Http 请求</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//http发送get请求</span></span><br><span class="line"><span class="comment">// http.get(&quot;http://localhost:8000&quot;, (res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   res.on(&#x27;data&#x27;, (data) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     console.log(data,toString());</span></span><br><span class="line"><span class="comment">//   &#125;);</span></span><br><span class="line"><span class="comment">//   res.on(&#x27;end&#x27;, () =&gt; &#123;	//监听数据结束</span></span><br><span class="line"><span class="comment">//     console.log(&quot;获取到了所有的结果&quot;);</span></span><br><span class="line"><span class="comment">//   &#125;);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//http发送post请求</span></span><br><span class="line"><span class="keyword">const</span> req = http.request(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8888</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 拿到结果</span></span><br><span class="line">    res.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data, toString())</span><br><span class="line">    &#125;)</span><br><span class="line">    res.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;获取到了所有的结果&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">req.end() <span class="comment">//结束请求</span></span><br></pre></td></tr></table></figure><h3 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装脚手架</span></span><br><span class="line">npm install -g express-generator</span><br><span class="line"><span class="meta">#</span><span class="bash">创建项目</span></span><br><span class="line">express express-project-name</span><br><span class="line"><span class="meta">#</span><span class="bash">进入项目文件夹</span></span><br><span class="line">cd express-project-name</span><br><span class="line"><span class="meta">#</span><span class="bash">安装依赖</span></span><br><span class="line">npm install</span><br><span class="line"><span class="meta">#</span><span class="bash">启动项目</span></span><br><span class="line">node 	bin/www</span><br><span class="line"><span class="meta">#</span><span class="bash">浏览器访问</span></span><br><span class="line">http://localhost:3000/</span><br></pre></td></tr></table></figure><h4 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h4><p>Express 是一个路由和中间件的 Web 框架，本质上是一系列中间件函数的调用</p><p>基本模式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>) <span class="comment">//导入express模块,express是一个函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express() <span class="comment">//调用express，返回一个函数赋值给app</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//监听默认路径</span></span><br><span class="line">app.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.end(<span class="string">&#x27;Hello POST Express&#x27;</span>) <span class="comment">//结束请求响应生命周期</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开启监听</span></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;express服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>中间件本质是一个传递给 express 的接收三个参数的回调函数</p><ul><li>请求对象(request 对象)</li><li>响应对象(response 对象)</li><li>next 函数(在 express 中定义的用于执行下一个中间件的函数)</li></ul><p>执行的任务：</p><ul><li>执行任何代码</li><li>更改请求和响应对象</li><li>结束请求响应周期(返回数据)</li><li>调用栈中的下一个中间件</li></ul><p>如果当前中间件没有结束请求-响应周期，则必须调用 next()将控制权传递给下一个中间件功能，否则，请求将被挂起</p><p>中间件应用到程序中：</p><ul><li>​ app.use() router.use()</li><li>app.methods() router.use()</li></ul><p><strong>四种中间件</strong></p><ul><li><p>普通中间件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">//编写普通中间件 使用use注册中间件(本质回调函数)</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//任何路径都可以匹配</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;注册第一个普通的中间件&#x27;</span>)</span><br><span class="line">  res.end(<span class="string">&#x27;Hello World&#x27;</span>) <span class="comment">//res.end一般放最后一个中间件里面</span></span><br><span class="line">  next() <span class="comment">//调用下一个中间件,不调用next()下一个中间件就不会执行</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;注册第二个中间件&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;普通中间件&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>路径匹配中间件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">//路径匹配中间件</span></span><br><span class="line">app.use(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 只匹配路径</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;middleware01&#x27;</span>)</span><br><span class="line">  res.end(<span class="string">&#x27;MiddleWare&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>路径和方法中间件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">//路径和方法匹配中间件</span></span><br><span class="line">app.get(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;path and method middleware01&#x27;</span>)</span><br><span class="line">  res.end(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>连续注册中间件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(</span><br><span class="line">  <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">  <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;home path and method middleware01&#x27;</span>)</span><br><span class="line">    next()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;home path and method middleware02&#x27;</span>)</span><br><span class="line">    next()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;home path and method middleware03&#x27;</span>)</span><br><span class="line">    next()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;home path and method middleware04&#x27;</span>)</span><br><span class="line">    next()</span><br><span class="line">    res.end(<span class="string">&#x27;home page&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p>解析 json 数据</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> e = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.use((req, res, next) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   if(req.headers[&quot;content-type&quot;] === &#x27;application/json&#x27;) &#123;  //如果前端传过来的是json数据就做解析</span></span><br><span class="line"><span class="comment">//     req.on(&#x27;data&#x27;, (data) =&gt; &#123;  // 监听前端传过来的数据</span></span><br><span class="line"><span class="comment">//       console.log(data.toString());</span></span><br><span class="line"><span class="comment">//       const info = JSON.parse(data.toString());</span></span><br><span class="line"><span class="comment">//       req.body = info;  //给request添加属性body,并且赋值为info</span></span><br><span class="line"><span class="comment">//       // 在其它中间件通过req.body就可拿到info参数</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"><span class="comment">//     res.on(&#x27;end&#x27;, () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//       res.end(&quot;Json~&quot;);</span></span><br><span class="line"><span class="comment">//       next();</span></span><br><span class="line"><span class="comment">//     &#125;);</span></span><br><span class="line"><span class="comment">//   &#125;else &#123;</span></span><br><span class="line"><span class="comment">//     next();</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">app.use(express.json()) <span class="comment">//express内置的解析json的函数,等价于以上代码</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;)) <span class="comment">// 解析x-www-form-urlencoded类型的数据</span></span><br><span class="line"><span class="comment">// extend:</span></span><br><span class="line"><span class="comment">// true: 对urlencoded进行解析时使用的第三方库： qs</span></span><br><span class="line"><span class="comment">// false：对urlencoded进行解析时使用的Node内置模块： querystring</span></span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.body)</span><br><span class="line">  res.end(<span class="string">&#x27;Json~&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>body 数据解析</p><p>安装第三方库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install multer	#express官方开发的用于解析表单数据的插件</span><br></pre></td></tr></table></figure><p>form-data 非文件类型解析</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>) <span class="comment">// 导入用于解析form-data的库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> upload = multer() <span class="comment">//调用函数multer，将返回的结果赋值给upload</span></span><br><span class="line"></span><br><span class="line">app.use(upload.any()) <span class="comment">//调用any方法,返回一个函数,注册为中间件;非文件类型使用any()解析</span></span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.body)</span><br><span class="line">  res.end(<span class="string">&#x27;form-data&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;form-data解析服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>form-data 文件解析</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>) <span class="comment">// 导入</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> storage = multer.diskStorage(&#123;</span><br><span class="line">  <span class="comment">//自定义存储信息</span></span><br><span class="line">  <span class="attr">destination</span>: <span class="function">(<span class="params">req, file, cb</span>) =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="string">&#x27;./uploads/&#x27;</span>) <span class="comment">//调用cb回调函数 参数1：有无错误  参数2：上传文件保存路径</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">filename</span>: <span class="function">(<span class="params">req, file, cb</span>) =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="built_in">Date</span>.now() + path.extname(file.originalname)) <span class="comment">//参数2：文件名 时间戳+从原始文件里面取出的后缀名</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> upload = multer(&#123;</span><br><span class="line">  <span class="comment">// dest:&#x27;./uploads/&#x27;, //上传的文件放到当前文件的uploads的文件夹下面,没有会自动创建文件夹</span></span><br><span class="line">  storage, <span class="comment">//自定义存储信息</span></span><br><span class="line">&#125;) <span class="comment">//调用函数multer，将返回的结果赋值给upload</span></span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/upload&#x27;</span>, upload.single(<span class="string">&#x27;file&#x27;</span>), <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//文件上传接口</span></span><br><span class="line">  <span class="comment">//中间插入中间件,获取上传的文件,并且进行保存,file为表单key,以便于精准拿到文件</span></span><br><span class="line">  <span class="comment">//上传一个文件:upload.single()  上传多个文件:upload.array(&#x27;file&#x27;)</span></span><br><span class="line">  <span class="comment">// upload.fields([&#123;name: &quot;file&quot;, maxCount: 2&#125;])</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.file) <span class="comment">//获取上传后的文件的信息  多个文件使用req.files</span></span><br><span class="line">  <span class="comment">// 不要将multer作为全局中间件使用</span></span><br><span class="line">  res.end(<span class="string">&#x27;文件上传成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;form-data解析服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="核心用法"><a href="#核心用法" class="headerlink" title="核心用法"></a>核心用法</h4><p>客户端传递到服务器参数的方法常见的是 5 种</p><ul><li><p>通过 get 请求中的 URL 的 params</p></li><li><p>通过 get 请求中的 URL 的 query</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.get(<span class="string">&#x27;/products/:id/:name&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//传过来一个id和name   localhost:8000/products/1/coderwhy</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.params) <span class="comment">//获取传过来的参数(是一个对象)</span></span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// localhost:8000/login?username=coderwhy&amp;password=123</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.query)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>通过 post 请求中的 body 的 json 格式</p></li><li><p>通过 post 请求中的 body 的 x-www-form-urlencoded 格式</p></li><li><p>通过 post 请求中的 form-data 格式</p></li></ul><p>响应数据</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.json() <span class="comment">//里面可以放json数据、数组</span></span><br><span class="line">res.status(<span class="number">404</span>) <span class="comment">//返回状态码</span></span><br></pre></td></tr></table></figure><h4 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h4><p>可以使用 express.Router 来创建一个路由处理程序,一个 Router 实例拥有完整的中间件和路由系统</p><p>路由的使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//user.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = express.Router() <span class="comment">//调用express.Router函数创建路由</span></span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json([<span class="string">&#x27;why&#x27;</span>, <span class="string">&#x27;kobe&#x27;</span>, <span class="string">&#x27;lilei&#x27;</span>])</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/:id&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(<span class="string">`<span class="subst">$&#123;req.params.id&#125;</span>用户的信息`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(<span class="string">&#x27;create users success&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router <span class="comment">//导出路由</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用路由.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&#x27;./routers/users&#x27;</span>) <span class="comment">//导入用户路由</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/users&#x27;</span>, userRouter) <span class="comment">//注册用户路由里面的接口,指定用户路由请求路径为/user</span></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;路由服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="静态资源服务器"><a href="#静态资源服务器" class="headerlink" title="静态资源服务器"></a>静态资源服务器</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.use(express.static(<span class="string">&#x27;./build&#x27;</span>)) <span class="comment">//静态资源的相对位置</span></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;路由服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Koa"><a href="#Koa" class="headerlink" title="Koa"></a>Koa</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa</span><br></pre></td></tr></table></figure><p>初体验</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>) <span class="comment">//导入,是一个类</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa() <span class="comment">//创建类的实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// koa中所有中间件执行完之后没有返回结果，就会返回not found</span></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//使用中间件 ctx：context,上下文</span></span><br><span class="line">  ctx.response.body = <span class="string">&#x27;Hello World&#x27;</span> <span class="comment">// 给body赋的值会返回给前端,类似于express的res.end(&quot;Hello World&quot;)</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;koa初体验服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//koa注册中间件只能使用app.use()</span></span><br><span class="line"><span class="comment">//app.get/post  app.use(&#x27;/home&#x27;)    没有提供这些方式,连续注册中间件也没有提供</span></span><br></pre></td></tr></table></figure><h4 id="路由-1"><a href="#路由-1" class="headerlink" title="路由"></a>路由</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-router</span><br></pre></td></tr></table></figure><p>路由的使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//user-router.js</span></span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>) <span class="comment">//导入koa-router的类</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">&#x27;/users&#x27;</span> &#125;) <span class="comment">// 创建路由的类,并填入路由的前缀</span></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//注册路由接口</span></span><br><span class="line">  ctx.response.body = <span class="string">&#x27;User List~&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">router.put(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//注册路由接口</span></span><br><span class="line">  ctx.response.body = <span class="string">&#x27;put request~&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router <span class="comment">//导出路由的类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/user&#x27;</span>) <span class="comment">//导入用户路由</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use(userRouter.routes()) <span class="comment">//调用userRouter.routes(),返回一个函数,注册路由中间件</span></span><br><span class="line">app.use(userRouter.allowedMethods()) <span class="comment">//某个methods请求方式不被服务器支持时会给出对应提示</span></span><br><span class="line"><span class="comment">//allowedMethods()用于判断某一个methods是否支持</span></span><br><span class="line"><span class="comment">//如请求put\delete\patch自动报错Method Not Allowed，状态码405</span></span><br><span class="line"><span class="comment">//link\copy\lock自动报错Not Implemented,状态码501</span></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;koa路由服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="参数解析"><a href="#参数解析" class="headerlink" title="参数解析"></a>参数解析</h4><p><strong>params 和 query</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">&#x27;/users&#x27;</span> &#125;)</span><br><span class="line"><span class="comment">//   http://localhost:8000/users/abc?name=ysj&amp;password=123</span></span><br><span class="line">userRouter.get(<span class="string">&#x27;/:id&#x27;</span>, <span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.request.params) <span class="comment">//&#123; id: &#x27;abc&#x27; &#125;</span></span><br><span class="line">  <span class="built_in">console</span>.log(ctx.request.query) <span class="comment">//&#123; name: &#x27;ysj&#x27;, password: &#x27;123&#x27; &#125;</span></span><br><span class="line">&#125;)</span><br><span class="line">app.use(userRouter.routes()) <span class="comment">//注册路由</span></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器参数解析&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>json 和 urlencoded</strong></p><p>安装第三方库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-bodyparser	#用来解析json和urlencoded</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparser&#x27;</span>) <span class="comment">// 导入解析json和urlencoded的第三方库</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use(bodyParser()) <span class="comment">// 调用bodyParser函数,返回值注册为中间件</span></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.request.body) <span class="comment">// 打印解析的json或urlencoded数据</span></span><br><span class="line">  ctx.response.body = <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;urlencoded和json解析&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>解析 form-data</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-multer</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;koa-multer&#x27;</span>) <span class="comment">// 导入解析form-data数据的第三方库</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> upload = multer() <span class="comment">// 调用multer函数</span></span><br><span class="line">app.use(upload.any()) <span class="comment">// 注册解析form-data的中间件</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.req.body) <span class="comment">// form-data解析之后的数据放在req里面(非request)</span></span><br><span class="line">  ctx.response.body = <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;form-data服务器解析&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a><strong>文件上传</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;koa-multer&#x27;</span>) <span class="comment">// 导入库</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> uploadRouter = <span class="keyword">new</span> Router(&#123; <span class="attr">prefix</span>: <span class="string">&#x27;/upload&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> storage = multer.diskStorage(&#123;</span><br><span class="line">  <span class="attr">destination</span>: <span class="function">(<span class="params">req, file, cb</span>) =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="string">&#x27;./uploads/&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">filename</span>: <span class="function">(<span class="params">req, file, cb</span>) =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="built_in">Date</span>.now() + path.extname(file.originalname))</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> upload = multer(&#123;</span><br><span class="line">  storage,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">uploadRouter.post(<span class="string">&#x27;/avatar&#x27;</span>, upload.single(<span class="string">&#x27;avatar&#x27;</span>), <span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.req.file) <span class="comment">// 打印当前上传文件的信息</span></span><br><span class="line">  ctx.response.body = <span class="string">&#x27;上传头像成功&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(uploadRouter.routes())</span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;文件上传服务器&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="数据响应"><a href="#数据响应" class="headerlink" title="数据响应"></a>数据响应</h4><p>输出结果：body 将响应主题设置为以下之一:</p><ul><li>string:字符串数据</li><li>Buffer:Buffer 数据</li><li>Stream:流数据</li><li>Object || Array: 对象或数组</li><li>null: 不输出任何内容</li><li>若 response.status 尚未设置，Koa 会自动将状态设置为 200 或 204</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//设置状态码</span></span><br><span class="line">  ctx.status = <span class="number">200</span></span><br><span class="line">  <span class="comment">//设置响应内容</span></span><br><span class="line">  <span class="comment">// ctx.response.body = &quot;Hello World&quot;;</span></span><br><span class="line">  ctx.body = <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;koa文件上传服务器&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="静态服务器"><a href="#静态服务器" class="headerlink" title="静态服务器"></a>静态服务器</h4><p>koa 并未内置部署相关的功能，需要使用第三方库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-static</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> staticAssets = <span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>) <span class="comment">//引入</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use(staticAssets(<span class="string">&#x27;./build/&#x27;</span>)) <span class="comment">//设置静态资源的路径</span></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;静态资源服务器&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use(<span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isLogin = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">if</span> (!isLogin) &#123;</span><br><span class="line">    ctx.app.emit(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;您还未登录&#x27;</span>), ctx)</span><br><span class="line">    <span class="comment">//抛出错误，传出ctx</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.on(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err, ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  ctx.status = <span class="number">401</span></span><br><span class="line">  ctx.body = err.message</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;静态资源服务器&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><h4 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h4><p>下载软件：<span class="exturl" data-url="aHR0cHM6Ly93d3cubXlzcWwuY29tLyVFRiVCQyU4QyVFNiU4QiU4OSVFNSU4OCVCMCVFNSVCQSU5NSVFOSU4MyVBOCVFRiVCQyU4QyVFOSU4MCU4OSVFNiU4QiVBOU15U1FM">https://www.mysql.com/，拉到底部，选择MySQL<i class="fa fa-external-link-alt"></i></span> Community Server 进行下载</p><p>点击 Go to Download Page,下载大一点的版本(小版本需要联网进行安装，安装教程详见视频 14)</p><p>MySQLroot 账户密码：123.</p><h4 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h4><p>打开终端，输入命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123.</span><br><span class="line"><span class="meta">#</span><span class="bash">root表示root用户  -p后跟密码</span></span><br><span class="line">mysql -uroot -p #回车后再输入密码</span><br></pre></td></tr></table></figure><h4 id="GUI-工具"><a href="#GUI-工具" class="headerlink" title="GUI 工具"></a>GUI 工具</h4><p>Navicat 破解教程，注册机在自己百度网盘：</p><p>[]: <span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vcG9sb3l5L3AvMTIyMzEzNTcuaHRtbA==">https://www.cnblogs.com/poloyy/p/12231357.html<i class="fa fa-external-link-alt"></i></span></p><h4 id="SQL-语句"><a href="#SQL-语句" class="headerlink" title="SQL 语句"></a>SQL 语句</h4><h5 id="常用规范"><a href="#常用规范" class="headerlink" title="常用规范"></a>常用规范</h5><ul><li>通常关键字大写</li><li>一句语句结束以后以;结尾</li><li>如遇到关键字作为表名或字段名称，可以使用``包裹</li></ul><h5 id="语句分类"><a href="#语句分类" class="headerlink" title="语句分类"></a>语句分类</h5><ul><li><p>DDL(Data Definition Language):数据定义语言</p><ul><li>对数据库或表进行创建、删除、修改等操作</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有数据库</span><br><span class="line">show databases;</span><br><span class="line"></span><br><span class="line"># 选择某一个数据库</span><br><span class="line">use coderhub;</span><br><span class="line"></span><br><span class="line">#查看当前正在使用的数据库</span><br><span class="line">select database();</span><br><span class="line"></span><br><span class="line">#创建数据库</span><br><span class="line">-- CREATE DATABASE douyu;</span><br><span class="line">carete database if not exists douyu;	-- 当这个数据库不存在时就创建这个数据库</span><br><span class="line">-- create database if not exists huya default character set utf8mb4 collate utf8mb4_0900_ai_ci;	-- 创建时设置字符集</span><br><span class="line"></span><br><span class="line">#删除数据库</span><br><span class="line">drop database if exists douyu;	-- 数据库存在则删除</span><br><span class="line"></span><br><span class="line"># 修改数据库编码</span><br><span class="line">alter database douyu character set = utf8 collate utf8_unicode_ci;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-- 查看当前数据库有哪些表</span><br><span class="line">show tables;</span><br><span class="line"></span><br><span class="line">-- 表不存在时创建表</span><br><span class="line">create table if not exists students(</span><br><span class="line">	`name` varchar(10),</span><br><span class="line">  age int,</span><br><span class="line">  score double</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 删除表</span><br><span class="line">drop table if exists `students`;</span><br></pre></td></tr></table></figure></li><li><p>DML(Data Manipulation Language):数据操作语言</p><ul><li>对表进行添加、删除、修改等操作</li></ul></li><li><p>DQL(Data Query Language):数据查询语言</p><ul><li>从数据库中查询记录</li></ul></li><li><p>DCL(Data Control Language):数据控制语言</p><ul><li>对数据库、表格的权限进行相关访问控制操作</li></ul></li></ul><h4 id="创建表-amp-数据查询"><a href="#创建表-amp-数据查询" class="headerlink" title="创建表&amp;数据查询"></a>创建表&amp;数据查询</h4><h5 id="MySQL-常用数据类型"><a href="#MySQL-常用数据类型" class="headerlink" title="MySQL 常用数据类型"></a><strong>MySQL 常用数据类型</strong></h5><ul><li>数字类型<ul><li>整数数字类型:int bigint ……</li><li>浮点数字类型:float double (float 是 4 个字节，double 是 8 个字节)</li><li>精确数字类型:decimal(n, m) numeric (n 位数字，保留 m 位小数)</li></ul></li><li>日期类型<ul><li>year：以 yyyy 格式显示值，范围 1901 到 2155，和 0000</li><li>date：以 YYYY-MM-DD 的格式显示值，支持范围 1000-01-01 到 9999-12-31</li><li>datetime：以 YYYY-MM-DD hh-mm-ss 的格式显示值，支持范围 1000-01-01 00:00:00 到 9999-12-31 23:59:59</li><li>timestamp：以 YYYY-MM-DD hh-mm-ss 的格式显示值但是范围为 UTC 的时间范围：1970-01-01 00:00:01 到 2038-01-19 03:14:07</li></ul></li><li>字符串类型<ul><li>char 类型在创建表时为固定长度，长度为 0-255，被查询时会删除后面的空格</li><li>varchar 类型是可变长度的字符串，长度可以指定为 0-65535 之间的值，被查询时不会删除后面的空格</li><li>binary 和 varbinary 用与存储二进制字符串，存储的是字节字符串</li><li>blob 用于存储大的二进制类型</li><li>text 用于存储大的字符串类型</li></ul></li></ul><h5 id="表约束"><a href="#表约束" class="headerlink" title="表约束"></a><strong>表约束</strong></h5><ul><li>主键：primary key<ul><li>区分每一条记录的唯一性，永远不会重复，不会为空</li><li>主键是表中唯一索引</li><li>创建表时若没有设置 not null，mysql 会自动设置</li><li>主键可以是多列索引，称为联合主键</li><li>开发中主键的字段应该是和业务无关的</li></ul></li><li>唯一性：unique<ul><li>约束某些字段，使其不会重复</li><li>null 可以重复</li></ul></li><li>不能为空：not null</li><li>默认值：default</li><li>自动递增：auto_increment</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-- 创建表的完整语法</span><br><span class="line">CREATE TABLE IF NOT EXISTS users (</span><br><span class="line">	id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,  #id为int类型,主键,不为空,自动增长</span><br><span class="line">	name VARCHAR(20) NOT NULL,	#可变长度，但是范围在20之内</span><br><span class="line">	age INT DEFAULT 0,</span><br><span class="line">	phoneNum VARCHAR(20) UNIQUE DEFAULT &#x27;&#x27;,</span><br><span class="line">	createTime TIMESTAMP</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 修改表</span><br><span class="line">-- 修改表名</span><br><span class="line">ALTER TABLE users RENAME TO `user`;</span><br><span class="line">-- 添加一个新的列</span><br><span class="line">ALTER TABLE `user` ADD `updateTime` TIMESTAMP;</span><br><span class="line">-- 修改列名(字段名称)</span><br><span class="line">ALTER TABLE `user` CHANGE `phoneNum` `telPhone` VARCHAR(20);	-- phoneNum列的名字改为telPhone</span><br><span class="line">-- 修改字段的类型</span><br><span class="line">ALTER TABLE `user` MODIFY `name` VARCHAR(30);	-- name字段的长度改为30</span><br><span class="line">-- 删除某一个字段</span><br><span class="line">ALTER TABLE `user` DROP `age`; -- 删除age</span><br><span class="line"></span><br><span class="line">#根据一个表结构取创建另外一张表</span><br><span class="line">CREATE TABLE `user1` LIKE `user`; -- 根据user创建user1,只复制结构</span><br><span class="line">#根据另外一个表中的所有内容创建一个新的表</span><br><span class="line">CREATE TABLE `user2` AS (SELECT * FROM `user`);	-- as可以省略，复制内容</span><br></pre></td></tr></table></figure><h5 id="DML-数据库的增删改"><a href="#DML-数据库的增删改" class="headerlink" title="DML-数据库的增删改"></a><strong>DML-数据库的增删改</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 插入数据</span><br><span class="line">INSERT INTO `user` VALUES (110, &#x27;why&#x27;, &#x27;0216451&#x27;, &#x27;2020-10-10&#x27;, &#x27;2020-11-11&#x27;);</span><br><span class="line">-- 不写id，id自动递增</span><br><span class="line">INSERT INTO `user` (name, telPhone, createTime, updateTime)</span><br><span class="line">						VALUES (&#x27;kobe&#x27;, &#x27;000-1111111&#x27;, &#x27;2020-10-10&#x27;, &#x27;2020-11-12&#x27;);</span><br><span class="line">-- 需求：createTime和updateTime自动设置值</span><br><span class="line">ALTER TABLE `user` MODIFY `createTime` TIMESTAMP DEFAULT CURRENT_TIMESTAMP;</span><br><span class="line">ALTER TABLE `user` MODIFY `updateTime` TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span><br><span class="line">			ON UPDATE CURRENT_TIMESTAMP; -- 插入记录时为插入记录的时间，修改记录时时间更新</span><br><span class="line"></span><br><span class="line">INSERT INTO `user` (name, telPhone)</span><br><span class="line">						VALUES (&#x27;hmm&#x27;, &#x27;000-1111112&#x27;);</span><br><span class="line"></span><br><span class="line">#删除数据</span><br><span class="line">DELETE FROM `user`; -- 删除所有数据</span><br><span class="line">DELETE FROM `user` WHERE id = 110; -- 删除符合条件的数据</span><br><span class="line"></span><br><span class="line">#更新数据</span><br><span class="line">UPDATE `user` SET name = &#x27;lily&#x27;, telPhone = &#x27;010-110110&#x27;;	-- 更新所有数据</span><br><span class="line">UPDATE `user` SET name = &#x27;lily&#x27;, telPhone = &#x27;010-110110&#x27; WHERE id = 110;	-- 更新符合条件的数据</span><br></pre></td></tr></table></figure><h5 id="DQL-数据查询"><a href="#DQL-数据查询" class="headerlink" title="DQL-数据查询"></a><strong>DQL-数据查询</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select 选择表达式</span><br><span class="line">	from 表名</span><br><span class="line">	where ……</span><br><span class="line">	order by ……</span><br><span class="line">	limit ……</span><br><span class="line">	group by ……</span><br><span class="line">	having ……</span><br></pre></td></tr></table></figure><p><strong>基本查询</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM products;</span><br><span class="line">#查询指定字段</span><br><span class="line">SELECT title, price FROM products;</span><br><span class="line">#对字段结果取别名,as可省略</span><br><span class="line">SELECT title as phoneTitle, price currentPrice FROM products;</span><br></pre></td></tr></table></figure><p><strong>where 查询条件</strong></p><p>IN：表示取多个值中的一个即可</p><p>模糊查询：like</p><ul><li>%表示匹配任意个的任意字符</li><li>_表示匹配一个的任意字符</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-- 查询价格小于1000的手机</span><br><span class="line">SELECT title, price FROM products WHERE price &lt; 1000;</span><br><span class="line">-- 查询价格在1000-2000之间的手机</span><br><span class="line">SELECT * FROM products WHERE price &gt; 1000 AND price &lt; 2000;</span><br><span class="line">SELECT * FROM products WHERE price &gt; 1000 &amp;&amp; price &lt; 2000;</span><br><span class="line">-- between and 包含等于</span><br><span class="line">SELECT * FROM products WHERE price BETWEEN 1000 AND 2000;</span><br><span class="line"></span><br><span class="line">-- 查询价格在5000以上或品牌是华为手机</span><br><span class="line">SELECT * FROM products WHERE price &gt; 5000 or brand = &#x27;华为&#x27;;</span><br><span class="line">SELECT * FROM products WHERE price &gt; 5000 || brand = &#x27;华为&#x27;;</span><br><span class="line"></span><br><span class="line">-- 查询某一个值为null</span><br><span class="line">select * from products where url is null;</span><br><span class="line"></span><br><span class="line">-- 模糊查询</span><br><span class="line">select * from products where title like &#x27;%M%&#x27;;</span><br><span class="line">select * from products where title like &#x27;_P%&#x27;;</span><br><span class="line">-- 查询所有的华为或者小米手机</span><br><span class="line">select * from products where brand in (&#x27;华为&#x27;, &#x27;小米&#x27;);</span><br></pre></td></tr></table></figure><p><strong>查询结果排序</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 查询结果按照价格升序,价格相同时按照评分降序排序</span><br><span class="line">select * from products where brand in (&#x27;华为&#x27;, &#x27;小米&#x27;)</span><br><span class="line">					order by price asc, score desc;</span><br></pre></td></tr></table></figure><p><strong>分页查询</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 查询20条数据，偏移0条</span><br><span class="line">select * from products limit 20 offset 0;</span><br><span class="line">select * from products limit 20 offset 20;	-- 偏移20条,从第21条开始</span><br><span class="line">-- limit offset, limit</span><br><span class="line">-- 从第一条开始(偏移0条)，查询20条</span><br><span class="line">select * from products limit 0, 20;</span><br></pre></td></tr></table></figure><h4 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h4><p>将整个表的所有数据看成是一组数据，对这一组数据进行某些操作使用到的函数称为聚合函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#表名products</span><br><span class="line"># 1.聚合函数的使用</span><br><span class="line"># 求所有手机的价格的总和,并给查询出来的列重命名为totalPrice</span><br><span class="line">SELECT SUM(price) totalPrice FROM `products`;</span><br><span class="line"># 求一下华为手机的价格的总和</span><br><span class="line">SELECT SUM(price) FROM `products` WHERE brand = &#x27;华为&#x27;;</span><br><span class="line"># 求华为手机的平均价格</span><br><span class="line">SELECT AVG(price) FROM `products` WHERE brand = &#x27;华为&#x27;;</span><br><span class="line"># 最高手机的价格和最低手机的价格</span><br><span class="line">SELECT MAX(price) FROM `products`;</span><br><span class="line">SELECT MIN(price) FROM `products`;</span><br><span class="line"></span><br><span class="line"># 求华为手机的个数(有多少条记录)</span><br><span class="line">SELECT COUNT(*) FROM `products` WHERE brand = &#x27;华为&#x27;;</span><br><span class="line">SELECT COUNT(*) FROM `products` WHERE brand = &#x27;苹果&#x27;;</span><br><span class="line">SELECT COUNT(url) FROM `products` WHERE brand = &#x27;苹果&#x27;;	-- 字段为null时不会计算在内</span><br><span class="line"></span><br><span class="line">SELECT COUNT(price) FROM `products`;</span><br><span class="line">SELECT COUNT(DISTINCT price) FROM `products`;	-- 重复的数据不计算在内</span><br><span class="line"></span><br><span class="line"># 2.GROUP BY的使用</span><br><span class="line">SELECT brand, AVG(price), COUNT(*), AVG(score) FROM `products` GROUP BY brand;</span><br><span class="line">-- 通过brand进行分组,查找不同分组(手机品牌)的平均价格等信息……</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 3.HAVING的使用(对分组之后查询到的结果进行筛选)</span><br><span class="line">-- where 是直接对表进行相关的筛选</span><br><span class="line">-- WHERE不能放在group by 后面,可以放在group by之前,即筛选生产的表的后面</span><br><span class="line">SELECT brand, AVG(price) avgPrice, COUNT(*), AVG(score) FROM `products` GROUP BY brand HAVING avgPrice &gt; 2000;</span><br><span class="line">-- 求分组之后的生成的表里平均价格大于2000的手机品牌</span><br><span class="line"></span><br><span class="line"># 4.需求：求评分score &gt; 7.5的手机的，平均价格是多少？</span><br><span class="line"># 升级：评分大于7.5的手机，按照品牌进行分类，求出平均价格。</span><br><span class="line">-- 每个品牌评分大于7.5分的手机求平均价格</span><br><span class="line">SELECT brand, AVG(price) FROM `products` WHERE score &gt; 7.5 GROUP BY brand;</span><br><span class="line"></span><br><span class="line">-- 保留两位小数</span><br><span class="line">ROUND(AVG(price), 2)</span><br></pre></td></tr></table></figure><h4 id="外键约束-amp-多表查询"><a href="#外键约束-amp-多表查询" class="headerlink" title="外键约束&amp;多表查询"></a>外键约束&amp;多表查询</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- 创建表时添加外键约束</span><br><span class="line">create table products(</span><br><span class="line">  -- 定义的字段……,</span><br><span class="line">	foreign key(brand_id) references brand(id)	-- brand_id字段引用brand表的id字段作为外键</span><br><span class="line">)</span><br><span class="line">-- 删除一列</span><br><span class="line">alter table `products` drop `brand_id`;</span><br><span class="line">-- 给已经创建好的表添加一个字段</span><br><span class="line">alter table `products` add `brand_id` int;</span><br><span class="line">-- 给已经创建好的表设置外键,修改brand_id为外键</span><br><span class="line">alter table `products` add foreign key(brand_id) references brand(id);</span><br><span class="line">-- 设置brand_id的值</span><br><span class="line">update `products` set `brand_id` = 1 where `brand` = &#x27;华为&#x27;;</span><br></pre></td></tr></table></figure><h5 id="外键存在时更新和删除数据"><a href="#外键存在时更新和删除数据" class="headerlink" title="外键存在时更新和删除数据"></a><strong>外键存在时更新和删除数据</strong></h5><p>需要修改 on delete 或者 on update 的值，可以给更新或者删除时设置几个值:</p><ul><li>RESTRICT（默认属性）：当更新或删除某个记录时，会检查该记录是否有关联的外键记录，有的话会报错的， 不允许更新或删除</li><li>NO ACTION：和 RESTRICT 是一致的，是在 SQL 标准中定义的</li><li>CASCADE：当更新或删除某个记录时，会检查该记录是否有关联的外键记录，有的话：<ul><li>更新：那么会更新对应的记录</li><li>删除：那么关联的记录会被一起删除掉</li></ul></li><li>SET NULL：当更新或删除某个记录时，会检查该记录是否有关联的外键记录，有的话，将对应的值设置为 NULL</li></ul><p>修改关联外键的 action</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- 1.获取到目前的关联外键的名称</span><br><span class="line">SHOW CREATE TABLE `products`;</span><br><span class="line"># CONSTRAINT `products_ibfk_1` FOREIGN KEY (`brand_id`) REFERENCES `brand` (`id`)</span><br><span class="line">-- 2.根据名称将外键删除</span><br><span class="line">ALTER TABLE `products` DROP FOREIGN KEY products_ibfk_1;</span><br><span class="line">-- 3.重新添加外键约束</span><br><span class="line">ALTER TABLE `products` ADD FOREIGN KEY (brand_id) REFERENCES brand(id)</span><br><span class="line">		ON UPDATE CASCADE -- 修改时使用级联修改</span><br><span class="line">		ON DELETE RESTRICT; -- 删除时使用默认的删除action</span><br></pre></td></tr></table></figure><h5 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a><strong>多表查询</strong></h5><p>笛卡尔积：第一个表的每一条数据都和第二个表的每一条数据结合形成的结果</p><p>多表连接(SQL JOIN)：</p><ul><li><p>左连接</p><p>左表的记录将会全部表示出来，而右表只会显示符合搜索条件的记录。右表记录不足的地方均为 NULL</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- ON后加限制条件：通过什么条件进行连接 ，左连接outer可以省略，只写left join</span><br><span class="line"># 2.1. 查询所有的手机（包括没有品牌信息的手机）以及对应的品牌 null</span><br><span class="line">SELECT * FROM `products` LEFT OUTER JOIN `brand` ON products.brand_id = brand.id;</span><br><span class="line"></span><br><span class="line"># 2.2. 查询没有对应品牌数据的手机</span><br><span class="line">SELECT * FROM `products` LEFT JOIN `brand` ON products.brand_id = brand.id WHERE brand.id IS NULL;</span><br></pre></td></tr></table></figure><ul><li><p>右连接</p><p>左表只会显示符合搜索条件的记录，而右表的记录将会全部表示出来。左表记录不足的地方均为 NULL。</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 3.1. 查询所有的品牌（没有对应的手机数据，品牌也显示）以及对应的手机数据；</span><br><span class="line">SELECT * FROM `products` RIGHT OUTER JOIN `brand` ON products.brand_id = brand.id;</span><br><span class="line"></span><br><span class="line"># 3.2. 查询没有对应手机的品牌信息</span><br><span class="line">SELECT * FROM `products` RIGHT JOIN `brand` ON products.brand_id = brand.id WHERE products.brand_id IS NULL;</span><br></pre></td></tr></table></figure><ul><li><p>内连接</p><p>组合两个表中的记录，返回关联字段相符的记录，也就是返回两个表的交集部分。</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 4.内连接</span><br><span class="line">SELECT * FROM `products` JOIN `brand` ON products.brand_id = brand.id;</span><br><span class="line">SELECT * FROM `products` JOIN `brand` ON products.brand_id = brand.id WHERE price = 8699;</span><br></pre></td></tr></table></figure><ul><li><p>全连接</p><p>MySQL 不支持全连接，左右连接结合起来实现全连接的效果</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(SELECT * FROM `products` LEFT OUTER JOIN `brand` ON products.brand_id = brand.id)</span><br><span class="line">UNION</span><br><span class="line">(SELECT * FROM `products` RIGHT OUTER JOIN `brand` ON products.brand_id = brand.id)</span><br><span class="line"></span><br><span class="line">(SELECT * FROM `products` LEFT OUTER JOIN `brand` ON products.brand_id = brand.id WHERE brand.id IS NULL)</span><br><span class="line">UNION</span><br><span class="line">(SELECT * FROM `products` RIGHT OUTER JOIN `brand` ON products.brand_id = brand.id WHERE products.brand_id IS NULL)</span><br></pre></td></tr></table></figure><h4 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h4><p>两个多对多关系表之间加一个关系表，用于联系两张表</p><p>联合主键</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists students_select_course(</span><br><span class="line">	id int primary key auto_increment,</span><br><span class="line">	sid int not null,</span><br><span class="line">	cid int not null,</span><br><span class="line">	foreign key (sid) references students(id) on update cascade,</span><br><span class="line">	foreign key (cid) references courses(id) on update cascade,</span><br><span class="line">	primary key (sid, cid);	-- 联合主键</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>查询需求</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">-- 17</span><br><span class="line">-- 查询所有有选课的学生选择了哪些课程</span><br><span class="line">select stu.id stuId, stu.name stuName,stu.age stuAge,cs.id csId, cs.name csName, cs.price csPrice</span><br><span class="line">from students stu</span><br><span class="line">join students_select_course ssc on stu.id = ssc.sid</span><br><span class="line">join courses cs on ssc.cid = cs.id;</span><br><span class="line"></span><br><span class="line">-- 查询所有学生的选课情况</span><br><span class="line">select stu.id stuId, stu.name stuName,stu.age stuAge,cs.id csId, cs.name csName, cs.price csPrice</span><br><span class="line">from students stu</span><br><span class="line">left join students_select_course ssc on stu.id = ssc.sid</span><br><span class="line">left join courses cs on ssc.cid = cs.id;</span><br><span class="line"></span><br><span class="line">-- 查询哪些学生没有选课</span><br><span class="line">select stu.id stuId, stu.name stuName,stu.age stuAge,cs.id csId, cs.name csName, cs.price csPrice</span><br><span class="line">from students stu</span><br><span class="line">left join students_select_course ssc on stu.id = ssc.sid</span><br><span class="line">left join courses cs on ssc.cid = cs.id</span><br><span class="line">where cs.id is null;	-- 此处无法使用select后面取的别名</span><br><span class="line"></span><br><span class="line">-- 查询哪些课程没有被学生选择的</span><br><span class="line">select stu.id stuId, stu.name stuName,stu.age stuAge,cs.id csId, cs.name csName, cs.price csPrice</span><br><span class="line">from students stu</span><br><span class="line">right join students_select_course ssc on stu.id = ssc.sid</span><br><span class="line">right join courses cs on ssc.cid = cs.id</span><br><span class="line">where stu.id is null;</span><br><span class="line"></span><br><span class="line">-- 某一个学生选择了哪些课程</span><br><span class="line">select stu.id stuId, stu.name stuName,stu.age stuAge,cs.id csId, cs.name csName, cs.price csPrice</span><br><span class="line">from students stu</span><br><span class="line">left join students_select_course ssc on stu.id = ssc.sid</span><br><span class="line">left join courses cs on ssc.cid = cs.id</span><br><span class="line">where stu.`name` = &#x27;why&#x27;;</span><br></pre></td></tr></table></figure><p>数据转对象或数组</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 将联合查询到的数据转成对象(一对多)</span><br><span class="line">SELECT products.id id, products.title title,products.price price,</span><br><span class="line">	JSON_OBJECT(&#x27;id&#x27;, brand.id, &#x27;name&#x27;, brand.`name`, &#x27;website&#x27;, brand.website) brand	-- 放入对象</span><br><span class="line">FROM products LEFT JOIN brand on products.brand_id = brand.id;</span><br><span class="line"></span><br><span class="line">#将查询到的多条数据，组织成对象，放入到一个数组中(多对多)</span><br><span class="line">select</span><br><span class="line">	stu.id id, stu.name name,stu.age age,</span><br><span class="line">	-- cs.id csId, cs.name csName, cs.price csPrice</span><br><span class="line">	JSON_ARRAYAGG(JSON_OBJECT(&#x27;id&#x27;, cs.id, &#x27;name&#x27;, cs.`name`, &#x27;price&#x27;, cs.price)) course	-- 放入对象，再把对象放入数组</span><br><span class="line">from students stu</span><br><span class="line">join students_select_course ssc on stu.id = ssc.sid</span><br><span class="line">join courses cs on ssc.cid = cs.id</span><br><span class="line">GROUP BY stu.id;</span><br></pre></td></tr></table></figure><h4 id="Node-中操作数据库"><a href="#Node-中操作数据库" class="headerlink" title="Node 中操作数据库"></a>Node 中操作数据库</h4><p>在 node 代码中执行 sql 语句：</p><ul><li>mysql：最早的 node 连接 mysql 的数据库驱动</li><li>mysql2：在 mysql 的基础上，进行了很多优化、改进</li></ul><p>安装 mysql2</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mysql2</span><br></pre></td></tr></table></figure><h5 id="mysql2-基本使用"><a href="#mysql2-基本使用" class="headerlink" title="mysql2 基本使用"></a>mysql2 基本使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>) <span class="comment">//导入模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.创建数据库连接</span></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">3306</span>, <span class="comment">// 默认3306，可省略不写</span></span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;coderhub&#x27;</span>, <span class="comment">// 操作的数据库名称</span></span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;123.&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//2.执行sql语句</span></span><br><span class="line"><span class="keyword">const</span> statement = <span class="string">`</span></span><br><span class="line"><span class="string">  SELECT * FROM products WHERE price &gt; 9000;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line">connection.query(statement, <span class="function">(<span class="params">err, result, fields</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//执行,回调函数中拿到结果</span></span><br><span class="line">  <span class="built_in">console</span>.log(result)</span><br><span class="line">  connection.end() <span class="comment">//拿到结果后终止程序</span></span><br><span class="line">  <span class="comment">// connection.destroy();  //拿到结果后终止程序</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="预处理语句"><a href="#预处理语句" class="headerlink" title="预处理语句"></a>预处理语句</h5><p>Prepared Statement（预编译语句）:</p><ul><li>提高性能：将创建的语句模块发送给 MySQL，然后 MySQL 编译（解析、优化、转换）语句模块，并且存储 它但是不执行，之后我们在真正执行时会给?提供实际的参数才会执行；就算多次执行，也只会编译一次，所 以性能是更高的；</li><li>防止 SQL 注入：之后传入的值不会像模块引擎那样就编译，那么一些 SQL 注入的内容不会被执行；or 1 = 1 不 会被执行；</li><li>如果再次执行该语句，它将会从 LRU（Least Recently Used） Cache 中获取获取，省略了编译 statement 的时间来提高性能。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">3306</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;coderhub&#x27;</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;123.&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> statement = <span class="string">`</span></span><br><span class="line"><span class="string">  SELECT * FROM products WHERE price &gt; ? AND score &gt; ?;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line">connection.execute(statement, [<span class="number">6000</span>, <span class="number">7</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//查询价格大于600评分高于7的手机</span></span><br><span class="line">  <span class="built_in">console</span>.log(result)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>) <span class="comment">//导入模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.创建连接池</span></span><br><span class="line"><span class="keyword">const</span> connections = mysql.createPool(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">3306</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;coderhub&#x27;</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;123.&#x27;</span>,</span><br><span class="line">  <span class="attr">connectionLimit</span>: <span class="number">10</span>, <span class="comment">//最多允许建立几个连接</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> statement = <span class="string">`</span></span><br><span class="line"><span class="string">  SELECT * FROM products WHERE price &gt; ? AND score &gt; ?;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.使用连接池</span></span><br><span class="line">connections.execute(statement, [<span class="number">6000</span>, <span class="number">7</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>promise 方式使用连接池</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>) <span class="comment">//导入模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.创建连接池</span></span><br><span class="line"><span class="keyword">const</span> connections = mysql.createPool(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">3306</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;coderhub&#x27;</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;123.&#x27;</span>,</span><br><span class="line">  <span class="attr">connectionLimit</span>: <span class="number">10</span>, <span class="comment">//最多允许建立几个连接</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> statement = <span class="string">`</span></span><br><span class="line"><span class="string">  SELECT * FROM products WHERE price &gt; ? AND score &gt; ?;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.使用连接池</span></span><br><span class="line">connections</span><br><span class="line">  .promise()</span><br><span class="line">  .execute(statement, [<span class="number">6000</span>, <span class="number">7</span>])</span><br><span class="line">  .then(<span class="function">(<span class="params">[results]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(results) <span class="comment">//打印结果</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err) <span class="comment">//打印错误信息</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h5 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h5><p>对象关系映射(Object Relational Mapping):</p><ul><li>简称 ORM，或 O/RM，或 O/R mapping，是一种程序设计的方案</li><li>提供了一个可在编程语言中，使用虚拟对象数据库的效果</li><li>node 中的 ORM 通常使用的是 sequelize</li></ul><p>如果希望将 Sequelize 和 mysql 一起使用，需要安装两个东西：</p><ul><li>mysql2：sequelize 在操作 mysql 的时候使用的是 mysql2</li><li>sequelize：使用它来让对象映射到表中</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mysql2 sequelize</span><br></pre></td></tr></table></figure><p><strong>基本使用</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建一个Sequelize对象，并且指定数据库、用户名、密码、数据库类型、主机地址等</span></span><br><span class="line"><span class="keyword">const</span> &#123; Sequelize &#125; = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;coderhub&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;123.&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">//数据库名字 用户名 密码</span></span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">dialect</span>: <span class="string">&#x27;mysql&#x27;</span>, <span class="comment">//数据库类型</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//2.测试连接是否成功</span></span><br><span class="line">sequelize</span><br><span class="line">  .authenticate()</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;连接数据库成功&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;连接数据库失败&#x27;</span>, err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>其他使用见视频 18</p><h3 id="项目实战"><a href="#项目实战" class="headerlink" title="项目实战"></a>项目实战</h3><p>完整的项目接口包括：</p><ul><li>面向用户的业务接口</li><li>面向企业或内部的后台管理接口</li></ul><h4 id="安装-3"><a href="#安装-3" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">npm init -y   # 项目描述信息</span><br><span class="line">npm install koa # 安装node框架koa</span><br><span class="line">npm install nodemon --save-dev	#热启动,开发阶段使用 或者-D</span><br><span class="line"><span class="meta">#</span><span class="bash">需修改package.json</span></span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;nodemon ./src/main.js&quot;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 后续启动项目使用  npm start</span></span><br><span class="line">npm install dotenv  #加载当前根目录下.env文件，将里面的数据加载到环境变量里面</span><br><span class="line">npm install koa-router #koa的路由库</span><br><span class="line">npm install koa-bodyparser #解析传过来的json数据</span><br><span class="line">npm install mysql2 #连接数据库的驱动</span><br><span class="line"><span class="meta">#</span><span class="bash"> crypto：node中自带的用于加密密码的库</span></span><br><span class="line">npm install jsonwebtoken #加密密码产生密钥的第三方库</span><br><span class="line">npm install koa-multer #上传文件所用的第三方库</span><br><span class="line">npm install jimp #对图像大小进行处理，库小一点</span><br><span class="line">npm install sharp #对图像大小进行处理，库大一点</span><br><span class="line">npm install koa2-cors #解决跨域访问</span><br><span class="line">npm install svg-captcha #生成图形验证码</span><br></pre></td></tr></table></figure><h4 id="目录结构划分"><a href="#目录结构划分" class="headerlink" title="目录结构划分"></a>目录结构划分</h4><p>常见划分方式：</p><ul><li>按照功能模块划分</li><li>按照业务模块划分</li></ul><p>coderhub：</p><ul><li>src<ul><li>main.js //入口文件</li><li>app //放置全局相关的东西<ul><li>keys //放置 token 的私钥和公钥</li><li>config.js //加载.env 的环境变量,存放其他全局常量(私钥公钥等)</li><li>database.js //数据库连接池</li><li>error-handle.js //错误处理函数</li><li>index.js //放置对 app 的操作</li></ul></li><li>constants //存放常量<ul><li>error-types.js //错误类型</li><li>file-path.js //文件路径</li></ul></li><li>controller //放所有的控制器，路由的处理逻辑在此编写</li><li>middleware //放一些中间件</li><li>router //注册路由<ul><li>index.js //自动加载路由</li><li>***.router.js //负责注册接口</li></ul></li><li>service //放与数据库操作相关的东西</li><li>utils //放工具<ul><li>password-handle.js //使用 token 加密密码</li></ul></li></ul></li><li>.env // 放置环境变量，应用程序的配置</li></ul><h4 id="登录凭证"><a href="#登录凭证" class="headerlink" title="登录凭证"></a>登录凭证</h4><h5 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h5><p>Cookie(复数 Cookies)，又称小甜饼，类型为小型文本文件，某些网站为了辨别用户身份而存储在用户本地终端上的数据</p><ul><li>浏览器会在特定的情况下携带上 cookie 来发送请求，我们可以通过 cookie 来获取一些信息</li><li>Cookie 总是保存在客户端中，按在客户端中的存储位置，Cookie 可以分为内存 Cookie 和硬盘 Cookie<ul><li>没有设置过期时间，默认情况下 cookie 是内存 cookie(也称会话 cookie)</li><li>内存 Cookie 由浏览器维护，保存在内存中，浏览器关闭时 Cookie 就会消失，其存在时间是短暂的</li><li>有设置过期时间，并且过期时间不为 0 或者负数的 cookie，是硬盘 cookie</li><li>硬盘 Cookie 保存在硬盘中，有一个过期时间，用户手动清理或者过期时间到时，才会被清理</li></ul></li></ul><p><strong>常见属性</strong></p><p>生命周期</p><ul><li>可以通过设置 expires 或者 max-age 来设置过期的时间<ul><li>expires：设置的是 Date.toUTCString()，设置格式是;expires=date-in-GMTString-format</li><li>max-age：设置过期的秒钟，;max-age=max-age-in-seconds (例如一年为 60<em>60</em>24*365)</li></ul></li></ul><p>作用域(允许 cookie 发送给哪些 URL)</p><ul><li>Domain：指定哪些主机可以接受 cookie<ul><li>如果不指定，那么默认是 origin，不包括子域名</li><li>如果指定 Domain，则包含子域名。</li></ul></li><li>Path：指定主机下哪些路径可以接受 cookie<ul><li>设置 Path=/docs，则以下地址都会匹配</li><li>/docs</li><li>/docs/Web/</li><li>/docs/Web/HTTP</li></ul></li></ul><p>设置 cookie</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="comment">// document.cookie = &quot;name=coderwhy&quot;;</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">&#x27;age=18;max-age=5;&#x27;</span> <span class="comment">//5秒钟后过期</span></span><br><span class="line"><span class="comment">//删除cookie：设置值为空，过期时间为0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//服务器端设置cookie</span></span><br><span class="line"><span class="comment">// maxAge对应毫秒</span></span><br><span class="line">ctx.cookies.set(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;lilei&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">maxAge</span>: <span class="number">50</span> * <span class="number">1000</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 读取cookie</span></span><br><span class="line"><span class="keyword">const</span> value = ctx.cookies.get(<span class="string">&#x27;name&#x27;</span>)</span><br></pre></td></tr></table></figure><h5 id="session"><a href="#session" class="headerlink" title="session"></a>session</h5><p>不能在客户端设置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-session</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Session = <span class="built_in">require</span>(<span class="string">&#x27;koa-session&#x27;</span>) <span class="comment">//一个函数</span></span><br><span class="line"><span class="comment">// 创建Session的配置</span></span><br><span class="line"><span class="keyword">const</span> session = Session(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;sessionid&#x27;</span>,</span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">10</span> * <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">signed</span>: <span class="literal">true</span>, <span class="comment">// 是否使用加密签名,默认为true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  app</span><br><span class="line">)</span><br><span class="line">app.keys = [<span class="string">&#x27;aaaa&#x27;</span>]</span><br><span class="line">app.use(session)</span><br><span class="line">ctx.session.user = &#123; id, name &#125; <span class="comment">//存入数据到session</span></span><br></pre></td></tr></table></figure><h5 id="token"><a href="#token" class="headerlink" title="token"></a>token</h5><p><strong>cookie 和 session 缺点</strong>：</p><ul><li>Cookie 会被附加在每个 HTTP 请求中，所以无形中增加了流量</li><li>Cookie 是明文传递的，所以存在安全性的问题</li><li>Cookie 的大小限制是 4KB，对于复杂的需求来说是不够的</li><li>对于浏览器外的其他客户端（比如 iOS、Android），必须手动的设置 cookie 和 session</li><li>对于分布式系统和服务器集群中如何可以保证其他系统也可以正确的解析 session？</li></ul><p>token，翻译为令牌，验证了用户账号和密码正确的情况下，给用户颁发一个令牌，作为后续用户访问一些接口或资源的凭证，以此判断用户是否有权限访问</p><p><strong>token 的使用</strong>：</p><ol><li>生成 token：登录的时候颁发 token</li><li>验证 token：访问某些资源或接口的时候，验证 token</li></ol><p><strong>JWT 实现 Token 机制</strong></p><p>JWT(json web token)生成的 Token 由三部分组成：</p><ol><li>header<ul><li>alg：采用的加密算法，默认是 HMAC SHA256（HS256），采用同一个密钥进行 加密和解密</li><li>typ：JWT，固定值，通常都写成 JWT 即可</li><li>会通过 base64Url 算法进行编码</li></ul></li><li>payload<ul><li>携带的数据，比如我们可以将用户的 id 和 name 放到 payload 中</li><li>默认也会携带 iat（issued at），令牌的签发时间</li><li>我们也可以设置过期时间：exp（expiration time）</li><li>会通过 base64Url 算法进行编码</li></ul></li><li>signature<ul><li>设置一个 secretKey，通过将前两个的结果合并后进行 HMACSHA256 的算法</li><li>HMACSHA256(base64Url(header)+.+base64Url(payload), secretKey)</li><li>但是如果 secretKey 暴露是一件非常危险的事情，因为之后就可以模拟颁发 token， 也可以解密 token</li></ul></li></ol><p><strong>Token 的使用</strong></p><p>安装库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jsonwebtoken</span><br></pre></td></tr></table></figure><p>token 对称加密</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>) <span class="comment">//导入token</span></span><br><span class="line"><span class="keyword">const</span> SECRET_KEY = <span class="string">&#x27;abcdsad123&#x27;</span> <span class="comment">//密钥,自己设置,解密时需要用到</span></span><br><span class="line"><span class="comment">//登录接口</span></span><br><span class="line">testRouter.post(<span class="string">&#x27;/test&#x27;</span>, <span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> user = &#123; <span class="attr">id</span>: <span class="number">110</span>, <span class="attr">name</span>: <span class="string">&#x27;kobe&#x27;</span> &#125;</span><br><span class="line">  <span class="keyword">const</span> token = jwt.sign(user, SECRET_KEY, &#123;</span><br><span class="line">    <span class="comment">//颁发令牌,参数1：携带的数据,参数2：携带的密钥,参数3:额外参数</span></span><br><span class="line">    <span class="attr">expiresIn</span>: <span class="number">10</span>, <span class="comment">//10秒后过期</span></span><br><span class="line">  &#125;)</span><br><span class="line">  ctx.body = token <span class="comment">//返回token</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//验证接口</span></span><br><span class="line">testRouter.get(<span class="string">&#x27;/demo&#x27;</span>, <span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> authorization = ctx.headers.authorization <span class="comment">//拿到授权的token</span></span><br><span class="line">  <span class="keyword">const</span> token = authorization.replace(<span class="string">&#x27;Bearer &#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 替换多余字符串，拿到真正的token</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//token过期时捕获异常</span></span><br><span class="line">    <span class="keyword">const</span> result = jwt.verify(token, SECRET_KEY) <span class="comment">//使用密钥验证token</span></span><br><span class="line">    ctx.body = result <span class="comment">//验证成功,返回验证结果</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    ctx.body = <span class="string">&#x27;token是无效的&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>token 非对称加密</p><ul><li>私钥(private Key)：用于发布令牌</li><li>公钥(public Key)：用于验证令牌</li></ul><p>openssl 在 windows 的 cmd 中无法直接使用，git bash 中可以直接使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1.在要生成私钥的文件夹打开git bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">2.输入命令</span></span><br><span class="line">openssl</span><br><span class="line"><span class="meta">#</span><span class="bash">3.生成rsa的私钥(名字为private.key，长度为1024)</span></span><br><span class="line">genrsa -out private.key 1024</span><br><span class="line"><span class="meta">#</span><span class="bash">4.通过私钥生产公钥</span></span><br><span class="line">rsa -in private.key -pubout -out public.key</span><br></pre></td></tr></table></figure><p>私钥加密，公钥验证</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>) <span class="comment">//导入token</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PRIVATE_KEY = fs.readFileSync(<span class="string">&#x27;./keys/private.key&#x27;</span>) <span class="comment">//拿到私钥,Buffer</span></span><br><span class="line"><span class="keyword">const</span> PUBLIC_KEY = fs.readFileSync(<span class="string">&#x27;./keys/public.key&#x27;</span>) <span class="comment">//拿到公钥,Buffer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//登录接口</span></span><br><span class="line">testRouter.post(<span class="string">&#x27;/test&#x27;</span>, <span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> user = &#123; <span class="attr">id</span>: <span class="number">110</span>, <span class="attr">name</span>: <span class="string">&#x27;kobe&#x27;</span> &#125;</span><br><span class="line">  <span class="keyword">const</span> token = jwt.sign(user, PRIVATE_KEY, &#123;</span><br><span class="line">    <span class="comment">//签发token</span></span><br><span class="line">    <span class="attr">expiresIn</span>: <span class="number">10</span>, <span class="comment">//10秒后过期</span></span><br><span class="line">    <span class="attr">algorithm</span>: <span class="string">&#x27;RS256&#x27;</span>, <span class="comment">//告知使用的加密算法</span></span><br><span class="line">  &#125;) <span class="comment">//颁发令牌,参数1：携带的数据,参数2：携带的私钥,参数3:额外参数</span></span><br><span class="line">  ctx.body = token <span class="comment">//返回token</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//验证接口</span></span><br><span class="line">testRouter.get(<span class="string">&#x27;/demo&#x27;</span>, <span class="function">(<span class="params">ctx, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> authorization = ctx.headers.authorization <span class="comment">//拿到授权的token</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//token过期时捕获异常</span></span><br><span class="line">    <span class="keyword">const</span> token = authorization.replace(<span class="string">&#x27;Bearer &#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 替换多余字符串，拿到真正的token</span></span><br><span class="line">    <span class="keyword">const</span> result = jwt.verify(token, PUBLIC_KEY, &#123;</span><br><span class="line">      <span class="attr">algorithms</span>: [<span class="string">&#x27;RS256&#x27;</span>], <span class="comment">//告知加密算法</span></span><br><span class="line">    &#125;) <span class="comment">//使用公钥验证token</span></span><br><span class="line">    ctx.body = result <span class="comment">//验证成功,返回验证结果</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    ctx.body = <span class="string">&#x27;token是无效的&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="crypto-加密密码"><a href="#crypto-加密密码" class="headerlink" title="crypto 加密密码"></a>crypto 加密密码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>) <span class="comment">//</span></span><br><span class="line"><span class="keyword">const</span> md5password = <span class="function">(<span class="params">password</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> md5 = crypto.createHash(<span class="string">&#x27;md5&#x27;</span>) <span class="comment">//调用哈希函数,采用md5的加密方式,返回一个对象</span></span><br><span class="line">  <span class="keyword">const</span> result = md5.update(password).digest(<span class="string">&#x27;hex&#x27;</span>) <span class="comment">// 不写hex拿到的是一个buffer</span></span><br><span class="line">  <span class="comment">// 对密码进行加密，并拿到加密之后的字符串,将加密之后生产的二进制转成16进制</span></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = md5password</span><br></pre></td></tr></table></figure><h5 id="相对路径补充"><a href="#相对路径补充" class="headerlink" title="相对路径补充"></a>相对路径补充</h5><p>在项目中的任何一个地方的相对路径，都是相对于 process.cwd(启动项目时所在的文件夹)</p><h5 id="http-响应代码"><a href="#http-响应代码" class="headerlink" title="http 响应代码"></a>http 响应代码</h5><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRUUC9TdGF0dXM=">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status<i class="fa fa-external-link-alt"></i></span></p><h4 id="jimp-图像处理"><a href="#jimp-图像处理" class="headerlink" title="jimp 图像处理"></a>jimp 图像处理</h4><p>作用等同于 sharp 库</p><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jimp</span><br></pre></td></tr></table></figure><p>代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> jimp = <span class="built_in">require</span>(<span class="string">&#x27;jimp&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">  <span class="keyword">const</span> destPath = path.join(file.destination, file.filename) <span class="comment">//路径拼接</span></span><br><span class="line">  jimp.read(file.path).then(<span class="function">(<span class="params">image</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//读物某一个文件,根据传进来的图像通过read，创建一个image对象</span></span><br><span class="line">    image.resize(<span class="number">1280</span>, jimp.AUTO).write(<span class="string">`<span class="subst">$&#123;destPath&#125;</span>-large`</span>) <span class="comment">//宽缩放为1280，高根据宽度按比例缩放,写入到destPath里面</span></span><br><span class="line">    image.resize(<span class="number">640</span>, jimp.AUTO).write(<span class="string">`<span class="subst">$&#123;destPath&#125;</span>-middle`</span>) <span class="comment">//中图</span></span><br><span class="line">    image.resize(<span class="number">320</span>, jimp.AUTO).write(<span class="string">`<span class="subst">$&#123;destPath&#125;</span>-small`</span>) <span class="comment">//小图</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="生成图形验证码"><a href="#生成图形验证码" class="headerlink" title="生成图形验证码"></a>生成图形验证码</h4><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install svg-captcha</span><br></pre></td></tr></table></figure><p>生成：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.生成有4个字符的图片和字符串</span></span><br><span class="line"><span class="keyword">const</span> svgCaptcha = <span class="built_in">require</span>(<span class="string">&#x27;svg-captcha&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cap = svgCaptcha.create(&#123;</span><br><span class="line">  <span class="attr">size</span>: <span class="number">4</span>, <span class="comment">// 验证码长度</span></span><br><span class="line">  <span class="attr">width</span>: <span class="number">160</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">60</span>,</span><br><span class="line">  <span class="attr">fontSize</span>: <span class="number">50</span>,</span><br><span class="line">  <span class="attr">ignoreChars</span>: <span class="string">&#x27;0oO1ilI&#x27;</span>, <span class="comment">// 验证码字符中排除 0o1i</span></span><br><span class="line">  <span class="attr">noise</span>: <span class="number">2</span>, <span class="comment">// 干扰线条的数量</span></span><br><span class="line">  <span class="attr">color</span>: <span class="literal">true</span>, <span class="comment">// 验证码的字符是否有颜色，默认没有，如果设定了背景，则默认有</span></span><br><span class="line">  <span class="attr">background</span>: <span class="string">&#x27;#eee&#x27;</span>, <span class="comment">// 验证码图片背景颜色</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(c)</span><br><span class="line"><span class="comment">// &#123;data: &#x27;&lt;svg.../svg&gt;&#x27;, text: &#x27;abcd&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.生成一个算术式和计算结果</span></span><br><span class="line"><span class="keyword">const</span> cap = svgCaptcha.createMathExpr(&#123;</span><br><span class="line">  <span class="attr">size</span>: <span class="number">4</span>, <span class="comment">// 验证码长度</span></span><br><span class="line">  <span class="attr">width</span>: <span class="number">160</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">60</span>,</span><br><span class="line">  <span class="attr">fontSize</span>: <span class="number">50</span>,</span><br><span class="line">  <span class="attr">ignoreChars</span>: <span class="string">&#x27;0oO1ilI&#x27;</span>, <span class="comment">// 验证码字符中排除 0o1i</span></span><br><span class="line">  <span class="attr">noise</span>: <span class="number">2</span>, <span class="comment">// 干扰线条的数量</span></span><br><span class="line">  <span class="attr">color</span>: <span class="literal">true</span>, <span class="comment">// 验证码的字符是否有颜色，默认没有，如果设定了背景，则默认有</span></span><br><span class="line">  <span class="attr">background</span>: <span class="string">&#x27;#eee&#x27;</span>, <span class="comment">// 验证码图片背景颜色</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fourChar.text = fourChar.text.toLowerCase() <span class="comment">//验证码字符，忽略大小写</span></span><br><span class="line"><span class="comment">//前端展示</span></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">dangerouslySetInnerHTML</span>=<span class="string">&#123;&#123;</span> <span class="attr">__html:</span> <span class="attr">captchaSvg</span> &#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="comment">// let img = fourChar.data; //验证码图片</span></span><br><span class="line"><span class="comment">// let text = fourChar.text.toLowerCase(); //验证码字符，忽略大小写</span></span><br><span class="line"><span class="comment">// ctx.type = &#x27;html&#x27;;</span></span><br><span class="line"><span class="comment">// ctx.body = `$&#123;img&#125;&lt;br&gt;&lt;a href=&quot;##&quot;&gt;$&#123;text&#125;&lt;/a&gt;`</span></span><br></pre></td></tr></table></figure><h3 id="云服务器自动化部署"><a href="#云服务器自动化部署" class="headerlink" title="云服务器自动化部署"></a>云服务器自动化部署</h3><h4 id="购买云服务器"><a href="#购买云服务器" class="headerlink" title="购买云服务器"></a>购买云服务器</h4><p>注册阿里云账号：</p><p><span class="exturl" data-url="aHR0cDovL3d3dy5hbGl5dW4uY29tLw==">www.aliyun.com<i class="fa fa-external-link-alt"></i></span></p><p>控制台-&gt;云服务器 ECS-&gt;实例-&gt;创建实例</p><ul><li><p>付费模式：包年包月(活动期间会偏移很多) 按量付费(按流量来)</p></li><li><p>地域及可用区：选离自己近一点的地方，访问会快一点</p></li><li><p>实例配置：2vCPU 4GiB 高主频计算型</p></li><li><p>镜像(服务器准备安装的操作系统)：CentOS 8.2 64 位 (自带 dnf 包管理器)</p></li><li><p>存储云盘：40 GiB</p></li></ul><p>下一步：</p><ul><li>安全组：除了 3389 其它都勾选</li><li>其他默认</li></ul><p>下一步：</p><ul><li>登录凭证：选择自定义密码</li><li>实例名称：自定义</li><li>主机名：自定义</li></ul><p>下一步：</p><ul><li>默认</li></ul><p>下一步：确认订单</p><h4 id="配置云服务器"><a href="#配置云服务器" class="headerlink" title="配置云服务器"></a>配置云服务器</h4><h5 id="连接云服务器"><a href="#连接云服务器" class="headerlink" title="连接云服务器"></a>连接云服务器</h5><p>windows 上使用 git bash ssh 工具</p><p>连接：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh root@8.134.6.135 #root:账户面 8.……：公有ip地址</span><br><span class="line"><span class="meta">#</span><span class="bash"> 回车，输入密码</span></span><br></pre></td></tr></table></figure><h5 id="安装-Node-js"><a href="#安装-Node-js" class="headerlink" title="安装 Node.js"></a>安装 Node.js</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dnf search nodejs #搜索软件</span><br><span class="line">dnf info nodejs #查看包的详细信息</span><br><span class="line">dnf install nodejs #安装nodejs</span><br><span class="line">node --version #查看版本号</span><br><span class="line">npm install -g n #安装管理多个node版本的工具</span><br><span class="line">n install lts #使用n安装最新的lts</span><br><span class="line">n install latest #通过n安装最新的current</span><br><span class="line">n  #通过n切换版本</span><br></pre></td></tr></table></figure><p>若发现切换之后终端没有反应，可以进行重启：</p><ul><li>方式一：重新通过 shh 建立连接</li><li>方式二：重启 ssh: service sshd restart</li></ul><h5 id="安装-MySQL"><a href="#安装-MySQL" class="headerlink" title="安装 MySQL"></a>安装 MySQL</h5><h6 id="安装-mySQL"><a href="#安装-mySQL" class="headerlink" title="安装 mySQL"></a>安装 mySQL</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dnf search mysql-server #</span><br><span class="line">dnf info mysql-server</span><br><span class="line">dnf install mysql-server -y #安装,加-y的意思是依赖的内容也安装</span><br></pre></td></tr></table></figure><p>启动 mysql-server</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld   # 开启MySQL后台服务</span><br><span class="line">systemctl status mysqld  # 查看MySQL服务：active (running)表示启动成功</span><br><span class="line">systemctl enable mysqld # 让mysqld随着系统⼀起启动</span><br></pre></td></tr></table></figure><h6 id="配置-mySQL"><a href="#配置-mySQL" class="headerlink" title="配置 mySQL"></a>配置 mySQL</h6><p>配置 MySQL 账号和密码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br><span class="line"><span class="meta">#</span><span class="bash"> 接下来有⼀些选项，⽐如密码强度等等⼀些</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MySQL8开始通常设置密码强度较强，选择2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 其他的选项可以⾃⾏选择</span></span><br></pre></td></tr></table></figure><p>现在，我们就可以直接在服务器中操作 MySQL 了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p #在服务器连接mysql 后面会提示输入密码Ysj123.0</span><br></pre></td></tr></table></figure><p>在自己电脑上远程连接 mysql 需要进行的配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">可在navicat里面新建连接，以在本地操作远程的数据库</span></span><br><span class="line">mysql -u root -p #在服务器连接mysql 后面会提示输入密码Ysj123.0</span><br><span class="line"></span><br><span class="line">use mysql; #使用mysql数据库</span><br><span class="line">select host, user from user; #查看user表中连接权限，默认看到root是localhost</span><br><span class="line">update user set host = &#x27;%&#x27; where user = &#x27;root&#x27;;	#修改权限，是navicat能远程连接服务器中的数据库,%表示任何地址都可以连接上</span><br><span class="line"><span class="meta">#</span><span class="bash">若此时navicat还是无法连接上远程数据库，则需要刷新一下</span></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><p>阿里云在安全组中默认是禁止 3306 端的连接的</p><p>实例-&gt;更多-&gt;网络和安全组-&gt;安全组配置-&gt;配置规则-&gt;快速创建规则-&gt;勾选 3306，授权对象：0.0.0.0/0</p><p>然后在 Navicat 中新建连接，主机填写公有 ip 地址</p><h6 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h6><p>将本地数据库迁移到服务器的 MySQL 数据库中：</p><ul><li>在服务器中创建 coderhub 数据库</li><li>选中本地 coderhub 数据库，右键，转储 SQL 文件，选择结构+数据</li><li>选择云服务器的 mysql 数据库，右键，运行 sql 文件，找到刚刚导出的文件，点击开始</li></ul><h4 id="部署-node-项目"><a href="#部署-node-项目" class="headerlink" title="部署 node 项目"></a>部署 node 项目</h4><h5 id="手动部署"><a href="#手动部署" class="headerlink" title="手动部署"></a>手动部署</h5><h6 id="代码托管到-Git-仓库"><a href="#代码托管到-Git-仓库" class="headerlink" title="代码托管到 Git 仓库"></a>代码托管到 Git 仓库</h6><p>在 GitHub 中创建仓库，并且将当前代码放到 GitHub 中</p><p>添加.gitignore 文件时，忽略一些文件：</p><ul><li>忽略 node_modules</li><li>忽略 uploads</li><li>忽略.env</li></ul><h6 id="代码-clone-到服务器"><a href="#代码-clone-到服务器" class="headerlink" title="代码 clone 到服务器"></a>代码 clone 到服务器</h6><p>在根目录下创建自己的文件夹(后续代码会 clone 到此文件夹目录下)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir ysj</span><br><span class="line">cd ysj/ #进入到创建的文件夹，便于后续clone</span><br><span class="line"><span class="meta">#</span><span class="bash">删除文件夹</span></span><br><span class="line">rm -rf filename</span><br></pre></td></tr></table></figure><p>服务器使用 Git 来 clone 代码：(centOS 中可以使用 dnf 安装 Git)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dnf search git;</span><br><span class="line">dnf info git;</span><br><span class="line">dnf install git; #安装</span><br></pre></td></tr></table></figure><p>clone 项目到 ysj 中：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone htps://github.com/ysj/ysj.git  #git地址为github仓库中code中的https中复制的</span><br></pre></td></tr></table></figure><h6 id="VSCode-中打开代码"><a href="#VSCode-中打开代码" class="headerlink" title="VSCode 中打开代码"></a>VSCode 中打开代码</h6><p>在本地的 VSCode 中直接编辑远程代码，可以使用一个 VSCode 插件：remote-ssh</p><p>点击左边的插件，出现的界面点击+号</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@8.134.60.235 #回车确定</span><br></pre></td></tr></table></figure><p>在侧边栏新出现的服务器右键，选择 Connect to Host in Current Window</p><p>选择 Linux</p><p>输入密码</p><p>选择文件夹之后即可在 vscode 打开远程项目</p><p>安装依赖：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure><p>创建新的配置文件.env</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意变量名字</span></span><br><span class="line">APP_HOST=http:<span class="comment">//8.134.60.235</span></span><br><span class="line">APP_PORT=<span class="number">8001</span></span><br><span class="line">MYSQL_HOST=localhost</span><br><span class="line">MYSQL_PORT=<span class="number">3306</span></span><br><span class="line">MYSQL_DATABASE=coderhub</span><br><span class="line">MYSQL_USER=root</span><br><span class="line">MYSQL_PASSWORD=Coderwhy888.</span><br></pre></td></tr></table></figure><p>启动项目</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm ./src/main.js</span><br></pre></td></tr></table></figure><p>加入 8000 端口到安全组中:</p><p>安全组规则-&gt;快速创建规则-&gt;自定义端口：8000，授权对象：0.0.0.0/0</p><h6 id="pm2-启动-node-程序"><a href="#pm2-启动-node-程序" class="headerlink" title="pm2 启动 node 程序"></a>pm2 启动 node 程序</h6><ul><li>pm2 是一个 node 的进程管理器</li><li>可以使用它来管理 node 的后台进程</li><li>这样在关闭本地 vscode 连接的远程终端时，node 继承会继续执行，服务器就可以继续为前端提供服务了</li></ul><p>安装 pm2</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pm2 -g</span><br></pre></td></tr></table></figure><p>pm2 常用命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pm2 start ./src/main.js --name my-api # 启动时命名进程</span><br><span class="line">pm2 list # 显示所有进程状态</span><br><span class="line">pm2 stop 0 # 停⽌指定的进程</span><br><span class="line">pm2 stop all # 停⽌所有进程</span><br><span class="line">pm2 restart all # 重启所有进程</span><br><span class="line">pm2 restart 0 # 重启指定的进程</span><br><span class="line">pm2 delete 0 # 杀死指定的进程</span><br><span class="line">pm2 delete all # 杀死全部进程</span><br><span class="line">pm2 start app.js -i 4  #后台运⾏pm2，启动4个app.js，实现负载均衡</span><br></pre></td></tr></table></figure><h5 id="jenkins-自动化部署"><a href="#jenkins-自动化部署" class="headerlink" title="jenkins 自动化部署"></a>jenkins 自动化部署</h5></div><div class="reward-container"><div>如果觉得文章有帮助，就请吃个雪糕吧~</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/wechatpay.png" alt="很帅很愁人~ 微信支付"><p>微信支付</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>很帅很愁人~</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://blog.wy1991.cn/20220315/186-nodejs/" title="186-nodejs">https://blog.wy1991.cn/20220315/186-nodejs/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li><li class="post-copyright-license"><strong>联系方式： </strong>如文章有错误，请联系qq：598204996 谢谢~</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/nodejs/" rel="tag"># nodejs</a></div><div class="post-nav"><div class="post-nav-item"><a href="/20220315/185-%E9%87%8D%E5%AD%A6react/" rel="prev" title="185-重学react"><i class="fa fa-chevron-left"></i> 185-重学react</a></div><div class="post-nav-item"><a href="/20220315/187-js%E9%AB%98%E7%BA%A7/" rel="next" title="187-js高级">187-js高级 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js"><span class="nav-number">1.</span> <span class="nav-text">Node.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91"><span class="nav-number">2.</span> <span class="nav-text">全局对象和模块化开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.1.</span> <span class="nav-text">全局对象</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E7%9A%84%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.1.1.</span> <span class="nav-text">特殊的全局对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.1.2.</span> <span class="nav-text">常见的全局对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#global-%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.1.3.</span> <span class="nav-text">global 对象</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JS-%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="nav-number">2.2.</span> <span class="nav-text">JS 模块化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#exports"><span class="nav-number">2.2.1.</span> <span class="nav-text">exports</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#module-exports"><span class="nav-number">2.2.2.</span> <span class="nav-text">module.exports</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#require-%E7%BB%86%E8%8A%82"><span class="nav-number">2.2.3.</span> <span class="nav-text">require 细节</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="nav-number">2.2.4.</span> <span class="nav-text">模块的加载过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ES-Module"><span class="nav-number">2.2.5.</span> <span class="nav-text">ES Module</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#import-%E5%87%BD%E6%95%B0"><span class="nav-number">2.2.6.</span> <span class="nav-text">import 函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90"><span class="nav-number">3.</span> <span class="nav-text">常用内置模块解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#path"><span class="nav-number">3.1.</span> <span class="nav-text">path</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fs"><span class="nav-number">3.2.</span> <span class="nav-text">fs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#events-%E6%A8%A1%E5%9D%97"><span class="nav-number">3.3.</span> <span class="nav-text">events 模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-%F0%9F%94%96"><span class="nav-number">4.</span> <span class="nav-text">包管理工具 🔖</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E5%B1%9E%E6%80%A7"><span class="nav-number">4.1.</span> <span class="nav-text">常见属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#npm-install-%E5%91%BD%E4%BB%A4"><span class="nav-number">4.2.</span> <span class="nav-text">npm install 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#npm-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="nav-number">4.3.</span> <span class="nav-text">npm 其他命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Yarn-%E5%B7%A5%E5%85%B7"><span class="nav-number">4.4.</span> <span class="nav-text">Yarn 工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cnpm-%E5%B7%A5%E5%85%B7"><span class="nav-number">4.5.</span> <span class="nav-text">cnpm 工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#npx-%E5%B7%A5%E5%85%B7"><span class="nav-number">4.6.</span> <span class="nav-text">npx 工具</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E8%84%9A%E6%89%8B%E6%9E%B6%E5%B7%A5%E5%85%B7"><span class="nav-number">5.</span> <span class="nav-text">开发脚手架工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Buffer-%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="nav-number">6.</span> <span class="nav-text">Buffer 和浏览器的事件循环</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81"><span class="nav-number">6.1.</span> <span class="nav-text">编码和解码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Buffer-%E5%92%8C%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">6.2.</span> <span class="nav-text">Buffer 和文件操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E5%92%8C%E5%BC%82%E6%AD%A5-IO"><span class="nav-number">6.3.</span> <span class="nav-text">事件循环和异步 IO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Stream"><span class="nav-number">6.4.</span> <span class="nav-text">Stream</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Http-%E6%A8%A1%E5%9D%97"><span class="nav-number">7.</span> <span class="nav-text">Http 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Web-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">7.1.</span> <span class="nav-text">Web 服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Request"><span class="nav-number">7.2.</span> <span class="nav-text">Request</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Response"><span class="nav-number">7.3.</span> <span class="nav-text">Response</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Http-%E8%AF%B7%E6%B1%82"><span class="nav-number">7.4.</span> <span class="nav-text">Http 请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Express"><span class="nav-number">8.</span> <span class="nav-text">Express</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">8.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">8.2.</span> <span class="nav-text">中间件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%94%A8%E6%B3%95"><span class="nav-number">8.3.</span> <span class="nav-text">核心用法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1"><span class="nav-number">8.4.</span> <span class="nav-text">路由</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">8.5.</span> <span class="nav-text">静态资源服务器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Koa"><span class="nav-number">9.</span> <span class="nav-text">Koa</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-1"><span class="nav-number">9.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1-1"><span class="nav-number">9.2.</span> <span class="nav-text">路由</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="nav-number">9.3.</span> <span class="nav-text">参数解析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">9.4.</span> <span class="nav-text">文件上传</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94"><span class="nav-number">9.5.</span> <span class="nav-text">数据响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">9.6.</span> <span class="nav-text">静态服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">9.7.</span> <span class="nav-text">错误处理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL"><span class="nav-number">10.</span> <span class="nav-text">MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-2"><span class="nav-number">10.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">10.2.</span> <span class="nav-text">连接数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GUI-%E5%B7%A5%E5%85%B7"><span class="nav-number">10.3.</span> <span class="nav-text">GUI 工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-%E8%AF%AD%E5%8F%A5"><span class="nav-number">10.4.</span> <span class="nav-text">SQL 语句</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E8%A7%84%E8%8C%83"><span class="nav-number">10.4.1.</span> <span class="nav-text">常用规范</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%AD%E5%8F%A5%E5%88%86%E7%B1%BB"><span class="nav-number">10.4.2.</span> <span class="nav-text">语句分类</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8-amp-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2"><span class="nav-number">10.5.</span> <span class="nav-text">创建表&amp;数据查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MySQL-%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">10.5.1.</span> <span class="nav-text">MySQL 常用数据类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A1%A8%E7%BA%A6%E6%9D%9F"><span class="nav-number">10.5.2.</span> <span class="nav-text">表约束</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#DML-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="nav-number">10.5.3.</span> <span class="nav-text">DML-数据库的增删改</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#DQL-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2"><span class="nav-number">10.5.4.</span> <span class="nav-text">DQL-数据查询</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-number">10.6.</span> <span class="nav-text">聚合函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F-amp-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">10.7.</span> <span class="nav-text">外键约束&amp;多表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%96%E9%94%AE%E5%AD%98%E5%9C%A8%E6%97%B6%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">10.7.1.</span> <span class="nav-text">外键存在时更新和删除数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">10.7.2.</span> <span class="nav-text">多表查询</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A"><span class="nav-number">10.8.</span> <span class="nav-text">多对多</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Node-%E4%B8%AD%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">10.9.</span> <span class="nav-text">Node 中操作数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mysql2-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">10.9.1.</span> <span class="nav-text">mysql2 基本使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E8%AF%AD%E5%8F%A5"><span class="nav-number">10.9.2.</span> <span class="nav-text">预处理语句</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">10.9.3.</span> <span class="nav-text">连接池</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ORM"><span class="nav-number">10.9.4.</span> <span class="nav-text">ORM</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98"><span class="nav-number">11.</span> <span class="nav-text">项目实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-3"><span class="nav-number">11.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%88%92%E5%88%86"><span class="nav-number">11.2.</span> <span class="nav-text">目录结构划分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E5%87%AD%E8%AF%81"><span class="nav-number">11.3.</span> <span class="nav-text">登录凭证</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#cookie"><span class="nav-number">11.3.1.</span> <span class="nav-text">cookie</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#session"><span class="nav-number">11.3.2.</span> <span class="nav-text">session</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#token"><span class="nav-number">11.3.3.</span> <span class="nav-text">token</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#crypto-%E5%8A%A0%E5%AF%86%E5%AF%86%E7%A0%81"><span class="nav-number">11.3.4.</span> <span class="nav-text">crypto 加密密码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E8%A1%A5%E5%85%85"><span class="nav-number">11.3.5.</span> <span class="nav-text">相对路径补充</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#http-%E5%93%8D%E5%BA%94%E4%BB%A3%E7%A0%81"><span class="nav-number">11.3.6.</span> <span class="nav-text">http 响应代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jimp-%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86"><span class="nav-number">11.4.</span> <span class="nav-text">jimp 图像处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%9B%BE%E5%BD%A2%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">11.5.</span> <span class="nav-text">生成图形验证码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="nav-number">12.</span> <span class="nav-text">云服务器自动化部署</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B4%AD%E4%B9%B0%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">12.1.</span> <span class="nav-text">购买云服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">12.2.</span> <span class="nav-text">配置云服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">12.2.1.</span> <span class="nav-text">连接云服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Node-js"><span class="nav-number">12.2.2.</span> <span class="nav-text">安装 Node.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-MySQL"><span class="nav-number">12.2.3.</span> <span class="nav-text">安装 MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-mySQL"><span class="nav-number">12.2.3.1.</span> <span class="nav-text">安装 mySQL</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-mySQL"><span class="nav-number">12.2.3.2.</span> <span class="nav-text">配置 mySQL</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB"><span class="nav-number">12.2.3.3.</span> <span class="nav-text">数据库迁移</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-node-%E9%A1%B9%E7%9B%AE"><span class="nav-number">12.3.</span> <span class="nav-text">部署 node 项目</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E9%83%A8%E7%BD%B2"><span class="nav-number">12.3.1.</span> <span class="nav-text">手动部署</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%89%98%E7%AE%A1%E5%88%B0-Git-%E4%BB%93%E5%BA%93"><span class="nav-number">12.3.1.1.</span> <span class="nav-text">代码托管到 Git 仓库</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-clone-%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">12.3.1.2.</span> <span class="nav-text">代码 clone 到服务器</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#VSCode-%E4%B8%AD%E6%89%93%E5%BC%80%E4%BB%A3%E7%A0%81"><span class="nav-number">12.3.1.3.</span> <span class="nav-text">VSCode 中打开代码</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#pm2-%E5%90%AF%E5%8A%A8-node-%E7%A8%8B%E5%BA%8F"><span class="nav-number">12.3.1.4.</span> <span class="nav-text">pm2 启动 node 程序</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#jenkins-%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="nav-number">12.3.2.</span> <span class="nav-text">jenkins 自动化部署</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="很帅很愁人~" src="/images/my.jpg"><p class="site-author-name" itemprop="name">很帅很愁人~</p><div class="site-description" itemprop="description">梦是一种欲望, 想是一种行动。梦想是梦与想的结晶，加油打工人~~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">218</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">49</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">120</span> <span class="site-state-item-name">标签</span></a></div></nav></div></div><script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script><script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script><div class="widget-wrap"><div id="myCanvasContainer" class="widget tagcloud"><canvas width="250" height="250" id="resCanvas"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ArryaBuffer/" rel="tag">ArryaBuffer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MarkDown/" rel="tag">MarkDown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Promise/" rel="tag">Promise</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Recorder/" rel="tag">Recorder</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS/" rel="tag">TS</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UDP/" rel="tag">UDP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/V8/" rel="tag">V8</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VueRouter/" rel="tag">VueRouter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vuex/" rel="tag">Vuex</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebStorage/" rel="tag">WebStorage</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/api%E9%9B%86%E4%B8%AD%E7%AE%A1%E7%90%86/" rel="tag">api集中管理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apply/" rel="tag">apply</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/axios/" rel="tag">axios</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bind/" rel="tag">bind</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/call/" rel="tag">call</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cli/" rel="tag">cli</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cors/" rel="tag">cors</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css3/" rel="tag">css3</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/drag/" rel="tag">drag</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejsexcel/" rel="tag">ejsexcel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/" rel="tag">electron</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/element/" rel="tag">element</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/" rel="tag">es6</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/excel%E5%AF%BC%E5%87%BA/" rel="tag">excel导出</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/filter/" rel="tag">filter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flex/" rel="tag">flex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/getters/" rel="tag">getters</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grid/" rel="tag">grid</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/host/" rel="tag">host</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/" rel="tag">html5</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jenkins/" rel="tag">jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a><span class="tag-list-count">83</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" rel="tag">js基础语法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js%E6%93%8D%E4%BD%9C%E7%AC%A6/" rel="tag">js操作符</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lottie/" rel="tag">lottie</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/media/" rel="tag">media</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/messageChannel/" rel="tag">messageChannel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/miniVue/" rel="tag">miniVue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mitt/" rel="tag">mitt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mock/" rel="tag">mock</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nest/" rel="tag">nest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nextTick/" rel="tag">nextTick</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/print/" rel="tag">print</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/promise/" rel="tag">promise</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/recorder/" rel="tag">recorder</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ref/" rel="tag">ref</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rem/" rel="tag">rem</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/require-context/" rel="tag">require.context</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reuqest/" rel="tag">reuqest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/router/" rel="tag">router</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scss/" rel="tag">scss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sessionStorage/" rel="tag">sessionStorage</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/slot/" rel="tag">slot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stackoverflow/" rel="tag">stackoverflow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tailwind/" rel="tag">tailwind</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/" rel="tag">tcp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/this/" rel="tag">this</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three/" rel="tag">three</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ts/" rel="tag">ts</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uniapp/" rel="tag">uniapp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utils/" rel="tag">utils</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vm/" rel="tag">vm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vueRouter/" rel="tag">vueRouter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuex/" rel="tag">vuex</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vw/" rel="tag">vw</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-worker/" rel="tag">web worker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web%E6%89%93%E5%8D%B0/" rel="tag">web打印</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/worker/" rel="tag">worker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xlsx/" rel="tag">xlsx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yarn/" rel="tag">yarn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%98%E5%8C%96/" rel="tag">优化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/" rel="tag">分库分表</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%9D%E5%BF%83/" rel="tag">初心</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A8%E7%94%BB%E5%BA%93/" rel="tag">动画库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%9F%E5%9E%8B%E4%B8%8E%E5%8E%9F%E5%9E%8B%E9%93%BE/" rel="tag">原型与原型链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/" rel="tag">发布订阅</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">可视化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" rel="tag">多文件下载</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E5%B1%8F/" rel="tag">大屏</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2/" rel="tag">媒体查询</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E8%8A%82%E5%BA%8F/" rel="tag">字节序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%81%E8%A3%85%E8%AF%B7%E6%B1%82/" rel="tag">封装请求</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">小程序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B1%85%E4%B8%AD%E5%AF%B9%E9%BD%90/" rel="tag">居中对齐</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">微信小程序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%83%E5%BE%97/" rel="tag">心得</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/" rel="tag">性能监控</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8B%96%E6%8B%BD/" rel="tag">拖拽</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%92%E6%A7%BD/" rel="tag">插槽</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" rel="tag">文件下载</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%9B%E5%9E%8B/" rel="tag">泛型</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%B8%E5%86%8C/" rel="tag">相册</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" rel="tag">移动端常见问题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%84%9A%E6%89%8B%E6%9E%B6/" rel="tag">脚手架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/" rel="tag">自动化部署</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E9%80%82%E5%BA%94/" rel="tag">自适应</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%83%E8%AF%95/" rel="tag">调试</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%A8%E5%9F%9F/" rel="tag">跨域</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7/" rel="tag">辅助工具</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%99%E4%B8%A4%E5%B9%B4%E5%81%9A%E8%BF%87%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E9%A1%B9%E7%9B%AE/" rel="tag">这两年做过的物联网项目</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/" rel="tag">进程和线程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%83%A8%E7%BD%B2/" rel="tag">部署</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a><span class="tag-list-count">1</span></li></ul></canvas></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><span class="exturl" data-url="aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==">豫ICP备19017003号-1 </span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://blog.img.wy1991.cn/static/images/ga.png" style="display:inline-block"></div><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">很帅很愁人~</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var e,t,o,n,r,a=document.getElementsByTagName("link");if(0<a.length)for(i=0;i<a.length;i++)"canonical"==a[i].rel.toLowerCase()&&a[i].href&&(e=a[i].href);t=e?e.split(":")[0]:window.location.protocol.split(":")[0],e=e||window.location.href,window,n=e,r=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(n)||(o="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",r?(o+="?r="+encodeURIComponent(document.referrer),n&&(o+="&l="+n)):n&&(o+="?l="+n),(new Image).src=o)}()</script><script src="/js/local-search.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f65cb40e9a5d20342ae8b58def42ea5f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.name="baidu_tongji";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}()</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:null,display:{position:"left",width:150,height:300},mobile:{show:!1},log:!1})</script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:3,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=r[a].getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var e=r[a],t=e,n=function(){r=r.filter(function(t){return e!==t})},i=new Image,o=t.getAttribute("data-original");i.onload=function(){t.src=o,n()},t.src!==o&&(i.src=o)}()}o(),n.addEventListener("scroll",function(){var t=o,e=n;clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html>