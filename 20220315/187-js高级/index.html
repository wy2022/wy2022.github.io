<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><meta name="keywords" data-name="fire" content="JavaScript,Vue.js,小程序,WebPack,ECMAScript 6,vue,php,js,JavaScript,typescirpt,node,egg,很帅很愁人,web前端,全栈,网页,博客，前端博客,JavaScript,html5,css3,Jquery,NodeJs
"><meta name="360-site-verification" content="178e3a7a27a16a1253976882a4d99509"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/fly-32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/fly-16.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="iy8yHMd-90Qb6NAJqgoij_Cz3i3Jh9FRGRxrWJbRrOw"><meta name="msvalidate.01" content="92E59C28288B8049A45C6288AD39DFA0"><meta name="baidu-site-verification" content="code-etAIIwOVpZ"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"blog.wy1991.cn",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!0,sidebar:{position:"left",display:"hide",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="js高级笔记"><meta property="og:type" content="article"><meta property="og:title" content="187-js高级"><meta property="og:url" content="https://blog.wy1991.cn/20220315/187-js%E9%AB%98%E7%BA%A7/index.html"><meta property="og:site_name" content="很帅很愁人~"><meta property="og:description" content="js高级笔记"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/js运行过程.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20211120221128918.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20220220110135691.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20220220165108250.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20220220183522719.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20220220202843560.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20220222224244191.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20211122221033194.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20220223215011307.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20220301140850398.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20211220220608871.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20211222214136541.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20211227214147478.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20220107204557058.png"><meta property="og:image" content="e:/Web/studyNotes/js高级.assets/image-20220107204617865.png"><meta property="article:published_time" content="2022-03-15T08:24:37.000Z"><meta property="article:modified_time" content="2022-03-15T08:25:51.513Z"><meta property="article:author" content="很帅很愁人~"><meta property="article:tag" content="js"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="e:/Web/studyNotes/js高级.assets/js运行过程.png"><link rel="canonical" href="https://blog.wy1991.cn/20220315/187-js%E9%AB%98%E7%BA%A7/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>187-js高级 | 很帅很愁人~</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><script src="/js/fairyDustCursor.js"></script><script src="/js/clickLove.js"></script></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">很帅很愁人~</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">迷茫是因为才华配不上梦想の，所以你必须非常努力，才能显得毫不费力！</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-相册"><a href="/20210707/0-%E6%A2%A6%E7%91%B6(%E4%B8%80%E4%B8%80)%E5%92%8C%E5%B0%8F%E6%B2%AB%E6%B2%AB/" rel="section"><i class="fa fa-user fa-fw"></i>相册</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>地图</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.wy1991.cn/20220315/187-js%E9%AB%98%E7%BA%A7/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/my.jpg"><meta itemprop="name" content="很帅很愁人~"><meta itemprop="description" content="梦是一种欲望, 想是一种行动。梦想是梦与想的结晶，加油打工人~~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="很帅很愁人~"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">187-js高级</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-03-15 16:24:37 / 修改时间：16:25:51" itemprop="dateCreated datePublished" datetime="2022-03-15T16:24:37+08:00">2022-03-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span></span><div class="post-description" style="opacity:0">js高级笔记</div></div></header><div class="post-body" itemprop="articleBody"><hr><p>`typora-copy-images-to: img</p><hr><h3 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h3><h4 id="浏览器引擎-js-执行原理"><a href="#浏览器引擎-js-执行原理" class="headerlink" title="浏览器引擎 js 执行原理"></a>浏览器引擎 js 执行原理</h4><p>浏览器内核指浏览器的排版引擎</p><ul><li>Webkit 内核，苹果基于 LHTML 开发，开源的，用于 Safari</li><li>Blink，Webkit 的一个分支，Goole 开发</li><li>排版引擎(layout engine)，也称浏览器引擎(browser engine)，页面渲染引擎(rendering engine)或样版引擎</li></ul><p>JS 引擎：将 js 代码翻译成 CPU 指令来执行</p><p><strong>浏览器内核和 js 引擎的关系</strong></p><p>以 WebKit 为例，WebKit 由两部分组成：</p><ul><li>WebCore:负责 HTML 解析、布局、渲染等相关工作</li><li>JavaScriptCore:解析、执行 js 代码</li></ul><p>chrome 浏览器使用 blink 内核，V8JS 引擎</p><h4 id="V8-引擎"><a href="#V8-引擎" class="headerlink" title="V8 引擎"></a><strong>V8 引擎</strong></h4><p>定义：V8 使用 c++编写的 Google 开源高性能 JavaScript 和 WebAssembly 引擎，用于 Google 和 nodejs 等</p><p>v8 可以独立运行，也可以嵌入到任何 c++应用程序中</p><p>js 源码 -&gt; Parse(词法分析，语法分析) -&gt; AST 抽象语法树 -&gt; Ignition -&gt; bytecode 字节码 -&gt; 运行结果</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\js运行过程.png" alt="image-20210905201029834"></p><p>v8 引擎本身源码非常复杂，有超过 100w 行 c++代码</p><ul><li>Parse 模块会将 JavaScript 代码转换成 AST（抽象语法树），这是因为解释器并不直接认识 JavaScript 代码<ul><li>如果函数没有被调用，那么是不会被转换成 AST 的</li></ul></li><li>Ignition 是一个解释器，会将 AST 转换成 ByteCode（字节码）<ul><li>同时会收集 TurboFan 优化所需要的信息（比如函数参数的类型信息，有了类型才能进行真实的运算）</li><li>如果函数只调用一次，Ignition 会执行解释执行 ByteCode</li></ul></li><li>TurboFan 是一个编译器，可以将字节码编译为 CPU 可以直接执行的机器码<ul><li>如果一个函数被多次调用，那么就会被标记为热点函数，那么就会经过 TurboFan 转换成优化的机器码，提高代码的执行性能</li><li>但机器码实际上也会被还原为 ByteCode，这是因为如果后续执行函数的过程中，类型发生了变化（比如 sum 函数原来执行的是 number 类型，后来执行变成了 string 类型），之前优化的机器码并不能正确的处理运算，就会逆向的转换成字节码</li></ul></li></ul><p><strong>js 代码运行过程</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;ysj&#x27;</span></span><br><span class="line"><span class="keyword">var</span> num1 = <span class="number">20</span></span><br><span class="line"><span class="keyword">var</span> num2 = <span class="number">30</span></span><br><span class="line"><span class="keyword">var</span> sum = num1 + num2</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  1.代码被解析时，v8引擎内部会帮助我们创建一个对象(globalObject -&gt; go)，</span></span><br><span class="line"><span class="comment">  对象里面有很多全局属性或对象(String,Date,setTimeout等)，window属性指向这个全局对象</span></span><br><span class="line"><span class="comment">  var globalObject = &#123; //go，解析阶段创建(从源代码到抽象语法树之间)</span></span><br><span class="line"><span class="comment">    String: &quot;一个类&quot;,</span></span><br><span class="line"><span class="comment">    Date: &quot;类&quot;，</span></span><br><span class="line"><span class="comment">    setTimeout； &quot;函数&quot;,</span></span><br><span class="line"><span class="comment">    window: globalObject,</span></span><br><span class="line"><span class="comment">    name: undefined, //解析阶段会将全局变量放进来</span></span><br><span class="line"><span class="comment">    num1: undefined, //此时代码还没运行，所以定义的所有全局变量的值都为undefined</span></span><br><span class="line"><span class="comment">    num2: undefined,</span></span><br><span class="line"><span class="comment">    result: undefined,</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  2.运行代码</span></span><br><span class="line"><span class="comment">    2.1 v8引擎为了执行代码，v8引擎内部会有执行上下文栈(Execution Context Stack, ECStack, ECS)(函数调用栈)</span></span><br><span class="line"><span class="comment">    2.2因为执行的是全局代码， 为了全局代码能够正常执行，</span></span><br><span class="line"><span class="comment">    需要创建 全局执行上下文(Global Execution Context, GEC)(全局代码需要被执行时才会创建) </span></span><br><span class="line"><span class="comment">      全局执行上下文:</span></span><br><span class="line"><span class="comment">        vo(variable Object，变量对象)，指向GO</span></span><br><span class="line"><span class="comment">        执行代码(会给定义的全局变量赋值)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="函数执行作用域链"><a href="#函数执行作用域链" class="headerlink" title="函数执行作用域链"></a>函数执行作用域链</h4><p>当 js 引擎编译过程中，发现是一个函数时，会在内存中开辟一块空间，创建另外一个对象，是一个函数对象，用来储存函数</p><ul><li>会保存函数的父级作用域</li><li>保存内存中函数的执行体(代码块)</li></ul><p>js 创建全局对象遇到函数时，</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GlobalObject = &#123;</span><br><span class="line">	<span class="attr">f00</span>: <span class="number">0xa00</span>, <span class="comment">//全局对象里面保存 存储函数的内存的地址</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当函数被调用时，会在ECStack(调用栈)创建一个函数执行上下文(FEC:Function Execution Context)</span></span><br><span class="line"><span class="comment">//此处的VO(Variable Object)指向AO(Activation Object:活跃对象)</span></span><br><span class="line"><span class="comment">//函数执行完后，EFC就会弹出ECStack，然后被销毁掉</span></span><br><span class="line">FEC = &#123;</span><br><span class="line">  <span class="attr">VO</span>:AO,</span><br><span class="line">  scope chain: VO + ParentScope, <span class="comment">//作用域链，包含当前的VO对象和父级作用域,父级作用域在编译阶段就已经确定了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当查找变量的时候，是沿着作用域链查找的</p><p>如果函数是定义在函数里面的，那么函数里面的这个函数在编译时也会在内存中开辟一块空间储存函数执行体。外部函数的 AO 对象会保存此空间的内存地址</p><p>内部函数也有自己的执行上下文，会创建自己的 AO 对象</p><h4 id="变量环境和记录"><a href="#变量环境和记录" class="headerlink" title="变量环境和记录"></a>变量环境和记录</h4><p>以上都是早期的 ECMA 版本规范：</p><ul><li>每一个执行上下文会被关联到一个变量对象（Variable Object， VO），在源代码中的变量和函数声明会被作为属性添加到 VO 中。对于函数来说，参数也会被添加到 VO 中</li></ul><p>在最新 ECMA 版本规范中，对一些词汇进行了修改：</p><ul><li>每一个执行上下文会关联到一个变量环境(VariableEnvironment)中，在执行代码中变量和函数的声明会作为环境记录(Environment Record)添加到变量环境中。对于函数来说，参数也会被作为环境记录添加到变量环境中</li></ul><h4 id="作用域补充"><a href="#作用域补充" class="headerlink" title="作用域补充"></a>作用域补充</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  m = <span class="number">100</span> <span class="comment">//变量直接赋值，没有在其它地方定义时，js会认为这个变量是定义在全局对象里面的</span></span><br><span class="line">&#125;</span><br><span class="line">foo()</span><br><span class="line"><span class="built_in">console</span>.log(m) <span class="comment">// 100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = (b = <span class="number">10</span>)</span><br><span class="line">  <span class="comment">//等价于</span></span><br><span class="line">  <span class="comment">//var a = 10;</span></span><br><span class="line">  <span class="comment">// b = 10</span></span><br><span class="line">&#125;</span><br><span class="line">bar()</span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// a is not defined</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure><h4 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h4><p>任何编程语言，在代码执行过程中都是需要给他分配内存的(有的需要手动管理内存，有的自动管理)</p><p>内存管理生命周期(申请-使用-释放)：</p><ul><li>分配申请你需要的内存(申请)</li><li>使用分配的内存(存放一些东西，比如对象等)</li><li>不需要使用时，对其进行释放</li></ul><p>js 内存管理：</p><ul><li>js 在<strong>定义变量时</strong>就会自动分配内存<ul><li>js 对于基本<strong>数据类型类型的分配</strong>会在执行时，直接在<strong>栈</strong>空间进行分配</li><li>js 对于<strong>复杂数据类型的分配</strong>会在<strong>堆</strong>内存中开辟一块空间，并且将这块空间的指针返回值变量引用</li></ul></li></ul><p>js 垃圾回收：</p><ul><li>因为内存大小是有限的，所以当内存不再需要的时候，需要对其进行释放，以便腾出更多内存空间</li><li>垃圾回收(Garbage Collection，GC)：不再使用的对象，称为垃圾，需要回收</li></ul><p>常见 GC 算法：</p><ul><li>引用计数:只要有引用指向变量，变量的引用计数就会+1(默认为 0)，引用计数再次变为 0 的时候就会回收</li><li>标记清除：设置一个根对象，立即回收器会定期从这个根开始，找所有从根开始引用到的对象，对于那些没有引用到的对象，则认为是不可用的对象</li></ul><h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>在 js 中，函数是一等公民：</p><ul><li>函数可以作为另外一个函数的参数，也可以作为另外一个函数的返回值</li></ul><p>高阶函数：一个函数接收另外一个函数作为参数，或者该函数会将另外一个函数作为返回值</p><p>函数：独立的 function，称之为函数</p><p>方法：当一个函数属于某一个对象时，称这个函数是这个对象的方法</p><p>相关常用高阶函数：数组的函数(filter、map 等)</p><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>在计算机科学中：</p><ul><li>闭包(Closure)，又称词法闭包或函数闭包</li><li>是在支持头等函数(函数可以作为第一公民)的编程语言中，实现词法绑定的一种技术</li><li>闭包在实现上是一个结构体，它存储了一个函数和一个关联的环境(相当于一个符号查找表)</li><li>闭包和函数最大的区别在于，当捕捉闭包的时候，它的自由变量会在捕捉时被确定，这样即使脱离捕捉的上下文，也能照常运行</li></ul><p>在 JavaScript 中：</p><ul><li>一个函数对其周围状态(词法环境)的引用捆绑在一起(或者说函数被引用包围)，这样的组合就是闭包</li><li>即：闭包让你可以在一个内层函数中访问到外层函数的作用域</li><li>在 js 中，每创建一个函数，闭包就会在函数创建的同时被创建出来</li></ul><p>理解：</p><ul><li>一个普通的函数，如果它可以访问外层作用域的自由变量，那么这个函数就是一个闭包</li><li>从广义的角度来说，js 中的函数都是闭包</li><li>从狭义的角度来说，js 中的一个函数，如果访问量外层作用域的变量，那么它是一个闭包</li></ul><h4 id="闭包的内存泄露"><a href="#闭包的内存泄露" class="headerlink" title="闭包的内存泄露"></a>闭包的内存泄露</h4><p>闭包执行完后，该销毁的没有销毁掉，称为内存泄漏。</p><p>解决：将不再使用的闭包变量置为 null</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">  <span class="keyword">var</span> age = <span class="number">18</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name)</span><br><span class="line">    <span class="built_in">console</span>.log(age)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> bar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = foo()</span><br><span class="line">fn()</span><br><span class="line">fn = <span class="literal">null</span> <span class="comment">//并不会立马销毁，GC会按照算法的时间不固定销毁</span></span><br></pre></td></tr></table></figure><p>闭包里面定义的变量如果没用到，也会被销毁掉</p><h3 id="this-指向"><a href="#this-指向" class="headerlink" title="this 指向"></a>this 指向</h3><p>在大多数情况下，this 出现在函数中</p><p>在全局作用域下，浏览器环境的 this 绑定的 window，node 环境的 this 绑定一个空对象</p><p>this 是在函数被执行的时候，才会绑定上去；</p><p>==this 指向什么，跟函数所处的位置没有关系；跟函数被调用的方式有关==</p><h4 id="this-绑定规则-默认绑定"><a href="#this-绑定规则-默认绑定" class="headerlink" title="this 绑定规则-默认绑定"></a>this 绑定规则-默认绑定</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认绑定：独立函数调用(函数是独立调用的，没有其它对象调用此函数,即没有调用主体)，this指向全局对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">  foo1()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">  foo2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo3() <span class="comment">//window window window</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//案例3</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;why&#x27;</span>,</span><br><span class="line">  <span class="attr">foo</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = obj.foo</span><br><span class="line">bar() <span class="comment">//独立函数调用，指向全局对象</span></span><br></pre></td></tr></table></figure><h4 id="this-绑定规则-隐式绑定"><a href="#this-绑定规则-隐式绑定" class="headerlink" title="this 绑定规则-隐式绑定"></a>this 绑定规则-隐式绑定</h4><p>object.fn()，object 对象会被 js 引擎绑定到 fn 函数中的 this 里面</p><p>通过某个对象来进行调用，即：它的调用位置中，是通过某个对象发起的函数调用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//案例1</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">foo</span>: foo,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.foo() <span class="comment">// obj</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//案例2</span></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">foo</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27;在吃饭&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fn = obj2.eating</span><br><span class="line">fn() <span class="comment">//此时变成了独立函数调用，指向了window</span></span><br></pre></td></tr></table></figure><p>隐式绑定前提：</p><ul><li>必须在调用的对象内部有一个对函数的引用</li><li>正是通过这个引用，间接的将这个 this 绑定到了这个对象上</li></ul><h4 id="this-绑定规则-显示绑定"><a href="#this-绑定规则-显示绑定" class="headerlink" title="this 绑定规则-显示绑定"></a>this 绑定规则-显示绑定</h4><p>如果不希望在对象内部包含这个函数的引用，同时又希望在这个对象上进行强制调用</p><ul><li>js 所有函数都可以使用 call 和 apply 方法</li><li>这两个的区别：第一个参数相同，后面的参数，apply 为数组，call 为参数列表</li><li>这两个函数的第一个参数都要求是一个对象，在调用这个函数时，会将 this 绑定到这个传入的对象上</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//call apply bind</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;函数被调用&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//foo直接调用和call/apply调用的不同在于this绑定的不同</span></span><br><span class="line">foo() <span class="comment">//foo直接调用指向全局对象</span></span><br><span class="line">foo.call() <span class="comment">//</span></span><br><span class="line">foo.apply()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;obj&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// call/apply可以指定this的绑定对象</span></span><br><span class="line">foo.call(obj) <span class="comment">//通过call使this指向obj</span></span><br><span class="line">foo.apply(obj) <span class="comment">//指向obj</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.call和apply的区别</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(num1 + num2, <span class="built_in">this</span>)</span><br><span class="line">&#125;</span><br><span class="line">sum(<span class="number">20</span>, <span class="number">30</span>) <span class="comment">//直接调用传参方式</span></span><br><span class="line">sum.call(<span class="string">&#x27;call&#x27;</span>, <span class="number">20</span>, <span class="number">30</span>) <span class="comment">//绑定的this ...参数列表(类似于剩余参数)</span></span><br><span class="line">sum.apply(<span class="string">&#x27;apply&#x27;</span>, [<span class="number">20</span>, <span class="number">30</span>]) <span class="comment">//绑定的this 参数(所有参数放进数组里面)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.call和apply在执行函数时，可以明确绑定this(显式绑定)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//4.bind</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">...arg</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>, arg)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> newFoo = foo.bind(<span class="string">&#x27;aaa&#x27;</span>) <span class="comment">//bind参数：绑定的this</span></span><br><span class="line">newFoo() <span class="comment">//调用这个独立函数，但因为这个独立函数在调用之前已经被显式绑定aaa，所以this指向aaa</span></span><br><span class="line"><span class="comment">//默认绑定和显示绑定冲突，显示绑定的this优先级更高</span></span><br></pre></td></tr></table></figure><h4 id="this-绑定规则-new-绑定"><a href="#this-绑定规则-new-绑定" class="headerlink" title="this 绑定规则-new 绑定"></a>this 绑定规则-new 绑定</h4><p>js 中的函数可以当作一个类的构造函数来使用，也就是使用 new 关键字</p><p>使用 new 关键字来调用函数时，会执行如下操作</p><ul><li>创建一个全新的对象</li><li>这个新对象会被执行 prototype 连接</li><li>这个新对象会绑定到函数调用的 this 上(this 的绑定,即 new 绑定在这个步骤完成)</li><li>执行函数体代码</li><li>如果函数没有返回其它对象，表达式会返回这个新对象</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person(<span class="string">&#x27;ysj&#x27;</span>, <span class="number">18</span>) <span class="comment">//通过new关键字来调用一个函数(构造器)，这时的this是在调用这个构造器时创建出来的对象</span></span><br><span class="line"><span class="comment">//this = 创建出来的对象 =&gt; new 绑定</span></span><br></pre></td></tr></table></figure><h4 id="内置函数-this-分析"><a href="#内置函数-this-分析" class="headerlink" title="内置函数 this 分析"></a>内置函数 this 分析</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.setTimeout</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>) <span class="comment">//window，不论是否是严格模式，this都是指向window</span></span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.监听点击</span></span><br><span class="line">boxDiv.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>) <span class="comment">//this指向boxDiv</span></span><br><span class="line">  <span class="comment">// 内部是以boxDiv.onclick();的方式调用</span></span><br><span class="line">&#125;</span><br><span class="line">boxDiv.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>) <span class="comment">//boxDiv</span></span><br><span class="line">  <span class="comment">//fn.call(boxDiv)</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 数组forEach map filter find</span></span><br><span class="line"><span class="keyword">var</span> names = [<span class="string">&#x27;ds&#x27;</span>, <span class="string">&#x27;dsad&#x27;</span>, <span class="string">&#x27;ffd&#x27;</span>, <span class="string">&#x27;fdg&#x27;</span>, <span class="string">&#x27;gfd&#x27;</span>]</span><br><span class="line">names.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>) <span class="comment">//this默认指向window</span></span><br><span class="line">&#125;, <span class="string">&#x27;ddd&#x27;</span>) <span class="comment">//参数一：函数  参数二：你要绑定的this</span></span><br></pre></td></tr></table></figure><h4 id="规则优先级"><a href="#规则优先级" class="headerlink" title="规则优先级"></a>规则优先级</h4><ol><li><p>默认规则优先级最低</p><ul><li>存在其它规则时，就会通过其它规则的方式来绑定 this</li></ul></li><li><p>显示绑定优先级高于隐式绑定</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">obj.foo.call(<span class="string">&#x27;aaa&#x27;</span>) <span class="comment">//此处this指向aaa</span></span><br><span class="line">obj.foo.apply(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> bar = obj.foo.bind(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">bar() <span class="comment">//this指向aaa</span></span><br></pre></td></tr></table></figure></li><li><p>new 绑定优先级高于隐式绑定</p></li><li><p>new 绑定高于显式绑定</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//   new关键字不能和apply/call一起使用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = foo.bind(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> bar() <span class="comment">//this指向空对象，说明使用的是new绑定</span></span><br></pre></td></tr></table></figure></li></ol><p>new 绑定 &gt; 显示绑定 &gt; 隐式绑定 &gt; 默认绑定(独立函数调用)</p><h4 id="规则之外-忽略显式绑定"><a href="#规则之外-忽略显式绑定" class="headerlink" title="规则之外-忽略显式绑定"></a>规则之外-忽略显式绑定</h4><p>apply/call/bind：当传入的是 null/undefined 时，自动将 this 绑定成全局对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo.apply(<span class="literal">null</span>) <span class="comment">//此时函数的this指向window</span></span><br><span class="line">foo.apply(<span class="literal">undefined</span>)</span><br></pre></td></tr></table></figure><p>规则之外-间接函数引用</p><p>创建一个函数的间接引用时，使用的是默认绑定规则</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;obj1&#x27;</span>,</span><br><span class="line">  <span class="attr">foo</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;obj2&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">;(obj2.bar = obj1.foo)() <span class="comment">//独立的函数调用,第一个括号会拿到函数foo,第二个括号执行函数foo</span></span><br></pre></td></tr></table></figure><h4 id="规则之外-箭头函数"><a href="#规则之外-箭头函数" class="headerlink" title="规则之外-箭头函数"></a>规则之外-箭头函数</h4><p>箭头函数是 es6 之后增加的一种编写函数的方法，并且它比函数表达式要更加简洁</p><ul><li>==<strong>箭头函数不会绑定 this</strong>==、arguments 属性</li><li>箭头函数不能作为构造函数使用(不能和 new 一起使用，会抛出错误)</li><li>==<strong>箭头函数的 this 只看上层作用域</strong>==</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="function">(<span class="params">n1, n2</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//定义的独立箭头函数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//高阶函数使用时传入箭头函数</span></span><br><span class="line">nums.forEach(<span class="function">(<span class="params">el, i</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure><p>箭头函数常见简写</p><ul><li>当只有一个参数时，小括号可以省略</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nums.forEach(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure><ul><li>如果函数执行体只有一行代码，大括号也可以省略;并且会将这行代码的执行结果作为返回值</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nums.forEach(<span class="function">(<span class="params">el</span>) =&gt;</span> <span class="built_in">console</span>.log(el))</span><br></pre></td></tr></table></figure><ul><li>如果箭头函数只有一行代码，返回一个对象</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = <span class="function">() =&gt;</span> (&#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;)</span><br></pre></td></tr></table></figure><p>箭头函数不使用 this 的四种标准规则(也就是不绑定 this)，而是根据外层作用域来决定 this</p><h4 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h4><p><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3M/X19iaXo9TXpnNU1EQXpOemt3TkE9PSZtaWQ9MjI0NzQ4Mzg0NyZpZHg9MSZzbj1mZTgwODlkZWQ4MTA5OGIzNTQ2MWQzYzE0YmI4NWNkZSZjaGtzbT1jZmUzZjIzOGY4OTQ3YjJlNzM0MjIxYzUxMzFlM2E2YmM0MmYyZGFlNjZiOTY0MGNjMGYwMzhlOWRmZmVmNDVkZDRhNTJkOGRkOTMwJm1wc2hhcmU9MSZzY2VuZT0yMyZzcmNpZD0wNTE0UkpTUU5YekZSMHZkMDNvMjJCMnAmc2hhcmVyX3NoYXJldGltZT0xNjIxMDc0OTE1NTkwJnNoYXJlcl9zaGFyZWlkPTlkZTY3YWMwNjBhZmNkMzU3Y2VlZWY0OWEyMzY1MmNiI3Jk">前端面试之彻底搞懂 this 指向<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;window&#x27;</span></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;person&#x27;</span>,</span><br><span class="line">  <span class="attr">sayName</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sss = person.sayName</span><br><span class="line">  sss() <span class="comment">//独立函数调用，window</span></span><br><span class="line">  person.sayName() <span class="comment">//隐式调用，person</span></span><br><span class="line">  person.sayName() <span class="comment">//person,此处加不加括号没区别</span></span><br><span class="line">  ;(b = person.sayName)() <span class="comment">//赋值表达式-&gt;间接函数引用-&gt;独立函数调用，window</span></span><br><span class="line">&#125;</span><br><span class="line">sayName()</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;window&#x27;</span></span><br><span class="line"><span class="keyword">var</span> person1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;person1&#x27;</span>,</span><br><span class="line">  <span class="attr">foo1</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">foo2</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="built_in">this</span>.name),</span><br><span class="line">  <span class="attr">foo3</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">foo4</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = &#123; <span class="attr">name</span>: <span class="string">&#x27;person2&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">person1.foo1() <span class="comment">//隐式绑定,person1</span></span><br><span class="line">person1.foo1.call(person2) <span class="comment">//显示绑定，person2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="comment">//定义对象，没有产生作用域</span></span><br><span class="line">  <span class="attr">foo</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//foo的上层作用域是全局(window)</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name) <span class="comment">//window</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person1.foo2() <span class="comment">//箭头函数，寻找上层作用域，window</span></span><br><span class="line">person1.foo2.call(person2) <span class="comment">//箭头函数只会从上层作用域寻找this，还是指向window</span></span><br><span class="line"></span><br><span class="line">person1.foo3()() <span class="comment">//person1.foo()拿到函数返回的结果（一个函数），调用返回的函数，独立函数调用，window</span></span><br><span class="line">person1.foo3.call(person2)() <span class="comment">//person1.foo3.call(person2)拿到返回的函数，独立函数调用，window</span></span><br><span class="line">person1.foo3().call(person2) <span class="comment">//person1.foo3()拿到返回的函数，再在调用时显式绑定， person2</span></span><br><span class="line"></span><br><span class="line">person1.foo4()() <span class="comment">//person1.foo4()拿到返回值箭头函数，箭头函数向上层作用域找,找到foo4这个函数,这个函数的this是person1</span></span><br><span class="line">person1.foo4.call(person2)() <span class="comment">//person1.foo4.call(person2)将foo4的this绑定到person2,上层作用域为foo4函数的this，指向person2</span></span><br><span class="line">person1.foo4().call(person2) <span class="comment">//person1.foo4()拿到箭头函数，箭头函数call绑定不生效，只会向上层作用域找，上层作用域为foo4的this,指向person1</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;window&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.foo1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.foo2 = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">  <span class="built_in">this</span>.foo3 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.foo4 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">&#x27;person1&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">&#x27;person2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">person1.foo1() <span class="comment">//隐式绑定，person1</span></span><br><span class="line">person1.foo1.call(person2) <span class="comment">//显式绑定&gt;隐式绑定，person2</span></span><br><span class="line"></span><br><span class="line">person1.foo2() <span class="comment">//箭头函数，上层作用域查找，找到Person这个函数的作用域，这里的this指向person1</span></span><br><span class="line">person1.foo2.call(person2) <span class="comment">//箭头函数不绑定this，call绑定不影响，依然向上层作用域查找，person1</span></span><br><span class="line"></span><br><span class="line">person1.foo3()() <span class="comment">//独立函数调用，window</span></span><br><span class="line">person1.foo3.call(person2)() <span class="comment">//独立函数调用，window</span></span><br><span class="line">person1.foo3().call(person2) <span class="comment">//person1.foo3()拿到返回的函数然后显式绑定，person2</span></span><br><span class="line"></span><br><span class="line">person1.foo4()() <span class="comment">//person1.foo4()拿到返回的箭头函数，上层作用域查找找到foo4,foo4绑定的this是person1</span></span><br><span class="line">person1.foo4.call(person2)() <span class="comment">//person1.foo4.call(person2)显式绑定person2,箭头函数向上层查找找到foo4,foo4绑定的this是person2</span></span><br><span class="line">person1.foo4().call(person2) <span class="comment">//person1.foo4()拿到箭头函数，上层查找找到person1(箭头函数t绑定不生效)</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;window&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.obj = &#123;</span><br><span class="line">    <span class="comment">//定义对象，对象的&#123;&#125;没有作用域，不是代码块</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;obj&#x27;</span>,</span><br><span class="line">    <span class="attr">foo1</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">foo2</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">&#x27;person1&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">&#x27;person2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">person1.obj.foo1()() <span class="comment">//独立函数调用，window</span></span><br><span class="line">person1.obj.foo1.call(person2)() <span class="comment">//person1.obj.foo1.call(person2)拿到返回的函数，独立函数调用，window</span></span><br><span class="line">person1.obj.foo1().call(person2) <span class="comment">//person1.obj.foo1()拿到返回的函数后显式绑定，person2</span></span><br><span class="line"></span><br><span class="line">person1.obj.foo2()() <span class="comment">//箭头函数,上层作用域foo2,foo被obj调用，obj</span></span><br><span class="line">person1.obj.foo2.call(person2)() <span class="comment">//箭头函数，person2</span></span><br><span class="line">person1.obj.foo2().call(person2) <span class="comment">//箭头函数，obj</span></span><br></pre></td></tr></table></figure><h3 id="JS-函数式编程"><a href="#JS-函数式编程" class="headerlink" title="JS 函数式编程"></a>JS 函数式编程</h3><h4 id="call-apply-bind-的实现"><a href="#call-apply-bind-的实现" class="headerlink" title="call-apply-bind 的实现"></a>call-apply-bind 的实现</h4><p>call 方法的实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给所有函数添加一个封装的call方法</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.ysjCall = <span class="function"><span class="keyword">function</span> (<span class="params">thisArg, ...rest</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//参数一：接收this  参数二：接收额外参数</span></span><br><span class="line">  <span class="keyword">var</span> fn = <span class="built_in">this</span> <span class="comment">//获取到调用ysjCall的函数</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//将thisArg转成对象类型(防止传入的thisArg是非对象类型)</span></span><br><span class="line">  thisArg = thisArg !== <span class="literal">null</span> &amp;&amp; thisArg !== <span class="literal">undefined</span> ? <span class="built_in">Object</span>(thisArg) : <span class="built_in">window</span></span><br><span class="line">  <span class="comment">//转化之前判断传进来的this有没有值，没有值时绑定window</span></span><br><span class="line">  <span class="comment">//调用需要被执行的函数</span></span><br><span class="line">  thisArg.fn = fn</span><br><span class="line">  <span class="keyword">var</span> result = thisArg.fn(...rest) <span class="comment">//拿到执行结果</span></span><br><span class="line">  <span class="keyword">delete</span> thisArg.fn <span class="comment">//使用完后删除该属性</span></span><br><span class="line">  <span class="keyword">return</span> result <span class="comment">//将函数的执行结果返回出去</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>apply 方法的实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.ysjApply = <span class="function"><span class="keyword">function</span> (<span class="params">thisArg, argArray</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//参数一：接收this  参数二：以数组形式接收额外参数</span></span><br><span class="line">  <span class="keyword">var</span> fn = <span class="built_in">this</span> <span class="comment">//获取到调用ysjApply的函数</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//将thisArg转成对象类型(防止传入的thisArg是非对象类型)</span></span><br><span class="line">  thisArg = thisArg !== <span class="literal">null</span> &amp;&amp; thisArg !== <span class="literal">undefined</span> ? <span class="built_in">Object</span>(thisArg) : <span class="built_in">window</span></span><br><span class="line">  <span class="comment">//转化之前判断传进来的this有没有值，没有值时绑定window</span></span><br><span class="line">  <span class="comment">//调用需要被执行的函数</span></span><br><span class="line">  thisArg.fn = fn</span><br><span class="line">  <span class="keyword">var</span> result</span><br><span class="line">  <span class="comment">// if (!argArray) &#123;</span></span><br><span class="line">  <span class="comment">//   //没有传参数</span></span><br><span class="line">  <span class="comment">//   result = thisArg.fn(); //拿到执行结果</span></span><br><span class="line">  <span class="comment">// &#125; else &#123;</span></span><br><span class="line">  <span class="comment">//   result = thisArg.fn(...argArray); //拿到执行结果</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  argArray = argArray ?? []</span><br><span class="line">  result = thisArg.fn(...argArray)</span><br><span class="line">  <span class="keyword">delete</span> thisArg.fn</span><br><span class="line">  <span class="keyword">return</span> result <span class="comment">//将函数的执行结果返回出去</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>bind 方法的实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//系统bind传参方式</span></span><br><span class="line"><span class="keyword">var</span> newSum = sum.bind(<span class="number">10</span>) <span class="comment">//方式一</span></span><br><span class="line">newSum(<span class="number">20</span>, <span class="number">30</span>) <span class="comment">//方式二</span></span><br><span class="line"><span class="comment">//两种方式可以独立使用，也可以混合使用;混合使用时，方式为前面的参数，方式二为后面的参数</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.ysjBind = <span class="function"><span class="keyword">function</span> (<span class="params">thisArg, ...argArray</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//获取调用bind的函数</span></span><br><span class="line">  <span class="keyword">var</span> fn = <span class="built_in">this</span></span><br><span class="line">  <span class="comment">//绑定this</span></span><br><span class="line">  thisArg = thisArg !== <span class="literal">null</span> &amp;&amp; thisArg !== <span class="literal">undefined</span> ? <span class="built_in">Object</span>(thisArg) : <span class="built_in">window</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...argArray2</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//将函数放到thisArg中进行调用</span></span><br><span class="line">    thisArg.fn = fn</span><br><span class="line">    <span class="keyword">var</span> finalArg = [...argArray, ...argArray2] <span class="comment">//对两个函数的参数进行合并</span></span><br><span class="line">    <span class="keyword">var</span> result = thisArg.fn(...finalArg)</span><br><span class="line">    <span class="keyword">delete</span> thisArg.fn</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h4><p>arguments 是一个对应于<strong>传递给函数的参数</strong>的<strong>类数组对象</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">num1, num2, num3</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//函数所接收的所有参数会放进一个类数组对象中：arguments</span></span><br><span class="line">  <span class="comment">//类数组：有length属性，可以通过index索引访问，但没有数组的方法</span></span><br><span class="line">  <span class="comment">//常见的对arguments的操作有三个</span></span><br><span class="line">  <span class="comment">//1.获取参数的长度</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>.length)</span><br><span class="line">  <span class="comment">//2.根据索引值获取某一个参数</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>[<span class="number">2</span>])</span><br><span class="line">  <span class="comment">//3.callee获取当前arguments所在的函数</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>.callee) <span class="comment">//此处打印的函数就为foo</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//将arguments转成数组类型的集中方式</span></span><br><span class="line">  <span class="comment">//1.自己遍历arguments中的所有元素再放到一个数组里面</span></span><br><span class="line">  <span class="comment">//2.利用Array.prototype.slice将arguments转成数组</span></span><br><span class="line">  <span class="keyword">var</span> newArr1 = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>) <span class="comment">//内部会将arguments这个可遍历对象遍历，然后放进一个数组再返回</span></span><br><span class="line">  <span class="comment">//写法等价于  [].slice.call(arguments);</span></span><br><span class="line">  <span class="comment">//3.ES6的语法</span></span><br><span class="line">  <span class="keyword">var</span> newArray2 = <span class="built_in">Array</span>.from(<span class="built_in">arguments</span>)</span><br><span class="line">  <span class="keyword">var</span> newArray3 = [...arguments] <span class="comment">//利用展开运算符</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>箭头函数中没有 arguments</p><h4 id="纯函数"><a href="#纯函数" class="headerlink" title="纯函数"></a>纯函数</h4><p>在程序设计中，若一个函数符合以下条件，那么这个函数被称为纯函数：</p><ul><li>此函数在相同的输入值时，需产生相同的输出</li><li>函数的输出和输入值以外的其它隐藏信息或状态无关，也和由 I/O 设备产生的外部输出无关</li><li>该函数不能有语义上可观察的函数副作用，如：触发事件，使输出设备输出或更改输出值以外物件的内容等</li></ul><p>总结：</p><ul><li>确定的输入，一定会产生确定的输出</li><li>函数在执行过程中，不能产生副作用</li></ul><p>副作用(slide effect)：表示在执行一个函数时，除了返回函数值之外，还对调用函数产生了附加的影响，比如修改了全局变量，修改参数或改变外部存储</p><h4 id="柯里化"><a href="#柯里化" class="headerlink" title="柯里化"></a>柯里化</h4><p>柯里化(Currying)也属于函数式编程里面一个非常重要的概念</p><ul><li>柯里化是把接收多个参数的函数，变成接收一个单一参数(最初函数的第一个参数)的函数，并且返回接收余下的参数，而且返回结果的新函数的技术</li><li>柯里化声称：如果你固定某些参数，你将得到接收余下参数的一个函数</li></ul><p>总结：</p><ul><li>只传递给函数一部分参数来调用它，让它返回一个函数去处理剩余的参数，这个过程称为柯里化</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y, z</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//柯里化之前</span></span><br><span class="line">  <span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//转成柯里化</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">z</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> x + y + z</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">10</span>)(<span class="number">20</span>)(<span class="number">30</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//简化柯里化的代码</span></span><br><span class="line"><span class="keyword">var</span> sum2 = <span class="function">(<span class="params">x</span>) =&gt;</span> <span class="function">(<span class="params">y</span>) =&gt;</span> <span class="function">(<span class="params">z</span>) =&gt;</span> x + y + z</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum2(<span class="number">10</span>)(<span class="number">20</span>)(<span class="number">30</span>))</span><br></pre></td></tr></table></figure><p>柯里化作用：</p><ul><li><p>让函数职责单一</p><ul><li>在函数式编程中，我们其实往往希望一个函数处理的问题尽可能单一，而不是将一大堆的处理过程交给一个函数来处理</li><li>我们就可以将每次传入的参数在单一的函数中进行处理，处理完后在下一个函数中再使用处理后的结果</li></ul></li><li><p>逻辑的复用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeAdder</span>(<span class="params">m</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> m + n</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//柯里化每次接收一个或多个参数</span></span><br><span class="line"><span class="keyword">var</span> makeAdder2 = <span class="function">(<span class="params">m</span>) =&gt;</span> <span class="function">(<span class="params">n</span>) =&gt;</span> m + n <span class="comment">//简写</span></span><br><span class="line"><span class="comment">//如果需要多次将5与另一个数相加</span></span><br><span class="line"><span class="keyword">var</span> adder5 = makeAdder(<span class="number">5</span>)</span><br><span class="line">adder(<span class="number">6</span>) <span class="comment">// 5 + 6</span></span><br><span class="line">adder(<span class="number">67</span>) <span class="comment">// 5 + 67</span></span><br><span class="line">adder(<span class="number">7</span>) <span class="comment">// 5 +7</span></span><br><span class="line">adder(<span class="number">76</span>) <span class="comment">// 5 + 76</span></span><br></pre></td></tr></table></figure></li></ul><p>柯里化函数的实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//柯里化函数的实现：传入一个函数，自动转换成柯里化之后的函数并返回</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curring</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">curried</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//判断当前已经接受的参数的个数，是否和参数本身需要接收的参数一致</span></span><br><span class="line">    <span class="comment">//函数名.length可以获取该函数接收几个参数</span></span><br><span class="line">    <span class="keyword">if</span> (args.length &gt;= fn.length) &#123;</span><br><span class="line">      <span class="comment">//当已经传入的参数大于需要的参数时，执行函数</span></span><br><span class="line">      <span class="keyword">return</span> fn.apply(<span class="built_in">this</span>, args) <span class="comment">//使用apply调用函数，若外界使用调用函数的时候绑定了this，可保持this与外界一致</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//接收的参数个数不够，还需返回新的函数，继续接收剩余的参数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args2</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//接收到参数后递归调用curried,来检查函数参数个数是否达到</span></span><br><span class="line">        <span class="keyword">return</span> curried.apply(<span class="built_in">this</span>, [...args, ...args2])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> curried</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="组合函数"><a href="#组合函数" class="headerlink" title="组合函数"></a>组合函数</h4><p>组合函数是在 js 开发过程中一种对函数的使用技巧、模式：</p><ul><li>如：需对某一个数据进行函数的调用，执行两个函数 fn1、fn2，两个函数依次执行</li><li>可以将这两个函数组合起来，自动依次调用(避免每次调用时操作上显得重复)</li><li>这个过程就是对函数的组合，称之为组合函数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">composeFn</span>(<span class="params">fn1, fn2</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//将传入的两个函数组合</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">count</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fn2(fn1(count))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> newFn = composeFn(doubleFn, squareFn)</span><br><span class="line"><span class="built_in">console</span>.log(newFn(<span class="number">10</span>))</span><br></pre></td></tr></table></figure><p>封装通用组合函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ysjCompose</span>(<span class="params">...fns</span>) </span>&#123;</span><br><span class="line">  fns.forEach(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> el !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">//如果传进来的参数有不是函数的</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;Expect arguments are functions!&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = args</span><br><span class="line">    fns.forEach(<span class="function">(<span class="params">fn, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (index === <span class="number">0</span>) <span class="keyword">return</span> (result = fn.apply(<span class="built_in">this</span>, args))</span><br><span class="line">      result = fn.call(<span class="built_in">this</span>, result)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> newFn = ysjCompose(fn1, fn2)</span><br><span class="line">newFn(<span class="number">20</span>, <span class="number">30</span>)</span><br></pre></td></tr></table></figure><h3 id="JS-小知识"><a href="#JS-小知识" class="headerlink" title="JS 小知识"></a>JS 小知识</h3><h4 id="with-语句"><a href="#with-语句" class="headerlink" title="with 语句"></a>with 语句</h4><p>可以形成自己的作用域(不建议在开发中使用，严格模式会报错)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>: <span class="string">&quot;ysj&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;obj message&quot;</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">with</span>(<span class="params">obj</span>)</span> &#123; <span class="comment">//with语句参数为一个对象</span></span><br><span class="line">      <span class="built_in">console</span>.log(message); <span class="comment">//此时会沿着作用域链向上查找，with是遇到的第一个作用域，里面有message，就会停止查找</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> info = &#123;<span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>&#125;;</span><br><span class="line"><span class="function"><span class="title">whih</span>(<span class="params">info</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name); <span class="comment">//ysj</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="eval-函数"><a href="#eval-函数" class="headerlink" title="eval 函数"></a>eval 函数</h4><p>eval 是一个特殊的函数，可以将传入的字符串当作 js 代码来执行(不建议使用)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jsString = <span class="string">&#x27;var message = &quot;hello&quot;; console.log(message);&#x27;</span></span><br><span class="line"><span class="built_in">eval</span>(jsString) <span class="comment">//hello</span></span><br></pre></td></tr></table></figure><h4 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a>严格模式</h4><p>在 ES5 中，JS 提出了严格模式的概念(Strict Mode)：</p><ul><li>支持严格模式的浏览器在检测到代码有严格模式时，会以更加严格的方式对代码进行检测和执行</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span> <span class="comment">//在js文件顶部书写，给这个js文件开启严格模式</span></span><br><span class="line"><span class="comment">//脚手架打包之后的代码会自动开启严格模式</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  &#x27;use strict&#x27;</span> <span class="comment">//在函数最前面书写，单独给这个函数开启严格模式</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>严格模式对正常的 js 语义进行了一些限制：</p><ul><li>严格模式通过抛出错误来显出一些原有的静默(silent)错误</li><li>严格模式让 js 引擎在执行代码时可以进行更多的优化(不需要对一些特殊的语法进行处理)</li><li>严格模式禁用了在 ECMAScript 未来版本中可能会定义的一些语法(禁止使用保留字、关键字)</li></ul><p>严格模式常见限制：</p><ul><li>无法意外的创建全局变量</li><li>严格模式会使引起静默失败(silently fail，不报错也没有任何效果)的赋值操作抛出异常</li><li>严格模式下试图删除不可删除的属性</li><li>严格模式下不允许函数参数有相同的名称</li><li>不允许 0 的八进制语法(原来的 0123 表示的八进制，现用 0o123 表八进制)</li><li>在严格模式下不允许使用 with</li><li>在严格模式下，eval 不再向上引用变量</li><li>严格模式下，this 绑定不会默认转成对象(严格模式下自执行函数&lt;默认绑定&gt;会指向 undefined)</li></ul><h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><p>面向对象是现实的抽象方式，对象可以将多个相关联的数据封装到一起，更好的描述一个事物</p><ul><li>如车的颜色、速度、品牌、价格等</li></ul><p>用对象来描述事物，更有利于我们将现实的事物，抽离成代码中的某个数据结构</p><h5 id="对象的创建方式"><a href="#对象的创建方式" class="headerlink" title="对象的创建方式"></a>对象的创建方式</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个对象，对某一个人进行抽象(描述)</span></span><br><span class="line"><span class="comment">//创建方式一：通过new Object创建</span></span><br><span class="line"><span class="keyword">var</span> obj1 = <span class="keyword">new</span> <span class="built_in">Object</span>()</span><br><span class="line">obj1.name = <span class="string">&#x27;ysj&#x27;</span></span><br><span class="line">obj1.age = <span class="number">18</span></span><br><span class="line">obj1.running = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27;在跑步&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建方式2:字面量形式</span></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">eating</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27;在吃饭&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="对属性操作的控制"><a href="#对属性操作的控制" class="headerlink" title="对属性操作的控制"></a>对属性操作的控制</h5><p>属性直接定义到对象内部或添加到对象内部，就无法对属性进行一些限制；如果想要对属性进行一些比较精准的操作控制，可以使用属性描述符</p><ul><li>通过属性描述符可以精准的添加或修改对象属性</li><li>属性描述符需要使用 Object.defineProperty 来对属性进行添加或修改</li></ul><p>Object.defineProperty()方法会直接在一个对象上定义一个新属性或修改一个对象现有的属性，并返回此对象</p><ul><li><p>参数一：要进行操作的对象</p></li><li><p>参数二：要对这个对象的哪一个属性进行操作</p></li><li><p>参数三：属性描述符(是一个对象,可以分为两类)</p><ul><li>数据属性描述符<ul><li>[[configurable]]:表示属性是否可以通过 delete 删除属性，是否可以修改它的特性，是否可以将它修改为存取属性描述符<ul><li>直接在对象上定义属性时，这个属性的 configurable 为 true</li><li>通过属性描述符定义一个属性时，这个属性的 configurable 默认为 false</li></ul></li><li>[[enumerable]]:表示属性是否可以通过 for-in 或者 Object.keys()返回该属性<ul><li>直接在对象上定义属性时，这个属性的 enumerable 为 true</li><li>通过属性描述符定义一个属性时，这个属性的 enumerable 默认为 false</li></ul></li><li>[[writable]]:表示是否可以修改属性的值<ul><li>直接在对象上定义属性时，这个属性的 writable 为 true</li><li>通过属性描述符定义一个属性时，这个属性的 writable 默认为 false</li></ul></li><li>[[value]]:属性的 value 值，读取属性时会返回该值，修改属性时，会对其进行修改<ul><li>默认情况下这个值为 undefined</li></ul></li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//没有使用属性描述符定义的属性，也具备对应的特性</span></span><br><span class="line"><span class="comment">//value:赋值的value</span></span><br><span class="line"><span class="comment">//其它特性默认值都为true</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//数据属性描述符</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;address&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;重庆市&#x27;</span>, <span class="comment">//默认值undefined</span></span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span>, <span class="comment">//不可配置(不能删除address属性,也不可重新定义属性描述符),默认值false</span></span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="comment">//不可枚举(只能通过对象.属性名取到这个属性的值,其它方式都看不到这个属性),默认值false</span></span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">false</span>, <span class="comment">//不可修改address的属性值(不可写入),默认值false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>存取属性描述符(也称访问器描述符)<ul><li>[[configurable]]特性与数据属性描述符相同</li><li>[[enumerable]]特性与数据属性描述符相同</li><li>[[get]]:获取属性时会执行的函数。默认为 undefined</li><li>[[set]]:设置属性时会执行的函数。默认为 undefined</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">_address</span>: <span class="string">&#x27;重庆市&#x27;</span>, <span class="comment">//_开头，表私有,隐藏该属性</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//存取属性描述符(vue2响应式原理)</span></span><br><span class="line"><span class="comment">//应用场景：1.隐藏某一个私有属性，不希望直接被外界使用和赋值</span></span><br><span class="line"><span class="comment">//2.如果希望截获某个属性的访问和设置值的过程时,也会使用存取属性描述符</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;address&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// value: &quot;重庆市&quot;, //&lt;value,write&gt;和&lt;getter,setter&gt;只能二选一</span></span><br><span class="line">  <span class="comment">// writable: true,</span></span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">get</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._address</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">set</span>: <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>._address = value</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.address) <span class="comment">//重庆市</span></span><br><span class="line">obj.address = <span class="string">&#x27;北京市&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.address) <span class="comment">//北京市</span></span><br></pre></td></tr></table></figure><table><thead><tr><th></th><th>configurable</th><th>enumerable</th><th>value</th><th>writable</th><th>get</th><th>set</th></tr></thead><tbody><tr><td>数据描述符</td><td>支持</td><td>支持</td><td>支持</td><td>支持</td><td></td><td></td></tr><tr><td>存取描述符</td><td>支持</td><td>支持</td><td></td><td></td><td>支持</td><td>支持</td></tr></tbody></table></li></ul><p><strong>定义多个属性描述符</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">_age</span>: <span class="number">18</span>, <span class="comment">//js没有严格意义上的私有属性,以_开头的属性或方法认为是私有属性、方法</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(obj, &#123;</span><br><span class="line">  <span class="comment">//变y为i加es表复数，可以定义多个属性描述符</span></span><br><span class="line">  <span class="attr">name</span>: &#123;</span><br><span class="line">    <span class="comment">//在此对象里面添加对应的属性描述符</span></span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">age</span>: &#123;</span><br><span class="line">    <span class="comment">//age属性</span></span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>._age</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>._age = value</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(obj.age)</span><br><span class="line">obj.age = <span class="number">33</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.age)</span><br></pre></td></tr></table></figure><p>另一种写法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">_age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="keyword">set</span> <span class="title">age</span>(<span class="params">value</span>) &#123; <span class="comment">//此写法enumerable，configurable都是使用默认值，都为true</span></span><br><span class="line">    <span class="built_in">this</span>._age = value;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">get</span> <span class="title">age</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="对象方法补充-了解"><a href="#对象方法补充-了解" class="headerlink" title="对象方法补充(了解)"></a>对象方法补充(了解)</h5><p>获取属性描述符</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取某一个属性的属性描述符</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, <span class="string">&#x27;name&#x27;</span>))</span><br><span class="line"><span class="comment">//获取对象的所有属性描述符</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptors(obj))</span><br></pre></td></tr></table></figure><p>Object 的方法对对象进行限制</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//禁止对象继续添加新的属性</span></span><br><span class="line"><span class="built_in">Object</span>.preventExtensions(obj) <span class="comment">//阻止对象进行扩展</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//禁止对象配置、删除里面的属性</span></span><br><span class="line"><span class="comment">//方法一：遍历对象，将对象每个描述符的configurable修改为false</span></span><br><span class="line"><span class="built_in">Object</span>.seal(obj) <span class="comment">//方法二，让对面里面的所有属性变得不可配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//让对象的属性不可被修改(writable设置成false)</span></span><br><span class="line"><span class="built_in">Object</span>.freeze(obj) <span class="comment">//freeze:冻结</span></span><br></pre></td></tr></table></figure><h5 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h5><p>构造函数也称之为构造器(constructor)，通常是我们在创建对象时会调用的函数</p><p>在其它面向对象编程的语言中，构造函数是存在于类中的一个方法，称之为构造方法</p><p>构造函数也是一个普通的函数，从表现形式上和其它函数没有任何区别；一旦一个普通函数被使用 new 操作符调用了，这个函数就称之为一个构造函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;构造函数&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//通过new关键字调用一个函数，那么这个函数就是一个构造函数</span></span><br><span class="line"><span class="keyword">new</span> Person() <span class="comment">//通过new调用，会将函数执行一遍</span></span><br></pre></td></tr></table></figure><p>如果一个函数被使用 new 操作符调用了，则会执行如下操作：</p><ol><li>在堆内存中创建一个新对象(空对象)</li><li>这个对象内部的[[prototype]]属性会被赋值为该构造函数的 prototype 属性<ul><li>this.__proto__ = fn.prototype (隐式原型指向显式原型)</li></ul></li><li>构造函数内部的 this，会指向创建出来的新对象</li><li>执行函数内部的代码(函数体代码)</li><li>如果构造函数没有返回非空对象，则返回创建出来的新对象</li></ol><p>构造函数创建对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, height, address</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//构造函数,函数名首字母大写，多个字母时采用驼峰(约定俗成的规范)</span></span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.age = age</span><br><span class="line">  <span class="built_in">this</span>.height = height</span><br><span class="line">  <span class="built_in">this</span>.address = address</span><br><span class="line">  <span class="built_in">this</span>.eating = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27;在吃东西&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.running = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27;在跑步&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> Person(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>, <span class="number">1.88</span>, <span class="string">&#x27;重庆市&#x27;</span>)</span><br></pre></td></tr></table></figure><p>构造函数缺点：</p><p>每个对象都会重复创建新的函数对象(如果有属性为函数),浪费空间(解决方案：原型)</p><h5 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h5><p><strong>对象原型</strong></p><p>JS 中每个对象都有一个特殊的内置属性[[prototype]]，这个特殊的对象可以指向另外一个对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span> &#125; <span class="comment">//每个对象被创建后里面就有一个属性[[prototype]],这个属性称之为对象的隐式原型</span></span><br><span class="line"><span class="comment">//早期的ECMA没有规范如何去查看[[prototype]]</span></span><br><span class="line"><span class="comment">//所以有些浏览器厂商给对象提供了一个属性,让我们可以查看这个原型对象</span></span><br><span class="line"><span class="comment">//  __proto__</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.__proto__)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getPrototypeOf(obj)) <span class="comment">//获取原型，ES5之后提供</span></span><br></pre></td></tr></table></figure><p>原型作用</p><p>当从一个对象中获取某一个属性时，会触发[[get]]操作(getter 操作)，进行两步操作</p><ol><li>在当前对象中去查找对应的属性,如果找到就直接使用</li><li>如果没有找到，就会沿着它的原型链(prototype chain)去查找，即去[[prototype]]里面查找(为了方便实现继承)</li></ol><p><strong>函数原型</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="comment">//函数也是一个对象</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.__proto__) <span class="comment">//函数作为对象来说，也有[[prototype]] 隐式原型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//函数因为是一个函数,所以还会多出一个显式原型属性: prototype</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.prototype)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> foo()</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> foo()</span><br><span class="line"><span class="comment">//this.__proto__ = fn.prototype (创建出来的对象的隐式原型指向函数的显式原型)</span></span><br><span class="line"><span class="comment">//new操作时，p1和p2的隐式原型会指向函数的显式原型</span></span><br><span class="line"><span class="comment">// 即 p1.__proto__ = p2.__proto__ = foo.prototype, 三者相等</span></span><br></pre></td></tr></table></figure><p>创建对象的内存表现</p><p>Person 函数的 prototype 指向 Person 函数的原型对象</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20211120221128918.png" alt="image-20211120221128918"></p><p><strong>函数原型上的属性</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//这个对象的显式原型上有一个constructor属性(此属性可枚举为false)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Person.prototype.constructor = 构造函数本身(指向构造函数本身)</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype.constructor)</span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype.constructor.name) <span class="comment">//拿到函数名字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//也可以给原型上面添加自己的属性</span></span><br><span class="line">Person.prototype.name = <span class="string">&#x27;ysj&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果要添加多个属性，可以直接修改整个prototype对像</span></span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  <span class="attr">constructor</span>: Person, <span class="comment">//此时添加的constructor的可枚举为true，与原先的constructor属性可枚举属性的值不一致</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//真实开发中，可以通过Object.defineProperty的方式添加constructor</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(Person.prototype, <span class="string">&#x27;constructor&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">writeable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">value</span>: Person,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>创建对象方案：原型和构造函数结合</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, height</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name <span class="comment">//属性放到对象自己上面</span></span><br><span class="line">  <span class="built_in">this</span>.age = age</span><br><span class="line">  <span class="built_in">this</span>.height = height</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.eating = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//方法放到原型上面(执行过程都一样，没必要每个对象都创建一个独立的方法)</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27;在吃饭&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> Person(<span class="string">&#x27;ysj&#x27;</span>, <span class="number">18</span>, <span class="number">1.88</span>)</span><br></pre></td></tr></table></figure><h5 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h5><p>面向对象三大特性：封装、继承、多态</p><ul><li>封装：将属性和方法封装到一个类中，称为封装的过程(编写类的过程称之为封装的过程)</li><li>继承：可以复用代码，是多态的前提</li><li>多态：在某一个方法里面，看似相同的类型，在真正执行方法的时候，表现出来的形态是不一样的</li></ul><p>继承可以将重复的代码和逻辑抽取到父类中，子类只需要直接继承过来使用即可(JS 利用原型链实现继承)</p><p><strong>当从对象取一个属性在自身没找到时，会去原型对象上的__proto__上查找，原型对象也是一个对象，也有__proto__属性，这个原型对象会在他的原型对象上面接着查找，还没找到会继续往下一个原型对象上面找，依次向后查找…… 所有的这些原型最终会形成一个链条，称之为原型链</strong></p><p>原型链: obj.__proto__.__proto__.__proto__</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20220220110135691.png" alt="image-20220220110135691"></p><p>obj.name</p><ul><li><p>取出对象的一个属性，会先从对象开始查找</p></li><li><p>没找到就在对象的__proto__上查找该属性，一直找到没有__proto__（Object.prototype.__proto__ === null）属性结束</p></li><li><p>即有一个对象的__proto__ === Object.prototype 时，就找到了顶层的原型，然后会停止查找</p></li></ul><p>==Object 是所有类的父类，本质上是一个构造函数==</p><p>Object 是一个函数，所以也有显式原型对象 prototype</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="comment">//此写法等价于  const obj = new Object();  所以 obj.__proto__ = Object.prototype</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.__proto__) <span class="comment">//打印出来的是Object.prototype</span></span><br></pre></td></tr></table></figure><p>Object 原型</p><ul><li>该对象有原型属性,但他的原型(__proto__)属性指向 null，也就是已经是顶层原型了</li><li>该对象上有很多默认的属性和方法（constructor、ToString、valueOf 等）</li></ul><p><strong>Person 构造函数原型</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype) <span class="comment">//里面有一个constructor</span></span><br><span class="line">Person.prototype.__proto__ <span class="comment">//Person的原型对象上面的原型属性指向顶层原型</span></span><br><span class="line"><span class="comment">//Person继承自Object</span></span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20220220165108250.png" alt="image-20220220165108250"></p><h5 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h5><h6 id="原型链继承方案"><a href="#原型链继承方案" class="headerlink" title="原型链继承方案"></a>原型链继承方案</h6><p>让子类的显式原型执指向父类 new 出来的实例</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父类：公共</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = <span class="string">&#x27;ysj&#x27;</span></span><br><span class="line">  <span class="built_in">this</span>.friends = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.eating = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27; eating&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类：放自己特有的属性和方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.sno = <span class="number">111</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> Person()</span><br><span class="line">Student.prototype = p <span class="comment">//继承</span></span><br><span class="line"></span><br><span class="line">Student.prototype.studying = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27; studying&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu1 = <span class="keyword">new</span> Student()</span><br><span class="line"></span><br><span class="line"><span class="comment">//原型链实现继承弊端</span></span><br><span class="line"><span class="comment">//1.打印stu对象时，继承过来的属性是看不到的</span></span><br><span class="line"><span class="comment">//2.创建多个对象时,获取引用,修改引用中的值会相互影响</span></span><br><span class="line"><span class="keyword">const</span> stu1 = <span class="keyword">new</span> Student()</span><br><span class="line"><span class="keyword">const</span> stu2 = <span class="keyword">new</span> Student()</span><br><span class="line">stu1.friends.push(<span class="string">&#x27;kobe&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(stu2.friends) <span class="comment">// [&quot;kobe&quot;]</span></span><br><span class="line"><span class="comment">//因为stu1和stu2的__proto__都指向同一个原型对象，</span></span><br><span class="line">stu1.name = <span class="string">&#x27;kobe&#x27;</span> <span class="comment">//直接修改对象上的属性，是给本对象添加了一个新属性，不会影响原型对象上面的值</span></span><br><span class="line">stu1.frieds = [<span class="string">&#x27;kobe&#x27;</span>] <span class="comment">//给stu1上添加属性，也不会影响原型上的值</span></span><br><span class="line"><span class="built_in">console</span>.log(stu2.name) <span class="comment">// ysj</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.传参只能传到子类Student，传不到父类Person，所以公共处理逻辑无法放到父类Person上面</span></span><br></pre></td></tr></table></figure><p>原型链继承方案内存图：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20220220183522719.png"></p><h6 id="借用构造函数继承方案"><a href="#借用构造函数继承方案" class="headerlink" title="借用构造函数继承方案"></a>借用构造函数继承方案</h6><p>让子类的显式原型指向父类 new 出来的实例</p><p>同时在子类构造函数中用 call 绑定 this 调用父类构造函数并传入参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父类：公共</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, friends</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.age = age</span><br><span class="line">  <span class="built_in">this</span>.friends = friends</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.eating = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27; eating&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类：放自己特有的属性和方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age, friends, sno</span>) </span>&#123;</span><br><span class="line">  Person.call(<span class="built_in">this</span>, name, age, friends) <span class="comment">//公共逻辑放到父类，解决原型链继承的弊端，此处会调用一次父类构造函数</span></span><br><span class="line">  <span class="built_in">this</span>.sno = sno</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Student.prototype = <span class="keyword">new</span> Person() <span class="comment">//此处new Person也会调用一次父类构造函数</span></span><br><span class="line"></span><br><span class="line">Student.prototype.studying = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27; studying&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stu1 = <span class="keyword">new</span> Student(<span class="string">&#x27;ysj&#x27;</span>, <span class="number">17</span>, [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>], <span class="number">111</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//组合继承弊端</span></span><br><span class="line"><span class="comment">//1.最大的问题就是无论在什么情况下，都会至少调用两次父类构造函数</span></span><br><span class="line"><span class="comment">//一次在创建子类原型的时候</span></span><br><span class="line"><span class="comment">//另一次在子类构造函数内部(也就是每次创建子类实例的时候)</span></span><br><span class="line"><span class="comment">//2.stu的原型上会多出一些属性，但是这些属性没有存在的必要</span></span><br><span class="line"><span class="comment">//2.所有的子类实例事实上都会拥有两份父类的属性</span></span><br><span class="line"><span class="comment">//一份在当前的实例自己里面(也就是stu1本身的)，</span></span><br><span class="line"><span class="comment">//另一份在子类对应的原型对象中(也就是stu1.__proto__里面，属性的值都为undefined,因为第18行代码指向父类实例的时候没有传参数)</span></span><br></pre></td></tr></table></figure><p>内存图：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20220220202843560.png" alt="image-20220220202843560"></p><p>原型式继承(对象)：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createObject</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newObj = &#123;&#125;</span><br><span class="line">  <span class="built_in">Object</span>.setPrototypeOf(newObj, o) <span class="comment">//将newObj的原型设置为传进来的o这个对象</span></span><br><span class="line">  <span class="keyword">return</span> newObj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createObject2</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//不适用Object.setPrototypeOf方法，实现办法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Fn</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  Fn.prototype = o</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Fn()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> info = createObject(obj) <span class="comment">//此时info的原型就为obj info.__proto__ === obj</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> info = <span class="built_in">Object</span>.create(obj) <span class="comment">//将info的原型设置为obj，Object.create功能等同于以上两个函数</span></span><br></pre></td></tr></table></figure><h6 id="寄生式继承方案"><a href="#寄生式继承方案" class="headerlink" title="寄生式继承方案"></a>寄生式继承方案</h6><p>结合原型类继承和工厂模式的一种方案：</p><ul><li>即创建一个封装继承过程的函数，该函数在内部以某种方式来增强对象，最后再将这个对象返回</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pObj = &#123;</span><br><span class="line">  <span class="comment">//原型式继承</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">running</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;running&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStu</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//工厂函数，</span></span><br><span class="line">  <span class="keyword">var</span> stu = <span class="built_in">Object</span>.create(pObj) <span class="comment">// stu.__proto__ === pObj</span></span><br><span class="line">  stu.name = name</span><br><span class="line">  stu.studying = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//这个方法每个实例对象都会有一份，浪费空间，且无法看到实例的类型，也不是通过new创建实例，不直观</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;studying&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> stu</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stuObj = createStu(<span class="string">&#x27;ysj&#x27;</span>)</span><br></pre></td></tr></table></figure><h6 id="寄生组合式继承方案"><a href="#寄生组合式继承方案" class="headerlink" title="寄生组合式继承方案"></a>寄生组合式继承方案</h6><p>创建一个新对象，使子类 Student.prototype 指向这个新对象，新对象的__proto__指向父类 Person.prototype</p><p>仍然需要在子类中使用 call 调用父类函数绑定 this，并传入参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span>(<span class="params">SubType, SuperType</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//封装的继承函数</span></span><br><span class="line">  SubType.prototype = <span class="built_in">Object</span>.create(SuperType.prototype) <span class="comment">//SubType.prototype.__proto__ === newObj.__proto__ ===  SuperType.prototype</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(SubType.prototype, <span class="string">&#x27;constructor&#x27;</span>, &#123;</span><br><span class="line">    <span class="comment">//给SubType.prototype添加constructor属性，使得SubType的实例的类型显式正确</span></span><br><span class="line">    <span class="attr">value</span>: SubType,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, friends</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.age = age</span><br><span class="line">  <span class="built_in">this</span>.friends = friends</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.eating = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27; eating&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age, friends, sno, score</span>) </span>&#123;</span><br><span class="line">  Person.call(<span class="built_in">this</span>, name, age, friends)</span><br><span class="line">  <span class="built_in">this</span>.sno = sno</span><br><span class="line">  <span class="built_in">this</span>.score = score</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inheritPrototype(Student, Person) <span class="comment">//调用封装的继承函数</span></span><br><span class="line"></span><br><span class="line">Student.prototype.studying = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27; studying&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu1 = <span class="keyword">new</span> Student(<span class="string">&#x27;ysj&#x27;</span>, <span class="number">18</span>, [<span class="string">&#x27;james&#x27;</span>, <span class="string">&#x27;curry&#x27;</span>], <span class="number">111</span>, <span class="number">100</span>)</span><br><span class="line"><span class="built_in">console</span>.log(stu1)</span><br><span class="line">stu1.studying()</span><br></pre></td></tr></table></figure><h5 id="JS-原型相关判断方法"><a href="#JS-原型相关判断方法" class="headerlink" title="JS 原型相关判断方法"></a>JS 原型相关判断方法</h5><p><strong>hasOwnProperty</strong></p><p>判断对象上是否具有某个属性：</p><ul><li>obj.hasOwnProperty(“propertyName”)</li><li>有返回 true，没有返回 false</li></ul><p><strong>in 操作符</strong></p><p><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%88%A4%E6%96%AD">数据类型和判断</a></p><p>判断指定的属性是否在指定的对象或其原型链中</p><ul><li>“prop” in obj</li><li>在对象或对象原型链上返回 true</li><li>不在返回 false</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> info = <span class="built_in">Object</span>.create(obj, &#123;</span><br><span class="line">  <span class="comment">//创建一个对象并赋值给info</span></span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="comment">//创建对象的时候同时向对象上增加属性</span></span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;北京市&#x27;</span>,</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//hasOwnProperty 判断的属性在当前对象中就返回true</span></span><br><span class="line"><span class="built_in">console</span>.log(info.hasOwnProperty(<span class="string">&#x27;address&#x27;</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(info.hasOwnProperty(<span class="string">&#x27;name&#x27;</span>)) <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//in操作符(只要判断的属性在当前对象或当前对象的原型（__proto__）上面，都返回true)(只要存在这个属性就都返回true)</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;address&#x27;</span> <span class="keyword">in</span> info) <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> info) <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> info) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(key) <span class="comment">// address name age 对象本身和对象原型上面的属性都能遍历出来</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>instanceof</strong></p><p><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%88%A4%E6%96%AD">数据类型和判断</a></p><p>用来检测<strong>构造函数的 prototype</strong>，是否出现在<strong>某个实例对象的原型链上</strong></p><ul><li>语法： 实例对象 instanceof 构造函数(只能是函数)</li><li>如果 <code>实例对象</code> 隶属于 <code>Class</code> 类（或 <code>Class</code> 类的衍生类），则返回 <code>true</code>。</li><li>出现返回 true，没出现返回 false</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span>(<span class="params">SubType, SuperType</span>) </span>&#123;</span><br><span class="line">  SubType.prototype = <span class="built_in">Object</span>.create(SuperType.prototype)</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(SubType.prototype, <span class="string">&#x27;constructor&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">value</span>: SubType,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">inheritPrototype(Student, Person) <span class="comment">//让Student继承自Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu = <span class="keyword">new</span> Student()</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断stu的原型链上会不会出现Student的原型，能出现返回true，否则返回false</span></span><br><span class="line"><span class="comment">// stu.__proto__ === Student.prototype</span></span><br><span class="line"><span class="comment">// Student.prototype.__proto__ === Person.prototype</span></span><br><span class="line"><span class="comment">// Person.prototype.__proto__ === Object.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(stu <span class="keyword">instanceof</span> Student) <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(stu <span class="keyword">instanceof</span> Person) <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(stu <span class="keyword">instanceof</span> <span class="built_in">Object</span>) <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p><strong>isPrototypeOf(了解)</strong></p><p>用于检测某个对象，是否出现在某个实例对象的原型链上</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person()</span><br><span class="line"><span class="built_in">console</span>.log(p <span class="keyword">instanceof</span> Person) <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype.isPrototypeOf(p)) <span class="comment">//true 判断p有没有直接出现在Person.prototype这个对象上面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> info = <span class="built_in">Object</span>.create(obj)</span><br><span class="line"><span class="built_in">console</span>.log(obj.isPrototypeOf(info)) <span class="comment">//判断obj对象有没有出现在info的原型链上面</span></span><br></pre></td></tr></table></figure><h5 id="对象-函数-原型关系"><a href="#对象-函数-原型关系" class="headerlink" title="对象-函数-原型关系"></a>对象-函数-原型关系</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="comment">//对象由 new Object()创建出来的</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在全局由Object和Function两个类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Object</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.__proto__ === <span class="built_in">Object</span>.prototype) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对象里面有一个隐式原型对象：__proto__</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Foo是一个函数，所以会有一个显式原型对象：Foo.prototype(来自创建函数时，js给这个函数生成的新的对象)</span></span><br><span class="line"><span class="comment">// Foo.prototype == &#123; constructor: Foo &#125; (constructor属性指向Foo本身)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//函数本身也是一个对象,这个对象由new Function()创建出来，所以会有一个隐式原型对象：Foo.__proto__(来自new Function)</span></span><br><span class="line"><span class="comment">// Foo.__proto__ == Function.prototype</span></span><br><span class="line"><span class="comment">// Function.prototype == &#123; constructor: Function &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//函数由 new Function()创建出来的：const Foo = new Function()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Function作为函数，本身也是由new Function()创建出来,Function.__proto__ == Function.prototype</span></span><br><span class="line"><span class="comment">// Object.prototype.__proto__ === null</span></span><br><span class="line"><span class="comment">// Object本身由new Function()创建出来：Object.__proto__ == Function.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foo1 = <span class="keyword">new</span> Foo()</span><br><span class="line"><span class="comment">// foo1.__proto__ == Foo.prototype;因为Foo.prototype是一个对象，所以Foo.prototype.__proto__ == Object.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj1 = <span class="keyword">new</span> <span class="built_in">Object</span>() <span class="comment">// obj1.__proto__ = Object.prototype;</span></span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20220222224244191.png" alt="image-20220222224244191"></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20211122221033194.png" alt="image-20211122221033194"></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20220223215011307.png" alt="image-20220223215011307"></p><h3 id="ES6"><a href="#ES6" class="headerlink" title="ES6+"></a>ES6+</h3><h4 id="ES6-1"><a href="#ES6-1" class="headerlink" title="ES6"></a>ES6</h4><h5 id="类"><a href="#类" class="headerlink" title="类"></a>类</h5><h6 id="使用-class-来定义类"><a href="#使用-class-来定义类" class="headerlink" title="使用 class 来定义类"></a>使用 class 来定义类</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="comment">//声明一个类</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Animal = <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">  <span class="comment">//类的表达式</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//类的特点</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> Person) <span class="comment">//function</span></span><br></pre></td></tr></table></figure><h6 id="类的构造函数"><a href="#类的构造函数" class="headerlink" title="类的构造函数"></a>类的构造函数</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//类的构造函数,一个类只能有一个构造函数</span></span><br><span class="line">    <span class="comment">//1.在内存中创建一个对象</span></span><br><span class="line">    <span class="comment">//2.将类的原型对象prototype赋值给创建出来的对象 moni.__proto__ = Person.prototype</span></span><br><span class="line">    <span class="comment">//3.将对象赋值给函数的this：new 绑定 this = moni</span></span><br><span class="line">    <span class="comment">//4.执行函数体中的代码</span></span><br><span class="line">    <span class="comment">//5.自动返回创建出来的对象</span></span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="built_in">this</span>.age = age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> Person(<span class="string">&#x27;ysj&#x27;</span>, <span class="number">18</span>)</span><br></pre></td></tr></table></figure><h6 id="类中定义方法"><a href="#类中定义方法" class="headerlink" title="类中定义方法"></a>类中定义方法</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="built_in">this</span>._address = <span class="string">&#x27;重庆市&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">eating</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//类中的普通的实例方法，通过创建出来的对象进行访问</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27; eating&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//类的访问器方法</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title">address</span>() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;拦截访问操作&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._address</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title">address</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;拦截设置操作&#x27;</span>)</span><br><span class="line">    <span class="built_in">this</span>._address = value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//类的静态方法(也称类方法)，通过类名去访问 Person.randomPerson()</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">randomPerson</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> age = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">&#x27;ysj&#x27;</span>, age) <span class="comment">//随机产生一个年龄然后返回</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="comment">//没写继承会默认继承自Object</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="built_in">this</span>.age = age</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">running</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&#x27; running&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">personMethods</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;父类处理逻辑&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">staticMethods</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;父类静态方法逻辑&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Student称之为子类或派生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age, sno</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//在子类的构造函数中使用this或者返回默认对象之前，必须先通过super调用父类的构造函数</span></span><br><span class="line">    <span class="comment">//super的使用位置有三个：子类的构造函数、实例方法、静态方法</span></span><br><span class="line">    <span class="built_in">super</span>(name, age) <span class="comment">//调用父类构造方法</span></span><br><span class="line">    <span class="built_in">this</span>.sno = sno</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">running</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//子类对父类方法进行重写</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;student &#x27;</span> + <span class="built_in">this</span>.name + <span class="string">&#x27; running&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">personMethods</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.personMethods() <span class="comment">//继续使用父类personMethods,对父类逻辑进行复用</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;子类处理逻辑&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">staticMethods</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//子类重写父类静态方法</span></span><br><span class="line">    <span class="built_in">super</span>.staticMethods()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;子类静态方法逻辑&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="继承内置类"><a href="#继承内置类" class="headerlink" title="继承内置类"></a>继承内置类</h6><p>继承内置类，在保留原有内置类方法/属性的基础上进行扩展</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SJArray</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">firstItem</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">lastItem</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>[<span class="built_in">this</span>.length - <span class="number">1</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = <span class="keyword">new</span> SJArray(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">console</span>.log(arr.firstItem())</span><br><span class="line"><span class="built_in">console</span>.log(arr.lastItem())</span><br></pre></td></tr></table></figure><h5 id="字面量增强"><a href="#字面量增强" class="headerlink" title="字面量增强"></a>字面量增强</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;ysj&#x27;</span></span><br><span class="line"><span class="keyword">const</span> age = <span class="number">18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  name, <span class="comment">//key、value名称相同时，可以简写(属性简写)</span></span><br><span class="line">  age,</span><br><span class="line">  <span class="function"><span class="title">bar</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//方法的简写</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;fda&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">baz</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//这种写法不是简写，绑定baz为箭头函数</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//计算属性名</span></span><br><span class="line">  [name + <span class="string">&#x27;hhh&#x27;</span>]: <span class="string">&#x27;呵呵呵&#x27;</span>, <span class="comment">//此处属性名为  ysjhhh</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj.ysjhhh) <span class="comment">//呵呵呵</span></span><br></pre></td></tr></table></figure><h5 id="解构"><a href="#解构" class="headerlink" title="解构"></a>解构</h5><p>数组的解构</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> [item1, item2, item3] = arr</span><br><span class="line"><span class="built_in">console</span>.log(item1) <span class="comment">//aaa</span></span><br><span class="line"><span class="built_in">console</span>.log(item2) <span class="comment">//bbb</span></span><br><span class="line"><span class="built_in">console</span>.log(item3) <span class="comment">//ccc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//解构后面的元素</span></span><br><span class="line"><span class="keyword">const</span> [, el1, el2] = arr <span class="comment">//解构后面两个元素</span></span><br><span class="line"><span class="built_in">console</span>.log(el1) <span class="comment">//bbb</span></span><br><span class="line"><span class="built_in">console</span>.log(el2) <span class="comment">//ccc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//解构出一个元素，后面的元素放到一个新数组中</span></span><br><span class="line"><span class="keyword">const</span> [itemA, ...newNames] = arr</span><br><span class="line"><span class="built_in">console</span>.log(itemA) <span class="comment">//aaa</span></span><br><span class="line"><span class="built_in">console</span>.log(newNames) <span class="comment">//[ &#x27;bbb&#x27;, &#x27;ccc&#x27; ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//解构的默认值</span></span><br><span class="line"><span class="keyword">const</span> [itema, itemb, itemc, itemd = <span class="string">&#x27;ddd&#x27;</span>] = arr</span><br><span class="line"><span class="built_in">console</span>.log(itemd) <span class="comment">//ddd</span></span><br></pre></td></tr></table></figure><p>对象的解构</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> &#123; age, name &#125; = obj <span class="comment">//对象解构是按key解构，与顺序无关</span></span><br><span class="line"><span class="built_in">console</span>.log(age, name) <span class="comment">//18 ysj</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 给解构出来的属性取别名</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">age</span>: newAge, <span class="attr">name</span>: newName &#125; = obj</span><br><span class="line"><span class="built_in">console</span>.log(newName, newAge) <span class="comment">//ysj 18</span></span><br><span class="line"><span class="comment">//解构时赋默认值</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">name</span>: name2 = <span class="string">&#x27;yyy&#x27;</span>, address = <span class="string">&#x27;默认地址&#x27;</span> &#125; = obj</span><br><span class="line"><span class="built_in">console</span>.log(name2, ddd) <span class="comment">// ysj 默认地址</span></span><br></pre></td></tr></table></figure><p>应用场景：</p><ul><li>参数的参数若为一个对象，可以直接在参数中解构</li><li>拿到一个变量时，解构后使用</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params">&#123; name, age &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//在参数中解构</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> &#123; name, age &#125; = <span class="keyword">await</span> getData() <span class="comment">//对结果解构</span></span><br></pre></td></tr></table></figure><h5 id="let-const"><a href="#let-const" class="headerlink" title="let/const"></a>let/const</h5><p>const:传递的值不能修改，但若传递的是一个引用类型，可以修改其属性</p><p>通过 let/const 定义的变量不可以重复定义</p><p>let/const 会在执行上下文创建阶段被创建出来,但不可访问，所以没有作用域提升</p><p><strong>块级作用域</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="comment">//声明对象字面量</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//块代码</span></span><br><span class="line">  <span class="keyword">let</span> foo = <span class="string">&#x27;ddd&#x27;</span> <span class="comment">//块级作用域duilet/const/function/class声明的类型有效</span></span><br><span class="line">  <span class="comment">//浏览器为了兼容以前的代码，让function没有块级作用域</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//es5中只有全局作用域和函数作用域</span></span><br><span class="line"><span class="comment">//es6增加了块级作用域</span></span><br><span class="line"><span class="comment">// if、switch、for都是块级作用域</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>, i &lt; arr.length; i++)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(arr[i])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">console</span>.log(arr[i])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//此时会把上面的i+1,得到一个结果</span></span><br><span class="line">	<span class="keyword">let</span> i = 结果; <span class="comment">//再把结果赋值给新定义的i，并不是沿用上面的i</span></span><br><span class="line">	<span class="built_in">console</span>.log(arr[i])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>暂时性死区</strong></p><p>在一个代码中，使用 let、const 声明的变量，在声明之前，变量都是不可以访问的</p><p>这种现象称之为暂时性死区 temporal dead zone(暂时性死区，TDZ)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="string">&#x27;dd&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(foo) <span class="comment">//在变量声明之前访问，报错</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> foo = <span class="string">&#x27;gvv&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>优先使用 const 定义变量，如果后面要修改变量，再考虑用 let</p><h5 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">`my name is <span class="subst">$&#123;name&#125;</span>, age is <span class="subst">$&#123;age * <span class="number">2</span>&#125;</span>, height is <span class="subst">$&#123;getHeight()&#125;</span>`</span>)</span><br></pre></td></tr></table></figure><p>标签模板字符串(Tagged Template Literals)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">m, n</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(m, n)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//普通调用函数方式</span></span><br><span class="line">foo(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//标签模板字符串调用函数(styled-components)</span></span><br><span class="line">foo<span class="string">``</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;ysj&#x27;</span></span><br><span class="line"><span class="keyword">const</span> age = <span class="number">18</span></span><br><span class="line">foo<span class="string">`Hello<span class="subst">$&#123;name&#125;</span>Wo<span class="subst">$&#123;age&#125;</span>rld`</span> <span class="comment">//[&#x27;Hello&#x27;, &#x27;Wo&#x27;, &#x27;rld&#x27;] ysj</span></span><br><span class="line"><span class="comment">//参数一：$&#123;&#125;将整个字符串切成三部分，将每部分都放进数组中(模板字符串的整个字符串，只是被切成多份，放进数组)</span></span><br><span class="line"><span class="comment">//参数二：使用模板字符串传入时，第一个$&#123;&#125;传入的变量的值</span></span><br><span class="line"><span class="comment">//参数三：使用模板字符串传入时，第二个$&#123;&#125;传入的变量的值</span></span><br><span class="line"><span class="comment">//参数四：以此类推</span></span><br></pre></td></tr></table></figure><h5 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h5><p><strong>函数的默认参数</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fuction <span class="function"><span class="title">foo</span>(<span class="params">name = <span class="string">&#x27;ysj&#x27;</span>, age =<span class="number">18</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">&#123;name, age&#125; = &#123;name:<span class="string">&#x27;ysj&#x27;</span>, age:<span class="number">18</span>&#125;</span>)</span>&#123; <span class="comment">//对象参数设置默认值并同时解构</span></span><br><span class="line">  <span class="built_in">console</span>.log(name, age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar2</span>(<span class="params">&#123;name = <span class="string">&quot;ysj&quot;</span>, age = <span class="number">18</span>&#125; = &#123;&#125;</span>)</span>&#123; <span class="comment">//对象参数设置默认值(空对象)并同时解构(解构时给属性设置默认值)</span></span><br><span class="line">  <span class="built_in">console</span>.log(name, age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//有默认值的形参最好放到最后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//有默认值的函数的参数不算在函数的length之内,并且默认参数之后的所有参数都不算在length之内</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tt</span>(<span class="params">a, b, c = <span class="number">3</span>, d, e</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(tt.length); <span class="comment">//2</span></span><br></pre></td></tr></table></figure><p><strong>函数的剩余参数</strong>(rest parameter)</p><p>如果最后一个参数是…为前缀的，那么它会将剩余的参数放到该参数中，并且作为一个数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, ...args</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//args必须放到最后</span></span><br><span class="line">  <span class="built_in">console</span>.log(args <span class="keyword">instanceof</span> <span class="built_in">Array</span>) <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>与 arguments 区别：</p><ul><li>剩余参数只包含没有对应形参的实参，arguemnts 对象包含了传给函数的所有实参</li><li>arguments 对象不是一个真正的数组,而 rest 参数是一个真正的数组，可以进行数组的所有操作</li></ul><p><strong>箭头函数</strong></p><ul><li>箭头函数没有显式原型，所以不能作为构造函数，使用 new 来创建对象</li><li>箭头函数没有 this,arguments</li></ul><h5 id="展开语法"><a href="#展开语法" class="headerlink" title="展开语法"></a>展开语法</h5><p>Spread syntax：</p><ul><li>可以在函数调用数组构造时，将数组表达式或者 string 在语法层面展开</li><li>可以在构造字面量对象时，将对象表达式按 key-value 的方式展开</li></ul><p>应用场景：</p><ul><li>在函数调用时使用</li><li>在数组构造时使用</li><li>在构建对象字面量时，也可以使用展开运算符，ES2018（ES9）中添加的新特性</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> names = [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;ysj&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x, y, z</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x, y, z)</span><br><span class="line">&#125;</span><br><span class="line">foo.apply(<span class="literal">null</span>, names) <span class="comment">//aaa bbb ccc</span></span><br><span class="line">foo(...names) <span class="comment">//aaa bbb ccc</span></span><br><span class="line">foo(...name) <span class="comment">//y s j</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newNames = [...names, ...name]</span><br><span class="line"><span class="built_in">console</span>.log(newNames) <span class="comment">//[&#x27;aaa&#x27;, &#x27;bbb&#x27;, &#x27;ccc&#x27;, &#x27;y&#x27;, &#x27;s&#x27;, &#x27;j&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> info = &#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;</span><br><span class="line"><span class="keyword">const</span> obj = &#123; ...info, <span class="attr">address</span>: <span class="string">&#x27;重庆市&#x27;</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj) <span class="comment">//&#123;name:&#x27;ysj&#x27;, age: 18, address: &#x27;重庆市&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//展开运算符进行的是一个浅拷贝</span></span><br></pre></td></tr></table></figure><h5 id="数值的表示"><a href="#数值的表示" class="headerlink" title="数值的表示"></a>数值的表示</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> num1 = <span class="number">100</span>; <span class="comment">//10进制</span></span><br><span class="line"><span class="keyword">const</span> num2 = 0b100l <span class="comment">//二进制 -&gt; binary</span></span><br><span class="line"><span class="keyword">const</span> num3 = <span class="number">0o100</span>; <span class="comment">//八进制 -&gt; octonary</span></span><br><span class="line"><span class="keyword">const</span> num4 = ox100; <span class="comment">//十六进制 -&gt; hexdecimal</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//大的数值可以使用连接符(ES2021 ES12)</span></span><br><span class="line"><span class="keyword">const</span> num = <span class="number">10_000_000_000</span></span><br></pre></td></tr></table></figure><h5 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h5><p>ES6 中新增的一个基本数据类型,翻译为符号</p><ul><li>在 ES6 之前，对象的属性名都是字符串形式，很容易造成属性名的冲突</li><li>Symbol 就是用来解决这个问题，用来生成一个独一无二的值</li><li>Symbol 是通过 Symbol 函数来生成的，生成后可以作为属性名</li><li>ES6 中，对象的属性名可以使用字符串或 Symbol 值</li><li>Symbol 值即使多次创建，他们也是不同的，每次都是独一无二的值</li><li>创建 Symbol 时也可以传入一个描述 description(ES2019 ES10 新特性)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s1 = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="built_in">Symbol</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s3 = <span class="built_in">Symbol</span>(<span class="string">&#x27;aaa&#x27;</span>) <span class="comment">//创建时传入描述</span></span><br><span class="line"><span class="built_in">console</span>.log(s3.description) <span class="comment">//aaa</span></span><br><span class="line"><span class="keyword">const</span> s4 = <span class="built_in">Symbol</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="comment">//定义对象字面量时使用</span></span><br><span class="line">  [s1]: <span class="string">&#x27;abc&#x27;</span>,</span><br><span class="line">  [s2]: <span class="string">&#x27;cba&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj[s3] = <span class="string">&#x27;bac&#x27;</span> <span class="comment">//新增属性时使用</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, s4, &#123;</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;cab&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj[s1]) <span class="comment">//获取</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用Symbol作为key的属性名,在遍历/Object.keys等中获取不到这些Symbol值</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertySymbols(obj)) <span class="comment">//只能通过这种方式获取</span></span><br><span class="line"><span class="comment">// [ Symbol(), Symbol(), Symbol(aaa), Symbol() ]</span></span><br><span class="line"><span class="comment">//遍历</span></span><br><span class="line"><span class="keyword">const</span> sKeys = <span class="built_in">Object</span>.getOwnPropertySymbols(obj)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> sKeys) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(obj[key])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一样的Symbol值 Symbol.for(描述)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s5 = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;ysj&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> s6 = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;ysj&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(s5 === s6) <span class="comment">//true</span></span><br><span class="line"><span class="comment">//获取key</span></span><br><span class="line"><span class="keyword">const</span> key = <span class="built_in">Symbol</span>.keyFor(s5)</span><br><span class="line"><span class="built_in">console</span>.log(key) <span class="comment">//ysj</span></span><br></pre></td></tr></table></figure><h5 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h5><p>ES6 中新增了另外两种数据解构：Set、Map，以及它们的另外形式：WeakSet、WeakMap</p><p>Set 类似于数组，但是和数组的区别是元素不能重复</p><ul><li>创建 Set 时需要通过 Set 构造函数(暂时没有字面量创建方式)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">set.add(<span class="number">10</span>) <span class="comment">//向set中添加元素</span></span><br><span class="line">set.add(<span class="number">20</span>)</span><br><span class="line">set.add(<span class="number">30</span>)</span><br><span class="line">set.add(<span class="number">40</span>)</span><br><span class="line"><span class="built_in">console</span>.log(set)</span><br><span class="line"><span class="comment">//向 set中添加对象时，只要对象内存地址不一致，就可以添加成功</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//给数组去重</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">66</span>, <span class="number">11</span>]</span><br><span class="line"><span class="keyword">const</span> arrSet = <span class="keyword">new</span> <span class="built_in">Set</span>(arr) <span class="comment">//创建时可以传入可迭代对象</span></span><br><span class="line"><span class="built_in">console</span>.log(arrSet) <span class="comment">// Set(6) &#123; 11, 22, 33, 44, 55, 66 &#125;</span></span><br><span class="line"><span class="keyword">const</span> newArr = <span class="built_in">Array</span>.from(arrSet) <span class="comment">//将set转为数组结构</span></span><br><span class="line"><span class="keyword">const</span> newArr2 = [...arrSet] <span class="comment">//将set使用展开运算符放进数组中</span></span><br><span class="line"><span class="built_in">console</span>.log(newArr, newArr2) <span class="comment">//[ 11, 22, 33, 44, 55, 66 ] [ 11, 22, 33, 44, 55, 66 ]</span></span><br></pre></td></tr></table></figure><p>Set 常见属性和方法：</p><ul><li>size,返回 set 中元素个数，set.size</li><li>add，向 set 中添加元素，set.add(el)</li><li>delete，删除 set 中的元素，set.delete(el)</li><li>has，判断 set 中有没有包含某个元素，set.has(el)</li><li>clear,清空 set，set.clear()</li></ul><p>对 set 遍历</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>])</span><br><span class="line">set.forEach(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(el)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> el <span class="keyword">of</span> set) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(el)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h5><p>和 Set 类似的另外一个数据结构，也是内部元素不能重复的数据结构</p><p>和 Set 区别：</p><ul><li>WeakSet 中只能存放对象类型，不能存放基本数据类型</li><li>WeakSet 对元素的引用是弱引用，如果没有其它引用对某个对象进行引用，那么 GC 会对该对象进行回收</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> weakSet = <span class="keyword">new</span> <span class="built_in">WeakSet</span>()</span><br><span class="line">weakSet.add(&#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;) <span class="comment">//建立的是弱引用</span></span><br></pre></td></tr></table></figure><p>WeakSet 常见方法：</p><ul><li>add(el)，添加某个元素，返回 WeakSet 对象本身</li><li>delete(el)，从 WeakSet 中删除和这个值相等的元素，返回 boolean 类型</li><li>has(value)，判断 WeakSet 中是否存在某个元素，返回 boolea 类型</li></ul><p>注意：WeakSet 不能进行遍历</p><ul><li>因为 WeakSet 只是对象的弱引用，如果我们遍历获取其中元素，那么有可能造成对象不能正常地销毁</li><li>所以存储到 WeakSet 中的对象是没办法获取的</li></ul><h5 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h5><p>用于存储映射关系(键值对)</p><p>与对象存储映射关系的区别：</p><ul><li>对象存储映射关系只能用字符串或 Symbol；</li><li>Map 可以将其它类型作为 key</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">map.set(obj1, <span class="string">&#x27;aaa&#x27;</span>) <span class="comment">//使用对象作为key</span></span><br><span class="line">map.set(obj2, <span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">map.set(<span class="number">1</span>, <span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map2 = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [key, value],</span><br><span class="line">  [key, value],</span><br><span class="line">  [key, value],</span><br><span class="line">]) <span class="comment">//Map传入数组需要以此种格式</span></span><br></pre></td></tr></table></figure><p>常见的属性和方法：</p><ul><li>map.size，查看 map 有几个元素</li><li>map.set(key, value)，向 map 中添加元素</li><li>map.get(key)，获取 key 对应的值</li><li>map.has(key)，判断某个 key 是否存在</li><li>map.delete(key)，删除某个元素，成功返回 true</li><li>map.clear()，清空元素</li></ul><p>遍历 map</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [key, value],</span><br><span class="line">  [key, value],</span><br><span class="line">  [key, value],</span><br><span class="line">])</span><br><span class="line">map.forEach(<span class="function">(<span class="params">value, key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value, key)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> el <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(el) <span class="comment">//打印出来的每一项都是一个数组，数组第一个元素放key，第二个元素放value</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="comment">//遍历的同时解构</span></span><br><span class="line">  <span class="built_in">console</span>.log(key, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h5><p>与 Map 类型相似的数据结构，也是以键值对的形式存在</p><p>和 Map 的区别：</p><ul><li>WeakMap 的 key 只能使用对象，不接受其它类型作为 key</li><li>WeakMap 的 key 对对象的引用是弱引用，如果没有其它引用引用这个对象，那么 GC 可以回收这个对象</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;obj&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">const</span> weakMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span><br><span class="line">weakMap.set(obj, <span class="string">&#x27;sss&#x27;</span>)</span><br></pre></td></tr></table></figure><p>常见方法：</p><ul><li>weakmap.set(key, value),向 weakmap 中添加元素</li><li>weakmap.get(key)，获取 key 对应的值</li><li>weakmap.has(key)，判断某个 key 是否存在</li><li>weakmap.delete(key)，删除某个元素</li></ul><p>应用场景：vue3 响应式原理</p><h4 id="ES7"><a href="#ES7" class="headerlink" title="ES7"></a>ES7</h4><h5 id="Array-Includes"><a href="#Array-Includes" class="headerlink" title="Array Includes"></a>Array Includes</h5><p>判断数组中是否包含某个元素</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> names = [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>]</span><br><span class="line"><span class="built_in">console</span>.log(names.includes(<span class="string">&#x27;aaa&#x27;</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="comment">//includes可以判断数组中是否包含NaN，indexOf()则没法判断</span></span><br></pre></td></tr></table></figure><h5 id="指数运算符"><a href="#指数运算符" class="headerlink" title="指数运算符"></a>指数运算符</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">3</span>) <span class="comment">//获取2的3次方</span></span><br><span class="line"><span class="comment">//现在获取2的3次方</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span> ** <span class="number">3</span>)</span><br></pre></td></tr></table></figure><h4 id="ES8"><a href="#ES8" class="headerlink" title="ES8"></a>ES8</h4><h5 id="Object-values"><a href="#Object-values" class="headerlink" title="Object.values"></a>Object.values</h5><p>之前可以通过 Object.keys 获取一个对象所有的 key，在 ES8 中提供了 Object.values 来获取所有的 value 值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj)) <span class="comment">//[&#x27;name&#x27;, &#x27;age&#x27;]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.values(obj)) <span class="comment">// [&#x27;ysj&#x27;, 18]</span></span><br></pre></td></tr></table></figure><h5 id="Object-entries"><a href="#Object-entries" class="headerlink" title="Object.entries"></a>Object.entries</h5><p>通过 Object.entries 可以获取到一个数组，数组中会存放可枚举属性的键值对数组</p><p>将键值对格式的数据转化为 entries 格式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.entries(obj)) <span class="comment">//[ [ &#x27;name&#x27;, &#x27;ysj&#x27; ], [ &#x27;age&#x27;, 18 ] ]</span></span><br></pre></td></tr></table></figure><h5 id="String-Padding"><a href="#String-Padding" class="headerlink" title="String Padding"></a>String Padding</h5><p>某些字符串需要进行前后的填充，来实现某种格式化的效果，ES8 中增加 padStart 和 padEnd 方法，分别对字符的首尾进行填充</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line"><span class="keyword">const</span> newStr = str.padStart(<span class="number">14</span>, <span class="string">&#x27;8&#x27;</span>).padEnd(<span class="number">18</span>, <span class="string">&#x27;=&#x27;</span>) <span class="comment">//参数一：填充完后字符串的最长长度，参数二：填充进去的字符</span></span><br><span class="line"><span class="built_in">console</span>.log(newStr) <span class="comment">//888Hello World====</span></span><br></pre></td></tr></table></figure><h5 id="Object-Descripts"><a href="#Object-Descripts" class="headerlink" title="Object Descripts"></a>Object Descripts</h5><p>Object.getOwnPropertyDescriptors,获取对象描述符</p><p>Async Function: async await</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> sleep(<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Object-assign-ES6"><a href="#Object-assign-ES6" class="headerlink" title="Object.assign(ES6)"></a>Object.assign(ES6)</h5><p>Object.assign(target, …source)</p><ul><li>将所有可枚举属性的值从一个或多个源对象分配到目标对象,并返回目标对象</li><li>目标对象中的属性具有相同的键，则属性将被源对象中的属性覆盖。后面的源对象的属性将类似地覆盖前面的源对象的属性</li><li><code>Object.assign()</code>拷贝的是（可枚举）属性值，假如源值是一个对象的引用，它仅仅会复制其引用值。(只能拷贝第一层)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//赋值一个对象(浅拷贝)</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">const</span> copy = <span class="built_in">Object</span>.assign(&#123;&#125;, obj)</span><br><span class="line"><span class="built_in">console</span>.log(copy) <span class="comment">// &#123; a: 1 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//合并对象</span></span><br><span class="line"><span class="keyword">const</span> o1 = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">const</span> o2 = &#123; <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">2</span> &#125;</span><br><span class="line"><span class="keyword">const</span> o3 = &#123; <span class="attr">c</span>: <span class="number">3</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="built_in">Object</span>.assign(o1, o2, o3)</span><br><span class="line"><span class="built_in">console</span>.log(obj) <span class="comment">// &#123; a: 1, b: 2, c: 3 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(o1) <span class="comment">// &#123; a: 1, b: 2, c: 3 &#125;, 注意目标对象自身也会改变。</span></span><br><span class="line"><span class="comment">//继承属性和不可枚举属性无法拷贝</span></span><br></pre></td></tr></table></figure><h4 id="ES9"><a href="#ES9" class="headerlink" title="ES9"></a>ES9</h4><p>Async iterators：迭代</p><p>Object Spread operators:对象展开运算符</p><p>Promise finally:Promise 的一个方法</p><p>for await of:</p><p>异步迭代器(for-await-of)：循环等待每个 Promise 对象变为 resolved 状态才进入下一步</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;异步操作&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ES10"><a href="#ES10" class="headerlink" title="ES10"></a>ES10</h4><h5 id="flat-flatMap"><a href="#flat-flatMap" class="headerlink" title="flat flatMap"></a>flat flatMap</h5><p>flat 方法会按照一个可指定的深度递归遍历数组，并将所有元素与遍历到的子数组中的元素合并为一个新数组返回</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [</span><br><span class="line">  <span class="number">10</span>,</span><br><span class="line">  <span class="number">20</span>,</span><br><span class="line">  [<span class="number">2</span>, <span class="number">9</span>],</span><br><span class="line">  [</span><br><span class="line">    [<span class="number">30</span>, <span class="number">20</span>],</span><br><span class="line">    [<span class="number">423</span>, <span class="number">543</span>],</span><br><span class="line">  ],</span><br><span class="line">  <span class="number">34</span>,</span><br><span class="line">  [<span class="number">34</span>, <span class="number">878</span>],</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> newNum = nums.flat() <span class="comment">//flat参数：降维深度，默认为1</span></span><br><span class="line"><span class="built_in">console</span>.log(newNum) <span class="comment">//[ 10, 20, 2, 9, [ 30, 20 ], [ 423, 543 ], 34, 34, 878 ]</span></span><br></pre></td></tr></table></figure><p>flatMap:flatMap 方法首先使用映射函数映射每个元素，然后将结果压缩成一个新数组</p><ul><li>flatMap 是先进行 map 操作，再做 flat 的操作</li><li>flatMap 中的 falt 相当于深度为 1</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flatMap</span></span><br><span class="line"><span class="keyword">const</span> nums2 = [<span class="number">12</span>, <span class="number">23</span>, <span class="number">434</span>, <span class="number">43</span>]</span><br><span class="line"><span class="keyword">const</span> newNums2 = nums2.flatMap(<span class="function">(<span class="params">item</span>) =&gt;</span> item * <span class="number">2</span>) <span class="comment">//参数一：回调函数   参数2：绑定的this</span></span><br><span class="line"><span class="built_in">console</span>.log(newNums2) <span class="comment">//[ 24, 46, 868, 86 ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//应用场景</span></span><br><span class="line"><span class="keyword">const</span> message = [<span class="string">&#x27;Hello World&#x27;</span>, <span class="string">&#x27;Hello ysj&#x27;</span>, <span class="string">&#x27;my name is ysj&#x27;</span>]</span><br><span class="line"><span class="comment">//要求：将每一个元素按照空格分隔，再将分割后的所有元素放进一个数组</span></span><br><span class="line"><span class="keyword">const</span> words = message.flatMap(<span class="function">(<span class="params">el</span>) =&gt;</span> el.split(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line"><span class="built_in">console</span>.log(words) <span class="comment">//[&#x27;Hello&#x27;, &#x27;World&#x27;, &#x27;Hello&#x27;, &#x27;ysj&#x27;, &#x27;my&#x27;, &#x27;name&#x27;, &#x27;is&#x27;, &#x27;ysj&#x27;]</span></span><br></pre></td></tr></table></figure><h5 id="Object-fromEntries"><a href="#Object-fromEntries" class="headerlink" title="Object.fromEntries"></a>Object.fromEntries</h5><p>将 entries 格式的数据转为对象键值对格式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">1.8</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> entries = <span class="built_in">Object</span>.entries(obj)</span><br><span class="line"><span class="built_in">console</span>.log(entries) <span class="comment">//[ [ &#x27;name&#x27;, &#x27;ysj&#x27; ], [ &#x27;age&#x27;, 18 ], [ &#x27;height&#x27;, 1.8 ] ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newObj = <span class="built_in">Object</span>.fromEntries(entries)</span><br><span class="line"><span class="built_in">console</span>.log(newObj) <span class="comment">//形式与obj一样 &#123; name: &#x27;ysj&#x27;, age: 18, height: 1.8 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//应用场景</span></span><br><span class="line"><span class="keyword">const</span> queryString = <span class="string">&#x27;name=ysj&amp;age=18&amp;height=1.80&#x27;</span></span><br><span class="line"><span class="keyword">const</span> queryParams = <span class="keyword">new</span> URLSearchParams(queryString)</span><br><span class="line"><span class="built_in">console</span>.log(queryParams) <span class="comment">//URLSearchParams &#123; &#x27;name&#x27; =&gt; &#x27;ysj&#x27;, &#x27;age&#x27; =&gt; &#x27;18&#x27;, &#x27;height&#x27; =&gt; &#x27;1.80&#x27; &#125;</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> param <span class="keyword">of</span> queryParams) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(param) <span class="comment">//每个元素都是一个数组</span></span><br><span class="line">  <span class="comment">//[ &#x27;name&#x27;, &#x27;ysj&#x27; ]</span></span><br><span class="line">  <span class="comment">//[ &#x27;age&#x27;, &#x27;18&#x27; ]</span></span><br><span class="line">  <span class="comment">//[ &#x27;height&#x27;, &#x27;1.80&#x27; ]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> paramObj = <span class="built_in">Object</span>.fromEntries(queryParams) <span class="comment">//传入可迭代对象queryParams</span></span><br><span class="line"><span class="built_in">console</span>.log(paramObj) <span class="comment">//&#123; name: &#x27;ysj&#x27;, age: &#x27;18&#x27;, height: &#x27;1.80&#x27; &#125;</span></span><br></pre></td></tr></table></figure><h5 id="trimStart、trimEnd"><a href="#trimStart、trimEnd" class="headerlink" title="trimStart、trimEnd"></a>trimStart、trimEnd</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> message = <span class="string">&#x27;    Hello  World   &#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(message.trimStart()) <span class="comment">//去除开头的空格 trimLeft()是此方法的别名</span></span><br><span class="line"><span class="built_in">console</span>.log(message.trimEnd()) <span class="comment">//去除尾部的空格  trimRight 是 trimEnd 的别名</span></span><br></pre></td></tr></table></figure><h5 id="其它知识点"><a href="#其它知识点" class="headerlink" title="其它知识点"></a>其它知识点</h5><p>Symbol description:获取创建 Symbol 时传入的名字</p><p>Optional catch binding:见后面 try catch</p><h4 id="ES11"><a href="#ES11" class="headerlink" title="ES11"></a>ES11</h4><h5 id="BigInt"><a href="#BigInt" class="headerlink" title="BigInt"></a>BigInt</h5><p>ES11 之前，最大能正确表示的整数为 <em>Number</em>.MAX_SAFE_INTEGER</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> maxInt = <span class="built_in">Number</span>.MAX_SAFE_INTEGER</span><br><span class="line"><span class="built_in">console</span>.log(maxInt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bigInt = <span class="number">9007199254740991999n</span> <span class="comment">//在超出max_safe_integer的数字后面加n</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(bigInt + <span class="number">10</span>) <span class="comment">//bigInt和number不能直接相加，会报错</span></span><br><span class="line"><span class="built_in">console</span>.log(bigInt + <span class="number">10n</span>) <span class="comment">//转换之后再相加</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> num = <span class="number">100</span></span><br><span class="line"><span class="built_in">console</span>.log(bigInt + <span class="built_in">BigInt</span>(num)) <span class="comment">//转换</span></span><br></pre></td></tr></table></figure><h5 id="空值合并运算"><a href="#空值合并运算" class="headerlink" title="空值合并运算 ??"></a>空值合并运算 ??</h5><p>Nullish Coalscing Operator</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">const</span> bar = foo || <span class="string">&#x27;默认值&#x27;</span> <span class="comment">//当foo是一个空的字符串或者0就无法正确的拿到foo的值了</span></span><br><span class="line"><span class="keyword">const</span> bar = foo ?? <span class="string">&#x27;&#x27;</span> <span class="comment">//只有当foo为null或者undefined的时候才会使用后面的值</span></span><br></pre></td></tr></table></figure><h5 id="可选链"><a href="#可选链" class="headerlink" title="可选链 ?."></a>可选链 ?.</h5><p>Optional Chaining</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> info = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">friends</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;lilei&#x27;</span>,</span><br><span class="line">    <span class="attr">girlFriend</span>:&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>hmm<span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(info.friends.girlFriend.name); <span class="comment">//当friends字段不存在时，取值就会报错</span></span><br><span class="line"><span class="built_in">console</span>.log(info.friends?.girlFriend.name); <span class="comment">//当friends为空时，后面代码不再执行，直接返回undefined</span></span><br></pre></td></tr></table></figure><h5 id="Global-This"><a href="#Global-This" class="headerlink" title="Global This"></a>Global This</h5><p>之前如果希望获取 JS 环境的全局对象，不同环境获取方式不一样</p><ul><li>浏览器需要通过 this、window 获取</li><li>node 里面需要通过 global 来获取</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(globalThis) <span class="comment">//不同环境指向的都是全局对象</span></span><br></pre></td></tr></table></figure><h5 id="for-in-标准化"><a href="#for-in-标准化" class="headerlink" title="for in 标准化"></a>for in 标准化</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="comment">//ES11以后，遍历对象，所有的浏览器的item都是对象的key</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="matchAll"><a href="#matchAll" class="headerlink" title="matchAll"></a>matchAll</h5><p><strong><code>matchAll()</code></strong> 方法返回一个包含所有匹配正则表达式的结果及分组捕获组的迭代器。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> regexp = <span class="regexp">/t(e)(st(\d?))/g</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;test1test2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> array = [...str.matchAll(regexp)]</span><br><span class="line"><span class="built_in">console</span>.log(array[<span class="number">0</span>]) <span class="comment">// [&quot;test1&quot;, &quot;e&quot;, &quot;st1&quot;, &quot;1&quot;]</span></span><br><span class="line"><span class="built_in">console</span>.log(array[<span class="number">1</span>]) <span class="comment">// [&quot;test2&quot;, &quot;e&quot;, &quot;st2&quot;, &quot;2&quot;]</span></span><br></pre></td></tr></table></figure><h5 id="其它知识点-1"><a href="#其它知识点-1" class="headerlink" title="其它知识点"></a>其它知识点</h5><p>Dynamic Import:动态导入</p><p>Promise.allSettled:Promise 的一个方法</p><p>import meta：</p><h4 id="ES12"><a href="#ES12" class="headerlink" title="ES12"></a>ES12</h4><h5 id="FinalizationRegistry"><a href="#FinalizationRegistry" class="headerlink" title="FinalizationRegistry"></a>FinalizationRegistry</h5><p>用于检测某一个对象有没有被回收</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> finalRegister = <span class="keyword">new</span> FinalizationRegistry(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//对象被销毁时会调用此回调函数，value为对象注册时绑定的值</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`注册在finalRegister的对象，<span class="subst">$&#123;value&#125;</span>被销毁了`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;</span><br><span class="line"><span class="keyword">let</span> info = &#123; <span class="attr">address</span>: <span class="string">&#x27;重庆市&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">finalRegister.register(obj, <span class="string">&#x27;obj&#x27;</span>) <span class="comment">//注册时可以绑定一个值，用于精确监听此对象被销毁的时候</span></span><br><span class="line">finalRegister.register(info, <span class="string">&#x27;info&#x27;</span>)</span><br><span class="line"></span><br><span class="line">obj = <span class="literal">null</span></span><br><span class="line">info = <span class="literal">null</span></span><br></pre></td></tr></table></figure><h5 id="WeakRef"><a href="#WeakRef" class="headerlink" title="WeakRef"></a>WeakRef</h5><p>获取对一个对象的弱引用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> finalRegister = <span class="keyword">new</span> FinalizationRegistry(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`注册在finalRegister的对象，<span class="subst">$&#123;value&#125;</span>被销毁了`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;</span><br><span class="line"><span class="keyword">let</span> info = <span class="keyword">new</span> WeakRef(obj) <span class="comment">//使info对obj的引用变为弱引用，使垃圾回收时忽略info对obj的引用</span></span><br><span class="line"></span><br><span class="line">finalRegister.register(obj, <span class="string">&#x27;obj&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(info.deref().name) <span class="comment">//弱引用拿原来的对象不能直接拿，需要通过deref来拿(原对象没有销毁才能拿到)</span></span><br><span class="line"><span class="built_in">console</span>.log(info.deref()?.name) <span class="comment">//使用可选链来拿,不会报错</span></span><br><span class="line"></span><br><span class="line">obj = <span class="literal">null</span></span><br></pre></td></tr></table></figure><p>逻辑赋值运算</p><p>logical assignment operators</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ||= 逻辑或赋值运算</span></span><br><span class="line"><span class="keyword">let</span> message = <span class="string">&#x27;&#x27;</span></span><br><span class="line">message ||= <span class="string">&#x27;默认值&#x27;</span> <span class="comment">// 等价于 message = message || &quot;默认值&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(message)</span><br><span class="line"><span class="comment">// &amp;&amp;= 逻辑与赋值运算</span></span><br><span class="line"><span class="comment">// &amp;&amp;</span></span><br><span class="line"><span class="keyword">let</span> info = &#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">info = info &amp;&amp; info.name <span class="comment">//判断info是否有值，有就取出name属性赋值给info</span></span><br><span class="line"><span class="built_in">console</span>.log(info)</span><br><span class="line">info &amp;&amp;= info.name <span class="comment">//等价于上面的写法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ??= 逻辑空赋值运算</span></span><br><span class="line"><span class="keyword">let</span> message2 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">message2 ??= <span class="string">&#x27;默认值&#x27;</span> <span class="comment">// 等价于 message2 = message2 ?? &quot;默认值&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(message2)</span><br></pre></td></tr></table></figure><h5 id="其它知识点-2"><a href="#其它知识点-2" class="headerlink" title="其它知识点"></a>其它知识点</h5><p>Numeric Separtor:数字非常大时，可以使用下划线分割 312_432_435_554</p><p>String.replaceAll:字符串替换</p><p><code>replaceAll()</code> 方法返回一个新字符串，新字符串中所有满足 <code>pattern</code> 的部分都会被<code>replacement</code> 替换。<code>pattern</code>可以是一个字符串或一个<code>RegExp</code>，<code>replacement</code>可以是一个字符串或一个在每次匹配被调用的函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;aabbcc&#x27;</span>.replaceAll(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;.&#x27;</span>) <span class="comment">// &#x27;aa..cc&#x27;</span></span><br><span class="line"><span class="comment">//使用正则表达式搜索值时，它必须是全局的。</span></span><br><span class="line"><span class="string">&#x27;aabbcc&#x27;</span>.replaceAll(<span class="regexp">/b/g</span>, <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">;(<span class="string">&#x27;aa..cc&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Proxy-Reflect"><a href="#Proxy-Reflect" class="headerlink" title="Proxy-Reflect"></a>Proxy-Reflect</h3><p>希望监听对象的属性被设置或获取的过程，可以使用 Object.defineProperty</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(obj).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> value = obj[key]</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    <span class="comment">//为obj对象所有的key设置监听</span></span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;key&#125;</span>属性被访问`</span>)</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">      value = val</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;key&#125;</span>属性被设置为`</span>, val)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.name)</span><br><span class="line">obj.name = <span class="string">&#x27;ysj2&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.name)</span><br></pre></td></tr></table></figure><p>缺点：</p><ul><li>Object.defindeProperty 设计的初衷(直接在一个对象上定义新的属性或修改现有属性，并返回该对象)，并不是为了监听一个对象中的所有属性</li><li>没法监听新增属性，删除属性</li><li>在遇到一个对象的属性还是一个对象的情况下，需要递归监听。对于数组通过 push、unshift 方法增加的元素，也无法监听</li><li>使用时会将原来对象的属性描述符改掉(数据改为访问属性描述符)</li></ul><p>ES6 新增一个类 Proxy，就是专门用来监听属性的各种各样的操作的：</p><ul><li>如果希望监听一个对象的相关操作，可以先创建一个代理对象(Proxy 对象)</li><li>之后对该对象的所有操作，都通过代理对象来完成</li><li>Proxy 对 Object.defineProperty 做了增强，最主要是对原来的对象创建代理，后续对对象的所有操作全部放到代理对象上</li></ul><h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="comment">//参数一：要进行代理的对象；参数二：捕获器</span></span><br><span class="line">  <span class="comment">//获取值时的捕获器(Trap)</span></span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//target:代理时所代理的对象 key:被代理对象的属性 receiver:调用的Proxy代理对象</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;target&#125;</span>的<span class="subst">$&#123;key&#125;</span>属性被访问了`</span>)</span><br><span class="line">    <span class="keyword">return</span> target[key]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//设置值时的捕获器</span></span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">target, key, newValue, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// newValue:设置的新的值</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;target&#125;</span>对象的<span class="subst">$&#123;key&#125;</span>属性的值被设置为<span class="subst">$&#123;newValue&#125;</span>`</span>)</span><br><span class="line">    target[key] = newValue</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(objProxy.name)</span><br><span class="line">objProxy.name = <span class="string">&#x27;ysj2&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(objProxy.name)</span><br><span class="line"><span class="built_in">console</span>.log(objProxy.age)</span><br></pre></td></tr></table></figure><h4 id="Proxy-其它捕获器"><a href="#Proxy-其它捕获器" class="headerlink" title="Proxy 其它捕获器"></a>Proxy 其它捕获器</h4><ol><li>handler.getProtitypeOf()<ul><li>Object.getPrototypeof 方法的捕捉器(获取对象原型的捕捉器)</li></ul></li><li>handler.setPrototypeOf()<ul><li>Object.setPrototypeOf 方法的捕捉器(设置对象原型)</li></ul></li><li>handler.isExtensible()<ul><li>Object.isExtensible 方法的捕捉器(判断某一个对象能不能进行扩展)</li></ul></li><li>handler.preventExtensions()<ul><li>Object.preventExtensions 方法的捕捉器(阻止某一个对象进行扩展)</li></ul></li><li>handler.getOwnPropertyDescriptor()<ul><li>Object.getOwnPropertyDescriptor 方法的捕捉器(获取某一个对象的属性描述符)</li></ul></li><li>handler.defineProperty()<ul><li>Object.defineProperty 方法的捕捉器(给一个对象定义属性描述符)</li></ul></li><li>handler.ownKeys()<ul><li>Object.getOwnPropertyNames 方法和 Object.getOwnPropertySymbols 方法的捕捉器</li></ul></li><li><strong>handler.has()</strong><ul><li>in 操作符捕捉器</li></ul></li><li><strong>handler.get()</strong><ul><li>属性读取操作的捕捉器</li></ul></li><li><strong>handler.set()</strong><ul><li>属性设置操作捕捉器</li></ul></li><li><strong>handler.deleteProperty()</strong><ul><li>delete 操作符的捕捉器</li></ul></li><li>handler.apply()<ul><li>函数调用操作的捕捉器(用于函数对象通过 apply 方式调用时监听)</li></ul></li><li>handler.construct()<ul><li>new 操作符的捕捉器(用于函数对象)</li></ul></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="comment">//监听in的捕获器</span></span><br><span class="line">  <span class="function"><span class="title">has</span>(<span class="params">target, key</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`监听到<span class="subst">$&#123;target&#125;</span>对象的in操作`</span>)</span><br><span class="line">    <span class="keyword">return</span> key <span class="keyword">in</span> target</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//监听delete的捕获器</span></span><br><span class="line">  <span class="function"><span class="title">deleteProperty</span>(<span class="params">target, key</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`监听到<span class="subst">$&#123;target&#125;</span>对象的<span class="subst">$&#123;key&#125;</span>属性被删除了`</span>)</span><br><span class="line">    <span class="keyword">delete</span> target[key]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//in 操作符</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> objProxy) <span class="comment">//name属性是否在objProxy对象里面</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//delete操作</span></span><br><span class="line"><span class="keyword">delete</span> objProxy.name</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fooProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(foo, &#123;</span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">target, thisArg, argArray</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//target:函数对象 thisArg:函数通过apply绑定的this  argArray:函数的额外参数</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;对foo函数进行了apply调用&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> target.apply(thisArg, argArray)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">construct</span>(<span class="params">target, argArray, newTarget</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//newTarget:与target一样，是同一个，一般不用</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;函数foo被通过new进行了调用&#x27;</span>, newTarget)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> target(...argArray)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fooProxy.apply(&#123;&#125;, [<span class="string">&#x27;das&#x27;</span>, <span class="string">&#x27;das&#x27;</span>])</span><br><span class="line"><span class="keyword">new</span> fooProxy(<span class="string">&#x27;dsad&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="Reflect-的作用"><a href="#Reflect-的作用" class="headerlink" title="Reflect 的作用"></a>Reflect 的作用</h4><p>ES6 新增的 API，是一个对象，主要提供了很多操作 JS 对象的方法，类似 Object 中操作对象的方法</p><p>Object 可以做这些操作，还新增 Reflect 对象的原因：</p><ul><li>早期的 ECMA 规范中没有考虑到对对象本身的操作如何设计会更加规范，所以将这些 API 放到了 Object 上面</li><li>但是 Object 作为一个构造函数，这些操作实际上放他身上并不合适</li><li>所以 ES6 中新增了 Reflect，让这些操作都集中到了 Reflect 身上</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvUmVmbGVjdC9Db21wYXJpbmdfUmVmbGVjdF9hbmRfT2JqZWN0X21ldGhvZHM=">比较 Reflect 和 Object 方法 MDN<i class="fa fa-external-link-alt"></i></span></p><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvUmVmbGVjdA==">Reflect<i class="fa fa-external-link-alt"></i></span>并非一个构造函数，所以不能通过<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvT3BlcmF0b3JzL25ldw==">new 运算符<i class="fa fa-external-link-alt"></i></span>对其进行调用，或者将<code>Reflect</code>对象作为一个函数来调用。<code>Reflect</code>的所有属性和方法都是静态的</p><p>Reflect 常见方法</p><p>Reflect 常见方法和 Proxy 是一一对应的，也是 13 个：</p><ol><li>Reflect.getPrototypeOf(target)<ul><li>类似于 Object.getPrototypeOf()</li></ul></li><li>Reflect.setPrototypeOf(target, prototype)<ul><li>设置对象原型的函数,返回一个 Boolean,如果更新成功,则返回 true</li></ul></li><li>Reflect.isExtensible(target)<ul><li>类似于 Object.isExtensible()</li></ul></li><li>Reflect.preventExtensions(target)<ul><li>类似于 Object.preventExtensions()。返回一个 Boolean</li></ul></li><li>Reflect.getOwnPropertyDescriptor(target, propertyKey)<ul><li>类似于 Object.getOwnPropertyDescriptor()。如果对象中存在该属性,则返回对应的属性描述符,否则返回 undefined</li></ul></li><li>Reflect.defineProperty(target, propertyKey, attributes)<ul><li>和 Object.defineProperty() 类似。如果设置成功就会返回 true</li></ul></li><li><code>Reflect.ownKeys(target)</code><ul><li>返回一个包含所有自身属性（不包含继承属性）的数组(类似于 Object.keys(), 但不会受 enumerable 影响)</li></ul></li><li><code>Reflect.has(target, propertyKey)</code><ul><li>判断一个对象是否存在某个属性，和 in 运算符 的功能完全相同</li></ul></li><li><code>Reflect.get(target, propertyKey[, receiver])</code><ul><li>获取对象身上某个属性的值，类似于 target[name]</li></ul></li><li><code>Reflect.set(target, propertyKey, value[, receiver])</code><ul><li>将值分配给属性的函数。返回一个 Boolean，如果更新成功，则返回 true</li></ul></li><li><code>Reflect.deleteProperty(target, propertyKey)</code><ul><li>作为函数的 delete 操作符，相当于执行 delete target[name]</li></ul></li><li>Reflect.apply(target, thisArgument, argumentsList)<ul><li>对一个函数进行调用操作，同时可以传入一个数组作为调用参数。和 Function.prototype.apply() 功能类似</li></ul></li><li>Reflect.construct(target, argumentsList[, newTarget])<ul><li>对构造函数进行 new 操作，相当于执行 new target(…args)</li></ul></li></ol><p>Reflect 和 Proxy 结合使用：</p><p>使用 Reflect 能保证操作的都是代理，不会直接对原始对象进行操作</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">17</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//target为原来的对象</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;获取值&#x27;</span>)</span><br><span class="line">    <span class="comment">// return target[key]; 这样是操作的原来的对象 target === obj =&gt; true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key, receiver) <span class="comment">//通过Reflect操作对象,避免直接操作对象</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">target, key, newValue, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;设置值&#x27;</span>)</span><br><span class="line">    <span class="built_in">Reflect</span>.set(target, key, newValue, receiver) <span class="comment">//设置值成功之后就会返回true，原先直接操作对象是没法知道设置值是否成功的</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">objProxy.name = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(objProxy.name)</span><br></pre></td></tr></table></figure><p>Receiver 的作用（只有 getter 和 setter 里面有）</p><p>使 this 正确的指向创建出来的代理对象，而不是原目标对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">_name</span>: <span class="string">&#x27;ysj&#x27;</span>, <span class="comment">//对象中私有属性以下划线开头</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title">name</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._name</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span> <span class="title">name</span>(<span class="params">newName</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._name = newName</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> objProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;获取值&#x27;</span>)</span><br><span class="line">    <span class="comment">//receiver是创建出来的代理对象:objProxy</span></span><br><span class="line">    <span class="comment">//传入receiver可以改变obj对象getter里面的this，this._name， 使this指向代理对象</span></span><br><span class="line">    <span class="comment">//改变this指向的作用：便于对get、set做拦截</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key, receiver)</span><br><span class="line">    <span class="comment">//如果没有receiver，objProxy.name会进入getter方法，后面访问this._name的时候,this指向obj，此时访问属性时就绕过了代理对象objProxy</span></span><br><span class="line">    <span class="comment">// 访问_name时就无法监听，对_name的访问过程，没有被拦截</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">target, key, newValue, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;设置值&#x27;</span>)</span><br><span class="line">    <span class="built_in">Reflect</span>.set(target, key, newValue, receiver) <span class="comment">//此时obj对象setter里的this也指向receiver</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">objProxy.name = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(objProxy.name)</span><br></pre></td></tr></table></figure><p>Reflect 中 contruct 的作用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Teacher</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//要求：执行Student函数的内容，但是创建出来的对象是一个Teacher对象</span></span><br><span class="line"><span class="keyword">const</span> teacher = <span class="built_in">Reflect</span>.construct(Student, [<span class="string">&#x27;ysj&#x27;</span>, <span class="number">18</span>], Teacher)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(teacher.__proto__ === Teacher.prototype) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="响应式原理"><a href="#响应式原理" class="headerlink" title="响应式原理"></a>响应式原理</h4><h5 id="Vue3"><a href="#Vue3" class="headerlink" title="Vue3"></a>Vue3</h5><p>管理响应式数据的依赖</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20220301140850398.png" alt="image-20220301140850398"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> activeReactiveFn = <span class="literal">null</span> <span class="comment">//全局变量，用于保存当前的响应函数，以便在其他地方中取到</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Depend</span> </span>&#123;</span><br><span class="line">  <span class="comment">//收集属性依赖的类</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.reactiveFns = <span class="keyword">new</span> <span class="built_in">Set</span>() <span class="comment">//用Set保存依赖，存放响应函数,防止响应函数重复</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">depend</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//添加依赖</span></span><br><span class="line">    <span class="keyword">if</span> (activeReactiveFn) &#123;</span><br><span class="line">      <span class="comment">//如果当前响应式函数不为空</span></span><br><span class="line">      <span class="built_in">this</span>.reactiveFns.add(activeReactiveFn) <span class="comment">//将当前的响应函数添加进依赖Set</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">notify</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//依赖属性发生改变时重新执行响应式函数</span></span><br><span class="line">    <span class="built_in">this</span>.reactiveFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> fn())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//封装一个响应式的函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">watchFn</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//传入需要响应式的函数</span></span><br><span class="line">  activeReactiveFn = fn <span class="comment">//记录当前的响应函数</span></span><br><span class="line">  fn() <span class="comment">//需要响应的函数里面会触发对象属性的getter方法，getter方法里面负责依赖收集</span></span><br><span class="line">  activeReactiveFn = <span class="literal">null</span> <span class="comment">//当前响应函数已经被添加进依赖，给activeReactiveFn置空</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>() <span class="comment">//使用WeakMap保存对象和对象依赖的映射</span></span><br><span class="line"><span class="comment">//封装一个获取depend实例的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDepend</span>(<span class="params">targetObj, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> map = targetMap.get(targetObj) <span class="comment">//根据对象这个key获取对应的value(一个map对象)</span></span><br><span class="line">  <span class="keyword">if</span> (!map) &#123;</span><br><span class="line">    <span class="comment">//如果map没有值</span></span><br><span class="line">    map = <span class="keyword">new</span> <span class="built_in">Map</span>() <span class="comment">//新建一个map</span></span><br><span class="line">    targetMap.set(targetObj, map)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//根据对象的属性key获取对应的depend对象</span></span><br><span class="line">  <span class="keyword">let</span> depend = map.get(key)</span><br><span class="line">  <span class="keyword">if</span> (!depend) &#123;</span><br><span class="line">    <span class="comment">//如果depend不存在</span></span><br><span class="line">    depend = <span class="keyword">new</span> Depend() <span class="comment">//给对象的属性创建对应的depend实例</span></span><br><span class="line">    map.set(key, depend)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> depend</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//将对象变为响应式对象，并返回</span></span><br><span class="line">  <span class="comment">//监听对象的属性变化:Proxy Object.defineProperty</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="comment">//创建obj对象的代理对象并返回响应式代理对象</span></span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="comment">//根据target、key获取对应的depend实例</span></span><br><span class="line">      <span class="keyword">const</span> depend = getDepend(target, key)</span><br><span class="line">      <span class="comment">//给depend对象中添加响应函数</span></span><br><span class="line">      depend.depend() <span class="comment">//将当前响应函数添加进对象属性对应的依赖数组</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key, receiver) <span class="comment">//通过Reflect操作对象,避免直接操作对象</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, newValue, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">Reflect</span>.set(target, key, newValue, receiver)</span><br><span class="line">      <span class="keyword">const</span> depend = getDepend(target, key) <span class="comment">//获取某个对象的属性对应的depend实例</span></span><br><span class="line">      depend.notify() <span class="comment">//自动监听，值变化后执行对应的响应式函数</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试代码</span></span><br><span class="line"><span class="keyword">const</span> objProxy = reactive(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">watchFn(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(objProxy.name, <span class="string">&#x27;name需要响应式的函数1&#x27;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(objProxy.name, <span class="string">&#x27;name需要响应式的函数1&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">watchFn(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(objProxy.age, <span class="string">&#x27;age需要响应式的函数1&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;改变name后执行的响应式函数-----&#x27;</span>)</span><br><span class="line">objProxy.name = <span class="string">&#x27;ddd&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;改变age后执行的响应式函数-----&#x27;</span>)</span><br><span class="line">objProxy.age = <span class="number">22</span></span><br></pre></td></tr></table></figure><h5 id="vue2"><a href="#vue2" class="headerlink" title="vue2"></a>vue2</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//将对象变为响应式对象，并返回</span></span><br><span class="line">  <span class="built_in">Object</span>.keys(obj).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value = obj[key]</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">      <span class="attr">get</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> depend = getDepend(obj, key)</span><br><span class="line">        depend.depend()</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">set</span>: <span class="function"><span class="keyword">function</span> (<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        value = newValue</span><br><span class="line">        <span class="keyword">const</span> depend = getDepend(obj, key)</span><br><span class="line">        depend.notify()</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//其它与vue3一样</span></span><br></pre></td></tr></table></figure><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>ES6 新增 API，在通过 new 创建 Promise 对象时，我们需要传入一个回调函数，称之为 executor：</p><ul><li>这个回调函数会被立即执行，并且传入给另外两个回调函数 resolve、reject;</li><li>调用 resolve 回调函数时，会执行 Promise 对象的 then 方法传入的回调函数</li><li>调用 reject 回调函数时，会执行 Promise 对象的 catch 方法传入的回调函数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//成功时调resolve函数，失败时调reject函数</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">&#x27;成功时传递的参数&#x27;</span>)</span><br><span class="line">  <span class="comment">//reject(&quot;失败时传递的参数&quot;);</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//then方法传入的函数，会在Promise执行resolve函数时被回调</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//catch方法传入的函数，会在Promise执行reject函数时被回调</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//另一种写法</span></span><br><span class="line">promise.then(</span><br><span class="line">  <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//Promise执行resolve时被回调</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;请求成功&#x27;</span>, res)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//Promise执行rejct时被回调</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;请求失败&#x27;</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="resolve-详解"><a href="#resolve-详解" class="headerlink" title="resolve 详解"></a>resolve 详解</h4><p>promise 的三种状态</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注：Promise状态一旦确定下来，那么就是不可更改的(锁定)</span></span><br><span class="line"><span class="comment">//即调了resolve，后面再调reject也是不会执行的</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//此阶段为pending状态（待定/悬而未决）</span></span><br><span class="line">  <span class="comment">//初始状态，既没有被兑现，也没有被拒绝</span></span><br><span class="line">&#125;).then(</span><br><span class="line">  <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//执行了resolve时，处于该状态</span></span><br><span class="line">    <span class="comment">//此阶段为fulfilled、resolved状态(固定、已敲定)，意味操作成功完成</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//执行了reject时处于该状态</span></span><br><span class="line">    <span class="comment">//此阶段为rejected状态(已拒绝)，意味操作失败</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>promise 的 resolve 参数</p><p>resolve 参数：</p><ul><li>可以传入普通的值或对象</li><li>可以传入一个 Promise<ul><li>传入的是一个 Promsie 时，当前的 Promise 状态会由传入的 Promise 来决定。相当于状态进行了移交</li></ul></li><li>传入一个对象，并且这个对象有实现 then 方法(thenable)<ul><li>那么也会执行该 then 方法，并且由该 then 方法决定后续状态</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传入Promise</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      resolve(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res) <span class="comment">//aaa</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//传入一个对象，这个对象有then方法</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(&#123;</span><br><span class="line">    <span class="function"><span class="title">then</span>(<span class="params">resolve, reject</span>)</span> &#123;</span><br><span class="line">      resolve(<span class="string">&#x27;then方法&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res) <span class="comment">///then方法</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="实例方法-then"><a href="#实例方法-then" class="headerlink" title="实例方法-then"></a>实例方法-then</h4><p>then 方法是 Promise 对象上的一个方法，放在 Promsie 原型上：Promise.prototype.then</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptors(<span class="built_in">Promise</span>.prototype))</span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">&#x27;hahaha&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.同一个Promise可以被多次调用then方法</span></span><br><span class="line"><span class="comment">//当我们的resolve方法被回调时，所有的then方法传入的回调函数都会被调用</span></span><br><span class="line">promise.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;res1:&#x27;</span>, res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;res2:&#x27;</span>, res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.then方法传入的回调函数可以有返回值</span></span><br><span class="line"><span class="comment">// then方法本身有返回值，返回值是一个Promise,</span></span><br><span class="line"><span class="comment">// 新Promise有then方法，所以还可以继续调用then(链式调用)，没有返回值时即默认返回undefined</span></span><br><span class="line"><span class="comment">//如果返回的是一个普通值，那么这个普通值会被作为一个新的Promise的resolve值</span></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1111</span></span><br><span class="line">    <span class="comment">//等价于 =&gt; return new Promise(resolve =&gt; resolve(1111))</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res) <span class="comment">// 1111</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果返回的是一个Promise</span></span><br><span class="line"><span class="comment">// 此时情况等同于传入一个Promise，当前的Promise状态会由传入的Promise来决定</span></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        resolve(<span class="number">1111</span>) <span class="comment">//传入的Promise调用了resolve</span></span><br><span class="line">      &#125;, <span class="number">3000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.如果返回的是一个对象，并且该对象实现了thenable</span></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="function"><span class="title">then</span>(<span class="params">resolve, reject</span>)</span> &#123;</span><br><span class="line">        resolve(<span class="number">2222</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res) <span class="comment">// 2222</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h4 id="实例方法-catch"><a href="#实例方法-catch" class="headerlink" title="实例方法-catch"></a>实例方法-catch</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// reject(&quot;rejected &quot;);</span></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;rejected &#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.then(<span class="literal">null</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//调用reject或者抛出异常都会来到此函数</span></span><br><span class="line">  <span class="built_in">console</span>.log(err) <span class="comment">//rejected</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//其它写法</span></span><br><span class="line">promise.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err) <span class="comment">// rejected</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;&#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//此处的reject优先捕获promise变量的异常，没有异常再捕获then返回的新的Promise的异常</span></span><br><span class="line">    <span class="built_in">console</span>.log(err) <span class="comment">//rejected</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>catch 返回值也会被包裹一个 Promise 返回，只要返回值不调用 reject 或抛出异常，就会继续调用 then 方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">promise</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;&#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1111</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res) <span class="comment">//1111</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h4 id="实例方法-finally"><a href="#实例方法-finally" class="headerlink" title="实例方法-finally"></a>实例方法-finally</h4><p>ES9(2018)新增特性，表示 Promise 对象无论变成 fulfilled 还是 rejected 状态，最终都会被执行的代码</p><p>finally 方法不接收参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">&#x27;resolve&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;&#125;)</span><br><span class="line">  .finally(<span class="function">(<span class="params">_</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;finally code&#x27;</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h4 id="类方法-resolve"><a href="#类方法-resolve" class="headerlink" title="类方法-resolve"></a>类方法-resolve</h4><p>有时候有一个现成的内容，希望将其转成 Promise 来用，可以使用 Promise.resolve 方法来完成</p><p>Promise.resolve 用法相当于 new Promise,并且执行 resolve 操作</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="built_in">Promise</span>.resolve(&#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">const</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> resolve(&#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span> &#125;)) <span class="comment">//两者等价</span></span><br><span class="line"></span><br><span class="line">promise.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res) <span class="comment">//&#123;name: &#x27;ysj&#x27;&#125;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//传入普通值</span></span><br><span class="line"><span class="comment">//传入Promise</span></span><br><span class="line"><span class="comment">//传入thenable</span></span><br><span class="line"><span class="comment">//此三种情况与之前类似</span></span><br></pre></td></tr></table></figure><h4 id="类方法-reject"><a href="#类方法-reject" class="headerlink" title="类方法-reject"></a>类方法-reject</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="built_in">Promise</span>.reject(&#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">const</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> reject(&#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span> &#125;)) <span class="comment">//两者等价</span></span><br><span class="line"></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err) <span class="comment">//&#123;name: &#x27;ysj&#x27;&#125;</span></span><br><span class="line">  &#125;)</span><br><span class="line"><span class="comment">//reject无论传入什么值都是一样的，都会来到catch</span></span><br></pre></td></tr></table></figure><h4 id="类方法-all"><a href="#类方法-all" class="headerlink" title="类方法-all"></a>类方法-all</h4><p>作用：将多个 Promise 包裹在一起形成一个新的 Promise</p><p>新的 Promise 状态由包裹的所有 Promise 共同决定：</p><ul><li>当<strong>所有的 Promise</strong>状态<strong>变为 fulfilled</strong>状态时，<strong>新的 Promise</strong>状态<strong>为 fulfilled</strong>，并且会将<strong>所有 Promise 返回值组成一个数组</strong></li><li>一旦<strong>有一个 Promise</strong>状态<strong>为 rejected</strong>时，<strong>新的 Promise 状态为 rejected</strong>，并且会将<strong>第一个 reject 的返回值作为参数</strong></li></ul><p>缺陷：</p><ul><li>当有其中一个 Promise 变成 reject 状态时，新 Promise 就会立即变成对应的 reject 状态</li><li>对于 resolved 的，以及依然处于 pending 状态的 Promise，我们是获取不到对应的结果的</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建多个Promise</span></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">1111</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">222</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">1111</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//希望所有的Promise都变成fulfilled时，再拿到结果</span></span><br><span class="line"><span class="built_in">Promise</span>.all([p1, p2, p3, <span class="string">&#x27;aaaa&#x27;</span>]).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//如果数组传入的不是一个Promise，会被转成一个Promise</span></span><br><span class="line">  <span class="built_in">console</span>.log(res) <span class="comment">//  [ 1111, 222, 1111, &#x27;aaaa&#x27; ],会将几个resolve的结果按照传入的顺序放进一个数组里面</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//意外：在拿到所有结果之前，有一个Promise变成了rejected，那么整个Promise是rejected</span></span><br><span class="line"><span class="built_in">Promise</span>.all([p1, p2, p3, <span class="string">&#x27;aaaa&#x27;</span>])</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// p2的返回结果改为reject</span></span><br><span class="line">    <span class="built_in">console</span>.log(err) <span class="comment">//222</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h4 id="类方法-allSettled"><a href="#类方法-allSettled" class="headerlink" title="类方法-allSettled"></a>类方法-allSettled</h4><p>ES11(2020)新增 API Promise.allSettled：</p><ul><li>该方法会在所有的 Promise 都有结果（settled），无论是 fulfilled，还是 reject 时，才会有最终的状态</li><li>并且这个 Promise 的结果一定是 fulfilled 的(不会来到 catch 里面)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.allSettled([p1, p2, p3]).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res) <span class="comment">//返回一个数组，数组里面包含每一个Promise的状态和结果</span></span><br><span class="line">  <span class="comment">// [</span></span><br><span class="line">  <span class="comment">//   &#123; status: &#x27;fulfilled&#x27;, value: 1111 &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123; status: &#x27;rejected&#x27;, reason: 222 &#125;,</span></span><br><span class="line">  <span class="comment">//   &#123; status: &#x27;fulfilled&#x27;, value: 1111 &#125;</span></span><br><span class="line">  <span class="comment">// ]</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="类方法-race"><a href="#类方法-race" class="headerlink" title="类方法-race"></a>类方法-race</h4><p>如果有一个 Promise 有了结果，我们就希望决定最终新 Promise 的状态，那么可以使用 race 方法：</p><ul><li>race 是竞技、竞赛的意思，表示多个 Promise 相互竞争，谁先有结果，那么就使用谁的结果</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="number">1111</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([p1, p2, p3])</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;res&#x27;</span>, res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err) <span class="comment">// err 1111</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h4 id="类方法-any"><a href="#类方法-any" class="headerlink" title="类方法-any"></a>类方法-any</h4><p>ES12 新增，与和 race 方法类似：</p><ul><li>any 方法会至少等到一个 fulfilled 状态，才会决定新 Promise 的状态</li><li>如果所有的 Promise 都是 reject 的，那么也会等到所有的 Promise 都变成 rejected 状态</li><li>并且会报一个 AggregateError 的错误</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="number">222</span>)</span><br><span class="line">  &#125;, <span class="number">500</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.any([p1, p2, p3])</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;res&#x27;</span>, res) <span class="comment">//  res 1111</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err.errors)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h4 id="手写-Promise"><a href="#手写-Promise" class="headerlink" title="手写 Promise"></a>手写 Promise</h4><p>构造函数规划</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HYPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 定义状态</span></span><br><span class="line">    <span class="comment">// 定义resolve、reject回调</span></span><br><span class="line">    <span class="comment">// resolve执行微任务队列：改变状态、获取value、then传入执行成功回调</span></span><br><span class="line">    <span class="comment">// reject执行微任务队列：改变状态、获取reason、then传入执行失败回调</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// try catch</span></span><br><span class="line">    executor(resolve, reject)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="then-方法实现"><a href="#then-方法实现" class="headerlink" title="then 方法实现"></a>then 方法实现</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HYPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// this.onFulfilled = onFulfilled</span></span><br><span class="line">    <span class="comment">// this.onRejected = onRejected</span></span><br><span class="line">    <span class="comment">// 1.判断onFulfilled、onRejected，会给默认值</span></span><br><span class="line">    <span class="comment">// 2.返回Promise resolve/reject</span></span><br><span class="line">    <span class="comment">// 3.判断之前的promise状态是否确定</span></span><br><span class="line">    <span class="comment">// onFulfilled/onRejected直接执行（捕获异常）</span></span><br><span class="line">    <span class="comment">// 4.添加到数组中push(() =&gt; &#123; 执行 onFulfilled/onRejected 直接执行代码&#125;)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//封装工具函数，抽取相似的try catch代码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execFunctionWithCatchError</span>(<span class="params">execFn, value, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = execFn(value) <span class="comment">//直接调用函数,并拿到函数执行的返回值</span></span><br><span class="line">    resolve(result) <span class="comment">//链式调用时使其能获取到上一次的返回值</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    reject(err) <span class="comment">//链式调用时使其能获取到上一次的返回值</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SJPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//接收创建实例时传进来的函数</span></span><br><span class="line">    <span class="built_in">this</span>.status = <span class="string">&#x27;pending&#x27;</span> <span class="comment">//记录当前Promise的状态(pending、fulfilled、rejected)</span></span><br><span class="line">    <span class="built_in">this</span>.value = <span class="literal">undefined</span> <span class="comment">//保存调用resolve时传进来的参数,链式调用的时候作为then里面的回调函数的参数</span></span><br><span class="line">    <span class="built_in">this</span>.reason = <span class="literal">undefined</span> <span class="comment">//保存调用reject时传进来的参数,链式调用的时候作为catch里面的回调函数的参数</span></span><br><span class="line">    <span class="built_in">this</span>.onFulfilledFns = [] <span class="comment">//保存通过实例对象多次调用then或者链式调用时传进来的成功回调函数</span></span><br><span class="line">    <span class="built_in">this</span>.onRejectedFns = [] <span class="comment">//保存通过实例对象多次调用then或者链式调用时传进来的失败回调函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//成功回调函数</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">//如果状态为pending时</span></span><br><span class="line">        <span class="comment">//new Promise时，传入的回调函数会被立即执行，resolve就会被调用(reject同理)</span></span><br><span class="line">        <span class="comment">//就会执行resolve函数,但此时then方法还未执行,保存成功后回调函数的this.onFulfilled还未被赋值，此时值还为undefined</span></span><br><span class="line">        <span class="comment">//所以要让resolve函数的代码在then方法执行完以后，this.onFulfilled被赋值以后再执行</span></span><br><span class="line">        <span class="comment">//所以需要将resolve代码放进微任务里面，保证以上执行顺序</span></span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//添加微任务</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span> <span class="comment">//如果promise的状态现在不等于pending，后面的代码不再执行</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;fulfilled&#x27;</span> <span class="comment">//调用resolve之后将状态改为fulfilled</span></span><br><span class="line">          <span class="built_in">this</span>.value = value <span class="comment">//保存调用resolve时传进来的参数</span></span><br><span class="line">          <span class="comment">//resolve被调用之后要执行then传进来的第一个回调函数</span></span><br><span class="line">          <span class="built_in">this</span>.onFulfilledFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(value) <span class="comment">//遍历保存的所有成功的回调函数并执行</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//失败回调函数</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">//如果状态为pending时</span></span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//添加微任务</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span> <span class="comment">//如果promise的状态现在不等于pending，后面的代码不再执行</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;rejected&#x27;</span> <span class="comment">//调用reject之后将状态改为rejected</span></span><br><span class="line">          <span class="built_in">this</span>.reason = reason <span class="comment">//存调用reject时传进来的参数</span></span><br><span class="line">          <span class="comment">//reject被调用之后要执行then传进来的第二个回调函数</span></span><br><span class="line">          <span class="built_in">this</span>.onRejectedFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(reason)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      executor(resolve, reject) <span class="comment">//函数传进来后会被直接调用,此函数接收成功和失败两个参数</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//then方法, 参数一：调用resolve后的回调函数;参数二：调用reject后的回调函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//返回一个promise，使其支持链式调用</span></span><br><span class="line">      <span class="comment">//如果在promise.then调用时状态已经确定下来，直接执行即可</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;fulfilled&#x27;</span> &amp;&amp; onFulfilled) &#123;</span><br><span class="line">        <span class="comment">//如果传入进来时已经时fulfilled状态</span></span><br><span class="line">        execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;rejected&#x27;</span> &amp;&amp; onRejected) &#123;</span><br><span class="line">        <span class="comment">//如果传入进来时已经时rejected状态</span></span><br><span class="line">        execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//如果在promise.then调用时状态还是pending，将每次promise.then传进来得函数放进数组，以便后续执行</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">//如果是pending状态</span></span><br><span class="line">        <span class="built_in">this</span>.onFulfilledFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//将本次执行的结果通过resolve或reject传给下一次链式的then</span></span><br><span class="line">          execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">this</span>.onRejectedFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//测试代码</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//此函数传进去后会被直接调用</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;pending状态&#x27;</span>)</span><br><span class="line">  reject(<span class="number">222</span>)</span><br><span class="line">  resolve(<span class="number">111</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise</span><br><span class="line">  .then(</span><br><span class="line">    <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;res1:&#x27;</span>, res)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;err1:&#x27;</span>, err)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;bbb&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .then(</span><br><span class="line">    <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;res2:&#x27;</span>, res)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;err2:&#x27;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//确定promise状态后再次调用then，传进的回调函数直接执行即可</span></span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="catch-方法实现"><a href="#catch-方法实现" class="headerlink" title="catch 方法实现"></a>catch 方法实现</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HYPromise</span> </span>&#123;</span><br><span class="line">  <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.then(<span class="literal">undefined</span>, onRejected)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execFunctionWithCatchError</span>(<span class="params">execFn, value, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = execFn(value)</span><br><span class="line">    resolve(result)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    reject(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SJPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.status = <span class="string">&#x27;pending&#x27;</span></span><br><span class="line">    <span class="built_in">this</span>.value = <span class="literal">undefined</span></span><br><span class="line">    <span class="built_in">this</span>.reason = <span class="literal">undefined</span></span><br><span class="line">    <span class="built_in">this</span>.onFulfilledFns = []</span><br><span class="line">    <span class="built_in">this</span>.onRejectedFns = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;fulfilled&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.value = value</span><br><span class="line">          <span class="built_in">this</span>.onFulfilledFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(value)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;rejected&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.reason = reason</span><br><span class="line">          <span class="built_in">this</span>.onRejectedFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(reason)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      executor(resolve, reject)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//当调用了reject，但是then的onRejected回调为空时，没有处理异常，给其默认值，直接将异常抛出</span></span><br><span class="line">    <span class="comment">//让这个then返回的promise直接进入到失败回调函数里面</span></span><br><span class="line">    <span class="comment">// onRejected = onRejected || (err =&gt; &#123; throw new Error(err) &#125;)</span></span><br><span class="line">    onRejected ||= <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;fulfilled&#x27;</span> &amp;&amp; onFulfilled) &#123;</span><br><span class="line">        execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;rejected&#x27;</span> &amp;&amp; onRejected) &#123;</span><br><span class="line">        execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (onFulfilled)</span><br><span class="line">          <span class="built_in">this</span>.onFulfilledFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="keyword">if</span> (onRejected)</span><br><span class="line">          <span class="built_in">this</span>.onRejectedFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">    <span class="comment">//catch方法</span></span><br><span class="line">    <span class="built_in">this</span>.then(<span class="literal">undefined</span>, onRejected)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  reject(<span class="number">222</span>)</span><br><span class="line">  <span class="comment">// resolve(111);</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//then为第一个promise，此时第一个then的失败处理回调为undefined</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;res1:&#x27;</span>, res)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//catch为第二个promise</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err1:&#x27;</span>, err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h5 id="finally-方法实现"><a href="#finally-方法实现" class="headerlink" title="finally 方法实现"></a>finally 方法实现</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HYPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">finally</span>(<span class="params">onFinally</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.then(</span><br><span class="line">      <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        onFinally()</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        onFinally()</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execFunctionWithCatchError</span>(<span class="params">execFn, value, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = execFn(value)</span><br><span class="line">    resolve(result)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    reject(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SJPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.status = <span class="string">&#x27;pending&#x27;</span></span><br><span class="line">    <span class="built_in">this</span>.value = <span class="literal">undefined</span></span><br><span class="line">    <span class="built_in">this</span>.reason = <span class="literal">undefined</span></span><br><span class="line">    <span class="built_in">this</span>.onFulfilledFns = []</span><br><span class="line">    <span class="built_in">this</span>.onRejectedFns = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;fulfilled&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.value = value</span><br><span class="line">          <span class="built_in">this</span>.onFulfilledFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(value)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;rejected&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.reason = reason</span><br><span class="line">          <span class="built_in">this</span>.onRejectedFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(reason)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      executor(resolve, reject)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">    onRejected ||= <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//当调用了then再调用catch再调用finally时，then返回一个值，但是catch中onFulfilled为undefined，</span></span><br><span class="line">    <span class="comment">//因为catch返回的promise中onFulfilled为空，就会导致无法返回一个新的promise，则无法链式调用finally</span></span><br><span class="line">    <span class="comment">//所以需要给其一个默认值，使得返回一个promise，用这个promise调用finally</span></span><br><span class="line">    onFulfilled ||= <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;fulfilled&#x27;</span>) &#123;</span><br><span class="line">        execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;rejected&#x27;</span>) &#123;</span><br><span class="line">        execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.onFulfilledFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">this</span>.onRejectedFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.then(<span class="literal">undefined</span>, onRejected) <span class="comment">//将调用then方法生成的promise返回出去</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">finally</span>(<span class="params">onFinally</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// this.then(() =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//   onFinally()</span></span><br><span class="line">    <span class="comment">// &#125;, () =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//   onFinally()</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="built_in">this</span>.then(onFinally, onFinally)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  reject(<span class="number">222</span>)</span><br><span class="line">  <span class="comment">// resolve(111);</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//promise1:</span></span><br><span class="line"><span class="comment">//success1 err =&gt; &#123; throw err &#125;</span></span><br><span class="line"><span class="comment">//promise2:</span></span><br><span class="line"><span class="comment">//undefined err =&gt; &#123;console.log(err)&#125;</span></span><br><span class="line"></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;res1:&#x27;</span>, res)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err)</span><br><span class="line">  &#125;)</span><br><span class="line">  .finally(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;finally&#x27;</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h5 id="resolve-和-reject-类方法"><a href="#resolve-和-reject-类方法" class="headerlink" title="resolve 和 reject 类方法"></a>resolve 和 reject 类方法</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execFunctionWithCatchError</span>(<span class="params">execFn, value, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = execFn(value)</span><br><span class="line">    resolve(result)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    reject(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SJPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.status = <span class="string">&#x27;pending&#x27;</span></span><br><span class="line">    <span class="built_in">this</span>.value = <span class="literal">undefined</span></span><br><span class="line">    <span class="built_in">this</span>.reason = <span class="literal">undefined</span></span><br><span class="line">    <span class="built_in">this</span>.onFulfilledFns = []</span><br><span class="line">    <span class="built_in">this</span>.onRejectedFns = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;fulfilled&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.value = value</span><br><span class="line">          <span class="built_in">this</span>.onFulfilledFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(value)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;rejected&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.reason = reason</span><br><span class="line">          <span class="built_in">this</span>.onRejectedFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(reason)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      executor(resolve, reject)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">    onRejected ||= <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    onFulfilled ||= <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;fulfilled&#x27;</span>) &#123;</span><br><span class="line">        execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;rejected&#x27;</span>) &#123;</span><br><span class="line">        execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.onFulfilledFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">this</span>.onRejectedFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.then(<span class="literal">undefined</span>, onRejected)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">finally</span>(<span class="params">onFinally</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.then(onFinally, onFinally)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//static作为前缀的方法称之为类方法，也称为静态方法</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">resolve</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve</span>) =&gt;</span> resolve(value))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">reject</span>(<span class="params">reason</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//reject类方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> reject(reason))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SJPromise.resolve(<span class="string">&#x27;aaa&#x27;</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;res1:&#x27;</span>, res)</span><br><span class="line">&#125;)</span><br><span class="line">SJPromise.reject(<span class="string">&#x27;err&#x27;</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;res2:&#x27;</span>, res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err:&#x27;</span>, err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h5 id="all-和-allSettled-方法"><a href="#all-和-allSettled-方法" class="headerlink" title="all 和 allSettled 方法"></a>all 和 allSettled 方法</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execFunctionWithCatchError</span>(<span class="params">execFn, value, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = execFn(value)</span><br><span class="line">    resolve(result)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    reject(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SJPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.status = <span class="string">&#x27;pending&#x27;</span></span><br><span class="line">    <span class="built_in">this</span>.value = <span class="literal">undefined</span></span><br><span class="line">    <span class="built_in">this</span>.reason = <span class="literal">undefined</span></span><br><span class="line">    <span class="built_in">this</span>.onFulfilledFns = []</span><br><span class="line">    <span class="built_in">this</span>.onRejectedFns = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;fulfilled&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.value = value</span><br><span class="line">          <span class="built_in">this</span>.onFulfilledFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(value)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;rejected&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.reason = reason</span><br><span class="line">          <span class="built_in">this</span>.onRejectedFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(reason)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      executor(resolve, reject)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">    onRejected ||= <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    onFulfilled ||= <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;fulfilled&#x27;</span>) &#123;</span><br><span class="line">        execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;rejected&#x27;</span>) &#123;</span><br><span class="line">        execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.onFulfilledFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">this</span>.onRejectedFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.then(<span class="literal">undefined</span>, onRejected)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">finally</span>(<span class="params">onFinally</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.then(onFinally, onFinally)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">resolve</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve</span>) =&gt;</span> resolve(value))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">reject</span>(<span class="params">reason</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> reject(reason))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">all</span>(<span class="params">promises</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> values = [] <span class="comment">//用于收集promise数组成功后的结果</span></span><br><span class="line">      promises.forEach(<span class="function">(<span class="params">promise</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//遍历传入的promise数组</span></span><br><span class="line">        promise.then(</span><br><span class="line">          <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            values.push(res) <span class="comment">//收集结果</span></span><br><span class="line">            <span class="keyword">if</span> (values.length === promises.length) &#123;</span><br><span class="line">              <span class="comment">//如果收集结果的数组和传进来的promise数组长度相等，说明所有的promise都执行成功了</span></span><br><span class="line">              resolve(values)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            reject(err) <span class="comment">//只要有错误，立马调用reject</span></span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">allSettled</span>(<span class="params">promises</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//搜集所有的结果</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> results = [] <span class="comment">//搜集所有的结果</span></span><br><span class="line">      promises.forEach(<span class="function">(<span class="params">promise</span>) =&gt;</span> &#123;</span><br><span class="line">        promise.then(</span><br><span class="line">          <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            results.push(&#123; <span class="attr">status</span>: <span class="string">&#x27;fulfilled&#x27;</span>, <span class="attr">value</span>: res &#125;)</span><br><span class="line">            <span class="keyword">if</span> (results.length === promises.length) &#123;</span><br><span class="line">              <span class="comment">//如果遍历完成</span></span><br><span class="line">              resolve(results)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            results.push(&#123; <span class="attr">status</span>: <span class="string">&#x27;rejected&#x27;</span>, <span class="attr">value</span>: err &#125;)</span><br><span class="line">            <span class="keyword">if</span> (results.length === promises.length) &#123;</span><br><span class="line">              <span class="comment">//如果遍历完成</span></span><br><span class="line">              resolve(results)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">111</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="number">222</span>)</span><br><span class="line">    resolve(<span class="number">222</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">333</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SJPromise.all([p1, p2, p3]).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res);</span></span><br><span class="line"><span class="comment">// &#125;).catch(err =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(err);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">SJPromise.allSettled([p1, p2, p3]).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="race-和-any-方法"><a href="#race-和-any-方法" class="headerlink" title="race 和 any 方法"></a>race 和 any 方法</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execFunctionWithCatchError</span>(<span class="params">execFn, value, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = execFn(value)</span><br><span class="line">    resolve(result)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    reject(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SJPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.status = <span class="string">&#x27;pending&#x27;</span></span><br><span class="line">    <span class="built_in">this</span>.value = <span class="literal">undefined</span></span><br><span class="line">    <span class="built_in">this</span>.reason = <span class="literal">undefined</span></span><br><span class="line">    <span class="built_in">this</span>.onFulfilledFns = []</span><br><span class="line">    <span class="built_in">this</span>.onRejectedFns = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> resolve = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;fulfilled&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.value = value</span><br><span class="line">          <span class="built_in">this</span>.onFulfilledFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(value)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> reject = <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.status !== <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="built_in">this</span>.status = <span class="string">&#x27;rejected&#x27;</span></span><br><span class="line">          <span class="built_in">this</span>.reason = reason</span><br><span class="line">          <span class="built_in">this</span>.onRejectedFns.forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">            fn(reason)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      executor(resolve, reject)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">then</span>(<span class="params">onFulfilled, onRejected</span>)</span> &#123;</span><br><span class="line">    onRejected ||= <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    onFulfilled ||= <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;fulfilled&#x27;</span>) &#123;</span><br><span class="line">        execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;rejected&#x27;</span>) &#123;</span><br><span class="line">        execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.onFulfilledFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          execFunctionWithCatchError(onFulfilled, <span class="built_in">this</span>.value, resolve, reject)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">this</span>.onRejectedFns.push(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          execFunctionWithCatchError(onRejected, <span class="built_in">this</span>.reason, resolve, reject)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.then(<span class="literal">undefined</span>, onRejected)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">finally</span>(<span class="params">onFinally</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.then(onFinally, onFinally)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">resolve</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve</span>) =&gt;</span> resolve(value))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">reject</span>(<span class="params">reason</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> reject(reason))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">all</span>(<span class="params">promises</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> values = []</span><br><span class="line">      promises.forEach(<span class="function">(<span class="params">promise</span>) =&gt;</span> &#123;</span><br><span class="line">        promise.then(</span><br><span class="line">          <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            values.push(res)</span><br><span class="line">            <span class="keyword">if</span> (values.length === promises.length) &#123;</span><br><span class="line">              resolve(values)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            reject(err)</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">allSettled</span>(<span class="params">promises</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> results = []</span><br><span class="line">      promises.forEach(<span class="function">(<span class="params">promise</span>) =&gt;</span> &#123;</span><br><span class="line">        promise.then(</span><br><span class="line">          <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            results.push(&#123; <span class="attr">status</span>: <span class="string">&#x27;fulfilled&#x27;</span>, <span class="attr">value</span>: res &#125;)</span><br><span class="line">            <span class="keyword">if</span> (results.length === promises.length) &#123;</span><br><span class="line">              resolve(results)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            results.push(&#123; <span class="attr">status</span>: <span class="string">&#x27;rejected&#x27;</span>, <span class="attr">value</span>: err &#125;)</span><br><span class="line">            <span class="keyword">if</span> (results.length === promises.length) &#123;</span><br><span class="line">              resolve(results)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">race</span>(<span class="params">promises</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//谁先有结果就用谁</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      promises.forEach(<span class="function">(<span class="params">promise</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// promise.then(res =&gt; &#123;</span></span><br><span class="line">        <span class="comment">//   resolve(res)</span></span><br><span class="line">        <span class="comment">// &#125;, err =&gt; &#123;</span></span><br><span class="line">        <span class="comment">//   reject(err)</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">        promise.then(resolve, reject) <span class="comment">//简写</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//至少等到有一个resolve，才会决定新Promise状态</span></span><br><span class="line">  <span class="comment">//全为rejected状态时，结果的promise也是rejected状态</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">any</span>(<span class="params">promises</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//一旦有一个成功的结果就执行resolve</span></span><br><span class="line">    <span class="comment">//所有的都失败了就执行reject</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> reasons = [] <span class="comment">//搜集错误信息的数组</span></span><br><span class="line">      promises.forEach(<span class="function">(<span class="params">promise</span>) =&gt;</span> &#123;</span><br><span class="line">        promise.then(resolve, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          reasons.push(err) <span class="comment">//将错误信息保存</span></span><br><span class="line">          <span class="keyword">if</span> (reasons.length === promises.length) &#123;</span><br><span class="line">            reject(<span class="keyword">new</span> AggregateError(reasons))</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// resolve(111)</span></span><br><span class="line">    reject(<span class="number">111</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="number">222</span>)</span><br><span class="line">    <span class="comment">// resolve(222)</span></span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="keyword">new</span> SJPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// resolve(333)</span></span><br><span class="line">    reject(<span class="number">333</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SJPromise.race([p1, p2, p3]).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res);</span></span><br><span class="line"><span class="comment">// &#125;).catch(err =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(err);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line">SJPromise.any([p1, p2, p3])</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err.errors) <span class="comment">//拿到所有错误信息</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h3 id="迭代器和生成器"><a href="#迭代器和生成器" class="headerlink" title="迭代器和生成器"></a>迭代器和生成器</h3><h4 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h4><h5 id="迭代器-1"><a href="#迭代器-1" class="headerlink" title="迭代器"></a>迭代器</h5><p>迭代器(Iterator),是确使用户可在容器对象（container，如链表或数组）上遍访的对象，使用该接口无需关心对象的内部实现细节</p><p>即：==迭代器是帮助我们对某个数据结构进行遍历的对象==</p><p>在 js 中，迭代器也是一个具体的对象，这个对象需要符合迭代器协议(iterator protocol):</p><ul><li>迭代器协议定义了产生一系列值(无论是有限还是无限个)的标准方式</li><li>在 js 中这个标准就是一个特定的 next 方法</li></ul><p>next 方法有如下要求：</p><ul><li>一个无参或者一个参数的函数，返回一个应当拥有以下两个属性的对象</li><li>done(boolean)<ul><li>如果迭代器可以产生序列中的下一个值，则为 false。(等价于没有指定 done 这个属性)</li><li>如果迭代器已将序列迭代完毕，则为 true。此时，value 可选，如果依然存在，即为迭代结束之后的默认返回值</li></ul></li><li>value<ul><li>迭代器返回的任何 js 值，done 为 true 时可省略</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> names = [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个迭代器对象来访问数组</span></span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line"><span class="keyword">const</span> namesIterator = &#123;</span><br><span class="line">  <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; names.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: names[index++] &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="literal">undefined</span> &#125; <span class="comment">//当没有值可以访问时</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(namesIterator.next())</span><br><span class="line"><span class="built_in">console</span>.log(namesIterator.next())</span><br><span class="line"><span class="built_in">console</span>.log(namesIterator.next())</span><br><span class="line"><span class="built_in">console</span>.log(namesIterator.next()) <span class="comment">//&#123; done: true, value: undefined &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createArrayIterator</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//生成数组迭代器的函数</span></span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (index &lt; arr.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: arr[index++] &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="literal">undefined</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="可迭代对象"><a href="#可迭代对象" class="headerlink" title="可迭代对象"></a>可迭代对象</h5><p>当一个对象实现了可迭代(iterable protocol)协议时，它就是一个可迭代对象</p><p>这个对象必须实现@@iterator 方法，在代码中我们使用 Symbol.iterator 访问该属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> iterableObj = &#123;</span><br><span class="line">  <span class="comment">//可迭代对象</span></span><br><span class="line">  <span class="attr">names</span>: [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>],</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//@@iterator方法</span></span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">next</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="built_in">this</span>.names.length) <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="built_in">this</span>.names[index++] &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="literal">undefined</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iterator = iterableObj[<span class="built_in">Symbol</span>.iterator]() <span class="comment">//每次调用函数都是生成一个新的迭代器</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next())</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next())</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next())</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next())</span><br><span class="line"></span><br><span class="line"><span class="comment">//for……of可以遍历的东西必须是一个可迭代对象</span></span><br><span class="line"><span class="comment">//普通对象不是一个可迭代对象，所以不能用for……of遍历</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> el <span class="keyword">of</span> iterableObj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(el)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="原生迭代器对象"><a href="#原生迭代器对象" class="headerlink" title="原生迭代器对象"></a>原生迭代器对象</h5><p>很多原生对象已经实现了可迭代协议，会生成一个迭代器对象：</p><ul><li>String、Array、Map、Set、arguments 对象、NodeList 集合</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> names = [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> iterator = names[<span class="built_in">Symbol</span>.iterator]()</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">//&#123;value: &quot;aaa&quot;, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">//&#123;value: &quot;bbb&quot;, done: false&#125;</span></span><br></pre></td></tr></table></figure><p>可迭代对象可以应用的场景：</p><ul><li>for…of、展开语法、yield*、解构赋值</li><li>new Map()、new WeakMap()、new Set()、new WeakSet()</li><li>Promise.all()、Promise.race()、Array.from()</li></ul><p>注:对象不是可迭代对象，但也可用展开运算符和解构语法</p><h5 id="自定义类的迭代"><a href="#自定义类的迭代" class="headerlink" title="自定义类的迭代"></a>自定义类的迭代</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建教室类，使这个类创建出来的对象都是可迭代对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Classroom</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">address, name, student</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.address = address</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="built_in">this</span>.student = student</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">entry</span>(<span class="params">newStu</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.student.push(newStu)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">next</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="built_in">this</span>.student.length) <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="built_in">this</span>.student[i++] &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="literal">undefined</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">return</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//监听迭代器提前终止</span></span><br><span class="line">        <span class="comment">//可以监听break、continue、return、throw</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;迭代器提前停止&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="literal">undefined</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> classroom = <span class="keyword">new</span> Classroom(<span class="string">&#x27;重庆市&#x27;</span>, <span class="string">&#x27;计算机一班&#x27;</span>, [<span class="string">&#x27;james&#x27;</span>, <span class="string">&#x27;kobe&#x27;</span>, <span class="string">&#x27;curry&#x27;</span>, <span class="string">&#x27;why&#x27;</span>])</span><br><span class="line">classroom.entry(<span class="string">&#x27;ysj&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> el <span class="keyword">of</span> classroom) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(el)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h4><p>==生成器是==ES6 中新增的==一种函数控制、使用的方案==，可以让我们更加灵活的控制函数什么时候继续执行、暂停执行</p><h5 id="生成器函数"><a href="#生成器函数" class="headerlink" title="生成器函数"></a>生成器函数</h5><p>生成器函数也是一个函数，但是和普通的函数有一些区别：</p><ul><li>生成器函数需要在 function 后面加一个符号：*</li><li>生成器函数可以通过 yield 关键字来控制函数的执行过程</li><li>生成器函数的返回值是一个 Generator(生成器)<ul><li>生成器是一种特殊的迭代器</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;生成器函数开始执行&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第一段代码&#x27;</span>)</span><br><span class="line">  <span class="keyword">yield</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第二段代码&#x27;</span>)</span><br><span class="line">  <span class="keyword">yield</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第三段代码&#x27;</span>)</span><br><span class="line">  <span class="keyword">yield</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;函数执行结束&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = foo()</span><br><span class="line"><span class="comment">//执行第一段代码</span></span><br><span class="line">generator.next() <span class="comment">//生成器函数开始执行 第一段代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//执行第二段代码</span></span><br><span class="line">generator.next() <span class="comment">//第二段代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//执行第三段代码</span></span><br><span class="line">generator.next() <span class="comment">//第三段代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//执行第三段代码后面的代码(最后一个yield后面的所有代码)</span></span><br><span class="line">generator.next() <span class="comment">//函数执行结束</span></span><br></pre></td></tr></table></figure><h5 id="生成器函数执行流程"><a href="#生成器函数执行流程" class="headerlink" title="生成器函数执行流程"></a>生成器函数执行流程</h5><ul><li><p>当函数遇到 yield 的时候，暂停执行</p></li><li><p>当函数遇到 return 的时候，停止执行</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第一段代码&#x27;</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&#x27;返回1&#x27;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第二段代码&#x27;</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&#x27;返回2&#x27;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第三段代码&#x27;</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&#x27;返回3&#x27;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;函数执行结束&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = foo()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(generator.next())</span><br><span class="line"><span class="comment">// 第一段代码</span></span><br><span class="line"><span class="comment">// &#123; value: &#x27;返回1&#x27;, done: false &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(generator.next())</span><br><span class="line"><span class="comment">// 第二段代码</span></span><br><span class="line"><span class="comment">// &#123; value: &#x27;返回2&#x27;, done: false &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(generator.next())</span><br><span class="line"><span class="comment">// 第三段代码</span></span><br><span class="line"><span class="comment">// &#123; value: &#x27;返回3&#x27;, done: false &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(generator.next())</span><br><span class="line"><span class="comment">// 函数执行结束</span></span><br><span class="line"><span class="comment">// &#123; value: 123, done: true &#125;</span></span><br></pre></td></tr></table></figure><h5 id="生成器其它方法使用"><a href="#生成器其它方法使用" class="headerlink" title="生成器其它方法使用"></a>生成器其它方法使用</h5><p>next 传递参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params">z</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(z) <span class="comment">// 5</span></span><br><span class="line">  <span class="keyword">const</span> n = <span class="keyword">yield</span> <span class="string">&#x27;第一段代码返回值&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(n) <span class="comment">// 10，这一段yield代码接收的参数</span></span><br><span class="line">  <span class="keyword">const</span> m = <span class="keyword">yield</span> <span class="string">&#x27;第二段代码返回值&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(m) <span class="comment">//20</span></span><br><span class="line">  <span class="keyword">const</span> x = <span class="keyword">yield</span> <span class="string">&#x27;第三段代码返回值&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(x) <span class="comment">//30</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;函数执行结束&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = foo(<span class="number">5</span>) <span class="comment">//第一个yield接收的参数在此处传入</span></span><br><span class="line"><span class="comment">// 截止到每一个yield就是一段代码</span></span><br><span class="line"><span class="comment">// 上一个yield表达式的返回值即为下一段yield代码接受的参数</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next())</span><br><span class="line"><span class="built_in">console</span>.log(generator.next(<span class="number">10</span>)) <span class="comment">//第二次调用next传入的参数，可以通过第一个yield的返回值拿到</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next(<span class="number">20</span>)) <span class="comment">//第三次调用next传入的参数，可以通过第二个yield的返回值拿到</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next(<span class="number">30</span>)) <span class="comment">//第四次调用next传入的参数，可以通过第三个yield的返回值拿到</span></span><br></pre></td></tr></table></figure><p>生成器的 return</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params">z</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(z) <span class="comment">// 5</span></span><br><span class="line">  <span class="keyword">const</span> n = <span class="keyword">yield</span> <span class="string">&#x27;第一段代码返回值&#x27;</span></span><br><span class="line">  <span class="comment">//等价  =&gt; return n</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&#x27;第二段代码返回值&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;函数执行结束&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = foo(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(generator.next())</span><br><span class="line"><span class="built_in">console</span>.log(generator.return(<span class="number">10</span>)) <span class="comment">//调用return时，第二段代码不会执行，但是会有返回值</span></span><br><span class="line"><span class="comment">// 等价于在第一个yield后面写了一个return,终止生成器函数代码执行，后续再调next，返回值都是undefined</span></span><br></pre></td></tr></table></figure><p>生成器的 throw 抛出异常</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第一段代码&#x27;</span>)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//捕获异常</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">100</span> <span class="comment">//会在此处发生异常</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err) <span class="comment">//抛出一个异常</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第二段代码&#x27;</span>) <span class="comment">//如未捕获异常，代码会终止执行，此行及之后的代码不会执行</span></span><br><span class="line">  <span class="keyword">yield</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;函数执行结束&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = foo()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">//&#123; value: 100, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.throw(<span class="string">&#x27;抛出一个异常&#x27;</span>)) <span class="comment">//调用throw，会在上一个yield处发生异常(第四行)</span></span><br></pre></td></tr></table></figure><h5 id="生成器替代迭代器"><a href="#生成器替代迭代器" class="headerlink" title="生成器替代迭代器"></a>生成器替代迭代器</h5><p>开发中，优先使用生成器，代码会更简洁</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生成器替代迭代器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createIterator</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// for (const el of arr) &#123;</span></span><br><span class="line">  <span class="comment">//   yield el;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//简便写法 yield* 自动迭代</span></span><br><span class="line">  <span class="keyword">yield</span>* arr <span class="comment">//yield* 后面跟上可迭代对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> names = [<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> namesGenerator = createIterator(names)</span><br><span class="line"><span class="built_in">console</span>.log(namesGenerator.next()) <span class="comment">//&#123; value: &#x27;aaa&#x27;, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(namesGenerator.next()) <span class="comment">//&#123; value: &#x27;bbb&#x27;, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(namesGenerator.next()) <span class="comment">//&#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个函数，函数可以迭代一定范围内的数字</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createRangeIterator</span>(<span class="params">start, end</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i = start</span><br><span class="line">  <span class="keyword">while</span> (i &lt; end) <span class="keyword">yield</span> i++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rangeIterator = createRangeIterator(<span class="number">10</span>, <span class="number">12</span>)</span><br><span class="line"><span class="built_in">console</span>.log(rangeIterator.next()) <span class="comment">//&#123; value: 10, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(rangeIterator.next()) <span class="comment">//&#123; value: 11, done: false &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(rangeIterator.next()) <span class="comment">//&#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Classroom</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">address, name, student</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.address = address</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="built_in">this</span>.student = student</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  *[<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">yield</span>* <span class="built_in">this</span>.student</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> classroom = <span class="keyword">new</span> Classroom(<span class="string">&#x27;重庆市&#x27;</span>, <span class="string">&#x27;计算机一班&#x27;</span>, [<span class="string">&#x27;james&#x27;</span>, <span class="string">&#x27;kobe&#x27;</span>, <span class="string">&#x27;curry&#x27;</span>, <span class="string">&#x27;why&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> el <span class="keyword">of</span> classroom) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(el)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="多个异步顺序调用"><a href="#多个异步顺序调用" class="headerlink" title="多个异步顺序调用"></a>多个异步顺序调用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestData</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 异步请求的代码会被放入到executor中</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">// 模拟网络请求</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 拿到请求的结果</span></span><br><span class="line">      resolve(url)</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Promise + generator实现</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res1 = <span class="keyword">yield</span> requestData(<span class="string">&quot;ysj&quot;</span>)</span><br><span class="line">  <span class="keyword">const</span> res2 = <span class="keyword">yield</span> requestData(res1 + <span class="string">&quot;aaa&quot;</span>)</span><br><span class="line">  <span class="keyword">const</span> res3 = <span class="keyword">yield</span> requestData(res2 + <span class="string">&quot;bbb&quot;</span>)</span><br><span class="line">  <span class="keyword">const</span> res4 = <span class="keyword">yield</span> requestData(res3 + <span class="string">&quot;ccc&quot;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(res4)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1&gt; 手动执行生成器函数</span></span><br><span class="line"><span class="keyword">const</span> generator = getData()</span><br><span class="line">generator.next().value.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  generator.next(res).value.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    generator.next(res).value.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      generator.next(res)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2&gt; 自己封装了一个自动执行的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execGenerator</span>(<span class="params">genFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> generator = genFn()</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params">res</span>) </span>&#123; <span class="comment">//递归执行生成器的next</span></span><br><span class="line">    <span class="keyword">const</span> result = generator.next(res)</span><br><span class="line">    <span class="keyword">if</span> (result.done) &#123; <span class="comment">//如果生成器已经执行完了</span></span><br><span class="line">      <span class="keyword">return</span> result.value</span><br><span class="line">    &#125;</span><br><span class="line">    result.value.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123; <span class="comment">//生成器没有执行完，递归调用</span></span><br><span class="line">      exec(res)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  exec()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">execGenerator(getData);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 async/await</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res1 = <span class="keyword">await</span> requestData(<span class="string">&quot;ysj&quot;</span>)</span><br><span class="line">  <span class="keyword">const</span> res2 = <span class="keyword">await</span> requestData(res1 + <span class="string">&quot;aaa&quot;</span>)</span><br><span class="line">  <span class="keyword">const</span> res3 = <span class="keyword">await</span> requestData(res2 + <span class="string">&quot;bbb&quot;</span>)</span><br><span class="line">  <span class="keyword">const</span> res4 = a requestData(res3 + <span class="string">&quot;ccc&quot;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(res4)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="aync-await"><a href="#aync-await" class="headerlink" title="aync/await"></a>aync/await</h3><h4 id="异步函数"><a href="#异步函数" class="headerlink" title="异步函数"></a>异步函数</h4><p>async function，async 关键字用于声明一个异步函数</p><p>异步函数写法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foo2 = <span class="keyword">async</span> () =&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">foo</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>异步函数的内部代码执行过程和普通的函数是一致的，默认情况下也是会被同步执行</p><p>异步函数有返回值时，和普通函数会有区别：</p><ul><li>异步函数返回值会被包裹到 Promise.resolve()中</li><li>如果异步函数的返回值是 Promise，Promise.resolve 的状态会由 Promise 决定</li><li>如果异步函数的返回值是一个对象，并且实现了 thenable，那么会由对象的 then 方法来决定</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// return &quot;aaa&quot;; //返回一个普通值，会被包裹到Promise.resolve中</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// return &#123; //返回一个thenable</span></span><br><span class="line">  <span class="comment">//   then(resolve, reject) &#123;</span></span><br><span class="line">  <span class="comment">//     resolve(&quot;hahahha&quot;);</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//返回yPromise</span></span><br><span class="line">    resolve(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = foo()</span><br><span class="line">promise.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如果在 async 中抛出了异常，程序并不会像普通函数一样报错，而是会作为 Promsie 的 reject 来传递</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;出错了&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo().catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err) <span class="comment">//Error: 出错了</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="await-关键字"><a href="#await-关键字" class="headerlink" title="await 关键字"></a>await 关键字</h4><p>async 函数内部可以使用 await 关键字：</p><ul><li>使用 await 关键字时，后面会跟上一个表达式，这个表达式会返回一个 Promsie</li><li>await 会等到 Promise 的状态变成 fulfilled 状态，之后继续执行异步函数</li><li>若 Promise 没有结果，await 后面的代码都不会执行</li></ul><p>如果 await 后面跟一个普通的值，会直接返回这个值</p><p>如果 await 后面是一个 thenable 对象，那么会根据对象的 then 方法调用来决定后续的值</p><p>如果 await 后面的表达式，返回的 Promise 是 reject 的状态，那么会将这个 reject 的结果直接作为整个 async 函数的 Promise 的 reject 值</p><h3 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h3><h4 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h4><p>进程和线程是操作系统中的两个概念：</p><ul><li>进程(process)：计算机已经运行的程序，是操作系统管理程序的一种方式</li><li>线程(thread)：操作系统能够运行运算调度的最小单位，通常情况下被包含在进程中</li></ul><p>可以认为，启动一个应用程序，就会默认启动一个进程(也可能是多个进程)；每一个进程中，都会启动至少一个线程用来执行程序中的代码，这个线程被称之为主线程，所以也可以说进程是线程的容器</p><p><strong>浏览器中的 JS 线程</strong></p><p>JS 是单线程，但是 JS 的线程应该有自己的容器进程：浏览器或 Node</p><p>JS 代码执行是在一个单独的线程中执行的。JS 代码同一时刻只能做一件事，如果这件事非常耗时，当前线程就会被阻塞</p><p>所以耗时的操作，实际上并不是由 js 线程在执行的，浏览器的每个进程是多线程的，可以由其他线程完成耗时操作</p><h4 id="浏览器的事件循环"><a href="#浏览器的事件循环" class="headerlink" title="浏览器的事件循环"></a>浏览器的事件循环</h4><p>js 是单线程，同一时刻只能处理一个任务。</p><p>阮一峰事件循环：<span class="exturl" data-url="aHR0cHM6Ly93d3cucnVhbnlpZmVuZy5jb20vYmxvZy8yMDE0LzEwL2V2ZW50LWxvb3AuaHRtbA==">https://www.ruanyifeng.com/blog/2014/10/event-loop.html<i class="fa fa-external-link-alt"></i></span></p><p>同步任务:在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务</p><p>异步任务：不进入主线程、而进入”任务队列”（task queue）的任务，只有”任务队列”通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行</p><p><strong>事件循环：</strong>js 主线程遇到耗时操作时，会在浏览器其他线程中做耗时操作，耗时操作完成以后，会将耗时操作的回调函数加入浏览器维护的任务队列中。主线程的任务执行完毕以后，会去任务队列中读取对应的任务，将这些回调函数取出，推入到主线程中执行。整个过程不断重复就称之为事件循环</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20211220220608871.png" alt="image-20211220220608871"></p><h4 id="微任务和宏任务"><a href="#微任务和宏任务" class="headerlink" title="微任务和宏任务"></a>微任务和宏任务</h4><p>一个微任务就是一个简短的函数</p><p>事件循环中维护着两个队列：</p><ul><li>宏任务队列(macrotask queue)：ajax、setTimeout、setInterval、DOM 监听、UI Rendering 等</li><li>微任务队列(microtask queue)：Promise 的 then 回调、Mutation Observer API、queueMicrotask()等都是微任务</li></ul><p>事件循环对于两个队列执行的优先级：</p><ul><li>main script 中的代码优先执行(编写的顶层的 script 代码)</li><li>在执行任何一个宏任务之前，都会先查看微任务队列中是否有任务需要执行<ul><li>宏任务执行之前，必须保证微任务队列是空的</li><li>如果不为空，优先执行微任务队列中的任务(回调)</li></ul></li></ul><h4 id="面试题-1"><a href="#面试题-1" class="headerlink" title="面试题"></a>面试题</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  a = <span class="keyword">await</span> sum() <span class="comment">//await 封装了promise，微任务保存了变量20，不在同步任务赋值</span></span><br><span class="line">  <span class="comment">//sum执行了，返回的20被保存了，然后等于号赋值被推入微任务了</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;1 :&#x27;</span>, a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b()</span><br><span class="line">a++</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;2 : &#x27;</span>, a)</span><br><span class="line"></span><br><span class="line"><span class="comment">//以上等价于这个</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">10</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve(sum())</span><br><span class="line">    p.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;1 :&gt;&gt; &#x27;</span>, res)</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async1()</span><br><span class="line">a++</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;2 :&#x27;</span>, a)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout1&#x27;</span>)</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;then4&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;then2&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise1&#x27;</span>)</span><br><span class="line">  resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;then1&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout2&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">queueMicrotask(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;queueMicrotask1&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;then3&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;22222&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;111111&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> bar()</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;33333&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;444444&#x27;</span>)</span><br><span class="line"><span class="comment">// 遇到foo执行(直接调异步函数，默认异步函数里面的代码不会异步执行，直接按照顺序执行。)</span></span><br><span class="line"><span class="comment">// 打印111</span></span><br><span class="line"><span class="comment">// 遇到await</span></span><br><span class="line"><span class="comment">// 执行bar函数</span></span><br><span class="line"><span class="comment">// 打印222</span></span><br><span class="line"><span class="comment">// 返回了一个Promise，调用的resolve回调，</span></span><br><span class="line"><span class="comment">// await后面的代码等同于在promise的then回调里面</span></span><br><span class="line"><span class="comment">// await后面的代码会被加入到微任务队列</span></span><br><span class="line"><span class="comment">// 此时继续执行main script，打印444</span></span><br><span class="line"><span class="comment">// 执行微任务队列，打印333</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;async1 start&#x27;</span>)</span><br><span class="line">  <span class="keyword">await</span> async2()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;async1 end&#x27;</span>) <span class="comment">//所以await后面的代码相当于在promise的then回调里面，会被加入到微任务队列中</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;async2&#x27;</span>)</span><br><span class="line">  <span class="comment">//没有返回值，等同于 return Promise.resolve(undefined)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;script start&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">async1()</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise1&#x27;</span>)</span><br><span class="line">  resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise2&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;script end&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve()</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// 1.直接return一个值 相当于resolve(4)</span></span><br><span class="line">    <span class="comment">// return 4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.return thenable的值</span></span><br><span class="line">    <span class="comment">//原生promise会将执行then本身向后推迟一个微任务，推到下一次的微任务</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">then</span>: <span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 大量的计算</span></span><br><span class="line">        resolve(<span class="number">4</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.return Promise</span></span><br><span class="line">    <span class="comment">// 不是普通的值, 多加一次微任务</span></span><br><span class="line">    <span class="comment">// Promise.resolve(4), 再多加一次微任务</span></span><br><span class="line">    <span class="comment">// 一共多加两次微任务</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="number">4</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve()</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">5</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">6</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h4 id="Node-事件循环"><a href="#Node-事件循环" class="headerlink" title="Node 事件循环"></a>Node 事件循环</h4><p>事件循环像一个桥梁，是连接着应用程序的 js 和系统调用之间的通道</p><ul><li>无论是文件 IO、数据库、网络 IO、定时器、子进程，在完成对应的操作后，都会将对应的结果和回调函数放到事件循环(任务队列)中</li><li>事件循环会不断的从任务队列中取出对应的事件(回调函数)来执行</li></ul><p>一次完整的事件循环 Tick 分成很多个阶段：</p><ul><li>定时器（Timers）：本阶段执行已经被 setTimeout() 和 setInterval() 的调度回调函数</li><li>待定回调（Pending Callback）：对某些系统操作（如 TCP 错误类型）执行回调，比如 TCP 连接时接收到 ECONNREFUSED</li><li>idle, prepare：仅系统内部使用。</li><li>轮询（Poll）：检索新的 I/O 事件；执行与 I/O 相关的回调</li><li>检测（check）：setImmediate() 回调函数在这里执行</li><li>关闭的回调函数：一些关闭的回调函数，如：socket.on(‘close’, …)</li></ul><p><strong>Node 事件循环阶段：</strong></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20211222214136541.png" alt="image-20211222214136541"></p><p><strong>Node 的微任务和宏任务：</strong></p><ul><li>宏任务（macrotask）：setTimeout、setInterval、IO 事件、setImmediate、close 事件</li><li>微任务（microtask）：Promise 的 then 回调、process.nextTick、queueMicrotask</li></ul><p>微任务队列：</p><ul><li>next tick queue：process.nextTick</li><li>other queue：Promise 的 then 回调、queueMicrotask</li></ul><p>宏任务队列：</p><ul><li>timer queue：setTimeout、setInterval</li><li>poll queue：IO 事件</li><li>check queue：setImmediate</li><li>close queue：close 事件</li></ul><p><strong>Node 事件循环的顺序：</strong></p><ol><li>next tick microtask queue</li><li>other microtask queue</li><li>timer queue</li><li>poll queue</li><li>check queue</li><li>close queue</li></ol><p><strong>Node 执行面试题：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;async1 start&#x27;</span>)</span><br><span class="line">  <span class="keyword">await</span> async2()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;async1 end&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;async2&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;script start&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout0&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;setTimeout2&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">setImmediate(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;setImmediate&#x27;</span>))</span><br><span class="line"></span><br><span class="line">process.nextTick(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;nextTick1&#x27;</span>))</span><br><span class="line"></span><br><span class="line">async1()</span><br><span class="line"></span><br><span class="line">process.nextTick(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;nextTick2&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise1&#x27;</span>)</span><br><span class="line">  resolve()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise2&#x27;</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise3&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;script end&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="错误处理方案"><a href="#错误处理方案" class="headerlink" title="错误处理方案"></a>错误处理方案</h3><h4 id="抛出错误"><a href="#抛出错误" class="headerlink" title="抛出错误"></a>抛出错误</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> num1 !== <span class="string">&#x27;number&#x27;</span> || <span class="keyword">typeof</span> num2 !== <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">&#x27;parameters is error type~&#x27;</span> <span class="comment">//抛出错误信息，终止后面代码的执行</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">sum(&#123; <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span> &#125;, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyError</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">errorCode, errorMessage</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.errorCode = errorCode</span><br><span class="line">    <span class="built_in">this</span>.errorMessage = errorMessage</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">//1.抛出一个字符串类型（基本数据类型都可以抛出）</span></span><br><span class="line">    <span class="comment">//2.抛出一个对象类型</span></span><br><span class="line">    <span class="comment">// throw &#123; errorCode: 1002, errorMessage: &quot;type不能为0&quot; &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.创建一个类，并且创建类对应的对象</span></span><br><span class="line">    <span class="comment">// throw new MyError(1001, &quot;type不能为0&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.抛出js提供的Error类</span></span><br><span class="line">    <span class="comment">// throw new Error(&quot;type不能为0&quot;);</span></span><br><span class="line">    <span class="comment">//此种方法抛出会有函数调用栈信息</span></span><br><span class="line">    <span class="comment">// const err = new Error(&quot;type不能为0&quot;);</span></span><br><span class="line">    <span class="comment">// console.log(err.message); //错误信息</span></span><br><span class="line">    <span class="comment">// console.log(err.stack); //调用栈</span></span><br><span class="line">    <span class="comment">// console.log(err.name);  //</span></span><br><span class="line">    <span class="comment">// throw err;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.Error的子类</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;遇到类型错误时抛出这种&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>Error 的三个属性：</p><ul><li>message：创建 Error 对象时传入的 message</li><li>name：Error 的名称，通常和类的名称一致</li><li>stack：整个 Error 的错误信息，包括函数的调用栈</li></ul><p>Error 的子类：</p><ul><li>RangeError：下标越界时使用的错误类型</li><li>SyntaxError：解析语法错误时使用的错误类型</li><li>TypeError：出现类型错误时，使用的错误类型</li></ul><p>如果函数中已经抛出了异常，那么后续的代码都不会继续执行了</p><h4 id="异常捕获"><a href="#异常捕获" class="headerlink" title="异常捕获"></a>异常捕获</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;错误&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  foo()</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error) <span class="comment">//打印异常信息</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;不论是否发生异常都会执行finally的代码&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">  <span class="comment">//如果用不到 (error) ,可以省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><h4 id="commonJS"><a href="#commonJS" class="headerlink" title="commonJS"></a>commonJS</h4><p>commonJS 是一个规范，简称 CJS，Node 是 CommonJS 在服务器端一个具有代表性的实现</p><ul><li>在 Node 中每一个 js 文件都是一个单独的模块</li><li>这个模块中包括 CommonJS 规范的核心变量：exports、module.exports、require</li></ul><p>模块的核心和导入和导出，Node 对其进行了实现：</p><ul><li>exports 和 module.exports 可以负责对模块中的内容进行导出</li><li>require 函数可以导入其他模块(自定义模块、系统模块、第三方库的模块)中的内容</li></ul><h5 id="基本使用-1"><a href="#基本使用-1" class="headerlink" title="基本使用"></a><strong>基本使用</strong></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.js</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;ysj&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">//导出一个对象</span></span><br><span class="line">  name,</span><br><span class="line">  foo,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//module.exports.name = name;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; name, foo &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./main.js&#x27;</span>) <span class="comment">//导入时解构main.js导出的对象，导入和导出的是同一个地址</span></span><br><span class="line"><span class="built_in">console</span>.log(name, foo)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;ysj&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//源码</span></span><br><span class="line"><span class="comment">// module.exports = &#123;&#125;;</span></span><br><span class="line"><span class="comment">// exports = module.exports;</span></span><br><span class="line"><span class="comment">//最终导出的是module.exports = &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//另一种导出写法</span></span><br><span class="line"><span class="built_in">exports</span>.name = name</span><br><span class="line"></span><br><span class="line"><span class="comment">//给exports重新赋值了一个对象，导致不再指向module.exports，exports对象的属性不会被导出</span></span><br><span class="line"><span class="built_in">exports</span> = &#123; name, age &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//给module.exports重新赋值为一个空对象，不再指向之前的对象，所以之前对象的属性不会被导出</span></span><br><span class="line"><span class="built_in">exports</span>.name = name <span class="comment">//之前的对象</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;&#125;</span><br></pre></td></tr></table></figure><h5 id="require"><a href="#require" class="headerlink" title="require"></a>require</h5><p>require 是一个函数，可以引入一个文件或模块中导出的对象</p><p>require 查找规则：<span class="exturl" data-url="aHR0cHM6Ly9ub2RlanMub3JnL2Rpc3QvbGF0ZXN0LXYxNC54L2RvY3MvYXBpL21vZHVsZXMuaHRtbA==">https://nodejs.org/dist/latest-v14.x/docs/api/modules.html<i class="fa fa-external-link-alt"></i></span></p><p>require 常见查找规则(导入格式如下：require(x) ):</p><ul><li><p>x 是一个核心模块，比如 path、http</p><ul><li>直接返回核心模块，并且停止查找</li></ul></li><li><p>X 是以 ./ 或 ../ 或 /（根目录）开头的</p><ol><li>将 X 当做一个文件在对应的目录下查找<ul><li>如果有后缀名，按照后缀名的格式查找对应的文件</li><li>如果没有后缀名，会按照如下顺序：<ul><li>直接查找文件 X</li><li>查找 X.js 文件</li><li>查找 X.json 文件</li><li>查找 X.node 文件</li></ul></li></ul></li><li>没有找到对应的文件，将 X 作为一个目录<ul><li>查找目录下面的 index 文件（查找 X/index.js 文件 &gt; 查找 X/index.json 文件 &gt; 查找 X/index.node 文件）</li></ul></li><li>如果没有找到，那么报错：not found</li></ol></li><li><p>直接是一个 X（不是路径），并且 X 不是一个核心模块</p><ul><li>会在每一层目录里面的 node_modules 里查找第三方模块(可打印 module.paths 查看路径)</li><li>如果找到根目录也没找到，报错 not found</li></ul></li></ul><h5 id="模块的加载过程"><a href="#模块的加载过程" class="headerlink" title="模块的加载过程"></a>模块的加载过程</h5><ul><li><input disabled type="checkbox"> 模块在被第一次引入时，模块中的 js 代码会被运行一次</li><li><input disabled type="checkbox"> 模块被多次引入时，会缓存，最终只加载（运行）一次<ul><li><input disabled type="checkbox"> 是因为每个模块对象 module 都有一个属性：loaded，为 false 表示还没有加载，为 true 表示已经加载；</li></ul></li><li><input disabled type="checkbox"> 如果有循环引入，node 采用深度优先算法加载</li></ul><h4 id="ES-Module"><a href="#ES-Module" class="headerlink" title="ES Module"></a>ES Module</h4><p>ES Module 模块采用 export 和 import 关键字来实现模块化</p><ul><li><input disabled type="checkbox"> export 负责将模块内的内容导出</li><li><input disabled type="checkbox"> import 负责从其他模块导入内容</li><li><input disabled type="checkbox"> ES Module 将自动采用严格模式(<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvU3RyaWN0X21vZGU=">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode<i class="fa fa-external-link-alt"></i></span>)</li></ul><h5 id="导入导出"><a href="#导入导出" class="headerlink" title="导入导出"></a>导入导出</h5><p><strong>导出</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导出方式1：声明前面加关键字export:export 声明语句</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="string">&#x27;ysj&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> age = <span class="number">18</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出方式2：export导出和声明分开</span></span><br><span class="line"><span class="keyword">const</span> height = <span class="number">1.88</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="comment">//是一个大括号，不是一个对象,不能写键值对</span></span><br><span class="line">  height, <span class="comment">//此处放要导出的标识符的列表</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出方式3：导出时起别名</span></span><br><span class="line"><span class="keyword">const</span> num = <span class="number">1</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  num <span class="keyword">as</span> num1, <span class="comment">//将num取别名为num1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>导入</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入方式1：普通导入</span></span><br><span class="line"><span class="keyword">import</span> &#123; name, age &#125; <span class="keyword">from</span> <span class="string">&#x27;./foo.js&#x27;</span></span><br><span class="line"><span class="comment">//导入方式2：导入时取别名</span></span><br><span class="line"><span class="keyword">import</span> &#123; height <span class="keyword">as</span> myHeight &#125; <span class="keyword">from</span> <span class="string">&#x27;./foo.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//导入方式3：将导入的所有内容放到一个标识符中</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> foo <span class="keyword">from</span> <span class="string">&#x27;./foo.js&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(name, age, myHeight, foo.name)</span><br><span class="line"><span class="comment">//import导入方式会阻塞后面代码的执行,导入完成后才会执行import后面代码</span></span><br></pre></td></tr></table></figure><p><strong>结合使用</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//统一出口</span></span><br><span class="line"><span class="comment">//导出方式1</span></span><br><span class="line"><span class="keyword">import</span> &#123; priceFormat, timeFormat &#125; <span class="keyword">from</span> <span class="string">&#x27;./format.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; add, sub &#125; <span class="keyword">from</span> <span class="string">&#x27;./math.js&#x27;</span></span><br><span class="line"><span class="keyword">export</span> &#123; priceFormat, timeFormat, add, sub &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出方式2</span></span><br><span class="line"><span class="keyword">export</span> &#123; priceFormat, timeFormat &#125; <span class="keyword">from</span> <span class="string">&#x27;./format.js&#x27;</span></span><br><span class="line"><span class="keyword">export</span> &#123; add, sub &#125; <span class="keyword">from</span> <span class="string">&#x27;./math.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//导出方式3</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./format.js&#x27;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./math.js&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>默认导出</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;ysj&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">const</span> foo = <span class="string">&quot;fsd fg&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  name,</span><br><span class="line">  age,</span><br><span class="line">  foo <span class="keyword">as</span> <span class="keyword">default</span>, <span class="comment">//将foo作为默认导出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> foo; <span class="comment">//默认导出方式2</span></span><br><span class="line"><span class="comment">//注：默认导出只能有一个</span></span><br></pre></td></tr></table></figure><h5 id="import-函数"><a href="#import-函数" class="headerlink" title="import 函数"></a>import 函数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//import函数返回的结果是一个Promise</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">&#x27;./aaa.js&#x27;</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//异步导出，不会阻塞后面代码的执行</span></span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//ES11新增特性,import作为一个对象</span></span><br><span class="line"><span class="comment">//meta属性本身是一个对象： &#123;url: &quot;当前模块所在的路径&quot;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">import</span>.meta)</span><br></pre></td></tr></table></figure><h5 id="ES-Module-解析流程"><a href="#ES-Module-解析流程" class="headerlink" title="ES Module 解析流程"></a>ES Module 解析流程</h5><p>ESModule 解析过程可以划分为三个阶段：</p><ol><li>构建(Construction),根据地址查找 js 文件，并且下载，将其解析成模块记录(Module Record)</li><li>实例化(Instantiation),对模块记录进行实例化，并且分配内存空间，解析模块的导入和导出语句，把模块指向对应的内存地址</li><li>运行(Evaluation),运行代码，计算值，并且将值填充到内存地址中</li></ol><p>Webpack 环境下，ESModule 和 commonJS 可以任意相互引用</p><h3 id="包管理工具"><a href="#包管理工具" class="headerlink" title="包管理工具"></a>包管理工具</h3><p>npm(node package manager):Node 包管理器</p><p>npm 属于 node 的一个管理工具，所以需要先安装<span class="exturl" data-url="aHR0cHM6Ly9ub2RlanMub3JnL3poLWNuLw==">node<i class="fa fa-external-link-alt"></i></span></p><p>node 管理的包的查看网址：<span class="exturl" data-url="aHR0cHM6Ly93d3cubnBtanMuY29tLw==">https://www.npmjs.com/<i class="fa fa-external-link-alt"></i></span></p><h4 id="npm-配置文件"><a href="#npm-配置文件" class="headerlink" title="npm 配置文件"></a>npm 配置文件</h4><p>每个项目都有一个对应的配置文件 package.json，记录着项目的名称、版本号、项目描述、依赖库的信息和版本号</p><p>获取 pack 个.json:</p><ul><li>手动从零创建项目，npm init -y(创建时所有信息使用默认的)</li><li>通过脚手架创建项目，生成 package.json,里面由相关的配置</li></ul><p><strong>常见属性：</strong></p><ul><li><p>name 是项目的名称(必填属性)</p></li><li><p>version 是当前项目的版本号(必填属性)</p></li><li><p>description 是描述信息，很多时候是作为项目的基本描述</p></li><li><p>author 是作者相关信息（发布时用到）</p></li><li><p>license 是开源协议（发布时用到)</p></li><li><p>private 属性记录当前的项目是否是私有的</p><ul><li>当值为 true 时，npm 是不能发布它的，这是防止私有项目或模块发布出去的方式</li></ul></li><li><p>main 属性，设置程序的入口</p><ul><li>你发布一个模块的时候会用到</li></ul></li><li><p>scripts 属性用于配置一些脚本命令，以键值对的形式存在</p><ul><li>配置后我们可以通过 npm run 命令的 key 来执行这个命令</li><li>npm start 和 npm run start 是等价的</li><li>对于常用的 start、 test、stop、restart 可以省略掉 run 直接通过 npm start 等方式运行</li></ul></li><li><p>dependencies 属性指定无论开发环节还是生产环节都需要依赖的包</p><ul><li>通常是项目实际开发用到的一些库模块 vue、axios 等</li></ul></li><li><p>devDependencies</p><ul><li>一些包在生产环境是不需要的，比如 webpack、babel 等</li><li>可以通过 npm install webpack –save-dev，将它安装到 devDependencies 属性中</li></ul></li><li><p>peerDependencies 属性</p><ul><li>还有一种项目依赖关系是对等依赖，也就是你依赖的一个包，它必须是以另外一个宿主包为前提的</li><li>比如 element-plus 是依赖于 vue3 的，ant design 是依赖于 react、react-dom</li></ul></li></ul><h4 id="依赖的版本管理"><a href="#依赖的版本管理" class="headerlink" title="依赖的版本管理"></a><strong>依赖的版本管理</strong></h4><p>npm 的包通常需要遵从 semver 版本规范：</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9zZW12ZXIub3JnL2xhbmcvemgtQ04v">semver<i class="fa fa-external-link-alt"></i></span>版本规范是 X.Y.Z<ul><li>X 主版本号（major）：当你做了不兼容的 API 修改（可能不兼容之前的版本）</li><li>Y 次版本号（minor）：当你做了向下兼容的功能性新增（新功能增加，但是兼容之前的版本）</li><li>Z 修订号（patch）：当你做了向下兼容的问题修正（没有新功能，修复了之前版本的 bug）</li></ul></li><li>npm semver：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm5wbWpzLmNvbS9taXNjL3NlbXZlcg==">https://docs.npmjs.com/misc/semver<i class="fa fa-external-link-alt"></i></span></li></ul><p>^和~的区别：</p><ul><li>^x.y.z：表示 x 是保持不变的，y 和 z 永远安装最新的版本</li><li>~x.y.z：表示 x 和 y 保持不变的，z 永远安装最新的版本</li></ul><p><strong>常见属性：</strong></p><ul><li>engines 属性用于指定 Node 和 NPM 的版本号<ul><li>在安装的过程中，会先检查对应的引擎版本，如果不符合就会报错</li><li>上也可以指定所在的操作系统 “os” : [ “darwin”, “linux” ]</li></ul></li><li>browserslist 属性用于配置打包后的 JavaScript 浏览器的兼容情况，参考<ul><li>否则我们需要手动的添加 polyfills 来让支持某些语法</li><li>它是为 webpack 等打包工具服务的一个属性</li></ul></li></ul><h4 id="npm-install-命令"><a href="#npm-install-命令" class="headerlink" title="npm install 命令"></a>npm install 命令</h4><p>安装 npm 包分两种情况：</p><ul><li><p>全局安装（global install）： npm install webpack -g</p><ul><li>直接将某个包安装到全局</li><li>比如 yarn 的全局安装：npm install yarn -g</li><li>通常使用 npm 全局安装的包都是一些工具包：yarn、webpack 等</li><li>并不是类似于 axios、express、koa 等库文件</li></ul></li><li><p>项目（局部）安装（local install）： npm install webpack</p><ul><li>局部安装分为开发时依赖和生产时依赖</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装开发和生产依赖</span></span><br><span class="line">npm install axios</span><br><span class="line">npm i axios</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开发时依赖</span></span><br><span class="line">npm install webpack --save-dev</span><br><span class="line">npm install webpack -D</span><br><span class="line">npm i webpack –D</span><br><span class="line"><span class="meta">#</span><span class="bash"> 根据package.json中的依赖包</span></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure></li></ul><p>项目安装会在当前目录下生产一个 node_modules 文件夹</p><h4 id="npm-install-原理"><a href="#npm-install-原理" class="headerlink" title="npm install 原理"></a>npm install 原理</h4><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20211227214147478.png" alt="image-20211227214147478"></p><p>npm install 会检测有没有 package-lock.json 文件:</p><ul><li>没有 lock 文件<ul><li>分析依赖关系，这是因为我们可能包会依赖其他的包，并且多个包之间会产生相同依赖的情况</li><li>从 registry 仓库中下载压缩包（如果我们设置了镜像，那么会从镜像服务器下载压缩包）</li><li>获取到压缩包后会对压缩包进行缓存（从 npm5 开始有的）</li><li>将压缩包解压到项目的 node_modules 文件夹中</li></ul></li><li>有 lock 文件<ul><li>检测 lock 中包的版本是否和 package.json 中一致（会按照 semver 版本规范检测）<ul><li>不一致，那么会重新构建依赖关系，直接会走顶层的流程</li><li>一致的情况下，会去优先查找缓存<ul><li>没有找到，会从 registry 仓库下载，直接走顶层流程</li><li>查找到，会获取缓存中的压缩文件，并且将压缩文件解压到 node_modules 文件夹中</li></ul></li></ul></li></ul></li></ul><h4 id="package-lock-json"><a href="#package-lock-json" class="headerlink" title="package-lock.json"></a>package-lock.json</h4><p>记录真实的版本号</p><ul><li>name：项目的名称</li><li>version：项目的版本</li><li>lockfileVersion：lock 文件的版本</li><li>requires：使用 requires 来跟踪模块的依赖关系</li><li>dependencies：项目的依赖<ul><li>如当前项目依赖 axios，但是 axios 依赖 follow-redireacts</li><li>axios 中的属性如下<ul><li>version 表示实际安装的 axios 的版本</li><li>resolved 用来记录下载的地址，registry 仓库中的位置</li><li>requires 记录当前模块的依赖</li><li>integrity 用来从缓存中获取索引，再通过索引去获取压缩包文件</li></ul></li></ul></li></ul><h4 id="npm-其它命令"><a href="#npm-其它命令" class="headerlink" title="npm 其它命令"></a>npm 其它命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 卸载某个依赖包</span></span><br><span class="line">npm uninstall package</span><br><span class="line">npm uninstall package --save-dev</span><br><span class="line">npm uninstall package -D</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 强制重新build,安装过的依赖重新安装</span></span><br><span class="line">npm rebuild</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">清除缓存</span></span><br><span class="line">npm cache clean</span><br></pre></td></tr></table></figure><p>更多命令：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm5wbWpzLmNvbS9jbGkvdjgvY29tbWFuZHMv">https://docs.npmjs.com/cli/v8/commands/<i class="fa fa-external-link-alt"></i></span></p><h4 id="yarn-工具"><a href="#yarn-工具" class="headerlink" title="yarn 工具"></a>yarn 工具</h4><p>node 包管理工具 yarn，是由 Facebook、Google、Exponent 和 Tilde 联合推出的一个新的 JS 包管理工具</p><p>使用 yarn 初始化项目：yarn init</p><p>yarn 是为了弥补 npm 的一些缺陷而出现的</p><table><thead><tr><th>npm</th><th>yarn</th></tr></thead><tbody><tr><td>npm install</td><td>yarn install</td></tr><tr><td>npm install [package]</td><td>yarn add [package]</td></tr><tr><td>npm install –save [package]</td><td>yarn add [package]</td></tr><tr><td>npm install –save-dev [package]</td><td>yarn add [package] [–dev/-D]</td></tr><tr><td>npm rebuild</td><td>yarn install –force</td></tr><tr><td>npm uninstall [package]</td><td>yarn remove [package]</td></tr><tr><td>npm uninstall –save [package]</td><td>yarn remove [package]</td></tr><tr><td>npm uninstall –save-dev [package]</td><td>yarn remove [package]</td></tr><tr><td>npm uninstall –save-optional [package]</td><td>yarn remove [package]</td></tr><tr><td>npm cache clean</td><td>yarn cache clean</td></tr><tr><td>rm -rf node_modules &amp;&amp; npm install</td><td>yarn upgrade</td></tr></tbody></table><h4 id="cnpm"><a href="#cnpm" class="headerlink" title="cnpm"></a>cnpm</h4><p>查看 npm 镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure><p>直接设置 npm 的镜像(不推荐)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><p>如果不希望修改 npm 镜像，可以使用 cnpm，并且将 cnpm 设置为淘宝的镜像：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">cnpm config get registry # https://r.npm.taobao.org/</span><br></pre></td></tr></table></figure><h4 id="npx-工具"><a href="#npx-工具" class="headerlink" title="npx 工具"></a>npx 工具</h4><p>npx 是 npm5.2 之后自带的一个命令，常用它来调用项目中的某个模块的指令：</p><p>以 webpack 为例，全局安装的是 webpack5.1.3，项目安装的是 webpack3.6.0，如果在终端执行 webpack –version，示结果会是 webpack 5.1.3，事实上使用的是全局的，因为在当前目录下找不到 webpack 时，就会去全局找，并且执行命令；</p><p><strong>执行局部命令：</strong>(三种方法)</p><ol><li><p>在终端中使用如下命令（在项目根目录下）</p><ul><li>./node_modules/.bin/webpack –version</li></ul></li><li><p>修改 package.json 中的 scripts</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">	<span class="attr">&quot;webpack&quot;</span>: <span class="string">&quot;webpack --version&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// npm run webpack</span></span><br></pre></td></tr></table></figure></li><li><p>使用 npx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx webpack --version</span><br><span class="line"><span class="meta">#</span><span class="bash">  npx会到当前目录的node_modules/.bin目录下查找对应的命令</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="npm-发布自己的包"><a href="#npm-发布自己的包" class="headerlink" title="npm 发布自己的包"></a>npm 发布自己的包</h4><ul><li>注册 npm 账号，<span class="exturl" data-url="aHR0cHM6Ly93d3cubnBtanMuY29tLyVFRiVCQyU4QyVFOSU4MCU4OSVFNiU4QiVBOXNpZ24=">https://www.npmjs.com/，选择sign<i class="fa fa-external-link-alt"></i></span> up</li><li>在命令行登录:npm login</li><li>修改 package.json</li><li>发布到 npm registry 上:npm publish</li><li>更新仓库：<ul><li>修改 package.json 里面的版本号(最好符合 semver 规范)</li><li>重新发布</li></ul></li><li>删除发布的包:npm unpublish</li><li>让发布的包过期:npm deprecate</li></ul><h3 id="JSON-和数据存储"><a href="#JSON-和数据存储" class="headerlink" title="JSON 和数据存储"></a>JSON 和数据存储</h3><h4 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h4><p>JSON(JavaScript Object Notation，JavaScript 对象符号),一种数据格式，可以在服务器端和客户端进行传输</p><p>使用场景：</p><ul><li>网络数据的传输 JSON 数据</li><li>项目的某些配置文件</li><li>非关系型数据库(NoSQL)将 json 作为存储格式</li></ul><p>JSON 的顶层支持三种类型的值：</p><ul><li>简单值：数字、字符串(不支持单引号)、布尔类型、null 类型</li><li>对象值：由 key、value 组成，key 是字符串类型，必须添加双引号，值可以为简单值、对象值、数组值</li><li>数组值：数组的值可以是简单值、对象值、数组值</li></ul><h5 id="JSON-序列化和解析"><a href="#JSON-序列化和解析" class="headerlink" title="JSON 序列化和解析"></a><strong>JSON 序列化和解析</strong></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonString = <span class="built_in">JSON</span>.stringify(obj) <span class="comment">//将对象转为json格式字符串</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="built_in">JSON</span>.parse(jsonString) <span class="comment">//将JSON格式字符串转回对象</span></span><br></pre></td></tr></table></figure><p><strong>序列化方法 stringify 细节</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">	<span class="attr">name</span>: <span class="string">&quot;ysj&quot;</span>m</span><br><span class="line">	<span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">	<span class="attr">friends</span>: &#123;</span><br><span class="line">		<span class="attr">name</span>: <span class="string">&quot;kobe&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">hobbies</span>: [<span class="string">&quot;唱&quot;</span>, <span class="string">&quot;跳&quot;</span>, <span class="string">&quot;rap&quot;</span>],</span><br><span class="line">  <span class="attr">toJSON</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;dddd&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//JSON.stringify第二个参数replacer</span></span><br><span class="line"><span class="comment">//1.设定哪些需要转换,放入对应的key</span></span><br><span class="line"><span class="keyword">const</span> jsonString1 = <span class="built_in">JSON</span>.stringify(obj, [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;friends&quot;</span>]); <span class="comment">//转化的时候只保留name和friends属性，舍弃其他属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.传入回调函数</span></span><br><span class="line"><span class="keyword">const</span> jsonStringify = <span class="built_in">JSON</span>.stringify(obj, <span class="function">(<span class="params">key, value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//转化每个属性的时候，会回调这个函数</span></span><br><span class="line">  <span class="keyword">if</span>(key === <span class="string">&quot;age&quot;</span>) &#123; <span class="comment">//转化时将年龄加1</span></span><br><span class="line">     <span class="keyword">return</span> value + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> value; <span class="comment">//其它属性不变</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//JSON.stringify第三个参数 space(控制转化之后的缩进)</span></span><br><span class="line"><span class="keyword">const</span> jsonStringify4 = <span class="built_in">JSON</span>.stringify(obj, <span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">//写数字时，转化每个键值对时都会换行并以2个空格进行缩进，写字符串时，以字符串进行缩进</span></span><br><span class="line"><span class="comment">//不再是一行字符串，增进可读性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果obj中有toJSON方法，就会以toJSON方法的返回值作为转化的结果</span></span><br><span class="line"><span class="built_in">console</span>.log(jsonStringify4); <span class="comment">// dddd</span></span><br></pre></td></tr></table></figure><p><strong>JSON 字符串解析 parse 细节</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> JSONString = <span class="string">&#x27;&#123;&quot;name&quot;: &quot;ysj&quot;, &quot;age&quot;:18, &quot;hobbies&quot;:[&quot;唱&quot;, &quot;跳&quot;, &quot;rap&quot;]&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">//JSON.parse第二个参数</span></span><br><span class="line"><span class="keyword">const</span> info = <span class="built_in">JSON</span>.parse(JSONString, <span class="function">(<span class="params">key, value</span>) =&gt;</span> &#123; <span class="comment">//解析时的拦截</span></span><br><span class="line">  <span class="keyword">if</span>(key === <span class="string">&quot;age&quot;</span>) <span class="keyword">return</span> value - <span class="number">1</span>；</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="利用-json-的序列化和解析做深拷贝"><a href="#利用-json-的序列化和解析做深拷贝" class="headerlink" title="利用 json 的序列化和解析做深拷贝"></a><strong>利用 json 的序列化和解析做深拷贝</strong></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;ysj&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">friends</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;kobe&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">hobbies</span>: [<span class="string">&#x27;唱&#x27;</span>, <span class="string">&#x27;跳&#x27;</span>, <span class="string">&#x27;rap&#x27;</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//展开运算符或Object.assign实现浅拷贝</span></span><br><span class="line"><span class="comment">//浅拷贝：第一层为引用类型时，赋值后依然使用的是原来的地址</span></span><br><span class="line"><span class="keyword">const</span> info1 = <span class="built_in">Object</span>.assign(obj)</span><br><span class="line"><span class="keyword">const</span> info2 = &#123; ...obj &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//stringify和parse实现深拷贝</span></span><br><span class="line"><span class="keyword">const</span> jsonString = <span class="built_in">JSON</span>.stringify(obj)</span><br><span class="line"><span class="keyword">const</span> info3 = <span class="built_in">JSON</span>.parse(jsonString)</span><br><span class="line"><span class="comment">//但是json里面有函数时，转化之后的结果不会包含函数，因为json数据格式不支持函数</span></span><br><span class="line"><span class="comment">//当Symbol作为键或者值的时候不会处理，也就无法拷贝</span></span><br><span class="line"><span class="comment">//无法拷贝循环引用(对象里面有个属性指向对象自己)</span></span><br></pre></td></tr></table></figure><h4 id="浏览器存储"><a href="#浏览器存储" class="headerlink" title="浏览器存储"></a>浏览器存储</h4><h5 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h5><p>WebStorage 提供了一种机制，可以让浏览器提供一种比 cookie 更直观的 key、value 存储方式：</p><ul><li>localStorage：本地存储，一种永久性的存储方法，在关闭网页重新打开后，存储的内容依然保留</li><li>sessionStorage：会话存储，提供的是本次会话存储，关闭调会话时，存储的内容会被清除</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">sessionStorage.setItem(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>) <span class="comment">//浏览器中一个标签可以看成一个会话</span></span><br></pre></td></tr></table></figure><p><strong>常见属性和方法</strong></p><p>Storage.length，只读属性：</p><ul><li>返回一个整数，表示存储在 Storage 对象中的数据项数量</li></ul><p>方法:</p><ul><li>Storage.key(),接受一个数值 n 作为参数，返回存储中的第 n 个 key 名称</li><li>Storage.getItem()，接受一个 key 作为参数，并且返回 key 对应的 value</li><li>Storage.setItem()，接受一个 key 和 value，并且会把 key 和 value 添加到存储中，如果 key 已存在，则更新其 value</li><li>Storage.removeItem()，接受一个 key 作为参数，并把该 key 从存储中删除</li><li>Storage.clear()，清空存储中的所有 key</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">localStorage</span>.length) <span class="comment">//打印localStorage的长度</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">localStorage</span>.length; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="built_in">localStorage</span>.key(i)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">localStorage</span>.getItem(key))</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line"><span class="built_in">localStorage</span>.key(<span class="number">0</span>) <span class="comment">//拿到第一个索引对应的key</span></span><br><span class="line"><span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="built_in">localStorage</span>.removeItem(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="built_in">localStorage</span>.clear()</span><br><span class="line"><span class="comment">//sessionStorage也有以上方法和属性</span></span><br></pre></td></tr></table></figure><p>封装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cache</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">isLocal = <span class="literal">true</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.storage = isLocal ? <span class="built_in">localStorage</span> : sessionStorage</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setItem</span>(<span class="params">key, value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (value) <span class="built_in">this</span>.storage.setItem(key, <span class="built_in">JSON</span>.stringify(value))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getItem</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="built_in">this</span>.storage.getItem(key)</span><br><span class="line">    <span class="keyword">if</span> (value) value = <span class="built_in">JSON</span>.parse(value)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">removeItem</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.storage.removeItem(key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">clear</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.storage.clear()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">key</span>(<span class="params">index</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.storage.key(index)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">length</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.storage.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> localCache = <span class="keyword">new</span> Cache()</span><br><span class="line"><span class="keyword">const</span> sessionCache = <span class="keyword">new</span> Cache(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; localCache, sessionCache &#125;</span><br></pre></td></tr></table></figure><h5 id="IndexedDB"><a href="#IndexedDB" class="headerlink" title="IndexedDB"></a>IndexedDB</h5><p>一种数据库(Database)，通常在服务器端比较常见。如果有大量数据需要存储，可以选择 IndexedDB</p><p>IndexedDB 是一种底层的 API，用于在客户端存储大量的数据化结构</p><ul><li>是一种事务型数据库系统，一种基于 JS 面向对象数据库，类似 NoSQL(非关系型数据库)</li><li>本身基于事务，只需要指定数据库模式，打开与数据库的连接，然后检索和更行一系列事务即可</li></ul><p>事务：对数据库进行操作的时候的一个操作单元</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//打开数据库(和数据库建立连接)</span></span><br><span class="line"><span class="keyword">const</span> dbRequest = indexedDB.open(<span class="string">&#x27;ysj&#x27;</span>) <span class="comment">//参数一：数据库名称  参数二：数据库版本  存在就打开，不存在就创建</span></span><br><span class="line"></span><br><span class="line">dbRequest.onerror = <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//数据库打开失败的回调函数</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;数据库打开失败&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> db = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">dbRequest.onsuccess = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//数据库打开成功时的回调</span></span><br><span class="line">  db = event.target.result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dbRequest.onupgradeneeded = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//第一次打开或版本更新时的回调</span></span><br><span class="line">  <span class="keyword">const</span> db = event.target.result</span><br><span class="line"></span><br><span class="line">  <span class="comment">//创建一些存储对象(类似于数据库的表),使用id作为主键</span></span><br><span class="line">  db.createObjectStore(<span class="string">&#x27;users&#x27;</span>, &#123; <span class="attr">keyPath</span>: <span class="string">&#x27;id&#x27;</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">id, name, age</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="built_in">this</span>.age = age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = [</span><br><span class="line">  <span class="keyword">new</span> User(<span class="number">1</span>, <span class="string">&#x27;ysj1&#x27;</span>, <span class="number">18</span>),</span><br><span class="line">  <span class="keyword">new</span> User(<span class="number">2</span>, <span class="string">&#x27;ysj2&#x27;</span>, <span class="number">19</span>),</span><br><span class="line">  <span class="keyword">new</span> User(<span class="number">3</span>, <span class="string">&#x27;ysj3&#x27;</span>, <span class="number">20</span>),</span><br><span class="line">  <span class="keyword">new</span> User(<span class="number">4</span>, <span class="string">&#x27;ysj4&#x27;</span>, <span class="number">21</span>),</span><br><span class="line">  <span class="keyword">new</span> User(<span class="number">5</span>, <span class="string">&#x27;ysj5&#x27;</span>, <span class="number">22</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取btns，监听点击</span></span><br><span class="line"><span class="keyword">const</span> btns = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; btns.length; i++) &#123;</span><br><span class="line">  btns[i].onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> transaction = db.transaction(<span class="string">&#x27;users&#x27;</span>, <span class="string">&#x27;readwrite&#x27;</span>) <span class="comment">//表名  操作模式</span></span><br><span class="line">    <span class="keyword">const</span> store = transaction.objectStore(<span class="string">&#x27;users&#x27;</span>) <span class="comment">//获取存储对象</span></span><br><span class="line">    <span class="keyword">switch</span> (i) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> user <span class="keyword">of</span> users) &#123;</span><br><span class="line">          <span class="keyword">const</span> request = store.add(user)</span><br><span class="line">          request.onsuccess = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//监听每一次是否插入成功</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;user.name&#125;</span>插入成功`</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.oncomplete = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;本次添加操作全部完成&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment">//查询方法1(知道主键，根据主键查询)</span></span><br><span class="line">        <span class="comment">// const request1 = store.get(1);</span></span><br><span class="line">        <span class="comment">// request1.onsuccess = event =&gt; &#123;</span></span><br><span class="line">        <span class="comment">//   console.log(event.target.result);</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">//查询方式二：</span></span><br><span class="line">        <span class="keyword">const</span> request = store.openCursor() <span class="comment">//打开一个游标</span></span><br><span class="line">        request.onsuccess = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> cursor = event.target.result</span><br><span class="line">          <span class="keyword">if</span> (cursor) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(cursor.key, cursor.value)</span><br><span class="line">            cursor.continue() <span class="comment">//继续查询</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;查询完成&#x27;</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">const</span> deleteRequest = store.openCursor() <span class="comment">//打开一个游标</span></span><br><span class="line">        deleteRequest.onsuccess = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> cursor = event.target.result</span><br><span class="line">          <span class="keyword">if</span> (cursor) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cursor.key === <span class="number">2</span>) &#123;</span><br><span class="line">              <span class="keyword">const</span> value = cursor.value</span><br><span class="line">              value.name = <span class="string">&#x27;yyy&#x27;</span></span><br><span class="line">              cursor.update(value)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              cursor.continue()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">const</span> updateRequest = store.openCursor() <span class="comment">//打开一个游标</span></span><br><span class="line">        updateRequest.onsuccess = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> cursor = event.target.result</span><br><span class="line">          <span class="keyword">if</span> (cursor) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cursor.key === <span class="number">2</span>) &#123;</span><br><span class="line">              cursor.delete()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              cursor.continue()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h5><p>Cookie,类型为小型文本文件，某些网站为了辨别用户身份而存储在用户本地终端(Client Side)上的数据</p><p>浏览器会在特定情况下携带上 cookie 来发送请求，我们可以通过 cookie 来获取一些信息</p><p>cookie 保存在客户端中，按在客户端中的存储位置，Cookie 可以分为内存 Cookie 和硬盘 Cookie</p><ul><li>内存 Cookie 由浏览器维护，保护在内存中，浏览器关闭时内存就会消失，其存在时间是短暂的<ul><li>没有设置过期时间的 Cookie==默认==是内存 Cookie，关闭浏览器时会自动删除</li></ul></li><li>硬盘 Cookie 保存在硬盘中，有过期时间，用户手动清理或过期时间到时，才会被清理<ul><li>有设置过期时间，并且过期时间不为 0 或者负数的 Cookie，是硬盘 Cookie，需要手动或者到期时，才会删除</li></ul></li></ul><p><strong>cookie 常见属性：</strong></p><ul><li>可以通过设置 expires 或者 max-age 来设置过期的时间<ul><li>expires：设置的是 Date.toUTCString()，设置格式是;expires=date-in-GMTString-format</li><li>max-age：设置过期的秒钟，;max-age=max-age-in-seconds (例如一年为 60*60*24*365)</li></ul></li><li>cookie 作用域：允许 cookie 发送给哪些 URL<ul><li>Domain：指定哪些主机可以接受 cookie<ul><li>如果不指定，那么默认是 origin，不包括子域名</li><li>如果指定 Domain，则包含子域名。例如，如果设置 Domain=mozilla.org，则 Cookie 也包含在子域名中（如 developer.mozilla.org）</li></ul></li><li>Path：指定主机下哪些路径可以接受 cookie<ul><li>设置 Path=/docs，则以下地址都会匹配</li><li>/docs</li><li>/docs/Web/</li><li>/docs/Web/HTTP</li></ul></li></ul></li></ul><p><strong>客户端设置 cookie</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//js直接获取和是指cookie</span></span><br><span class="line">consoloe.log(<span class="built_in">document</span>.cookie)</span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">&#x27;name=ysj&#x27;</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">&#x27;age=18&#x27;</span></span><br><span class="line"><span class="comment">//删除cookie，设置过期时间为0</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">&#x27;name=ysj;max-age=0&#x27;</span></span><br><span class="line"><span class="comment">//设置cookie时设置过期时间(默认是秒钟)</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">&#x27;name=ysj;max-age=10&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="BOM-DOM"><a href="#BOM-DOM" class="headerlink" title="BOM-DOM"></a>BOM-DOM</h3><h4 id="BOM"><a href="#BOM" class="headerlink" title="BOM"></a>BOM</h4><p>JS 的一个重要运行环节就是浏览器，浏览器本身又作为一个应用程序需要对其本身进行操作，所有浏览器通常会有对应的对象模型(BOM,Browser Object Model)；可以将 BOM 看成是连接 JS 脚本与浏览器窗口的桥梁</p><p>BOM 主要包括的对象模型：</p><ul><li>window：包括全局属性、方法，控制浏览器窗口相关的属性、方法</li><li>location：浏览器连接到的对象的位置(URL)</li><li>history：操作浏览器的历史</li><li>document：当前窗口操作文档的对象</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL1dpbmRvdw==">window 对象<i class="fa fa-external-link-alt"></i></span>在浏览器中有两个身份：</p><ol><li>全局对象</li><li>浏览器窗口对象<ul><li>包含约 60+个属性属性：localStorage、console、history、scrollX、screenX 等</li><li>包含约 40+个方法方法：alert、close、scrollToopen 等</li><li>包含约 30+个事件：focus、blur、load、hashchange 等</li><li>包含从 EventTarget 继承过来的方法:addEventListener、removeEventListener、dispatchEvent 等(Window 类继承自 EventTarget)</li></ul></li></ol><p>事件参考 MDN：<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvRXZlbnRz">https://developer.mozilla.org/zh-CN/docs/Web/Events<i class="fa fa-external-link-alt"></i></span></p><p>location:<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL0xvY2F0aW9u">https://developer.mozilla.org/zh-CN/docs/Web/API/Location<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.location)</span><br><span class="line"><span class="comment">// location.href 完整的url地址</span></span><br><span class="line"><span class="comment">// location.protocol  协议</span></span><br><span class="line"></span><br><span class="line">location.assign(<span class="string">&#x27;http://www.baidu.com&#x27;</span>) <span class="comment">//打开一个新的地址。跳转后有回退按钮</span></span><br><span class="line">location.href = <span class="string">&#x27;http://www.baidu.com&#x27;</span> <span class="comment">//两者等价</span></span><br><span class="line"></span><br><span class="line">location.replace(<span class="string">&#x27;http://www.baidu.com&#x27;</span>) <span class="comment">//跳转后无法返回</span></span><br><span class="line">location.reload() <span class="comment">//重新加载页面</span></span><br></pre></td></tr></table></figure><p>history:<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL0hpc3RvcnlfQVBJ">https://developer.mozilla.org/zh-CN/docs/Web/API/History_API<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// history主要有两个属性</span></span><br><span class="line"><span class="attr">length</span>:会话中的记录条数</span><br><span class="line">state：当前保留的状态值</span><br><span class="line"></span><br><span class="line"><span class="comment">// back():返回上一页，等价于history.go(-1);</span></span><br><span class="line"><span class="comment">// forward():前进下一页，等价于history.go(1);</span></span><br><span class="line"><span class="comment">// go():加载历史中的某一页</span></span><br><span class="line"><span class="comment">// pushState():打开一个指定的地址(不会刷新页面)</span></span><br><span class="line"><span class="comment">// replaceState():打开一个新的地址，并且使用replace</span></span><br></pre></td></tr></table></figure><h4 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  x,</span></span></span><br><span class="line"><span class="params"><span class="function">  y = <span class="keyword">function</span> () &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    x = <span class="number">3</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="built_in">console</span>.log(x)</span></span></span><br><span class="line"><span class="params"><span class="function">  &#125;</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//当函数参数有默认值时，会多形成一个参数作用域，用于保存参数的值，作用域里面是所有的参数</span></span><br><span class="line">  <span class="comment">// 即： x = undefined y = function</span></span><br><span class="line">  consoloe.log(x)</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">2</span></span><br><span class="line">  y()</span><br><span class="line">  <span class="built_in">console</span>.log(x) <span class="comment">//找自己作用域里面的x，x = 2</span></span><br><span class="line">&#125;</span><br><span class="line">foo()</span><br><span class="line"><span class="built_in">console</span>.log(x)</span><br></pre></td></tr></table></figure><p>JS 通过 DOM(Document Object Model，文档对象模型)操作网页中的各种标签元素</p><p>所有的 DOM 节点类型都继承自<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL05vZGU=">Node<i class="fa fa-external-link-alt"></i></span>接口</p><p>Node 的几个重要的属性：</p><ul><li>nodeName:node 节点的名称(默认大写)</li><li>nodeType:可以区分节点的<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL05vZGUvbm9kZVR5cGU=">类型<i class="fa fa-external-link-alt"></i></span>(文本类型、元素类型、注释类型等)</li><li>nodeValue:node 节点的值</li><li>childNodes:所有的子节点</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL0RvY3VtZW50">Document<i class="fa fa-external-link-alt"></i></span>节点表示的整个载入的网页，常见的属性和方法：</p><ul><li>属性<ul><li>document.title</li><li>document.body</li><li>document.head</li><li>document.children</li><li>document.location(等同于 window.location)</li></ul></li><li>方法<ul><li>document.createElement(“h2”) 创建元素</li><li>document.body.appendChild(h3El) 追加元素</li><li>document.body.removeChild(h3El) 移除元素</li><li>document.getElementsByName(“aaa”) 获取元素</li><li>document.getElementsByTagName(“div”) 获取元素</li><li>document.querySelector(“div”) 获取元素</li><li>document.querySelectorAll(“div”) 获取元素</li></ul></li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvQVBJL0VsZW1lbnQ=">Element<i class="fa fa-external-link-alt"></i></span>:div、p、span 等元素在 DOM 中表示为 Element 元素,常见属性和方法：</p><ul><li>属性<ul><li>el.children 获取子元素</li><li>el.childNodes 获取子元素</li><li>el.tagName 获取标签名</li><li>el.id</li><li>el.className</li><li>el.classList</li><li>el.clientWidth/clientHeight/clientLeft/clientTop</li></ul></li><li>方法<ul><li>el.getAttribute(“name”)</li><li>el.setAttribute(“height”, “1.22”)</li></ul></li></ul><h4 id="事件监听"><a href="#事件监听" class="headerlink" title="事件监听"></a><strong>事件监听</strong></h4><p>浏览器在某个时刻可能会发生一些事件，需要以某种方式(代码)对其响应，进行事件的处理</p><p>事件对象：</p><ul><li>event.type:事件的类型</li><li>event.target:发生点击的元素</li><li>event.currentTarget：处理点击事件的元素</li><li>event.offsetX,event.offsetY：事件发生的位置</li><li>event.preventDefault():默认默认行为</li><li>event.stopPropagation():阻止事件进一步传递</li></ul><p>其它事件类型：<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvRXZlbnRz">https://developer.mozilla.org/zh-CN/docs/Web/Events<i class="fa fa-external-link-alt"></i></span></p><h4 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h4><p>MDN:<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9EYXRhX3N0cnVjdHVyZXM=">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures<i class="fa fa-external-link-alt"></i></span></p><h5 id="Number-数字对象"><a href="#Number-数字对象" class="headerlink" title="Number 数字对象"></a>Number 数字对象</h5><ul><li>toFixed(x)：数字转化为字符串，结果的的小数点后有指定位有效数字</li><li>toString()把数字转换为字符串</li><li>valueOf()返回一个 Number 对象的基本数字值</li></ul><p>判断数字是否为纯数字、</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">Number</span>(num) + <span class="string">&#x27;&#x27;</span> !== <span class="literal">NaN</span> + <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;是纯数字&#x27;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">Number</span>(<span class="number">1.22</span>) + <span class="string">&#x27;&#x27;</span>) <span class="comment">//1.22</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">Number</span>(<span class="string">&#x27;1.22a&#x27;</span>) + <span class="string">&#x27;&#x27;</span>) <span class="comment">//NaN</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;不是纯数字&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="String-字符串对象"><a href="#String-字符串对象" class="headerlink" title="String 字符串对象"></a>String 字符串对象</h5><ul><li><p>length：字符串的长度</p></li><li><p>charAt() 返回在指定位置的字符</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str.charAt(index) <span class="comment">//第一个字符的下标是0，若index下标越界，将返回一个空字符串</span></span><br></pre></td></tr></table></figure></li><li><p>concat() 连接两个或更多字符串，并返回新的字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str.concat(str1, str2, str3, …); <span class="comment">//连接多个字符串，使用+连接会更方便一点</span></span><br></pre></td></tr></table></figure></li><li><p>indexOf() 返回某个指定的字符串值在字符串中首次出现的位置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str.indexOf(str1, start)</span><br><span class="line"><span class="comment">//检索str中是否含有str1,start为开始检索的下标，默认从0开始</span></span><br><span class="line"><span class="comment">//找到返回str1第一次出现的位置，没找到返回-1</span></span><br></pre></td></tr></table></figure></li><li><p>includes() 查找字符串中是否包含指定的子字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str.includes(str1, start) <span class="comment">//判断str中是否包含str1字符串</span></span><br><span class="line"><span class="comment">//找到返回true，否则返回false</span></span><br><span class="line"><span class="comment">//start为开始查找的下标，默认为0</span></span><br></pre></td></tr></table></figure></li><li><p>lastIndexOf() 返回一个指定的字符串值最后出现的位置，在一个字符串中的指定位置从后向前搜索</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str.lastIndexOf(str1, start)</span><br><span class="line"><span class="comment">//查找str1在str中最后出现在哪个位置</span></span><br><span class="line"><span class="comment">//start为开始检索位置的下标,默认为字符串结尾</span></span><br><span class="line"><span class="comment">//未搜索到时返回-1</span></span><br></pre></td></tr></table></figure></li><li><p>replace() 在字符串中查找匹配的子串，并替换与正则表达式匹配的子串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str.replace(str1 | reg, newStr)</span><br><span class="line"><span class="comment">//将str中的str1字符串替换为newStr(只替换第一个str1)</span></span><br><span class="line"><span class="comment">//将str中符合正则表达式的字符串替换为newStr</span></span><br><span class="line"><span class="comment">//会返回一个替换后的字符串</span></span><br></pre></td></tr></table></figure></li><li><p>slice() 提取字符串的片段，并在新的字符串中返回被提取的部分</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str.slice(start, end)</span><br><span class="line"><span class="comment">//[start, end)</span></span><br><span class="line"><span class="comment">//start从0开始，若为负数表示从w截取startg字符串，slice(-2)表示提取原字符串中最后两个字符</span></span><br><span class="line"><span class="comment">//end若为负数，-1指字符串最后一个字符的位置，-2指到数第二个字符</span></span><br></pre></td></tr></table></figure></li><li><p>split()把字符串分割为字符串数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str.split(<span class="string">&#x27;str1&#x27;</span> | reg, limit)</span><br><span class="line"><span class="comment">//把一个字符串以str1作为分隔符分割成一个数组</span></span><br><span class="line"><span class="comment">//limit返回数组的最大长度</span></span><br></pre></td></tr></table></figure></li><li><p>substr()从起始索引号提取字符串中指定数目的字符</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str.substr(start, length)</span><br><span class="line"><span class="comment">//start:抽取子串的起始下标，若为负数则从尾部开始算起，-1值最后一个字符</span></span><br><span class="line"><span class="comment">//length:可选，子串中的字符数，若省略则一直截取到str字符串末尾</span></span><br></pre></td></tr></table></figure></li><li><p>substring()提取字符串中两个指定的索引号之间的字符</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">str.substring(start, end)</span><br><span class="line"><span class="comment">// [start, end)</span></span><br><span class="line"><span class="comment">//from:非负整数，提取子串的起始位置</span></span><br><span class="line"><span class="comment">//to:可选，非负整数，比from大1，省略会一直提取到字符串结尾</span></span><br><span class="line"><span class="comment">// start == end,返回一个空字符串</span></span><br><span class="line"><span class="comment">//任意参数小于0或为NaN，会被视为0; 大于length会被视为length</span></span><br><span class="line"><span class="comment">//start &gt; end 则  str.substring(1, 0) &lt;==&gt; str.substring(0, 1)</span></span><br></pre></td></tr></table></figure></li><li><p>toLowerCase()把字符串转换为小写</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str.toLowerCase()</span><br></pre></td></tr></table></figure></li><li><p>toUpperCase()把字符串转换为大写</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str.toUpperCase()</span><br></pre></td></tr></table></figure></li><li><p>trim()去除字符串两边的空白</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str.trim()</span><br></pre></td></tr></table></figure></li><li><p>valueOf()返回某个字符串对象的原始值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;Hello world!&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(str.valueOf()) <span class="comment">//Hello world!</span></span><br></pre></td></tr></table></figure></li><li><p>toString()返回一个字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bool = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">var</span> myvar = bool.toString() <span class="comment">//true</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="Date-日期对象"><a href="#Date-日期对象" class="headerlink" title="Date 日期对象"></a>Date 日期对象</h5><ul><li>getDate() 从 Date 对象中返回一个月中的某一天(1~31)</li><li>getDay() 从 Date 对象中返回一周中的某一天(0~6)</li><li>getFullYear() 返回四位数字的年份</li><li>getHours() 返回小时(0-23)</li><li>getMilliseconds() 返回毫秒(0~999)</li><li>getMinutes() 返回分钟(0~59)</li><li>getMonth() 返回月份(0~11)</li><li>getSeconds() 返回秒数(0~59)</li><li>getTime() 返回 1970 年 1 月 1 日至今的毫秒数</li><li>toJSON() 以 JSON 数据格式返回日期字符串</li><li>toString() 把 Date 对象转换为字符串</li><li>valueOf() 返回 Date 对象的原始值</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> date1 = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">//创建当前日期</span></span><br><span class="line"><span class="keyword">var</span> date2 = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&quot;2021-7-7 18:30:00&quot;</span>); <span class="comment">//创建指定日期</span></span><br><span class="line"><span class="keyword">var</span> date3 = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2021</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">18</span>, <span class="number">30</span>, <span class="number">50</span>， <span class="number">333</span>); <span class="comment">//创建指定日期（此处月份从0开始）</span></span><br></pre></td></tr></table></figure><p>日期在 js 中存储的是距离 1970 年 1 月 1 日 0 点 0 分 0 秒 0 毫秒的毫秒数</p><p>日期相加结果为字符串拼接，相减结果为毫秒数的差值</p><h5 id="Array-数组对象"><a href="#Array-数组对象" class="headerlink" title="Array 数组对象"></a>Array 数组对象</h5><ul><li><p>concat() 连接两个或更多的数组</p><p>返回一个新数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> newArray = arr.concat(arr2, arr3)</span><br></pre></td></tr></table></figure></li><li><p>copyWithin() 浅复制数组的一部分到同一数组中的另一个位置</p><p>==会改变原数组==，但不会改变数组长度</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr.copyWithin(target, start, end)</span><br><span class="line"><span class="comment">//[start, end)</span></span><br><span class="line"><span class="comment">//target:复制序列到该位置。如果是负数，target 将从末尾开始计算;如果 target 大于等于 arr.length，将会不发生拷贝</span></span><br><span class="line"><span class="comment">//start:可选，开始复制元素的起始位置，若为负数，将从末尾开始计算，默认从0开始</span></span><br><span class="line"><span class="comment">//end：可选，开始复制元素的结束位置(不包含),若为负数, end 将从末尾开始计算，默认复制到数组结尾</span></span><br></pre></td></tr></table></figure></li><li><p>every() 检测数值元素的每个元素是否都符合条件</p><p>注：若收到一个空数组，此方法在一切情况下都会返回 <code>true</code></p><p>返回布尔值。如果所有元素都通过检测返回 true，否则返回 false</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr.every(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">el, index, arr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//el:当前元素的值</span></span><br><span class="line">  <span class="comment">//index:可选，当前元素的下标</span></span><br><span class="line">  <span class="comment">//arr:可选，调用array的当前数组</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>fill() 用一个固定值填充一个数组中从起始索引到终止索引内的全部元素</p><p>返回一个修改后的数组，==会改变原数组==</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arr.fill(value, start, end)</span><br><span class="line"><span class="comment">// [start, end)</span></span><br><span class="line"><span class="comment">// value:用来填充数组元素的值</span></span><br><span class="line"><span class="comment">// start:可选，起始索引，默认值为0</span></span><br><span class="line"><span class="comment">// end:可选，终止索引，默认值为 this.length</span></span><br><span class="line"><span class="keyword">const</span> newSkuGroup = <span class="keyword">new</span> <span class="built_in">Array</span>(totalLength).fill(&#123; <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">price</span>: <span class="number">0</span> &#125;)</span><br><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1024</span> * <span class="number">1024</span>).fill(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li><li><p>filter() 检测数值元素，并返回符合条件所有元素的数组</p><p>返回一个新的数组，若无元素通过测试则返回空数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arr.filter(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">el, index, arr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//callback:测试数组每个元素的函数，返回true保留该元素，false不保留</span></span><br><span class="line">  <span class="comment">//el：数组当前正在处理的元素</span></span><br><span class="line">  <span class="comment">//index：可选，正在处理的元素的下标</span></span><br><span class="line">  <span class="comment">//arr：调用filter的数组本身</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>find() 返回数组中满足提供的测试函数的第一个元素的值,否则返回 undefined</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr.find(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">el, index, arr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//el:当前遍历到的元素</span></span><br><span class="line">  <span class="comment">//index：可选，当前元素的下标</span></span><br><span class="line">  <span class="comment">//arr：调用find()的数组本身</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>findIndex() 返回数组中满足提供的测试函数的第一个元素的<strong>索引</strong>。若没有找到对应元素则返回-1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.findIndex(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">el, index, arr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//参数同上</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>forEach() 数组每个元素都执行一次回调函数</p><p>除了抛出异常以外，没有办法中止或跳出 <code>forEach()</code> 循环</p><p>forEach 不会直接改变调用它的对象，但那个对象可能会被 callback 函数改变</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.forEach(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">el, index, arr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//参数同上</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>from() 从一个类似数组或可迭代对象创建一个新的，浅拷贝的数组实例</p><p>返回一个新数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.from(object, callback)</span><br><span class="line"><span class="comment">//object:要转换为数组的对象</span></span><br><span class="line"><span class="comment">//callback：可选，数组中每个元素要调用的函数</span></span><br></pre></td></tr></table></figure></li><li><p>includes() 判断一个数组是否包含一个指定的值</p><p>如果包含则返回 true，否则返回 false</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.includes(value, start)</span><br><span class="line"><span class="comment">//value：需要查找的元素值</span></span><br><span class="line"><span class="comment">//start：可选，开始查找的位置，默认为0</span></span><br></pre></td></tr></table></figure></li><li><p>indexOf() 搜索数组中的元素，并返回它第一次出现的位置,不存在返回-1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.indexOf(el, start)</span><br><span class="line"><span class="comment">//el:要查找的元素</span></span><br><span class="line"><span class="comment">//start：可选，开始查找的下标，默认为0</span></span><br></pre></td></tr></table></figure></li><li><p>isArray() 判断对象是否为数组</p><p>值是 Array，返回 true，否则返回 false</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.isArray(obj)</span><br><span class="line"><span class="comment">//obj：需要检测是否为数组的对象</span></span><br></pre></td></tr></table></figure></li><li><p>join() 将一个数组（或一个类数组对象）的所有元素连接成一个字符串并返回这个字符串。若数组只有一个项目，那么将返回该项目而不使用分隔符</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr.join(separator)</span><br><span class="line"><span class="comment">//separator：可选，指定一个字符串来分隔数组的每个元素，默认用逗号分割</span></span><br><span class="line"><span class="comment">//如果一个元素为 undefined 或 null，它会被转换为空字符串。</span></span><br><span class="line"><span class="comment">//若数组长度为0，则返回空字符串</span></span><br></pre></td></tr></table></figure></li><li><p>keys() 返回一个包含数组中每个索引键的 Array Iterator 对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> iterator = arr.keys()</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> iterator) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(key) <span class="comment">// 0 1 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>lastIndexOf() 搜索数组中的元素，并返回它最后出现的位置,从数组的后面向前查找</p><p>如果不存在则返回 -1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.lastIndexOf(el, start)</span><br><span class="line"><span class="comment">//el:被查找的元素</span></span><br><span class="line"><span class="comment">//start：可选，从此位置开始逆向查找，默认从数组最后一个开始。若为负数，如-2，从数组倒数第二个开始逆向查找，以此类推</span></span><br></pre></td></tr></table></figure></li><li><p>map() 通过指定函数处理数组的每个元素，并返回处理后的数组</p><p>返回一个新数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr.map(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">el, index, array</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//el：当前正在处理的元素</span></span><br><span class="line">  <span class="comment">//index：当前元素的下标</span></span><br><span class="line">  <span class="comment">//array：调用map方法的数组</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>pop() 从数组中删除最后一个元素，并返回该元素的值;数组为空时返回 undefined</p><p>==会改变原数组的长度==</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.pop()</span><br></pre></td></tr></table></figure></li><li><p>push() 将一个或多个元素添加到数组的末尾，并返回该数组的新长度</p><p>==会改变原数组的长度==</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.push(el1, el2, ……);</span><br></pre></td></tr></table></figure></li><li><p>reduce() 对数组中的每个元素执行一个由您提供的 reducer 函数(升序执行)，将其结果汇总为单个返回值</p><p>在没有初始值的空数组上调用 reduce 将报错</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arr.reduce(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">returnValue, el, index, arr</span>) </span>&#123;&#125;, initValue)</span><br><span class="line"><span class="comment">//returnValue：上一次调用会调用返回累积值或initValue</span></span><br><span class="line"><span class="comment">//el：数组中正在处理的元素</span></span><br><span class="line"><span class="comment">//index：正在处理的元素的下标</span></span><br><span class="line"><span class="comment">//arr：调用reduce的数组</span></span><br><span class="line"><span class="comment">//initValue：第一次调用callback函数时的第一个参数的值，若没有提供，则将使用数组中的第一个元素</span></span><br></pre></td></tr></table></figure></li><li><p>reduceRight() 接受一个函数作为累加器和数组的每个值（从右到左）将其减少为单个值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array1 = [</span><br><span class="line">  [<span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">  [<span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">].reduceRight(<span class="function">(<span class="params">accumulator, currentValue</span>) =&gt;</span> accumulator.concat(currentValue))</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(array1)</span><br><span class="line"><span class="comment">// expected output: Array [4, 5, 2, 3, 0, 1]</span></span><br></pre></td></tr></table></figure></li><li><p>reverse() 将数组中元素的位置颠倒，并返回该数组</p><p>==会改变原数组==</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.reverse()</span><br></pre></td></tr></table></figure></li><li><p>shift() 从数组中删除第一个元素，并返回该元素的值;若为空数组返回 undefined</p><p>==会改变原数组的长度==</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.shift()</span><br></pre></td></tr></table></figure></li><li><p>slice() 返回一个新的数组对象，这一对象是一个由 begin 和 end 决定的原数组的浅拷贝</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr.slice(begin, end)</span><br><span class="line"><span class="comment">// [begin, end);</span></span><br><span class="line"><span class="comment">//begin：可选，从该索引开始提取原数组元素，默认从0开始；slice(-2) 表示提取原数组中的倒数第二个元素到最后一个元素（包含最后一个元素）；</span></span><br><span class="line"><span class="comment">//如果 begin 超出原数组的索引范围，则会返回空数组。</span></span><br><span class="line"><span class="comment">//end：可选，提取终止处的索引，默认提取到数组结束；若为负数， 则它表示在原数组中的倒数第几个元素结束抽取</span></span><br></pre></td></tr></table></figure></li><li><p>some() 测试数组中是不是至少有 1 个元素通过了被提供的函数测试。它返回的是一个 Boolean 类型的值。</p><p>如果用一个空数组进行测试，在任何情况下它返回的都是 false</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr.some(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">el, index, arr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//el：数组正在处理的元素</span></span><br><span class="line">  <span class="comment">//index：正在处理元素的下标</span></span><br><span class="line">  <span class="comment">//arr：调用some的数组</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>sort() 对数组的元素进行排序，并返回数组；默认排序顺序是在将元素转换为字符串，然后比较它们的 UTF-16 代码单元值序列时构建的</p><p>==会改变原数组==</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.sort(<span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a - b <span class="comment">//升序排序</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>splice() 删除、替换现有元素、原地添加新的元素,并以数组形式返回被修改的内容</p><p>==会改变原数组==</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arr.splice(start, delCount, item1, item2, ……);</span><br><span class="line"><span class="comment">//start：可选，指定修改的开始位置，默认从0开始；超出了数组的长度，则从数组末尾开始添加内容；若为负值，则表示从数组末位开始的第几位；负数的绝对值大于数组的长度，则表示开始位置为第0位</span></span><br><span class="line"><span class="comment">//delcount：要移除的数组元素的个数</span></span><br><span class="line">						<span class="comment">//0或负数，不会移除元素，至少添加一个新元素</span></span><br><span class="line">						<span class="comment">//大于start后面的元素个数，start及之后的元素都会被删除</span></span><br><span class="line">						<span class="comment">//被省略，start及之后的所有元素都会被删除</span></span><br><span class="line"><span class="comment">//item：要添加进数组的元素,从start开始。如果不指定，则 splice() 将只删除数组元素。</span></span><br></pre></td></tr></table></figure></li><li><p>toString() 把数组转换为字符串，并返回结果</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.toString()</span><br></pre></td></tr></table></figure></li><li><p>unshift() 将一个或多个元素添加到数组的开头，并返回该数组的新长度</p><p>==会改变原数组==</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr.unshift(item1, item2, ……);</span><br><span class="line"><span class="comment">//item：要添加到数组开头的元素</span></span><br></pre></td></tr></table></figure></li><li><p>valueOf() 返回数组对象的原始值</p></li></ul><h5 id="Boolean-布尔对象"><a href="#Boolean-布尔对象" class="headerlink" title="Boolean 布尔对象"></a>Boolean 布尔对象</h5><ul><li>toString() 把布尔值转换为字符串，并返回结果</li><li>valueOf() 返回 Boolean 对象的原始值</li></ul><h5 id="Math-算数对象"><a href="#Math-算数对象" class="headerlink" title="Math 算数对象"></a>Math 算数对象</h5><ul><li><p>abs(x) 返回 x 的绝对值</p></li><li><p>ceil(x) 对数进行上舍入</p></li><li><p>floor(x) 对 x 进行下舍入</p></li><li><p>max(x,y,z,…,n) 返回 x,y,z,…,n 中的最高值</p></li><li><p>min(x,y,z,…,n) 返回 x,y,z,…,n 中的最低值</p></li><li><p>pow(x,y) 返回 x 的 y 次幂</p></li><li><p>random() 返回 0 ~ 1 之间的随机数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Matn.random() <span class="comment">// [0, 1)</span></span><br></pre></td></tr></table></figure></li><li><p>round(x) 四舍五入为整数</p></li><li><p>sqrt(x) 返回数的平方根</p></li></ul><h4 id="数据类型和判断"><a href="#数据类型和判断" class="headerlink" title="数据类型和判断"></a>数据类型和判断</h4><p><strong>数据类型</strong></p><p>基本数据类型：</p><ol><li>String</li><li>Number</li><li>Bigint</li><li>Symbol</li><li>Boolean</li><li>null</li><li>undefined</li></ol><p>引用类型：</p><ul><li>对象(函数、日期、几乎所有通过 new 创建的东西)</li></ul><p><strong>typeof</strong></p><p><code>typeof</code> 操作符的唯一目的就是检查数据类型，如果我们希望检查任何从 Object 派生出来的结构类型，使用 <code>typeof</code> 是不起作用的，因为总是会得到 <code>&quot;object&quot;</code>。检查 Object 种类的合适方式是使用 instanceof 关键字。但即使这样也存在误差。</p><table><thead><tr><th align="center">类型</th><th align="left">结果</th></tr></thead><tbody><tr><td align="center">undefined</td><td align="left">“undefined”</td></tr><tr><td align="center">null</td><td align="left">“object”</td></tr><tr><td align="center">boolean</td><td align="left">“boolean”</td></tr><tr><td align="center">number</td><td align="left">“number”</td></tr><tr><td align="center">bigint</td><td align="left">“bigint”</td></tr><tr><td align="center">string</td><td align="left">“string”</td></tr><tr><td align="center">symbol</td><td align="left">“symbol”</td></tr><tr><td align="center">宿主对象(由 js 环境提供)</td><td align="left">取决于具体实现</td></tr><tr><td align="center">function 对象</td><td align="left">“function”</td></tr><tr><td align="center">其它任何对象</td><td align="left">“object”</td></tr></tbody></table><p><strong>instanceof 和 in</strong></p><p><a href="#JS%E5%8E%9F%E5%9E%8B%E7%9B%B8%E5%85%B3%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95">面向对象：JS 原型相关判断方法</a></p><h3 id="防抖和节流"><a href="#防抖和节流" class="headerlink" title="防抖和节流"></a>防抖和节流</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>防抖最早出现在电子元件中，节流出现在流体流动中；</p><p>js 是事件驱动的，大量的操作会触发事件，加入到事件队列中处理。对于某些频繁的事件处理会造成事件的损耗，可以通过防抖和节流来限制事件频繁的发生</p><p>==防抖==(debounce)：事件触发时，相应的函数会等待一定时间再触发；当事件密集触发时，函数的触发会被频繁的推迟，只有<strong>等待了一段时间也没有事件触发，才会真正的执行响应函数</strong></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20220107204557058.png" alt="image-20220107204557058"></p><p>应用场景：</p><ul><li>输入框中频繁的输入内容，搜素或提交信息</li><li>频繁的点击按钮，触发某个事件</li><li>监听浏览器滚动事件，完成某些特定操作</li><li>用户缩放浏览器的 resize 事件</li></ul><p>==节流==(throttle)：当事件触发，会执行这个事件的响应函数；如果这个事件会被<strong>频繁触发</strong>，节流函数会<strong>按照固定的频率来执行</strong>函数；不管在这个中间有多少次触发这个事件，执行函数的频率总是固定的</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="E:\Web\studyNotes\js高级.assets\image-20220107204617865.png" alt="image-20220107204617865"></p><p>应用场景：</p><ul><li>监听页面的滚动事件</li><li>鼠标移动事件</li><li>用户频繁点击按钮操作</li><li>游戏中的一些设计</li></ul><p>第三方库实现防抖：</p><ul><li>lodash</li><li><span class="exturl" data-url="aHR0cHM6Ly91bmRlcnNjb3JlanMub3JnLw==">underscore<i class="fa fa-external-link-alt"></i></span></li></ul><h4 id="防抖函数"><a href="#防抖函数" class="headerlink" title="防抖函数"></a><strong>防抖函数</strong></h4><p>基本实现:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, delay</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">const</span> _debounce = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">    &#125;, delay)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _debounce</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>立即执行(触发时先执行一次)：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, delay, immediate = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">let</span> isInvoke = <span class="literal">false</span> <span class="comment">//立即执行是否执行过</span></span><br><span class="line">  <span class="keyword">const</span> _debounce = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    <span class="keyword">if</span> (immediate &amp;&amp; !isInvoke) &#123;</span><br><span class="line">      <span class="comment">//如果需要立即执行</span></span><br><span class="line">      fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">      isInvoke = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">        isInvoke = <span class="literal">false</span></span><br><span class="line">      &#125;, delay)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _debounce</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>取消功能(用户触发后等待时间还未结束时，用户取消触发)：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//取消功能</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, delay, immediate = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">let</span> isInvoke = <span class="literal">false</span> <span class="comment">//立即执行是否执行过</span></span><br><span class="line">  <span class="keyword">const</span> _debounce = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    <span class="keyword">if</span> (immediate &amp;&amp; !isInvoke) &#123;</span><br><span class="line">      <span class="comment">//如果需要立即执行</span></span><br><span class="line">      fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">      isInvoke = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">        timer = <span class="literal">null</span></span><br><span class="line">        isInvoke = <span class="literal">false</span></span><br><span class="line">      &#125;, delay)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//增加取消执行功能</span></span><br><span class="line">  _debounce.cancel = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    timer = <span class="literal">null</span></span><br><span class="line">    isInvoke = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _debounce</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获取函数的返回值：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取函数返回值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn, delay, immediate = <span class="literal">false</span>, resultCallback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">let</span> isInvoke = <span class="literal">false</span> <span class="comment">//立即执行是否执行过</span></span><br><span class="line">  <span class="keyword">const</span> _debounce = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">      <span class="keyword">if</span> (immediate &amp;&amp; !isInvoke) &#123;</span><br><span class="line">        <span class="comment">//如果需要立即执行</span></span><br><span class="line">        <span class="keyword">const</span> result = fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">        <span class="keyword">if</span> (resultCallback) resultCallback(result) <span class="comment">//通过回调函数拿到返回结果</span></span><br><span class="line">        resolve(result) <span class="comment">//通过返回Promise拿到返回结果</span></span><br><span class="line">        isInvoke = <span class="literal">true</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> result = fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">          <span class="keyword">if</span> (resultCallback) resultCallback(result) <span class="comment">//通过回调函数拿到返回结果</span></span><br><span class="line">          resolve(result) <span class="comment">//通过返回Promise拿到返回结果</span></span><br><span class="line">          timer = <span class="literal">null</span></span><br><span class="line">          isInvoke = <span class="literal">false</span></span><br><span class="line">        &#125;, delay)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//增加取消执行功能</span></span><br><span class="line">  _debounce.cancel = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    timer = <span class="literal">null</span></span><br><span class="line">    isInvoke = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _debounce</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="节流函数"><a href="#节流函数" class="headerlink" title="节流函数"></a>节流函数</h4><p>基本实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, interval</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> _throttle = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> lastTime = <span class="number">0</span> <span class="comment">//上一次执行函数的时间</span></span><br><span class="line">    <span class="keyword">const</span> nowTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() <span class="comment">//当前触发节流函数的时间</span></span><br><span class="line">    <span class="keyword">const</span> remainTime = interval - (nowTime - lastTime) <span class="comment">//还剩多少时间触发函数</span></span><br><span class="line">    <span class="comment">//还剩多少时间触发函数 = 间隔时间 - (当前时间 - 上次执行时间)</span></span><br><span class="line">    <span class="keyword">if</span> (remainTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//此时函数需要开始执行</span></span><br><span class="line">      fn() <span class="comment">//触发函数</span></span><br><span class="line">      lastTime = nowTime <span class="comment">//保留上次触发的时间</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _throttle</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>增加由外界决定第一次是否触发的功能</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//外界决定第一次是否执行函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, interval, options = &#123; leading: <span class="literal">true</span>, trailing: <span class="literal">false</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; leading &#125; = options</span><br><span class="line">  <span class="keyword">const</span> _throttle = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> lastTime = <span class="number">0</span> <span class="comment">//上一次执行函数的时间</span></span><br><span class="line">    <span class="keyword">const</span> nowTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() <span class="comment">//当前触发节流函数的时间</span></span><br><span class="line">    <span class="keyword">if</span> (!lastTime &amp;&amp; !leading) lastTime = nowTime <span class="comment">//若传进来的leading为false,并且lastTime==0，让lastTime=nowTime，让剩余时间大于0，表示第一次不执行函数</span></span><br><span class="line">    <span class="keyword">const</span> remainTime = interval - (nowTime - lastTime) <span class="comment">//还剩多少时间触发函数</span></span><br><span class="line">    <span class="keyword">if</span> (remainTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      fn()</span><br><span class="line">      lastTime = nowTime <span class="comment">//保留上次触发的时间</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _throttle</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>外界决定没到触发时间的最后一次是否执行函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//外界决定第一次是否执行函数,没到触发时间的最后一次是否执行</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, interval, options = &#123; leading: <span class="literal">true</span>, trailing: <span class="literal">false</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; leading, trailing &#125; = options</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span> <span class="comment">//定时器，</span></span><br><span class="line">  <span class="keyword">const</span> _throttle = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> lastTime = <span class="number">0</span> <span class="comment">//上一次执行函数的时间</span></span><br><span class="line">    <span class="keyword">const</span> nowTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() <span class="comment">//当前触发节流函数的时间</span></span><br><span class="line">    <span class="keyword">if</span> (!lastTime &amp;&amp; !leading) lastTime = nowTime <span class="comment">//若传进来的leading为false,并且lastTime==0，让lastTime=nowTime，让剩余时间大于0，表示第一次不执行函数</span></span><br><span class="line">    <span class="keyword">const</span> remainTime = interval - (nowTime - lastTime) <span class="comment">//还剩多少时间触发函数</span></span><br><span class="line">    <span class="keyword">if</span> (remainTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      fn()</span><br><span class="line">      lastTime = nowTime <span class="comment">//保留上次触发的时间</span></span><br><span class="line">      <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">        <span class="comment">//事件已经触发，取消定时器，防止多次执行</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">        timer = <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="comment">//事件已经执行，不需要再加定时器</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (trailing &amp;&amp; remainTime &gt; <span class="number">0</span> &amp;&amp; !timer) &#123;</span><br><span class="line">      <span class="comment">//判断有没有定时器</span></span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        timer = <span class="literal">null</span> <span class="comment">//清空定时器，让下一次定时器能够开启</span></span><br><span class="line">        lastTime = leading ? <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() : <span class="number">0</span></span><br><span class="line">        <span class="comment">//如果第一次触发执行，则将上一次执行时间设置为当前时间；</span></span><br><span class="line">        <span class="comment">//如果事第一次不执行，则将上一次执行时间设置为0</span></span><br><span class="line">        fn()</span><br><span class="line">      &#125;, remainTime)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _throttle</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>绑定 this 和参数和取消功能</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//绑定this和参数和取消功能</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, interval, options = &#123; leading: <span class="literal">true</span>, trailing: <span class="literal">false</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; leading, trailing &#125; = options</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">const</span> _throttle = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> lastTime = <span class="number">0</span> <span class="comment">//上一次执行函数的时间</span></span><br><span class="line">    <span class="keyword">const</span> nowTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() <span class="comment">//当前触发节流函数的时间</span></span><br><span class="line">    <span class="keyword">if</span> (!lastTime &amp;&amp; !leading) lastTime = nowTime <span class="comment">//若传进来的leading为false,让lastTime=noeTime，表示第一次不执行函数</span></span><br><span class="line">    <span class="keyword">const</span> remainTime = interval - (nowTime - lastTime) <span class="comment">//还剩多少时间触发函数</span></span><br><span class="line">    <span class="keyword">if</span> (remainTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">      lastTime = nowTime <span class="comment">//保留上次触发的时间</span></span><br><span class="line">      <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">        timer = <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="comment">//事件已经执行，不需要再加定时器</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (trailing &amp;&amp; remainTime &gt; <span class="number">0</span> &amp;&amp; !timer) &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        timer = <span class="literal">null</span></span><br><span class="line">        lastTime = leading ? <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() : <span class="number">0</span></span><br><span class="line">        fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">      &#125;, remainTime)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  _throttle.cancel = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    timer = <span class="literal">null</span></span><br><span class="line">    lastTime = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _throttle</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数返回值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数返回值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, interval, options = &#123; leading: <span class="literal">true</span>, trailing: <span class="literal">false</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; leading, trailing, resultCallback &#125; = options</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">const</span> _throttle = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> lastTime = <span class="number">0</span> <span class="comment">//上一次执行函数的时间</span></span><br><span class="line">    <span class="keyword">const</span> nowTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() <span class="comment">//当前触发节流函数的时间</span></span><br><span class="line">    <span class="keyword">if</span> (!lastTime &amp;&amp; !leading) lastTime = nowTime <span class="comment">//若传进来的leading为false,让lastTime=nowTime，表示第一次不执行函数</span></span><br><span class="line">    <span class="keyword">const</span> remainTime = interval - (nowTime - lastTime) <span class="comment">//还剩多少时间触发函数</span></span><br><span class="line">    <span class="keyword">if</span> (remainTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">      <span class="keyword">if</span> (resultCallback) resultCallback(result)</span><br><span class="line">      lastTime = nowTime <span class="comment">//保留上次触发的时间</span></span><br><span class="line">      <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">        timer = <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="comment">//事件已经执行，不需要再加定时器</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (trailing &amp;&amp; remainTime &gt; <span class="number">0</span> &amp;&amp; !timer) &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        timer = <span class="literal">null</span></span><br><span class="line">        lastTime = leading ? <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() : <span class="number">0</span></span><br><span class="line">        <span class="keyword">const</span> result = fn.apply(<span class="built_in">this</span>, args)</span><br><span class="line">        <span class="keyword">if</span> (resultCallback) resultCallback(result)</span><br><span class="line">      &#125;, remainTime)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _throttle.cancel = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    timer = <span class="literal">null</span></span><br><span class="line">    lastTime = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _throttle</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h3><p>引用赋值：指向同一个对象，相互之间会影响</p><p>对象的浅拷贝：只是浅层的拷贝，内部引入对象时，依然会相互影响</p><p>对象的深拷贝：两个对象不再有任何关系，不会相互影响</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> valueType = <span class="keyword">typeof</span> value</span><br><span class="line">  <span class="comment">//传进来的值不为null，且typeof出来的类型为object或function才是一个对象</span></span><br><span class="line">  <span class="keyword">return</span> value !== <span class="literal">null</span> &amp;&amp; (valueType === <span class="string">&#x27;object&#x27;</span> || valueType === <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现基本的深拷贝</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">originValue</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//判断传入的originValue是否是一个对象类型</span></span><br><span class="line">  <span class="keyword">if</span> (!isObject(originValue)) <span class="keyword">return</span> originValue <span class="comment">//如果不是对象，返回原始值即可</span></span><br><span class="line">  <span class="keyword">const</span> newObj = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> originValue) &#123;</span><br><span class="line">    <span class="comment">//对对象所有的key进行遍历</span></span><br><span class="line">    newObj[key] = deepClone(originValue[key])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newObj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>特殊类型处理</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> valueType = <span class="keyword">typeof</span> value</span><br><span class="line">  <span class="keyword">return</span> value !== <span class="literal">null</span> &amp;&amp; (valueType === <span class="string">&#x27;object&#x27;</span> || valueType === <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//特殊类型的处理</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">originValue</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//判断是否是一个Set类型</span></span><br><span class="line">  <span class="keyword">if</span> (originValue <span class="keyword">instanceof</span> <span class="built_in">Set</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Set</span>([...originValue])</span><br><span class="line">  <span class="comment">//判断是否是一个Map类型</span></span><br><span class="line">  <span class="keyword">if</span> (originValue <span class="keyword">instanceof</span> <span class="built_in">Map</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Map</span>([...originValue])</span><br><span class="line"></span><br><span class="line">  <span class="comment">//判断如果是一个Symbol的value，则创建一个新的Symbol</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> originValue === <span class="string">&#x27;symbol&#x27;</span>) <span class="keyword">return</span> <span class="built_in">Symbol</span>(originValue.description)</span><br><span class="line">  <span class="comment">//判断传入的originValue不是对象类型或者是一个函数对象类型，返回原始值即可</span></span><br><span class="line">  <span class="keyword">if</span> (!isObject(originValue) || <span class="keyword">typeof</span> originValue === <span class="string">&#x27;function&#x27;</span>) <span class="keyword">return</span> originValue</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> newObj = <span class="built_in">Array</span>.isArray(originValue) ? [] : &#123;&#125; <span class="comment">//判断传入的是数组还是对象</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> originValue) &#123;</span><br><span class="line">    newObj[key] = deepClone(originValue[key])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//如Symbol作为key，通过for循环遍历时是遍历不到的，需要特殊处理</span></span><br><span class="line">  <span class="keyword">const</span> symbolKeys = <span class="built_in">Object</span>.getOwnPropertySymbols(originValue) <span class="comment">//从原始对象中取出所有以Symbol作为key的属性</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> sKey <span class="keyword">of</span> symbolKeys) &#123;</span><br><span class="line">    <span class="comment">//使用for of遍历取出数组元素的值</span></span><br><span class="line">    newObj[sKey] = deepClone(originValue[sKey])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newObj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>循环引用拷贝处理(重点)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> valueType = <span class="keyword">typeof</span> value</span><br><span class="line">  <span class="keyword">return</span> value !== <span class="literal">null</span> &amp;&amp; (valueType === <span class="string">&#x27;object&#x27;</span> || valueType === <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//解决循环引用的拷贝</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">originValue, map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//使用WeakMap弱引用，使对象想要销毁时能够销毁</span></span><br><span class="line">  <span class="keyword">if</span> (originValue <span class="keyword">instanceof</span> <span class="built_in">Set</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Set</span>([...originValue])</span><br><span class="line">  <span class="keyword">if</span> (originValue <span class="keyword">instanceof</span> <span class="built_in">Map</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Map</span>([...originValue])</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> originValue === <span class="string">&#x27;symbol&#x27;</span>) <span class="keyword">return</span> <span class="built_in">Symbol</span>(originValue.description)</span><br><span class="line">  <span class="keyword">if</span> (!isObject(originValue) || <span class="keyword">typeof</span> originValue === <span class="string">&#x27;function&#x27;</span>) <span class="keyword">return</span> originValue</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (map.has(originValue)) <span class="keyword">return</span> map.get(originValue) <span class="comment">//如果对象有属性又指向这个对象，直接将这个对象返回</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> newObj = <span class="built_in">Array</span>.isArray(originValue) ? [] : &#123;&#125;</span><br><span class="line">  map.set(originValue, newObj) <span class="comment">//将newObj对象暂存到map里面</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> originValue) &#123;</span><br><span class="line">    newObj[key] = deepClone(originValue[key], map) <span class="comment">//在调用第二次deepClone将map传进去，保证第二次和第一次使用的是同一个map</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> symbolKeys = <span class="built_in">Object</span>.getOwnPropertySymbols(originValue)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> sKey <span class="keyword">of</span> symbolKeys) &#123;</span><br><span class="line">    newObj[sKey] = deepClone(originValue[sKey], map) <span class="comment">//在调用第二次deepClone将map传进去</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newObj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="事件总线"><a href="#事件总线" class="headerlink" title="事件总线"></a>事件总线</h3><p>eventBus-Store:<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvZGVyd2h5L2h5LWV2ZW50LXN0b3Jl">https://github.com/coderwhy/hy-event-store<i class="fa fa-external-link-alt"></i></span></p><p>自定义事件总线属于一种观察者模式，包括三个角色：</p><ul><li>发布者(Publisher):发出事件(Event)</li><li>订阅者(Subscriber):订阅事件(Event),并且会进行响应(Handler)</li><li>事件总线(EventBus):无论是发布者还是订阅者都是通过事件总线作为中台的</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventBus</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.eventBus = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">on</span>(<span class="params">eventName, eventCallback, thisArg</span>)</span> &#123; <span class="comment">//监听事件</span></span><br><span class="line">    <span class="comment">//事件名称  事件回调  this参数</span></span><br><span class="line">    <span class="keyword">let</span> handlers = <span class="built_in">this</span>.eventBus[eventName]; <span class="comment">//根据事件名从对象中取要执行的函数数组(多次监听就是一个数组)</span></span><br><span class="line">    <span class="keyword">if</span> (!handlers) &#123; <span class="comment">//第一次进来时是为空的，取不到</span></span><br><span class="line">      handlers = []； <span class="comment">//赋默认值</span></span><br><span class="line">      <span class="built_in">this</span>.eventBus[eventName] = handlers; <span class="comment">//将默认值存进对象</span></span><br><span class="line">    &#125;</span><br><span class="line">    handlers.push(&#123; <span class="comment">//将事件和this参数存进数组</span></span><br><span class="line">      eventCallback,</span><br><span class="line">      thisArg</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">off</span>(<span class="params">eventName, eventCallback</span>)</span> &#123; <span class="comment">//取消监听</span></span><br><span class="line">    <span class="keyword">const</span> handlers = <span class="built_in">this</span>.eventBus[eventName]; <span class="comment">//根据事件名取函数</span></span><br><span class="line">    <span class="keyword">if</span> (!handlers) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> newHandlers = [...handlers]; <span class="comment">//将原来的对象拷贝一份</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newHandlers.length; i++) &#123; <span class="comment">//一边遍历一边移除</span></span><br><span class="line">      <span class="keyword">const</span> handler = newHandlers[i]; <span class="comment">//取出对应的事件对象</span></span><br><span class="line">      <span class="keyword">if</span> (handler.eventCallback === eventCallback) &#123;  <span class="comment">//如果取出的对象里面的函数和传进来的函数相等</span></span><br><span class="line">        <span class="keyword">const</span> index = handlers.indexOf(handler); <span class="comment">//从原数组里面找到要删除的函数的下标</span></span><br><span class="line">        handler.splice(index, <span class="number">1</span>); <span class="comment">//从原数组中删除</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">emit</span>(<span class="params">eventName, ...payload</span>)</span> &#123; <span class="comment">//发射事件</span></span><br><span class="line">    <span class="keyword">const</span> handlers = <span class="built_in">this</span>.eventBus[eventName]; <span class="comment">//根据事件名取出要执行的函数</span></span><br><span class="line">    <span class="keyword">if</span> (!handlers) <span class="keyword">return</span>; <span class="comment">//没有值的时候不进行操作</span></span><br><span class="line">    handlers.forEach(<span class="function"><span class="params">handler</span> =&gt;</span> &#123; <span class="comment">//遍历存储的事件并一一执行</span></span><br><span class="line">      handler.eventCallback.apply(handler.thisArg, payload); <span class="comment">//执行的时候将this传进去</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> eventBus = <span class="keyword">new</span> EventBus()</span><br><span class="line"></span><br><span class="line">eventBus.on(<span class="string">&quot;aaa&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">payload</span>) </span>&#123; <span class="comment">//监听</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;jianting&quot;</span>, payload);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">eventBus.emit(<span class="string">&quot;aaa&quot;</span>, <span class="number">123</span>); <span class="comment">//发射</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对应的数据解构</span></span><br><span class="line"><span class="comment">//eventBus = &#123;</span></span><br><span class="line"><span class="comment">//  aaa: [fn1, fn2, &#123;eventCallBack, this&#125;],</span></span><br><span class="line"><span class="comment">//  bbb: [fn4, fn5]</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure><h3 id="手写-flat"><a href="#手写-flat" class="headerlink" title="手写 flat"></a>手写 flat</h3><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzgwOTU4NC9hcnRpY2xlL2RldGFpbHMvMTIxNzgwMDUy">https://blog.csdn.net/weixin_47809584/article/details/121780052<i class="fa fa-external-link-alt"></i></span></p><h3 id="数组交并差"><a href="#数组交并差" class="headerlink" title="数组交并差"></a>数组交并差</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 并集</span></span><br><span class="line"><span class="keyword">let</span> union = <span class="keyword">new</span> <span class="built_in">Set</span>([...a, ...b])</span><br><span class="line"><span class="comment">// Set &#123;1, 2, 3, 4&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 交集</span></span><br><span class="line"><span class="keyword">let</span> intersect = <span class="keyword">new</span> <span class="built_in">Set</span>([...a].filter(<span class="function">(<span class="params">x</span>) =&gt;</span> b.has(x)))</span><br><span class="line"><span class="comment">// set &#123;2, 3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 差集</span></span><br><span class="line"><span class="keyword">let</span> difference = <span class="keyword">new</span> <span class="built_in">Set</span>([...a].filter(<span class="function">(<span class="params">x</span>) =&gt;</span> !b.has(x)))</span><br></pre></td></tr></table></figure></div><div class="reward-container"><div>如果觉得文章有帮助，就请吃个雪糕吧~</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/wechatpay.png" alt="很帅很愁人~ 微信支付"><p>微信支付</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>很帅很愁人~</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://blog.wy1991.cn/20220315/187-js%E9%AB%98%E7%BA%A7/" title="187-js高级">https://blog.wy1991.cn/20220315/187-js高级/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li><li class="post-copyright-license"><strong>联系方式： </strong>如文章有错误，请联系qq：598204996 谢谢~</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/js/" rel="tag"># js</a></div><div class="post-nav"><div class="post-nav-item"><a href="/20220315/186-nodejs/" rel="prev" title="186-nodejs"><i class="fa fa-chevron-left"></i> 186-nodejs</a></div><div class="post-nav-item"><a href="/20220315/188-git%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/" rel="next" title="188-git详细介绍">188-git详细介绍 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">底层原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%BC%95%E6%93%8E-js-%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.</span> <span class="nav-text">浏览器引擎 js 执行原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#V8-%E5%BC%95%E6%93%8E"><span class="nav-number">1.2.</span> <span class="nav-text">V8 引擎</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE"><span class="nav-number">1.3.</span> <span class="nav-text">函数执行作用域链</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E7%8E%AF%E5%A2%83%E5%92%8C%E8%AE%B0%E5%BD%95"><span class="nav-number">1.4.</span> <span class="nav-text">变量环境和记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E8%A1%A5%E5%85%85"><span class="nav-number">1.5.</span> <span class="nav-text">作用域补充</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-number">1.6.</span> <span class="nav-text">内存管理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AD%E5%8C%85"><span class="nav-number">2.</span> <span class="nav-text">闭包</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">2.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AD%E5%8C%85%E7%9A%84%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2"><span class="nav-number">2.2.</span> <span class="nav-text">闭包的内存泄露</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this-%E6%8C%87%E5%90%91"><span class="nav-number">3.</span> <span class="nav-text">this 指向</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#this-%E7%BB%91%E5%AE%9A%E8%A7%84%E5%88%99-%E9%BB%98%E8%AE%A4%E7%BB%91%E5%AE%9A"><span class="nav-number">3.1.</span> <span class="nav-text">this 绑定规则-默认绑定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#this-%E7%BB%91%E5%AE%9A%E8%A7%84%E5%88%99-%E9%9A%90%E5%BC%8F%E7%BB%91%E5%AE%9A"><span class="nav-number">3.2.</span> <span class="nav-text">this 绑定规则-隐式绑定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#this-%E7%BB%91%E5%AE%9A%E8%A7%84%E5%88%99-%E6%98%BE%E7%A4%BA%E7%BB%91%E5%AE%9A"><span class="nav-number">3.3.</span> <span class="nav-text">this 绑定规则-显示绑定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#this-%E7%BB%91%E5%AE%9A%E8%A7%84%E5%88%99-new-%E7%BB%91%E5%AE%9A"><span class="nav-number">3.4.</span> <span class="nav-text">this 绑定规则-new 绑定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0-this-%E5%88%86%E6%9E%90"><span class="nav-number">3.5.</span> <span class="nav-text">内置函数 this 分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%84%E5%88%99%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">3.6.</span> <span class="nav-text">规则优先级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%84%E5%88%99%E4%B9%8B%E5%A4%96-%E5%BF%BD%E7%95%A5%E6%98%BE%E5%BC%8F%E7%BB%91%E5%AE%9A"><span class="nav-number">3.7.</span> <span class="nav-text">规则之外-忽略显式绑定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%84%E5%88%99%E4%B9%8B%E5%A4%96-%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0"><span class="nav-number">3.8.</span> <span class="nav-text">规则之外-箭头函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="nav-number">3.9.</span> <span class="nav-text">面试题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JS-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="nav-number">4.</span> <span class="nav-text">JS 函数式编程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#call-apply-bind-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.1.</span> <span class="nav-text">call-apply-bind 的实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#arguments"><span class="nav-number">4.2.</span> <span class="nav-text">arguments</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%AF%E5%87%BD%E6%95%B0"><span class="nav-number">4.3.</span> <span class="nav-text">纯函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%AF%E9%87%8C%E5%8C%96"><span class="nav-number">4.4.</span> <span class="nav-text">柯里化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-number">4.5.</span> <span class="nav-text">组合函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JS-%E5%B0%8F%E7%9F%A5%E8%AF%86"><span class="nav-number">5.</span> <span class="nav-text">JS 小知识</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#with-%E8%AF%AD%E5%8F%A5"><span class="nav-number">5.1.</span> <span class="nav-text">with 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#eval-%E5%87%BD%E6%95%B0"><span class="nav-number">5.2.</span> <span class="nav-text">eval 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F"><span class="nav-number">5.3.</span> <span class="nav-text">严格模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="nav-number">6.</span> <span class="nav-text">面向对象</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="nav-number">6.0.1.</span> <span class="nav-text">对象的创建方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%B9%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C%E7%9A%84%E6%8E%A7%E5%88%B6"><span class="nav-number">6.0.2.</span> <span class="nav-text">对属性操作的控制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95%E8%A1%A5%E5%85%85-%E4%BA%86%E8%A7%A3"><span class="nav-number">6.0.3.</span> <span class="nav-text">对象方法补充(了解)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-number">6.0.4.</span> <span class="nav-text">构造函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B"><span class="nav-number">6.0.5.</span> <span class="nav-text">原型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E9%93%BE"><span class="nav-number">6.0.6.</span> <span class="nav-text">原型链</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF"><span class="nav-number">6.0.7.</span> <span class="nav-text">继承</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%BB%A7%E6%89%BF%E6%96%B9%E6%A1%88"><span class="nav-number">6.0.7.1.</span> <span class="nav-text">原型链继承方案</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%80%9F%E7%94%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%BB%A7%E6%89%BF%E6%96%B9%E6%A1%88"><span class="nav-number">6.0.7.2.</span> <span class="nav-text">借用构造函数继承方案</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AF%84%E7%94%9F%E5%BC%8F%E7%BB%A7%E6%89%BF%E6%96%B9%E6%A1%88"><span class="nav-number">6.0.7.3.</span> <span class="nav-text">寄生式继承方案</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AF%84%E7%94%9F%E7%BB%84%E5%90%88%E5%BC%8F%E7%BB%A7%E6%89%BF%E6%96%B9%E6%A1%88"><span class="nav-number">6.0.7.4.</span> <span class="nav-text">寄生组合式继承方案</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#JS-%E5%8E%9F%E5%9E%8B%E7%9B%B8%E5%85%B3%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95"><span class="nav-number">6.0.8.</span> <span class="nav-text">JS 原型相关判断方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1-%E5%87%BD%E6%95%B0-%E5%8E%9F%E5%9E%8B%E5%85%B3%E7%B3%BB"><span class="nav-number">6.0.9.</span> <span class="nav-text">对象-函数-原型关系</span></a></li></ol></li></ol><li class="nav-item nav-level-3"><a class="nav-link" href="#ES6"><span class="nav-number">7.</span> <span class="nav-text">ES6+</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ES6-1"><span class="nav-number">7.1.</span> <span class="nav-text">ES6</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%B1%BB"><span class="nav-number">7.1.1.</span> <span class="nav-text">类</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-class-%E6%9D%A5%E5%AE%9A%E4%B9%89%E7%B1%BB"><span class="nav-number">7.1.1.1.</span> <span class="nav-text">使用 class 来定义类</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-number">7.1.1.2.</span> <span class="nav-text">类的构造函数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%B1%BB%E4%B8%AD%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95"><span class="nav-number">7.1.1.3.</span> <span class="nav-text">类中定义方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF"><span class="nav-number">7.1.1.4.</span> <span class="nav-text">类的继承</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF%E5%86%85%E7%BD%AE%E7%B1%BB"><span class="nav-number">7.1.1.5.</span> <span class="nav-text">继承内置类</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AD%97%E9%9D%A2%E9%87%8F%E5%A2%9E%E5%BC%BA"><span class="nav-number">7.1.2.</span> <span class="nav-text">字面量增强</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E6%9E%84"><span class="nav-number">7.1.3.</span> <span class="nav-text">解构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#let-const"><span class="nav-number">7.1.4.</span> <span class="nav-text">let&#x2F;const</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">7.1.5.</span> <span class="nav-text">模板字符串</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">7.1.6.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B1%95%E5%BC%80%E8%AF%AD%E6%B3%95"><span class="nav-number">7.1.7.</span> <span class="nav-text">展开语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E5%80%BC%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="nav-number">7.1.8.</span> <span class="nav-text">数值的表示</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Symbol"><span class="nav-number">7.1.9.</span> <span class="nav-text">Symbol</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Set"><span class="nav-number">7.1.10.</span> <span class="nav-text">Set</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WeakSet"><span class="nav-number">7.1.11.</span> <span class="nav-text">WeakSet</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Map"><span class="nav-number">7.1.12.</span> <span class="nav-text">Map</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WeakMap"><span class="nav-number">7.1.13.</span> <span class="nav-text">WeakMap</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ES7"><span class="nav-number">7.2.</span> <span class="nav-text">ES7</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Array-Includes"><span class="nav-number">7.2.1.</span> <span class="nav-text">Array Includes</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8C%87%E6%95%B0%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">7.2.2.</span> <span class="nav-text">指数运算符</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ES8"><span class="nav-number">7.3.</span> <span class="nav-text">ES8</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Object-values"><span class="nav-number">7.3.1.</span> <span class="nav-text">Object.values</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Object-entries"><span class="nav-number">7.3.2.</span> <span class="nav-text">Object.entries</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#String-Padding"><span class="nav-number">7.3.3.</span> <span class="nav-text">String Padding</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Object-Descripts"><span class="nav-number">7.3.4.</span> <span class="nav-text">Object Descripts</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Object-assign-ES6"><span class="nav-number">7.3.5.</span> <span class="nav-text">Object.assign(ES6)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ES9"><span class="nav-number">7.4.</span> <span class="nav-text">ES9</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ES10"><span class="nav-number">7.5.</span> <span class="nav-text">ES10</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#flat-flatMap"><span class="nav-number">7.5.1.</span> <span class="nav-text">flat flatMap</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Object-fromEntries"><span class="nav-number">7.5.2.</span> <span class="nav-text">Object.fromEntries</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#trimStart%E3%80%81trimEnd"><span class="nav-number">7.5.3.</span> <span class="nav-text">trimStart、trimEnd</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-number">7.5.4.</span> <span class="nav-text">其它知识点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ES11"><span class="nav-number">7.6.</span> <span class="nav-text">ES11</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#BigInt"><span class="nav-number">7.6.1.</span> <span class="nav-text">BigInt</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A9%BA%E5%80%BC%E5%90%88%E5%B9%B6%E8%BF%90%E7%AE%97"><span class="nav-number">7.6.2.</span> <span class="nav-text">空值合并运算 ??</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%AF%E9%80%89%E9%93%BE"><span class="nav-number">7.6.3.</span> <span class="nav-text">可选链 ?.</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Global-This"><span class="nav-number">7.6.4.</span> <span class="nav-text">Global This</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#for-in-%E6%A0%87%E5%87%86%E5%8C%96"><span class="nav-number">7.6.5.</span> <span class="nav-text">for in 标准化</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#matchAll"><span class="nav-number">7.6.6.</span> <span class="nav-text">matchAll</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E7%9F%A5%E8%AF%86%E7%82%B9-1"><span class="nav-number">7.6.7.</span> <span class="nav-text">其它知识点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ES12"><span class="nav-number">7.7.</span> <span class="nav-text">ES12</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#FinalizationRegistry"><span class="nav-number">7.7.1.</span> <span class="nav-text">FinalizationRegistry</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WeakRef"><span class="nav-number">7.7.2.</span> <span class="nav-text">WeakRef</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E7%9F%A5%E8%AF%86%E7%82%B9-2"><span class="nav-number">7.7.3.</span> <span class="nav-text">其它知识点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Proxy-Reflect"><span class="nav-number">8.</span> <span class="nav-text">Proxy-Reflect</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">8.1.</span> <span class="nav-text">基本使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Proxy-%E5%85%B6%E5%AE%83%E6%8D%95%E8%8E%B7%E5%99%A8"><span class="nav-number">8.2.</span> <span class="nav-text">Proxy 其它捕获器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reflect-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">8.3.</span> <span class="nav-text">Reflect 的作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86"><span class="nav-number">8.4.</span> <span class="nav-text">响应式原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Vue3"><span class="nav-number">8.4.1.</span> <span class="nav-text">Vue3</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#vue2"><span class="nav-number">8.4.2.</span> <span class="nav-text">vue2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Promise"><span class="nav-number">9.</span> <span class="nav-text">Promise</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#resolve-%E8%AF%A6%E8%A7%A3"><span class="nav-number">9.1.</span> <span class="nav-text">resolve 详解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95-then"><span class="nav-number">9.2.</span> <span class="nav-text">实例方法-then</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95-catch"><span class="nav-number">9.3.</span> <span class="nav-text">实例方法-catch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95-finally"><span class="nav-number">9.4.</span> <span class="nav-text">实例方法-finally</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B1%BB%E6%96%B9%E6%B3%95-resolve"><span class="nav-number">9.5.</span> <span class="nav-text">类方法-resolve</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B1%BB%E6%96%B9%E6%B3%95-reject"><span class="nav-number">9.6.</span> <span class="nav-text">类方法-reject</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B1%BB%E6%96%B9%E6%B3%95-all"><span class="nav-number">9.7.</span> <span class="nav-text">类方法-all</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B1%BB%E6%96%B9%E6%B3%95-allSettled"><span class="nav-number">9.8.</span> <span class="nav-text">类方法-allSettled</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B1%BB%E6%96%B9%E6%B3%95-race"><span class="nav-number">9.9.</span> <span class="nav-text">类方法-race</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B1%BB%E6%96%B9%E6%B3%95-any"><span class="nav-number">9.10.</span> <span class="nav-text">类方法-any</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%8B%E5%86%99-Promise"><span class="nav-number">9.11.</span> <span class="nav-text">手写 Promise</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#then-%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="nav-number">9.11.1.</span> <span class="nav-text">then 方法实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#catch-%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="nav-number">9.11.2.</span> <span class="nav-text">catch 方法实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#finally-%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="nav-number">9.11.3.</span> <span class="nav-text">finally 方法实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#resolve-%E5%92%8C-reject-%E7%B1%BB%E6%96%B9%E6%B3%95"><span class="nav-number">9.11.4.</span> <span class="nav-text">resolve 和 reject 类方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#all-%E5%92%8C-allSettled-%E6%96%B9%E6%B3%95"><span class="nav-number">9.11.5.</span> <span class="nav-text">all 和 allSettled 方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#race-%E5%92%8C-any-%E6%96%B9%E6%B3%95"><span class="nav-number">9.11.6.</span> <span class="nav-text">race 和 any 方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">10.</span> <span class="nav-text">迭代器和生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">10.1.</span> <span class="nav-text">迭代器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8-1"><span class="nav-number">10.1.1.</span> <span class="nav-text">迭代器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1"><span class="nav-number">10.1.2.</span> <span class="nav-text">可迭代对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8E%9F%E7%94%9F%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%AF%B9%E8%B1%A1"><span class="nav-number">10.1.3.</span> <span class="nav-text">原生迭代器对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E7%9A%84%E8%BF%AD%E4%BB%A3"><span class="nav-number">10.1.4.</span> <span class="nav-text">自定义类的迭代</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">10.2.</span> <span class="nav-text">生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0"><span class="nav-number">10.2.1.</span> <span class="nav-text">生成器函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">10.2.2.</span> <span class="nav-text">生成器函数执行流程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%85%B6%E5%AE%83%E6%96%B9%E6%B3%95%E4%BD%BF%E7%94%A8"><span class="nav-number">10.2.3.</span> <span class="nav-text">生成器其它方法使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E6%9B%BF%E4%BB%A3%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">10.2.4.</span> <span class="nav-text">生成器替代迭代器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E5%BC%82%E6%AD%A5%E9%A1%BA%E5%BA%8F%E8%B0%83%E7%94%A8"><span class="nav-number">10.2.5.</span> <span class="nav-text">多个异步顺序调用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aync-await"><span class="nav-number">11.</span> <span class="nav-text">aync&#x2F;await</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0"><span class="nav-number">11.1.</span> <span class="nav-text">异步函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#await-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-number">11.2.</span> <span class="nav-text">await 关键字</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="nav-number">12.</span> <span class="nav-text">事件循环</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B"><span class="nav-number">12.1.</span> <span class="nav-text">进程和线程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="nav-number">12.2.</span> <span class="nav-text">浏览器的事件循环</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BE%AE%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%AE%8F%E4%BB%BB%E5%8A%A1"><span class="nav-number">12.3.</span> <span class="nav-text">微任务和宏任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98-1"><span class="nav-number">12.4.</span> <span class="nav-text">面试题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Node-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="nav-number">12.5.</span> <span class="nav-text">Node 事件循环</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88"><span class="nav-number">13.</span> <span class="nav-text">错误处理方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF"><span class="nav-number">13.1.</span> <span class="nav-text">抛出错误</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7"><span class="nav-number">13.2.</span> <span class="nav-text">异常捕获</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="nav-number">14.</span> <span class="nav-text">模块化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#commonJS"><span class="nav-number">14.1.</span> <span class="nav-text">commonJS</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-1"><span class="nav-number">14.1.1.</span> <span class="nav-text">基本使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#require"><span class="nav-number">14.1.2.</span> <span class="nav-text">require</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="nav-number">14.1.3.</span> <span class="nav-text">模块的加载过程</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ES-Module"><span class="nav-number">14.2.</span> <span class="nav-text">ES Module</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA"><span class="nav-number">14.2.1.</span> <span class="nav-text">导入导出</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#import-%E5%87%BD%E6%95%B0"><span class="nav-number">14.2.2.</span> <span class="nav-text">import 函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ES-Module-%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B"><span class="nav-number">14.2.3.</span> <span class="nav-text">ES Module 解析流程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="nav-number">15.</span> <span class="nav-text">包管理工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#npm-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">15.1.</span> <span class="nav-text">npm 配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E7%9A%84%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="nav-number">15.2.</span> <span class="nav-text">依赖的版本管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#npm-install-%E5%91%BD%E4%BB%A4"><span class="nav-number">15.3.</span> <span class="nav-text">npm install 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#npm-install-%E5%8E%9F%E7%90%86"><span class="nav-number">15.4.</span> <span class="nav-text">npm install 原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#package-lock-json"><span class="nav-number">15.5.</span> <span class="nav-text">package-lock.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#npm-%E5%85%B6%E5%AE%83%E5%91%BD%E4%BB%A4"><span class="nav-number">15.6.</span> <span class="nav-text">npm 其它命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#yarn-%E5%B7%A5%E5%85%B7"><span class="nav-number">15.7.</span> <span class="nav-text">yarn 工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cnpm"><span class="nav-number">15.8.</span> <span class="nav-text">cnpm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#npx-%E5%B7%A5%E5%85%B7"><span class="nav-number">15.9.</span> <span class="nav-text">npx 工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#npm-%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8C%85"><span class="nav-number">15.10.</span> <span class="nav-text">npm 发布自己的包</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSON-%E5%92%8C%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="nav-number">16.</span> <span class="nav-text">JSON 和数据存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JSON"><span class="nav-number">16.1.</span> <span class="nav-text">JSON</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JSON-%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E8%A7%A3%E6%9E%90"><span class="nav-number">16.1.1.</span> <span class="nav-text">JSON 序列化和解析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%A9%E7%94%A8-json-%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E8%A7%A3%E6%9E%90%E5%81%9A%E6%B7%B1%E6%8B%B7%E8%B4%9D"><span class="nav-number">16.1.2.</span> <span class="nav-text">利用 json 的序列化和解析做深拷贝</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AD%98%E5%82%A8"><span class="nav-number">16.2.</span> <span class="nav-text">浏览器存储</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Storage"><span class="nav-number">16.2.1.</span> <span class="nav-text">Storage</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IndexedDB"><span class="nav-number">16.2.2.</span> <span class="nav-text">IndexedDB</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Cookie"><span class="nav-number">16.2.3.</span> <span class="nav-text">Cookie</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BOM-DOM"><span class="nav-number">17.</span> <span class="nav-text">BOM-DOM</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#BOM"><span class="nav-number">17.1.</span> <span class="nav-text">BOM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DOM"><span class="nav-number">17.2.</span> <span class="nav-text">DOM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="nav-number">17.3.</span> <span class="nav-text">事件监听</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1"><span class="nav-number">17.4.</span> <span class="nav-text">内置对象</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Number-%E6%95%B0%E5%AD%97%E5%AF%B9%E8%B1%A1"><span class="nav-number">17.4.1.</span> <span class="nav-text">Number 数字对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#String-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E8%B1%A1"><span class="nav-number">17.4.2.</span> <span class="nav-text">String 字符串对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Date-%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1"><span class="nav-number">17.4.3.</span> <span class="nav-text">Date 日期对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Array-%E6%95%B0%E7%BB%84%E5%AF%B9%E8%B1%A1"><span class="nav-number">17.4.4.</span> <span class="nav-text">Array 数组对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Boolean-%E5%B8%83%E5%B0%94%E5%AF%B9%E8%B1%A1"><span class="nav-number">17.4.5.</span> <span class="nav-text">Boolean 布尔对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Math-%E7%AE%97%E6%95%B0%E5%AF%B9%E8%B1%A1"><span class="nav-number">17.4.6.</span> <span class="nav-text">Math 算数对象</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%88%A4%E6%96%AD"><span class="nav-number">17.5.</span> <span class="nav-text">数据类型和判断</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81"><span class="nav-number">18.</span> <span class="nav-text">防抖和节流</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5"><span class="nav-number">18.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%B2%E6%8A%96%E5%87%BD%E6%95%B0"><span class="nav-number">18.2.</span> <span class="nav-text">防抖函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8A%82%E6%B5%81%E5%87%BD%E6%95%B0"><span class="nav-number">18.3.</span> <span class="nav-text">节流函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D"><span class="nav-number">19.</span> <span class="nav-text">深拷贝</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF"><span class="nav-number">20.</span> <span class="nav-text">事件总线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%8B%E5%86%99-flat"><span class="nav-number">21.</span> <span class="nav-text">手写 flat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E4%BA%A4%E5%B9%B6%E5%B7%AE"><span class="nav-number">22.</span> <span class="nav-text">数组交并差</span></a></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="很帅很愁人~" src="/images/my.jpg"><p class="site-author-name" itemprop="name">很帅很愁人~</p><div class="site-description" itemprop="description">梦是一种欲望, 想是一种行动。梦想是梦与想的结晶，加油打工人~~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">202</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">46</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">115</span> <span class="site-state-item-name">标签</span></a></div></nav></div></div><script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script><script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script><div class="widget-wrap"><div id="myCanvasContainer" class="widget tagcloud"><canvas width="250" height="250" id="resCanvas"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ArryaBuffer/" rel="tag">ArryaBuffer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MarkDown/" rel="tag">MarkDown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Promise/" rel="tag">Promise</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Recorder/" rel="tag">Recorder</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS/" rel="tag">TS</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UDP/" rel="tag">UDP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/V8/" rel="tag">V8</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VueRouter/" rel="tag">VueRouter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vuex/" rel="tag">Vuex</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebStorage/" rel="tag">WebStorage</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/api%E9%9B%86%E4%B8%AD%E7%AE%A1%E7%90%86/" rel="tag">api集中管理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apply/" rel="tag">apply</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/axios/" rel="tag">axios</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bind/" rel="tag">bind</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/call/" rel="tag">call</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cli/" rel="tag">cli</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cors/" rel="tag">cors</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css3/" rel="tag">css3</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/drag/" rel="tag">drag</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ejsexcel/" rel="tag">ejsexcel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/" rel="tag">electron</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/element/" rel="tag">element</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/" rel="tag">es6</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/excel%E5%AF%BC%E5%87%BA/" rel="tag">excel导出</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/filter/" rel="tag">filter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flex/" rel="tag">flex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/getters/" rel="tag">getters</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grid/" rel="tag">grid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/host/" rel="tag">host</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/" rel="tag">html5</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jenkins/" rel="tag">jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a><span class="tag-list-count">78</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" rel="tag">js基础语法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js%E6%93%8D%E4%BD%9C%E7%AC%A6/" rel="tag">js操作符</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lottie/" rel="tag">lottie</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/media/" rel="tag">media</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/messageChannel/" rel="tag">messageChannel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/miniVue/" rel="tag">miniVue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mitt/" rel="tag">mitt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mock/" rel="tag">mock</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nextTick/" rel="tag">nextTick</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/print/" rel="tag">print</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/promise/" rel="tag">promise</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a><span class="tag-list-count">25</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/recorder/" rel="tag">recorder</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ref/" rel="tag">ref</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rem/" rel="tag">rem</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/require-context/" rel="tag">require.context</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reuqest/" rel="tag">reuqest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/router/" rel="tag">router</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scss/" rel="tag">scss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sessionStorage/" rel="tag">sessionStorage</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/slot/" rel="tag">slot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stackoverflow/" rel="tag">stackoverflow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tailwind/" rel="tag">tailwind</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/this/" rel="tag">this</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/three/" rel="tag">three</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ts/" rel="tag">ts</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uniapp/" rel="tag">uniapp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utils/" rel="tag">utils</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vueRouter/" rel="tag">vueRouter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuex/" rel="tag">vuex</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vw/" rel="tag">vw</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-worker/" rel="tag">web worker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web%E6%89%93%E5%8D%B0/" rel="tag">web打印</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/worker/" rel="tag">worker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xlsx/" rel="tag">xlsx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yarn/" rel="tag">yarn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%98%E5%8C%96/" rel="tag">优化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/" rel="tag">分库分表</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%9D%E5%BF%83/" rel="tag">初心</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A8%E7%94%BB%E5%BA%93/" rel="tag">动画库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%9F%E5%9E%8B%E4%B8%8E%E5%8E%9F%E5%9E%8B%E9%93%BE/" rel="tag">原型与原型链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/" rel="tag">发布订阅</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">可视化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" rel="tag">多文件下载</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E5%B1%8F/" rel="tag">大屏</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2/" rel="tag">媒体查询</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E8%8A%82%E5%BA%8F/" rel="tag">字节序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%81%E8%A3%85%E8%AF%B7%E6%B1%82/" rel="tag">封装请求</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">小程序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B1%85%E4%B8%AD%E5%AF%B9%E9%BD%90/" rel="tag">居中对齐</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">微信小程序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%83%E5%BE%97/" rel="tag">心得</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/" rel="tag">性能监控</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8B%96%E6%8B%BD/" rel="tag">拖拽</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%92%E6%A7%BD/" rel="tag">插槽</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" rel="tag">文件下载</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%9B%E5%9E%8B/" rel="tag">泛型</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%B8%E5%86%8C/" rel="tag">相册</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" rel="tag">移动端常见问题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%84%9A%E6%89%8B%E6%9E%B6/" rel="tag">脚手架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/" rel="tag">自动化部署</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E9%80%82%E5%BA%94/" rel="tag">自适应</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%83%E8%AF%95/" rel="tag">调试</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%A8%E5%9F%9F/" rel="tag">跨域</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7/" rel="tag">辅助工具</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/" rel="tag">进程和线程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%82%A3%E4%BA%9B%E5%B9%B4%E5%81%9A%E8%BF%87%E7%9A%84%E9%A1%B9%E7%9B%AE/" rel="tag">那些年做过的项目</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%83%A8%E7%BD%B2/" rel="tag">部署</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a><span class="tag-list-count">1</span></li></ul></canvas></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><span class="exturl" data-url="aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==">豫ICP备19017003号-1 </span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://blog.img.wy1991.cn/static/images/ga.png" style="display:inline-block"></div><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">很帅很愁人~</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var e,t,o,n,r,a=document.getElementsByTagName("link");if(0<a.length)for(i=0;i<a.length;i++)"canonical"==a[i].rel.toLowerCase()&&a[i].href&&(e=a[i].href);t=e?e.split(":")[0]:window.location.protocol.split(":")[0],e=e||window.location.href,window,n=e,r=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(n)||(o="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",r?(o+="?r="+encodeURIComponent(document.referrer),n&&(o+="&l="+n)):n&&(o+="?l="+n),(new Image).src=o)}()</script><script src="/js/local-search.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f65cb40e9a5d20342ae8b58def42ea5f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.name="baidu_tongji";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}()</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:null,display:{position:"left",width:150,height:300},mobile:{show:!1},log:!1})</script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:3,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=r[a].getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var e=r[a],t=e,n=function(){r=r.filter(function(t){return e!==t})},i=new Image,o=t.getAttribute("data-original");i.onload=function(){t.src=o,n()},t.src!==o&&(i.src=o)}()}o(),n.addEventListener("scroll",function(){var t=o,e=n;clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html>